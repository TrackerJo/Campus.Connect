import{j as e,r as c,c as G}from"./index-CKNi8vpN.js";import{B as C,w as v,F as g,k as b,r as K,G as q,H as z,I as Q,J as V,K as X}from"./db-DROJG-1T.js";import{T as Y}from"./trash-BnpXJPEK.js";function Z({conflict:s,canDelete:o,onDelete:h,setConflict:m}){return e.jsx("div",{className:"ConflictDateTile",id:"conflict-date-tile-"+s.date.date.toISOString(),children:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"ConflictDateNameDiv",children:[e.jsx("label",{htmlFor:"Character",children:"Date: "}),e.jsx("input",{type:"date",value:s.date.date.toISOString().slice(0,10),onChange:n=>{const l=new Date(n.target.value);l.setHours(0,0,0,0),m(C.fromBlank(v.fromBlank(l,s.date.from,s.date.to),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Actor",children:"From: "}),e.jsx("input",{type:"time",value:s.date.from.toTimeString().slice(0,5),onChange:n=>{console.log(n.target.value);const l=new Date,d=n.target.value.split(":");l.setHours(parseInt(d[0]),parseInt(d[1]),0,0),m(C.fromBlank(v.fromBlank(s.date.date,l,s.date.to),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Actor",children:"To: "}),e.jsx("input",{type:"time",value:s.date.to.toTimeString().slice(0,5),onChange:n=>{console.log(n.target.value);const l=new Date,d=n.target.value.split(":");l.setHours(parseInt(d[0]),parseInt(d[1]),0,0),console.log({date:l}),m(C.fromBlank(v.fromBlank(s.date.date,s.date.from,l),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Character",children:"More Info: "}),e.jsx("input",{type:"text",value:s.moreInfo,onChange:n=>{m(C.fromBlank(v.fromBlank(s.date.date,s.date.from,s.date.to),n.target.value))}})]}),o&&e.jsx("div",{children:e.jsx("img",{src:Y,alt:"",className:"TrashIcon",onClick:()=>{h()}})})]})})}function _({minTime:s,maxTime:o,setConflict:h,dialogRef:m,close:n,date:l}){const[d,p]=c.useState(g.fromBlank(l,s,o,!0));return c.useEffect(()=>{p(g.fromBlank(l,s,o,!0))},[s,o,l]),e.jsxs("dialog",{ref:m,children:[e.jsx("h2",{children:"Add Conflict"}),e.jsxs("div",{className:"conflict-times",children:[e.jsx("label",{htmlFor:"",children:"From: "}),e.jsx("input",{type:"time",value:d.from.toTimeString().slice(0,5),onChange:f=>{const x=new Date,u=f.target.value.split(":");x.setHours(parseInt(u[0]),parseInt(u[1]),0,0),p(g.fromBlank(l,x,d.to,!0))}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"To: "}),e.jsx("input",{type:"time",value:d.to.toTimeString().slice(0,5),onChange:f=>{const x=new Date,u=f.target.value.split(":");x.setHours(parseInt(u[0]),parseInt(u[1]),0,0),p(g.fromBlank(l,d.from,x,!0))}}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{h(d)},children:"Add Conflict"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{n()},children:"Close"})]})]})}function R({conflict:s,conflictResponseDate:o,setConflict:h}){const m=c.useRef(null);return e.jsxs("div",{className:"ConflictDateFormTile",id:"conflict-date-form-tile-"+s.date.date.toISOString(),children:[e.jsx("div",{className:"header",children:e.jsxs("div",{className:"ConflictDateFormNameDiv",children:[e.jsxs("label",{htmlFor:"Character",children:["Date: ",s.date.date.toDateString()]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["From: ",s.date.from.toLocaleTimeString()," "]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["To: ",s.date.to.toLocaleTimeString()]}),e.jsx("br",{}),s.moreInfo!=""&&e.jsxs("label",{htmlFor:"Character",children:["More Info: ",s.moreInfo]})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Can attend rehersal: "}),e.jsx("input",{type:"checkbox",checked:o==null?void 0:o.canAttend,onChange:n=>{h(g.fromBlank(s.date.date,null,null,n.target.checked))}})]}),(o==null?void 0:o.from)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Conflict:"}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"",children:["From: ",o.from.toLocaleTimeString()]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"",children:["To: ",o.to.toLocaleTimeString()]})]}),e.jsx("br",{})]}),(o==null?void 0:o.canAttend)&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var n;(n=m.current)==null||n.showModal()},children:o!=null&&o.from?"Edit Conflict":"Add Conflict"}),e.jsx(_,{minTime:s.date.from,maxTime:s.date.to,setConflict:n=>{var l;h(g.fromBlank(s.date.date,n.from,n.to,!0)),(l=m.current)==null||l.close()},date:s.date.date,dialogRef:m,close:()=>{var n;(n=m.current)==null||n.close()}})]})}G(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(ee,{})}));function ee(){var M;const[s,o]=c.useState(""),[h,m]=c.useState(""),[n,l]=c.useState(),[d,p]=c.useState(null),[f,x]=c.useState(null),[u,L]=c.useState(null),[N,O]=c.useState(null),[D,F]=c.useState([]),[I,y]=c.useState([]),[J,A]=c.useState("setDates"),[B,w]=c.useState(!1),[T,W]=c.useState("student"),[k,E]=c.useState([]),[H,P]=c.useState(!0),[te,U]=c.useState(null);return c.useEffect(()=>{const a=new URLSearchParams(window.location.search),t=a.get("activityId");t&&o(t);const r=a.get("showId");r&&m(r);const i=localStorage.getItem("show-"+r);i&&(l(b.fromMap(JSON.parse(i))),console.log(b.fromMap(JSON.parse(i))),K(t,r).then(S=>{E(S),console.log(S)}));const j=localStorage.getItem("accountType");if(j&&(W(j),j=="student"&&i&&b.fromMap(JSON.parse(i)).conflictForm)){const S=[];b.fromMap(JSON.parse(i)).conflictForm.dates.map($=>{S.push(g.fromBlank($.date.date,null,null,!1))}),y(S)}},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Conflict Form"})}),e.jsxs("div",{className:"center",children:[!(n!=null&&n.conflictForm)&&T=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Create Conflict Form"}),e.jsx("br",{}),J=="setDates"?e.jsxs(e.Fragment,{children:[" ",e.jsx("label",{children:"Start Date"}),e.jsx("input",{type:"date",onChange:a=>{console.log(new Date(a.target.value));const t=new Date(a.target.value);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),p(t)}}),e.jsx("br",{}),e.jsx("label",{children:"End Date"}),e.jsx("input",{type:"date",onChange:a=>{const t=new Date(a.target.value);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),x(t)}}),e.jsx("br",{}),e.jsx("label",{children:"Default Rehersal Start Time"}),e.jsx("input",{type:"time",onChange:a=>{console.log(a.target.value);const t=new Date,r=a.target.value.split(":");t.setHours(parseInt(r[0]),parseInt(r[1]),0,0),L(t),console.log({date:t})}}),e.jsx("br",{}),e.jsx("label",{children:"Default Rehersal End Time"}),e.jsx("input",{type:"time",onChange:a=>{console.log(a.target.value);const t=new Date,r=a.target.value.split(":");t.setHours(parseInt(r[0]),parseInt(r[1]),0,0),O(t),console.log({date:t})}}),e.jsx("br",{}),e.jsx("label",{children:"Exclude Weekends"}),e.jsx("input",{type:"checkbox",checked:H,onChange:a=>{P(a.target.checked)}}),e.jsx("br",{}),e.jsx("label",{children:"Form Deadline"}),e.jsx("input",{type:"time",onChange:a=>{console.log(a.target.value);const t=new Date,r=a.target.value.split(":");t.setHours(parseInt(r[0]),parseInt(r[1]),0,0),U(t),console.log({date:t})}}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{if(d&&f&&u&&N){const a=[],t=new Date(d);for(console.log("Start Date"),console.log(t);t<=f;)if(console.log(t),a.push(C.fromBlank(v.fromBlank(new Date(t),u,N),"")),t.setDate(t.getDate()+1),H)for(;t.getDay()==0||t.getDay()==6;)t.setDate(t.getDate()+1);F(a),A("editDates"),console.log(a)}},children:"Next"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"conflicts",children:D.map((a,t)=>e.jsx(Z,{conflict:a,canDelete:!0,onDelete:()=>{const r=[...D];r.splice(t,1),F(r)},setConflict:r=>{const i=[...D];i[t]=r,F(i)}},a.date.date.toISOString()))}),e.jsx("br",{}),B?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{w(!0);const a=b.fromMap(n.toMap());a.conflictForm=q.fromBlank(D,Date.now()),l(a),console.log(a),await z(s,h,a.conflictForm),w(!1)},children:"Save Conflict Form"}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{A("setDates"),F([])},children:"Back"})]})]}):T=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Conflict Form Responses"}),e.jsx("div",{className:"conflicts",children:k.map(a=>e.jsxs("div",{className:"conflict-response",children:[a.actor.name,e.jsx("br",{}),e.jsx("div",{className:"conflict-response-dates",children:a.dates.map(t=>t.canAttend?e.jsxs("div",{className:"conflict-response-date",children:[t.date.toDateString(),e.jsx("br",{}),t.from.toLocaleTimeString()," - ",t.to.toLocaleTimeString()]}):e.jsxs("div",{className:"conflict-response-date",children:[t.date.toDateString(),e.jsx("br",{}),"Can't Attend"]}))})]}))})]}):k.length==0?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Conflict Form"}),e.jsx("br",{}),e.jsx("p",{children:"Select can attend even if you can't make the full rehersal, just add a conflict"}),e.jsx("div",{className:"conflicts",children:(M=n==null?void 0:n.conflictForm)==null?void 0:M.dates.map((a,t)=>(console.log(a),e.jsx(R,{conflict:a,conflictResponseDate:I[t],setConflict:r=>{const i=[...I];console.log(i),i[t]=r,y(i)}})))}),e.jsx("br",{}),B?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{w(!0);const a=I.filter(j=>j.canAttend&&j.from||!j.canAttend),t=await Q(),r=V.fromBlank(a,"",t,s,h,Date.now());console.log(r),await X(s,h,r);const i=[...k];i.push(r),E(i),w(!1)},children:"Submit Conflict Form"})]}):e.jsx(e.Fragment,{children:e.jsx("h2",{children:"Already Submitted Conflict Form"})}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href=`/Campus.Connect/Activity/Shows/Show/?activityId=${s}&showId=${h}`},children:"Close"})]})]})}
