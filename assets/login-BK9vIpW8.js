import{c as he,j as e,r as a,a as pe,l as Y,s as ge,b as F,i as fe}from"./index-CBYUpoa4.js";import{c as L,a as ye,b as xe,g as Ce,d as je}from"./db-CHdH9QDA.js";import{T as we,E as _,C as q,a as Se,L as ve,G as Pe,S as Ie}from"./constants-CiIGZTLG.js";import{A as Ne}from"./Add_Location_Dialog-BZWBC07o.js";import"./distance-DNOHIura.js";he(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(be,{})}));function be(){const[i,A]=a.useState(""),[p,T]=a.useState(""),[j,s]=a.useState(!1),[x,W]=a.useState([]),[k,K]=a.useState([]),[S,E]=a.useState(""),[R,B]=a.useState(""),[J,y]=a.useState("accountType"),[m,D]=a.useState("student"),[v,U]=a.useState("LoginInfo"),[f,M]=a.useState(""),[l,h]=a.useState(""),[$,Q]=a.useState(""),[C,G]=a.useState(""),[P,X]=a.useState("");a.useState(""),a.useState(""),a.useState(""),a.useState("");const[O,ee]=a.useState(""),[I,te]=a.useState(""),[w,ae]=a.useState(void 0),[z,oe]=a.useState(void 0),[Fe,ne]=a.useState(void 0),N=a.useRef(null),[re,H]=a.useState("");a.useState(!1);const[le,Z]=a.useState(!1),[se,b]=a.useState(!1);async function ce(t){const o={lat:0,lon:0},r="",c=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const n=await F(i,p);if(console.log(n),!n){alert("Error creating account");return}const d=ve.fromBlank("home",r,new Pe(o.lat,o.lon),!1),u=Ie.fromBlank(n,t.schoolId,"unknown",c,"","student",l.replace("none",""),$,"unknown",f.toLowerCase().trim(),f.trim(),i.trim(),{},d);await L("student",u),localStorage.setItem("accountType","student");const V=new URLSearchParams(window.location.search).get("redirect");V?window.location.href=V.replace(/~/g,"&"):window.location.href="/",s(!1)}return a.useEffect(()=>{async function t(){await fe(d=>{if(d&&localStorage.getItem("accountType")!=null){const g=new URLSearchParams(window.location.search).get("redirect");g?window.location.href=g.replace(/~/g,"&"):window.location.href="/"}});const o=await Ce();W(o);const r=await je();console.log(r),K(r);const c=localStorage.getItem("schoolId");c&&c!=""?B(c):B(o[0].schoolId);const n=localStorage.getItem("companyId");n&&n!=""?E(n):r.length>0&&(console.log(r[0].id),E(r[0].id))}t()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:J=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{D("student"),y("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{D("teacher"),y("login")},children:"Teacher"}),e.jsx("button",{className:"actionBtn",onClick:()=>{D("employer"),y("login")},children:"Employer"})]}):J=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",value:i,onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{T(t.target.value)}}),e.jsx("label",{htmlFor:"",className:"forgotPassword",onClick:()=>{y("forgotPassword")},children:"Forgot Password?"}),e.jsxs("label",{htmlFor:"",children:["Select your ",m!="employer"?"School":"Company"]}),m!="employer"?e.jsx("select",{onChange:t=>{B(t.target.value)},value:R,children:x.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}):e.jsx("select",{onChange:t=>{E(t.target.value)},value:S,children:k.map(t=>e.jsx("option",{value:t.id,children:t.name}))}),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await pe(i,p,R,S)){s(!1),alert("Wrong email or password");return}const o=localStorage.getItem("userId");if(m=="employer"){const n=k.find(u=>u.id==S);if(console.log(n),console.log(S),!n){s(!1),alert("Error logging in as employer");return}if(!n.employers.find(u=>u.uid==o)){s(!1),alert("You are not in this company"),await Y();return}}else{let n=!1;const d=x.find(u=>u.schoolId==R);if(!d){s(!1),alert("Error logging in");return}if(m=="teacher"?d.teachers.find(g=>g.uid==o)&&(n=!0):d.students.find(g=>g.uid==o)&&(n=!0),!n){s(!1),alert("You are not in this school"),await Y();return}}localStorage.setItem("accountType",m),console.log("Logging in as "+m);const c=new URLSearchParams(window.location.search).get("redirect");c?window.location.href=c.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Login"}),e.jsxs("p",{children:[e.jsx("label",{htmlFor:"",className:"info",onClick:()=>{},children:"Don't have an account? "}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{y("createAccount")},children:"Click here to create an account!"})]}),e.jsxs("p",{children:[e.jsxs("label",{htmlFor:"",className:"info",onClick:()=>{},children:["Signing in as a ",m,", "]}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{y("accountType")},children:"back?"})]})]}):J=="forgotPassword"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Forgot Password"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{H(t.target.value)}}),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await ge(re)){alert("Error sending email"),s(!1);return}H(""),alert("Email sent"),y("login"),s(!1)},children:"Send Password Request Email"})]}):m=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{M(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{h(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{T(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{G(t.target.value)}}),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),f==""){alert("Please enter your full name");return}if(i==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(i)){alert("Invalid email");return}if(l==""){alert("Please enter your phone number, if you don't have one, type none");return}h(l.replace(/-/g,"")),h(l.replace(/ /g,"")),h(l.replace(/\(/g,"")),h(l.replace(/\)/g,""));const o=/^\d{10}$/;if(l!="none"&&!o.test(l)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if(C==""){alert("Please enter your school code");return}const r=x.find(g=>g.schoolTeacherCode==C);if(!r){alert("Invalid School Code");return}localStorage.setItem("schoolId",r.schoolId);const c=we.fromBlank("",r.schoolId,l.replace("none",""),"","teacher",f.toLowerCase().trim(),f.trim(),i.trim()),n=await F(i,p);if(!n){alert("Error creating account");return}c.uid=n,await L("teacher",c),localStorage.setItem("accountType","teacher");const u=new URLSearchParams(window.location.search).get("redirect");u?window.location.href=u.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Create Account"})]}):v=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),ie(),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:()=>{if(f==""){alert("Please enter your full name");return}if(i==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(i)){alert("Invalid email");return}if(l==""){alert("Please enter your phone number, if you don't have one, type none");return}h(l.replace(/-/g,"")),h(l.replace(/ /g,"")),h(l.replace(/\(/g,"")),h(l.replace(/\)/g,""));const o=/^\d{10}$/;if(l!="none"&&!o.test(l)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if($==""&&m!="employer"){alert("Please select your sex");return}const r=x.find(c=>c.schoolDomain==i.split("@")[1]);if(r!=null){s(!0),ce(r);return}if(m=="employer"){U("CreateOrJoinCompany");return}U("SchoolCode")},children:"Next"})]}):v=="HomeAddress"?e.jsx(e.Fragment,{}):v=="CreateOrJoinCompany"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),ue()]}):v=="CreateCompany"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),me()]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),de(),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{s(!0);let t;if(C!=""?t=x.find(o=>o.schoolCode==C):t=x.find(o=>o.schoolDomain==P.split("@")[1]),t==null){C!=""&&P!=""?alert("Invalid School Code or a School Email"):P!=""?alert("Invalid School Email"):alert("Invalid School Code"),s(!1);return}},children:"Create Account"})]})})}),e.jsx(Ne,{addLocation:t=>{ae(t),N.current.close()},close:()=>{N.current.close()},dialogRef:N,savedLocations:[]})]});function ie(){return e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Please enter your full name!"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{M(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{T(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{h(t.target.value)}}),m!="employer"&&e.jsxs("select",{onChange:t=>{Q(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function de(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:C,onChange:t=>{G(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:P,onChange:t=>{X(t.target.value)}})]})}function ue(){return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"actionBtn",onClick:()=>{U("CreateCompany")},children:"Create a Company"}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"Compnay Join Code",value:O,onChange:t=>{ee(t.target.value)}}),se?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(O==""){alert("Please enter a company join code");return}b(!0);const t=k.find(d=>d.joinCode==O);if(!t){alert("Invalid join code"),b(!1);return}ne(t),localStorage.setItem("companyId",t.id);const o=await F(i,p);if(!o){alert("Error creating account: "+o),b(!1);return}const r=new _({uid:o,companyId:t.id,email:i,fullname:f,phoneNumber:l,accountType:"employer",FCMToken:""});await L("employer",r),localStorage.setItem("accountType","employer");const n=new URLSearchParams(window.location.search).get("redirect");n?window.location.href=n.replace(/~/g,"&"):window.location.href="/",b(!1)},children:"Join Company"})]})}function me(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Create a company"}),e.jsx("input",{type:"text",placeholder:"Company Name",value:I,onChange:t=>{te(t.target.value)}}),e.jsxs("div",{className:"form-element",children:[e.jsx("label",{htmlFor:"",children:"Company Location: "}),w?e.jsxs("label",{htmlFor:"",children:[w.name," (",w.address,")"]}):e.jsx("label",{htmlFor:"",children:"Location not set"}),e.jsx("button",{className:"actionBtn",onClick:()=>{N.current.showModal()},children:"Set Location"})]}),e.jsxs("div",{className:"form-element",children:[e.jsx("label",{htmlFor:"",children:"Company Type: "}),e.jsxs("select",{name:"companyType",id:"",value:z,onChange:t=>{oe(t.target.value)},children:[e.jsx("option",{value:void 0,selected:!0,children:"Select Company Type"}),e.jsx("option",{value:q.Job,children:"Job"}),e.jsx("option",{value:q.Volunteer,children:"Volunteer"})]})]}),le?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(I==""){alert("Please enter a company name");return}if(!w){alert("Please set a company location");return}if(!z){alert("Please select a company type");return}Z(!0);const t=new Se({name:I,location:w,employers:[],id:"",lastUpdated:Date.now(),type:z,joinCode:ye(I),savedLocations:[]}),o=await xe(t);localStorage.setItem("companyId",t.id);const r=await F(i,p);if(!r){alert("Error creating account: "+r),Z(!1);return}const c=new _({uid:r,companyId:o.id,email:i,fullname:f,phoneNumber:l,accountType:"employer",FCMToken:""});await L("employer",c),localStorage.setItem("accountType","employer");const d=new URLSearchParams(window.location.search).get("redirect");d?window.location.href=d.replace(/~/g,"&"):window.location.href="/",Z(!1)},children:"Create Company"})]})}}
