import{w as gt,x as i,y as c,z as M,q as x,g as b,B as k,H as v,d as Y,f as P,I as w,J as T,K as A,i as H,N as O,m as j,O as V,S as z,T as mt,P as F,Q as pt,U as G,u as It,r as E,V as ot,W as st,M as q,s as C,X as yt,p as _,Y as R,n as vt,L as rt}from"./constants-BaAdZBoe.js";import{h as wt,C as St,k as at,_ as Dt,d as Q,e as Tt,f as Mt,F as At,n as W,p as Ct,g as L}from"./index-BrfWEQze.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et="type.googleapis.com/google.protobuf.Int64Value",kt="type.googleapis.com/google.protobuf.UInt64Value";function lt(e,t){const o={};for(const s in e)e.hasOwnProperty(s)&&(o[s]=t(e[s]));return o}function K(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>K(t));if(typeof e=="function"||typeof e=="object")return lt(e,t=>K(t));throw new Error("Data cannot be encoded in JSON: "+e)}function B(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Et:case kt:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>B(t)):typeof e=="function"||typeof e=="object"?lt(e,t=>B(t)):e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends At{constructor(t,o,s){super(`${Z}/${t}`,o||""),this.details=s}}function Nt(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Ut(e,t){let o=Nt(e),s=o,a;try{const n=t&&t.error;if(n){const r=n.status;if(typeof r=="string"){if(!nt[r])return new U("internal","internal");o=nt[r],s=r}const l=n.message;typeof l=="string"&&(s=l),a=n.details,a!==void 0&&(a=B(a))}}catch{}return o==="ok"?null:new U(o,s,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(t,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||t.get().then(a=>this.auth=a,()=>{}),this.messaging||o.get().then(a=>this.messaging=a,()=>{}),this.appCheck||s.get().then(a=>this.appCheck=a,()=>{})}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return t==null?void 0:t.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.appCheck){const o=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(t){const o=await this.getAuthToken(),s=await this.getMessagingToken(),a=await this.getAppCheckToken(t);return{authToken:o,messagingToken:s,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X="us-central1";function Ft(e){let t=null;return{promise:new Promise((o,s)=>{t=setTimeout(()=>{s(new U("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class Lt{constructor(t,o,s,a,n=X,r){this.app=t,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new bt(o,s,a),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(n);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=X}catch{this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(t){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${o}.cloudfunctions.net/${t}`}}function Rt(e,t,o){e.emulatorOrigin=`http://${t}:${o}`}function Pt(e,t,o){return s=>_t(e,t,s,{})}async function Ot(e,t,o,s){o["Content-Type"]="application/json";let a;try{a=await s(e,{method:"POST",body:JSON.stringify(t),headers:o})}catch{return{status:0,json:null}}let n=null;try{n=await a.json()}catch{}return{status:a.status,json:n}}function _t(e,t,o,s){const a=e._url(t);return xt(e,a,o,s)}async function xt(e,t,o,s){o=K(o);const a={data:o},n={},r=await e.contextProvider.getContext(s.limitedUseAppCheckTokens);r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken);const l=s.timeout||7e4,g=Ft(l),u=await Promise.race([Ot(t,a,n,e.fetchImpl),g.promise,e.cancelAllRequests]);if(g.cancel(),!u)throw new U("cancelled","Firebase Functions instance was deleted.");const h=Ut(u.status,u.json);if(h)throw h;if(!u.json)throw new U("internal","Response is not valid JSON object.");let f=u.json.data;if(typeof f>"u"&&(f=u.json.result),typeof f>"u")throw new U("internal","Response is missing data field.");return{data:B(f)}}const ct="@firebase/functions",it="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gt="auth-internal",Bt="app-check-internal",$t="messaging-internal";function Jt(e,t){const o=(s,{instanceIdentifier:a})=>{const n=s.getProvider("app").getImmediate(),r=s.getProvider(Gt),l=s.getProvider($t),g=s.getProvider(Bt);return new Lt(n,r,l,g,a,e)};wt(new St(Z,o,"PUBLIC").setMultipleInstances(!0)),at(ct,it,t),at(ct,it,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(e=Mt(),t=X){const s=Dt(Q(e),Z).getImmediate({identifier:t}),a=Tt("functions");return a&&Ht(s,...a),s}function Ht(e,t,o){Rt(Q(e),t,o)}function tt(e,t,o){return Pt(Q(e),t)}Jt(fetch.bind(self));const jt=ut(W);function N(e,t,o,s){tt(jt,"sendEmail")({emails:t.map(a=>a.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:e.message,senderName:e.senderName})}const dt=ut(W),d=gt(W),ht=i(d,"schools"),Vt=async e=>{const t=c(ht,e);return(await M(t)).data()},zt=async()=>{const e=await w(ht),t=[];return e.forEach(o=>{t.push(o.data())}),t},Qt=async()=>{const e=localStorage.getItem("accountType"),t=localStorage.getItem("schoolId");if(!t)return[];const o=c(d,"schools",t);if(e=="student"){const s=T(i(o,"activities"),A("studentUids","array-contains",L())),a=[];return(await w(s)).forEach(r=>{a.push(b.fromMap(r.data()))}),a}else{const s=T(i(o,"activities"),A("teacherUids","array-contains",L())),a=[];return(await w(s)).forEach(r=>{console.log(r.data()),a.push(b.fromMap(r.data()))}),a}};async function qt(e){const t=localStorage.getItem("schoolId");if(!t)return null;const o=c(d,"schools",t),s=c(i(o,"activities"),e),a=await M(s);return a.exists()?a.data().type=="theater"?x.fromMap(a.data()):b.fromMap(a.data()):null}async function Wt(e){const t=localStorage.getItem("schoolId");if(!t)return"";const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=i(s,"shows"),n=await k(a,e.toMap());return e.id=n.id,await v(n,{id:n.id}),n.id}async function Zt(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=c(i(s,"shows"),e.id);await v(a,e.toMap())}async function te(e){await Ct("cmurphy@gmail.com","123456");const t=i(d,"showTemplates"),o=await k(t,e.toMap());e.id=o.id,await v(o,{id:o.id})}async function ee(e,t){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),a=c(i(s,"activities"),e),n=c(i(a,"shows"),t),r=await M(n);return r.exists()?(console.log(r.data()),Y.fromMap(r.data())):null}async function oe(e){const t=localStorage.getItem("schoolId");if(!t)return[];console.log("Getting actors for activity "+t);const o=c(d,"schools",t),s=c(i(o,"activities"),e),a=await M(s);if(!a.exists())return[];const n=[];return a.data().students.forEach(r=>{n.push(P.fromMap(r))}),n}async function se(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t);await O(r,o.toMap())}async function ae(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=i(s,"events"),n=await k(a,e.toMap());e.id=n.id,await v(n,{id:n.id})}async function ne(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(d,"schools",o),n=c(i(a,"activities"),e),r=i(n,"events");if(s=="student"){const l=await w(T(r,A("showId","==",t),A("targetUids","array-contains",L()))),g=[];return l.forEach(u=>{u.data().deleted||g.push(H.fromMap(u.data()))}),g}else{const l=await w(T(r,A("showId","==",t))),g=[];return l.forEach(u=>{u.data().deleted||g.push(H.fromMap(u.data()))}),g}}async function ce(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=c(i(s,"events"),e.id);await v(a,{deleted:!0}),await tt(dt,"startDeleteActivityEvent")({activityId:e.activityId,eventId:e.id,schoolId:t})}async function ie(e){const t=localStorage.getItem("schoolId");if(!t)return[];const o=c(d,"schools",t),s=c(i(o,"activities"),e),a=i(s,"shows"),n=await w(a),r=[];return n.forEach(l=>{r.push(Y.fromMap(l.data()))}),r}async function re(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t);await v(r,{conflictForm:o.toMap()}),await tt(dt,"addConflictFormDeadline")({activityId:e,showId:t,schoolId:s,deadline:o.deadline.toISOString()})}async function le(){const e=await L(),t=localStorage.getItem("schoolId");if(!t)return null;const o=c(d,"schools",t),s=i(o,"students"),a=c(s,e),n=await M(a);return n.exists()?P.fromMap(n.data()):null}async function ue(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t),l=c(r,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await O(l,o.toMap())}async function de(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(d,"schools",o),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t),l=i(r,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(L());const h=await w(T(l,A("submitterId","==",L()))),f=[];return h.forEach(S=>{f.push(j.fromMap(S.data()))}),f}const g=await w(l),u=[];return g.forEach(h=>{u.push(j.fromMap(h.data()))}),u}async function he(){const e=i(d,"showTemplates"),t=await w(e),o=[];return t.forEach(s=>{o.push(Y.fromMap(s.data()))}),o}async function fe(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+t+" UID: "+o+" AT: "+s),!t||!o||!s)return null;const a=c(d,"schools",t),n=T(i(a,"activities"),A("joinCode","==",e)),r=await w(n);if(r.empty)return null;const l=r.docs[0],g=c(i(a,s=="student"?"students":"teachers"),o),u=await M(g);if(console.log(u.data()),!u.exists())return null;if(l.data().studentUids.includes(o)||l.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),l.data().type=="theater"){if((u.data().gender==null||u.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),u.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(u.data().phoneNumber==""||u.data().gender==null||u.data().gender=="")&&s=="student")return null;if(s=="student")return await v(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,P.fromMap(u.data()).toMap()]}),x.fromMap(l.data());{console.log("Joining as teacher"),console.log(u.data());const h=G.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return console.log(h.toMap()),await v(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,h.toMap()]}),x.fromMap(l.data())}}else if(s=="student"){const h=P.fromBlank(u.data().fullname,u.data().gender,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await v(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,h.toMap()]}),b.fromMap(l.data())}else{const h=G.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await v(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,h.toMap()]}),b.fromMap(l.data())}}async function ge(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!t||!o||!s)return;const a=c(d,"schools",t),n=c(i(a,s=="student"?"students":"teachers"),o);await v(n,{gender:e})}async function me(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!t||!o||!s)return;const a=c(d,"schools",t),n=c(i(a,s=="student"?"students":"teachers"),o);await v(n,{phoneNumber:e})}async function pe(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=c(i(s,"events"),e.id);await v(a,e.toMap())}async function Ie(){const e=localStorage.getItem("schoolId"),t=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!e||!t)return[];const s=c(d,"schools",e),a=[];let n;o=="student"?n=await w(T(i(s,"activities"),A("studentUids","array-contains",t))):n=await w(T(i(s,"activities"),A("teacherUids","array-contains",t))),console.log(n);for(const r of n.docs){let l;o=="student"?l=await w(T(i(r.ref,"events"),A("targetUids","array-contains",t))):l=await w(i(r.ref,"events"));for(const g of l.docs){const u=g.data();console.log(u),u.type=="activity-theater-event"?a.push(H.fromMap(u)):a.push(It.fromMap(u))}}return a}async function ye(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const a=c(d,"schools",o),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t),l=i(r,"conflictResponses"),g=await M(c(l,s));return g.exists()?j.fromMap(g.data()):null}async function ve(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),a=c(i(s,"activities"),e);await v(a,{rehearsalLocations:t.map(n=>n.toMap())})}async function we(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const a=localStorage.getItem("accountType"),n=c(d,"schools",o),r=c(i(n,"activities"),e);if(a=="teacher")V(i(r,"groupChats"),async l=>{const g=[];for(const u of l.docs){const h=E.fromMap(u.data());if((h.generalTarget=="direct"||h.generalTarget=="custom")&&!h.members.find(p=>p.userId==s))continue;if(h.generalTarget=="direct"){const p=h.members.find(m=>m.userId!=s);h.name=(p==null?void 0:p.name)||"Unknown"}const f=i(u.ref,"messages"),S=T(f,st("timeSent","desc"),ot(1)),I=await w(S);I.empty||(h.lastMessage=q.fromMap(I.docs[0].data())),g.push(h)}g.sort((u,h)=>u.lastMessage?h.lastMessage?h.lastMessage.timeSent.getTime()-u.lastMessage.timeSent.getTime():-1:1),t(g)});else{const l=c(i(n,"students"),s),g=await M(l);if(!g.exists())return;const u=z.fromMap(g.data());console.log(u),V(i(r,"groupChats"),async h=>{const f=[];for(const S of h.docs){const I=E.fromMap(S.data());if(!(I.generalTarget=="everyone"||I.generalTarget=="students")&&(I.generalTarget=="parents"||!I.members.find(D=>D.userId==s)))continue;if(I.generalTarget=="direct"){const D=I.members.find($=>$.userId!=s);I.name=(D==null?void 0:D.name)||"Unknown"}const p=i(S.ref,"messages"),m=T(p,st("timeSent","desc"),ot(1)),y=await w(m);y.empty||(I.lastMessage=q.fromMap(y.docs[0].data())),f.push(I)}f.sort((S,I)=>S.lastMessage?I.lastMessage?I.lastMessage.timeSent.getTime()-S.lastMessage.timeSent.getTime():-1:1),t(f)})}}async function Se(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return[];const a=c(d,"schools",s),n=c(i(a,"activities"),e);console.log("Getting messages for "+t);const r=c(i(n,"groupChats"),t),l=i(r,"messages");V(l,g=>{const u=[];g.forEach(h=>{u.push(q.fromMap(h.data()))}),u.sort((h,f)=>h.timeSent.getTime()-f.timeSent.getTime()),o(u)})}async function et(){const e=localStorage.getItem("schoolId"),t=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!e||!t)return null;const s=c(d,"schools",e),a=c(i(s,o=="student"?"students":"teachers"),t),n=await M(a);return n.exists()?o=="student"?z.fromMap(n.data()):mt.fromMap(n.data()):null}async function De(e,t,o,s,a){if(o.message=="")return;const n=localStorage.getItem("schoolId"),r=localStorage.getItem("userId");if(!n||!r)return;const l=c(d,"schools",n),g=c(i(l,"activities"),e),u=c(i(g,"groupChats"),t),h=await M(u);if(!h.exists()){if(a==null)return;const p=await et();if(!p)return;const m=E.fromBlank("",a.userId,[C.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),a],"direct",e,Date.now());await O(u,m.toMap());const y=i(u,"messages"),D=await k(y,o.toMap());o.messageId=D.id,await v(D,{messageId:D.id}),N(o,[C.fromMap(a)],m,s);return}const f=E.fromMap(h.data()),S=i(u,"messages"),I=await k(S,o.toMap());if(o.messageId=I.id,await v(I,{messageId:I.id}),f.generalTarget!="direct"&&f.generalTarget!="custom"&&f.generalTarget!="group"){const p=await qt(e);if(!p)return;if(f.generalTarget=="everyone"){let m=p.students.map(y=>C.fromMap(y));m=m.concat(p.teachers.map(y=>C.fromMap(y))),m=m.concat(p.parents.map(y=>C.fromMap(y))),m=m.filter(y=>y.userId!=o.senderUid),N(o,m,f,p.name)}else if(f.generalTarget=="students"){let m=p.students.map(y=>C.fromMap(y));m=m.filter(y=>y.userId!=o.senderUid),N(o,m,f,p.name)}else if(f.generalTarget=="parents"){let m=p.parents.map(y=>C.fromMap(y));m=m.filter(y=>y.userId!=o.senderUid),N(o,m,f,p.name)}return}if(f.generalTarget=="direct"){const p=f.members.find(m=>m.userId!=r);if(!p)return;N(o,[p],f,s);return}if(f.generalTarget=="custom"){N(o,f.members.filter(p=>p.userId!=r),f,s);return}}async function J(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),a=i(s,"groupChats"),n=await et();if(!n)return;const r=C.fromBlank(n.fullname,n.email,n.phoneNumber,n.FCMToken,n.uid);e.members.push(r);const l=await k(a,e.toMap());e.id=l.id,await v(l,{id:l.id})}async function Te(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t);v(r,{resources:F(o.toMap())})}async function Me(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t);v(r,{resources:yt(o.toMap())})}async function Ae(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(d,"schools",s),n=c(i(a,"activities"),e),r=c(i(n,"shows"),t),l=i(r,"conflictResponses"),g=c(l,o.id);await pt(g)}async function Ce(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),a=i(s,e+"s");await O(c(a,t.uid),t.toMap());let n;t instanceof z?n=P.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid):n=G.fromBlank(t.fullname,t.email,t.phoneNumber,t.FCMToken,t.uid),await v(s,{[e+"Uids"]:F(t.uid),[e+"s"]:F(n.toMap())})}function Kt(e){const t=new Date,o=t.getTime().toString();return`${e.charCodeAt(0)}${t.getDate()}${o.slice(-2)}`}async function Ee(e,t){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),a=await M(s);if(!a.exists())return null;const n=a.data(),r=i(s,"activities"),l=Kt(e),g=[_.fromMap({name:"Rehearsal",color:R("#FF0000")}),_.fromMap({name:"Performance",color:R("#00FF00")})],u=[_.fromMap({name:"Practice",color:R("#FF0000")}),_.fromMap({name:"Game",color:R("#00FF00")})],h=[vt.fromMap({name:"Auditorium",color:R("#0000FF")})],f=rt.fromMap(n.location),S=[f],I=await et();if(!I)return null;const p=G.fromBlank(I.fullname,I.email,I.phoneNumber,I.FCMToken,I.uid);let m;t=="theater"?m=x.fromBlank(e,"",l,[],[],[],[p],S,g,f,h,"type",Date.now()):m=b.fromBlank(e,"",l,[],[],[],[p],S,u,f,"type",Date.now(),"activity");const y=await k(r,m.toMap());m.id=y.id,await v(y,{id:y.id});const D=E.fromMap({name:"Everyone",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"everyone"});await J(D);const $=E.fromMap({name:"Parents",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"parents"});await J($);const ft=E.fromMap({name:"Students",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"students"});return await J(ft),m}async function ke(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return null;const a=c(d,"schools",s),n=c(i(a,"activities"),o),r=i(n,"groupChats"),l=E.fromBlank("",t.userId,[e,t],"direct",o,Date.now());return await O(c(r,t.userId),l.toMap()),l.name=t.name,l}async function Ne(){const e=await Vt(localStorage.getItem("schoolId")||"");if(!e)return[];const t=[];return e.savedLocations.forEach(o=>{t.push(rt.fromMap(o))}),t}async function Ue(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),a=c(i(s,"activities"),e);await v(a,{locations:F(t.toMap())})}async function be(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t);await v(o,{savedLocations:F(e.toMap())})}async function Fe(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),a=c(i(s,"activities"),e);await v(a,{eventTypes:F(t.toMap())})}export{ye as A,ve as B,Ue as C,be as D,Fe as E,Ne as F,J as G,De as H,Se as I,we as J,et as K,ke as L,Te as M,Me as N,ge as a,Ee as b,Ce as c,Qt as d,qt as e,ie as f,zt as g,he as h,Wt as i,fe as j,te as k,Zt as l,ee as m,oe as n,de as o,ne as p,ce as q,pe as r,se as s,ae as t,me as u,re as v,Ae as w,le as x,ue as y,Ie as z};
