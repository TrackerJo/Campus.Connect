import{j as r,c as F,r as f,i as H}from"./index-DsZHpGFm.js";import{d as S,E as M,f as L,C as u,b,e as W}from"./constants-BwLTggyG.js";import{C as q,S as z}from"./Show_Group_Tile-Dd89r9J4.js";import{n as K,o as Q}from"./db-D2uaWAAf.js";import{T as V}from"./trash-BnpXJPEK.js";import{A as X}from"./Ensemble_Section_Tile-DLEWHXZs.js";function Y({actor:g,canDelete:j,onDelete:w}){return r.jsx("div",{className:"ActorTile",id:"actor-tile-"+g.userId,children:r.jsxs("div",{className:"header",children:[r.jsx("div",{className:"ActorNameDiv",children:r.jsxs("label",{htmlFor:"Actor",children:["Actor: ",g.name]})}),j&&r.jsx("div",{className:"ActorTrashDiv",children:r.jsx("img",{src:V,alt:"",className:"TrashIcon",onClick:()=>{w()}})})]})})}F(document.getElementById("root")).render(r.jsx(f.StrictMode,{children:r.jsx(Z,{})}));function Z(){const[g,j]=f.useState(""),[w,R]=f.useState(""),[n,y]=f.useState(),[m,G]=f.useState([]),[p,N]=f.useState([]),[J,v]=f.useState(!1),[x,T]=f.useState([]),[A,I]=f.useState([]),[k,E]=f.useState(!1),C=f.useRef(null),[D,B]=f.useState(!1);async function P(){let l=!0;if(v(!0),!n){v(!1);return}for(let t=0;t<n.characters.length;t++){const s=n.characters[t],e=m.find(a=>a.name==s.name);e&&(console.log("New Character"),console.log(e),n.characters[t]=e,e.actor==null&&(console.log("Actor is null"),l=!1))}for(let t=0;t<n.showGroups.length;t++){console.log("UPDATING SHOW GROUPS");const s=n.showGroups[t];console.log("Show Group: "+s.name);const e=p.find(a=>a.name==s.name);if(console.log("New Show Group: "+(e==null?void 0:e.name)),e){s.characters=e.characters;for(let a=0;a<s.characters.length;a++){const c=s.characters[a];if(c instanceof u){const o=m.find(i=>i.name==c.name);o&&(s.characters[a]=o,o.actor==null&&(l=!1))}}}}for(let t=0;t<n.layout.length;t++){const s=n.layout[t];for(let e=0;e<s.scenes.length;e++){const a=s.scenes[e];for(let c=0;c<a.characters.length;c++){const o=a.characters[c];if(o instanceof u){const i=m.find(h=>h.name==o.name);i&&(a.characters[c]=i)}else if(o instanceof b){const i=p.find(h=>h.name==o.name);if(i){for(let h=0;h<i.characters.length;h++){const d=i.characters[h];if(d instanceof u){const O=m.find(U=>U.name==d.name);O&&(i.characters[h]=O)}}a.characters[c]=i}}}}}for(let t=0;t<n.songs.length;t++){const s=n.songs[t];console.log("Assigning roles to song"),console.log(s);for(let e=0;e<s.characters.length;e++){const a=s.characters[e];if(console.log("Character"),console.log(a),console.log(typeof a),a instanceof u){const c=m.find(o=>o.name==a.name);c&&(s.characters[e]=c)}else if(a instanceof b){const c=p.find(o=>o.name==a.name);if(c){for(let o=0;o<c.characters.length;o++){const i=c.characters[o];if(i instanceof u){const h=m.find(d=>d.name==i.name);h&&(c.characters[o]=h)}}s.characters[e]=c}}console.log("New Character"),console.log(s.characters[e]),console.log(typeof s.characters[e])}}for(let t=0;t<n.dances.length;t++){const s=n.dances[t];for(let e=0;e<s.characters.length;e++){const a=s.characters[e];if(a instanceof u){const c=m.find(o=>o.name==a.name);c&&(s.characters[e]=c)}else if(a instanceof b){const c=p.find(o=>o.name==a.name);if(c){for(let o=0;o<c.characters.length;o++){const i=c.characters[o];if(i instanceof u){const h=m.find(d=>d.name==i.name);h&&(c.characters[o]=h)}}s.characters[e]=c}}}}n.canCreateSchedule=l,n.ensemble=W.fromBlank(A,Date.now()),y(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+w,JSON.stringify(n)),await Q(g,w,n),v(!1)}return f.useEffect(()=>{var a;H(()=>{}),E(!0);const l=new URLSearchParams(window.location.search),t=l.get("activityId");t&&(j(t),K(t).then(c=>{T(c),console.log(c),E(!1)}));const s=l.get("showId");s&&R(s);const e=localStorage.getItem("show-"+s);if(e){console.log(JSON.parse(e)),y(S.fromMap(JSON.parse(e))),console.log(S.fromMap(JSON.parse(e))),G(S.fromMap(JSON.parse(e)).characters),N(S.fromMap(JSON.parse(e)).showGroups);const c=S.fromMap(JSON.parse(e)).showGroups;let o=!1;for(let i=0;i<c.length;i++)c[i].characters.map(d=>d instanceof M).includes(!0)&&(o=!0);B(o),(a=JSON.parse(e))!=null&&a.hasEnsemble&&I(S.fromMap(JSON.parse(e)).ensemble.actors)}},[]),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"title",children:r.jsx("h1",{children:"Assign Roles"})}),r.jsxs("div",{className:"center",children:[r.jsx("h2",{children:"Assign Characters"}),r.jsx("div",{className:"characters",id:"create-characters",children:m.map((l,t)=>r.jsx(q,{character:l,actors:x,characters:[],isAssign:!0,setCharacter:s=>{G(e=>{const a=[...e];return a[t]=s,a})},removeCharacter:()=>{G(m.filter((s,e)=>e!==t))},isCreate:!1},t))}),D&&r.jsxs(r.Fragment,{children:[r.jsx("h2",{children:"Assign Show Groups"}),r.jsx("div",{className:"showGroups",id:"create-showGroups",children:p.map((l,t)=>l.characters.map(s=>s instanceof M).includes(!0)?r.jsx(z,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:m,actors:x,isAssign:!0,setShowGroup:s=>{N(e=>{const a=[...e];a[t]=s,console.log("NEW SHOW GROUPS");for(let c=0;c<a.length;c++){const o=a[c];console.log(o.toMap())}return a})},removeShowGroup:()=>{N(p.filter((s,e)=>e!==t))},isCreate:!1},t):null)})]}),(n==null?void 0:n.hasEnsemble)&&r.jsxs(r.Fragment,{children:[r.jsx("h2",{children:"Assign Ensemble"}),r.jsx("div",{className:"ensemble",id:"create-ensemble",children:A.map((l,t)=>(console.log(l),r.jsx(Y,{actor:l,canDelete:!0,onDelete:()=>{I(A.filter((s,e)=>e!==t))}},t)))}),r.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=C.current)==null||l.showModal()},children:"Add Actor"})]}),J?r.jsx("div",{className:"loader"}):r.jsx("button",{className:"ActionBtn",onClick:async()=>{await P(),window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Save"}),r.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!k&&r.jsx(X,{dialogRef:C,keepPastResult:!1,actor:new L,addedActors:A,actors:x,setActor:l=>{var s;const t=[...A];t.push(l),console.log("Setting actors"),I(t),(s=C.current)==null||s.close()},close:()=>{var l;(l=C.current)==null||l.close()}})]})}
