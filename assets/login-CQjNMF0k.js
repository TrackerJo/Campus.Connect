import{c as M,j as e,r as a,a as _,l as q,s as W,T as Y,b as R,L as J,G as K,S as Q,i as V}from"./index-CTdd_IJn.js";import{a as X,c as B,b as ee}from"./db-BM5h2dO_.js";M(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(te,{})}));function te(){const[l,y]=a.useState(""),[d,v]=a.useState(""),[p,r]=a.useState(!1),[x,U]=a.useState([]),[C,P]=a.useState(""),[I,h]=a.useState("accountType"),[f,N]=a.useState("student"),[b,z]=a.useState("LoginInfo"),[g,A]=a.useState(""),[o,c]=a.useState(""),[F,Z]=a.useState(""),[m,E]=a.useState(""),[j,D]=a.useState("");a.useState(""),a.useState(""),a.useState(""),a.useState("");const[$,k]=a.useState("");a.useState(!1);async function O(t){const n={lat:0,lon:0},s="",u=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const i=await R(l,d);if(console.log(i),!i){alert("Error creating account");return}const S=J.fromBlank("home",s,new K(n.lat,n.lon),!1),w=Q.fromBlank(i,t.schoolId,"unknown",u,"","student",o.replace("none",""),F,"unknown",g.toLowerCase().trim(),g.trim(),l.trim(),{},S);await B("student",w),localStorage.setItem("accountType","student");const T=new URLSearchParams(window.location.search).get("redirect");T?window.location.href=T.replace(/~/g,"&"):window.location.href="/",r(!1)}return a.useEffect(()=>{async function t(){await V(u=>{if(u&&localStorage.getItem("accountType")!=null){const S=new URLSearchParams(window.location.search).get("redirect");S?window.location.href=S.replace(/~/g,"&"):window.location.href="/"}});const n=await ee();U(n);const s=localStorage.getItem("schoolId");if(s){P(s);return}P(n[0].schoolId)}t()},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:I=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{N("student"),h("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{N("teacher"),h("login")},children:"Teacher"})]}):I=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",value:l,onChange:t=>{y(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{v(t.target.value)}}),e.jsx("label",{htmlFor:"",className:"forgotPassword",onClick:()=>{h("forgotPassword")},children:"Forgot Password?"}),e.jsx("label",{htmlFor:"",children:"Select your School"}),e.jsx("select",{onChange:t=>{P(t.target.value)},value:C,children:x.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),!await _(l,d,C)){r(!1),alert("Wrong email or password");return}const n=localStorage.getItem("userId");if(!await X(C,n,f)){r(!1),alert("You are not in this school"),await q();return}localStorage.setItem("accountType",f),console.log("Logging in as "+f);const i=new URLSearchParams(window.location.search).get("redirect");i?window.location.href=i.replace(/~/g,"&"):window.location.href="/",r(!1)},children:"Login"}),e.jsx("button",{className:"actionBtn",onClick:()=>{h("createAccount")},children:"Create an Account"}),e.jsxs("p",{children:[e.jsxs("label",{htmlFor:"",className:"info",onClick:()=>{},children:["Signing in as a ",f,", "]}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{h("accountType")},children:"back?"})]})]}):I=="forgotPassword"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Forgot Password"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{k(t.target.value)}}),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),!await W($)){alert("Error sending email"),r(!1);return}k(""),alert("Email sent"),h("login"),r(!1)},children:"Send Password Request Email"})]}):f=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{y(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{c(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{v(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{E(t.target.value)}}),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),g==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}c(o.replace(/-/g,"")),c(o.replace(/ /g,"")),c(o.replace(/\(/g,"")),c(o.replace(/\)/g,""));const n=/^\d{10}$/;if(o!="none"&&!n.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(d==""){alert("Please enter a password");return}if(d.length<6){alert("Password must be at least 6 characters");return}if(m==""){alert("Please enter your school code");return}const s=x.find(L=>L.schoolTeacherCode==m);if(!s){alert("Invalid School Code");return}localStorage.setItem("schoolId",s.schoolId);const u=Y.fromBlank("",s.schoolId,o.replace("none",""),"","teacher",g.toLowerCase().trim(),g.trim(),l.trim()),i=await R(l,d);if(!i){alert("Error creating account");return}u.uid=i,await B("teacher",u),localStorage.setItem("accountType","teacher");const w=new URLSearchParams(window.location.search).get("redirect");w?window.location.href=w.replace(/~/g,"&"):window.location.href="/",r(!1)},children:"Create Account"})]}):b=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),G(),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:()=>{if(g==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}c(o.replace(/-/g,"")),c(o.replace(/ /g,"")),c(o.replace(/\(/g,"")),c(o.replace(/\)/g,""));const n=/^\d{10}$/;if(o!="none"&&!n.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(d==""){alert("Please enter a password");return}if(d.length<6){alert("Password must be at least 6 characters");return}if(F==""){alert("Please select your sex");return}const s=x.find(u=>u.schoolDomain==l.split("@")[1]);if(s!=null){r(!0),O(s);return}z("SchoolCode")},children:"Next"})]}):b=="HomeAddress"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),H(),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{r(!0);let t;if(m!=""?t=x.find(n=>n.schoolCode==m):t=x.find(n=>n.schoolDomain==j.split("@")[1]),t==null){m!=""&&j!=""?alert("Invalid School Code or a School Email"):j!=""?alert("Invalid School Email"):alert("Invalid School Code"),r(!1);return}},children:"Create Account"})]})})})});function G(){return e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Please enter your full name!"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{y(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{v(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{c(t.target.value)}}),e.jsxs("select",{onChange:t=>{Z(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function H(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:m,onChange:t=>{E(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:j,onChange:t=>{D(t.target.value)}})]})}}
