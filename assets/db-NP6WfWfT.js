import{w as gt,x as i,y as c,z as D,q as _,g as N,B as U,H as I,d as Y,f as L,I as w,J as M,K as C,i as H,N as R,m as j,O as V,S as z,T as mt,P as k,Q as pt,U as G,u as It,r as E,V as ot,W as st,M as q,s as A,X as yt,p as x,Y as O,n as vt,L as rt}from"./constants-BNam4_mG.js";import{h as wt,C as St,k as at,_ as Dt,d as Q,e as Tt,f as Mt,F as Ct,n as W,g as P}from"./index-BrX1-YwQ.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const At="type.googleapis.com/google.protobuf.Int64Value",Et="type.googleapis.com/google.protobuf.UInt64Value";function lt(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function K(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>K(e));if(typeof t=="function"||typeof t=="object")return lt(t,e=>K(e));throw new Error("Data cannot be encoded in JSON: "+t)}function B(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case At:case Et:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>B(e)):typeof t=="function"||typeof t=="object"?lt(t,e=>B(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends Ct{constructor(e,o,s){super(`${Z}/${e}`,o||""),this.details=s}}function kt(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Nt(t,e){let o=kt(t),s=o,a;try{const n=e&&e.error;if(n){const r=n.status;if(typeof r=="string"){if(!nt[r])return new F("internal","internal");o=nt[r],s=r}const l=n.message;typeof l=="string"&&(s=l),a=n.details,a!==void 0&&(a=B(a))}}catch{}return o==="ok"?null:new F(o,s,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(a=>this.auth=a,()=>{}),this.messaging||o.get().then(a=>this.messaging=a,()=>{}),this.appCheck||s.get().then(a=>this.appCheck=a,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),a=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X="us-central1";function bt(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new F("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class Ft{constructor(e,o,s,a,n=X,r){this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Ut(o,s,a),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(n);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=X}catch{this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function Lt(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function Pt(t,e,o){return s=>Ot(t,e,s,{})}async function Rt(t,e,o,s){o["Content-Type"]="application/json";let a;try{a=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let n=null;try{n=await a.json()}catch{}return{status:a.status,json:n}}function Ot(t,e,o,s){const a=t._url(e);return _t(t,a,o,s)}async function _t(t,e,o,s){o=K(o);const a={data:o},n={},r=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken);const l=s.timeout||7e4,d=bt(l),u=await Promise.race([Rt(e,a,n,t.fetchImpl),d.promise,t.cancelAllRequests]);if(d.cancel(),!u)throw new F("cancelled","Firebase Functions instance was deleted.");const f=Nt(u.status,u.json);if(f)throw f;if(!u.json)throw new F("internal","Response is not valid JSON object.");let g=u.json.data;if(typeof g>"u"&&(g=u.json.result),typeof g>"u")throw new F("internal","Response is missing data field.");return{data:B(g)}}const ct="@firebase/functions",it="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt="auth-internal",Gt="app-check-internal",Bt="messaging-internal";function $t(t,e){const o=(s,{instanceIdentifier:a})=>{const n=s.getProvider("app").getImmediate(),r=s.getProvider(xt),l=s.getProvider(Bt),d=s.getProvider(Gt);return new Ft(n,r,l,d,a,t)};wt(new St(Z,o,"PUBLIC").setMultipleInstances(!0)),at(ct,it,e),at(ct,it,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(t=Mt(),e=X){const s=Dt(Q(t),Z).getImmediate({identifier:e}),a=Tt("functions");return a&&Jt(s,...a),s}function Jt(t,e,o){Lt(Q(t),e,o)}function tt(t,e,o){return Pt(Q(t),e)}$t(fetch.bind(self));const Ht=ut(W);function b(t,e,o,s){tt(Ht,"sendEmail")({emails:e.map(a=>a.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:t.message,senderName:t.senderName})}const dt=ut(W),h=gt(W),ht=i(h,"schools"),jt=async t=>{const e=c(ht,t);return(await D(e)).data()},Yt=async()=>{const t=await w(ht),e=[];return t.forEach(o=>{e.push(o.data())}),e},zt=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=c(h,"schools",e);if(t=="student"){const s=M(i(o,"activities"),C("studentUids","array-contains",P())),a=[];return(await w(s)).forEach(r=>{a.push(N.fromMap(r.data()))}),a}else{const s=M(i(o,"activities"),C("teacherUids","array-contains",P())),a=[];return(await w(s)).forEach(r=>{console.log(r.data()),a.push(N.fromMap(r.data()))}),a}};async function Vt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(h,"schools",e),s=c(i(o,"activities"),t),a=await D(s);return a.exists()?a.data().type=="theater"?_.fromMap(a.data()):N.fromMap(a.data()):null}async function Qt(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=i(s,"shows"),n=await U(a,t.toMap());return t.id=n.id,await I(n,{id:n.id}),n.id}async function Wt(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=c(i(s,"shows"),t.id);await I(a,t.toMap())}async function Zt(t){const e=i(h,"showTemplates"),o=await U(e,t.toMap());return t.id=o.id,await I(o,{id:o.id}),o.id}async function te(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(h,"schools",o),a=c(i(s,"activities"),t),n=c(i(a,"shows"),e),r=await D(n);return r.exists()?(console.log(r.data()),Y.fromMap(r.data())):null}async function ee(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=c(h,"schools",e),s=c(i(o,"activities"),t),a=await D(s);if(!a.exists())return[];const n=[];return a.data().students.forEach(r=>{n.push(L.fromMap(r))}),n}async function oe(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e);await R(r,o.toMap())}async function se(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=i(s,"events"),n=await U(a,t.toMap());t.id=n.id,await I(n,{id:n.id})}async function ae(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(h,"schools",o),n=c(i(a,"activities"),t),r=i(n,"events");if(s=="student"){const l=await w(M(r,C("showId","==",e),C("targetUids","array-contains",P()))),d=[];return l.forEach(u=>{u.data().deleted||d.push(H.fromMap(u.data()))}),d}else{const l=await w(M(r,C("showId","==",e))),d=[];return l.forEach(u=>{u.data().deleted||d.push(H.fromMap(u.data()))}),d}}async function ne(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=c(i(s,"events"),t.id);await I(a,{deleted:!0}),await tt(dt,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function ce(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=c(h,"schools",e),s=c(i(o,"activities"),t),a=i(s,"shows"),n=await w(a),r=[];return n.forEach(l=>{r.push(Y.fromMap(l.data()))}),r}async function ie(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e);await I(r,{conflictForm:o.toMap()}),await tt(dt,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function re(){const t=await P(),e=localStorage.getItem("schoolId");if(!e)return null;const o=c(h,"schools",e),s=i(o,"students"),a=c(s,t),n=await D(a);return n.exists()?L.fromMap(n.data()):null}async function le(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e),l=c(r,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await R(l,o.toMap())}async function ue(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(h,"schools",o),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e),l=i(r,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(P());const f=await w(M(l,C("submitterId","==",P()))),g=[];return f.forEach(S=>{g.push(j.fromMap(S.data()))}),g}const d=await w(l),u=[];return d.forEach(f=>{u.push(j.fromMap(f.data()))}),u}async function de(){const t=i(h,"showTemplates"),e=await w(t),o=[];return e.forEach(s=>{o.push(Y.fromMap(s.data()))}),o}async function he(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const a=c(h,"schools",e),n=M(i(a,"activities"),C("joinCode","==",t)),r=await w(n);if(r.empty)return null;const l=r.docs[0],d=c(i(a,s=="student"?"students":"teachers"),o),u=await D(d);if(console.log(u.data()),!u.exists())return null;if(l.data().studentUids.includes(o)||l.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),l.data().type=="theater"){if((u.data().gender==null||u.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),u.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(u.data().phoneNumber==""||u.data().gender==null||u.data().gender=="")&&s=="student")return null;if(s=="student")return await I(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,L.fromMap(u.data()).toMap()]}),_.fromMap(l.data());{console.log("Joining as teacher"),console.log(u.data());const f=G.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return console.log(f.toMap()),await I(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),_.fromMap(l.data())}}else if(s=="student"){const f=L.fromBlank(u.data().fullname,u.data().gender,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await I(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,f.toMap()]}),N.fromMap(l.data())}else{const f=G.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await I(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),N.fromMap(l.data())}}async function fe(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const a=c(h,"schools",e),n=c(i(a,s=="student"?"students":"teachers"),o);await I(n,{gender:t})}async function ge(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const a=c(h,"schools",e),n=c(i(a,s=="student"?"students":"teachers"),o);await I(n,{phoneNumber:t})}async function me(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=c(i(s,"events"),t.id);await I(a,t.toMap())}async function pe(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=c(h,"schools",t),a=[];let n;o=="student"?n=await w(M(i(s,"activities"),C("studentUids","array-contains",e))):n=await w(M(i(s,"activities"),C("teacherUids","array-contains",e))),console.log(n);for(const r of n.docs){let l;o=="student"?l=await w(M(i(r.ref,"events"),C("targetUids","array-contains",e))):l=await w(i(r.ref,"events"));for(const d of l.docs){const u=d.data();console.log(u),u.type=="activity-theater-event"?a.push(H.fromMap(u)):a.push(It.fromMap(u))}}return a}async function Ie(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const a=c(h,"schools",o),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e),l=i(r,"conflictResponses"),d=await D(c(l,s));return d.exists()?j.fromMap(d.data()):null}async function ye(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=c(i(s,"activities"),t);await I(a,{rehearsalLocations:e.map(n=>n.toMap())})}async function ve(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const a=localStorage.getItem("accountType"),n=c(h,"schools",o),r=c(i(n,"activities"),t);if(a=="teacher")V(i(r,"groupChats"),async l=>{const d=[];for(const u of l.docs){const f=E.fromMap(u.data());if((f.generalTarget=="direct"||f.generalTarget=="custom")&&!f.members.find(p=>p.userId==s))continue;if(f.generalTarget=="direct"){const p=f.members.find(m=>m.userId!=s);f.name=(p==null?void 0:p.name)||"Unknown"}const g=i(u.ref,"messages"),S=M(g,st("timeSent","desc"),ot(1)),y=await w(S);y.empty||(f.lastMessage=q.fromMap(y.docs[0].data())),d.push(f)}d.sort((u,f)=>u.lastMessage?f.lastMessage?f.lastMessage.timeSent.getTime()-u.lastMessage.timeSent.getTime():-1:1),e(d)});else{const l=c(i(n,"students"),s),d=await D(l);if(!d.exists())return;const u=z.fromMap(d.data());console.log(u),V(i(r,"groupChats"),async f=>{const g=[];for(const S of f.docs){const y=E.fromMap(S.data());if(!(y.generalTarget=="everyone"||y.generalTarget=="students")&&(y.generalTarget=="parents"||!y.members.find(T=>T.userId==s)))continue;if(y.generalTarget=="direct"){const T=y.members.find($=>$.userId!=s);y.name=(T==null?void 0:T.name)||"Unknown"}const p=i(S.ref,"messages"),m=M(p,st("timeSent","desc"),ot(1)),v=await w(m);v.empty||(y.lastMessage=q.fromMap(v.docs[0].data())),g.push(y)}g.sort((S,y)=>S.lastMessage?y.lastMessage?y.lastMessage.timeSent.getTime()-S.lastMessage.timeSent.getTime():-1:1),e(g)})}}async function we(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const a=c(h,"schools",s),n=c(i(a,"activities"),t);console.log("Getting messages for "+e);const r=c(i(n,"groupChats"),e),l=i(r,"messages");V(l,d=>{const u=[];d.forEach(f=>{u.push(q.fromMap(f.data()))}),u.sort((f,g)=>f.timeSent.getTime()-g.timeSent.getTime()),o(u)})}async function et(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=c(h,"schools",t),a=c(i(s,o=="student"?"students":"teachers"),e),n=await D(a);return n.exists()?o=="student"?z.fromMap(n.data()):mt.fromMap(n.data()):null}async function Se(t,e,o,s,a){if(o.message=="")return;const n=localStorage.getItem("schoolId"),r=localStorage.getItem("userId");if(!n||!r)return;const l=c(h,"schools",n),d=c(i(l,"activities"),t),u=c(i(d,"groupChats"),e),f=await D(u);if(!f.exists()){if(a==null)return;const p=await et();if(!p)return;const m=E.fromBlank("",a.userId,[A.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),a],"direct",t,Date.now());await R(u,m.toMap());const v=i(u,"messages"),T=await U(v,o.toMap());o.messageId=T.id,await I(T,{messageId:T.id}),b(o,[A.fromMap(a)],m,s);return}const g=E.fromMap(f.data()),S=i(u,"messages"),y=await U(S,o.toMap());if(o.messageId=y.id,await I(y,{messageId:y.id}),g.generalTarget!="direct"&&g.generalTarget!="custom"&&g.generalTarget!="group"){const p=await Vt(t);if(!p)return;if(g.generalTarget=="everyone"){let m=p.students.map(v=>A.fromMap(v));m=m.concat(p.teachers.map(v=>A.fromMap(v))),m=m.concat(p.parents.map(v=>A.fromMap(v))),m=m.filter(v=>v.userId!=o.senderUid),b(o,m,g,p.name)}else if(g.generalTarget=="students"){let m=p.students.map(v=>A.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),b(o,m,g,p.name)}else if(g.generalTarget=="parents"){let m=p.parents.map(v=>A.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),b(o,m,g,p.name)}return}if(g.generalTarget=="direct"){const p=g.members.find(m=>m.userId!=r);if(!p)return;b(o,[p],g,s);return}if(g.generalTarget=="custom"){b(o,g.members.filter(p=>p.userId!=r),g,s);return}}async function J(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),a=i(s,"groupChats"),n=await et();if(!n)return;const r=A.fromBlank(n.fullname,n.email,n.phoneNumber,n.FCMToken,n.uid);t.members.push(r);const l=await U(a,t.toMap());t.id=l.id,await I(l,{id:l.id})}async function De(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e);I(r,{resources:k(o.toMap())})}async function Te(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e);I(r,{resources:yt(o.toMap())})}async function Me(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(h,"schools",s),n=c(i(a,"activities"),t),r=c(i(n,"shows"),e),l=i(r,"conflictResponses"),d=c(l,o.id);await pt(d)}async function Ce(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=i(s,t+"s");await R(c(a,e.uid),e.toMap());let n;e instanceof z?n=L.fromBlank(e.fullname,e.gender,e.email,e.phoneNumber,e.FCMToken,e.uid):n=G.fromBlank(e.fullname,e.email,e.phoneNumber,e.FCMToken,e.uid),await I(s,{[t+"Uids"]:k(e.uid),[t+"s"]:k(n.toMap())})}function qt(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function Ae(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(h,"schools",o),a=await D(s);if(!a.exists())return null;const n=a.data(),r=i(s,"activities"),l=qt(t),d=[x.fromMap({name:"Rehearsal",color:O("#FF0000")}),x.fromMap({name:"Performance",color:O("#00FF00")})],u=[x.fromMap({name:"Practice",color:O("#FF0000")}),x.fromMap({name:"Game",color:O("#00FF00")})],f=[vt.fromMap({name:"Auditorium",color:O("#0000FF")})],g=rt.fromMap(n.location),S=[g],y=await et();if(!y)return null;const p=G.fromBlank(y.fullname,y.email,y.phoneNumber,y.FCMToken,y.uid);let m;e=="theater"?m=_.fromBlank(t,"",l,[],[],[],[p],S,d,g,f,"type",Date.now()):m=N.fromBlank(t,"",l,[],[],[],[p],S,u,g,"type",Date.now(),"activity");const v=await U(r,m.toMap());m.id=v.id,await I(v,{id:v.id});const T=E.fromMap({name:"Everyone",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"everyone"});await J(T);const $=E.fromMap({name:"Parents",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"parents"});await J($);const ft=E.fromMap({name:"Students",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"students"});return await J(ft),m}async function Ee(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return null;const a=c(h,"schools",s),n=c(i(a,"activities"),o),r=i(n,"groupChats"),l=E.fromBlank("",e.userId,[t,e],"direct",o,Date.now());return await R(c(r,e.userId),l.toMap()),l.name=e.name,l}async function ke(){const t=await jt(localStorage.getItem("schoolId")||"");if(!t)return[];const e=[];return t.savedLocations.forEach(o=>{e.push(rt.fromMap(o))}),e}async function Ne(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=c(i(s,"activities"),t);await I(a,{locations:k(e.toMap())})}async function Ue(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e);await I(o,{savedLocations:k(t.toMap())})}async function be(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=c(i(s,"activities"),t);await I(a,{eventTypes:k(e.toMap())})}async function Fe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=c(i(s,"activities"),t),n=c(i(a,"shows"),e);await I(n,{isCreatingSchedule:!0})}async function Le(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),a=i(s,"students");await R(c(a,t.uid),t.toMap());const n=L.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid);await I(s,{studentUids:k(t.uid),students:k(n.toMap())});const r=n.userId;if(!o||!r)return null;const l=c(i(s,"activities"),e),d=await D(l);return d.exists()?d.data().type=="theater"?(await I(d.ref,{studentUids:[...d.data().studentUids,r],students:[...d.data().students,n.toMap()]}),_.fromMap(d.data())):(await I(d.ref,{studentUids:[...d.data().studentUids,r],students:[...d.data().students,n.toMap()]}),N.fromMap(d.data())):null}export{pe as A,Ie as B,ye as C,Ne as D,Ue as E,be as F,ke as G,J as H,Se as I,we as J,ve as K,et as L,Ee as M,De as N,Te as O,Le as P,fe as a,Ae as b,Ce as c,zt as d,Vt as e,ce as f,Yt as g,de as h,Qt as i,he as j,Zt as k,Wt as l,te as m,ee as n,oe as o,ue as p,ae as q,ne as r,Fe as s,me as t,ge as u,se as v,ie as w,Me as x,re as y,le as z};
