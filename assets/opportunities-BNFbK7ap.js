import{r as a,j as e,c as me,i as he,g as $}from"./index-U3pxML4x.js";import{J as te,O,B as f,H as l,C as xe,I as fe,K as ee,k as je}from"./constants-j_evCGIy.js";import{aa as K,G as ge,ab as pe,ac as ve,ad as ye,ae as be,af as we,ag as Se}from"./db-cUw2cP4H.js";import{g as G}from"./distance-DNOHIura.js";import{S as ke}from"./Student_Display_Tile-Baz9R7gj.js";function Ne({close:c,dialogRef:i,confirmed:r}){const[u,g]=a.useState(!1);return e.jsx("dialog",{ref:i,children:e.jsxs("div",{className:"ConfirmApplyDialog",children:[e.jsx("h2",{children:"Did you apply?"}),e.jsx("br",{}),u?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{g(!0),await r(),g(!1)},children:"Yes"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{c()},children:"No"})]})})}function Fe({opportunity:c,accountType:i,studentData:r,onEdit:u,onRemove:g,onApply:N,onRSVP:S,onViewAttendees:L}){const m=a.useRef(null),[A,d]=a.useState(!1),[w,x]=a.useState(!1);function F(n,o,B){const p=new Intl.DateTimeFormat("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),C=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),v=p.format(n),R=C.format(o),D=C.format(B);return`On ${v} from ${R} to ${D}`}function T(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Job"}),e.jsx("div",{className:"divider"}),i==="student"&&e.jsxs("label",{children:[n.companyName," • ",G(n.location.location.latitude,n.location.location.longitude,r.homeLocation.location.latitude,r.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsxs("label",{htmlFor:"",children:["$",n.hourlyRate.toFixed(2)," per hour"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==f.Weekdays?"Weekdays":n.shiftType==f.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),i==="student"&&e.jsx("label",{children:"Description: "}),i==="student"&&e.jsx("label",{children:n.description}),i==="student"&&e.jsx("br",{}),i==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var o;window.open(n.applicationLink,"_blank"),(o=m.current)==null||o.showModal()},children:"Apply"}),i==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),i==="employer"?A?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{d(!0),await g(),d(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function W(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"One Time Volunteer"}),e.jsx("div",{className:"divider"}),i==="student"&&e.jsxs("label",{children:[n.companyName," • ",G(n.location.location.latitude,n.location.location.longitude,r.homeLocation.location.latitude,r.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:F(n.eventDate.date,n.eventDate.from,n.eventDate.to)}),e.jsx("br",{}),i==="student"&&e.jsx("label",{children:"Description: "}),i==="student"&&e.jsx("label",{children:n.description}),i==="student"&&e.jsx("br",{}),i==="student"?w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var o;if(n.applicationLink===""){x(!0),await S(),x(!1);return}window.open(n.applicationLink,"_blank"),(o=m.current)==null||o.showModal()},children:"RSVP"}):w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var o;if(n.applicationLink===""){x(!0),await L(),x(!1);return}window.open(n.applicationLink,"_blank"),(o=m.current)==null||o.showModal()},children:"View Attendees"}),i==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),i==="employer"?A?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{d(!0),await g(),d(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function k(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Recurring Volunteer"}),e.jsx("div",{className:"divider"}),i==="student"&&e.jsxs("label",{children:[n.companyName," • ",G(n.location.location.latitude,n.location.location.longitude,r.homeLocation.location.latitude,r.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==f.Weekdays?"Weekdays":n.shiftType==f.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),i==="student"&&e.jsx("label",{children:"Description: "}),i==="student"&&e.jsx("label",{children:n.description}),i==="student"&&e.jsx("br",{}),i==="student"&&w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var o;if(n.applicationLink===""){x(!0),await S(),x(!1);return}window.open(n.applicationLink,"_blank"),(o=m.current)==null||o.showModal()},children:"RSVP"}),i==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),i==="employer"?A?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{d(!0),await g(),d(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}return e.jsxs(e.Fragment,{children:[c instanceof te?T(c):c instanceof O?W(c):k(c),i==="student"&&e.jsx(Ne,{dialogRef:m,close:()=>{var n;(n=m.current)==null||n.close()},confirmed:async()=>{var n;c.applicants.push(r.toActivityMember()),c.lastUpdated=Date.now(),await K(c,!0),(n=m.current)==null||n.close(),N()}})]})}function Ce({attendees:c,dialogRef:i,close:r}){const[u,g]=a.useState(0);return e.jsx("dialog",{className:"AttendeesDialog",ref:i,children:e.jsxs("div",{className:"StudentListTile",children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"StudentListNameDiv",children:e.jsx("label",{htmlFor:"StudentList",children:"Students "})})}),e.jsx("br",{}),e.jsx("div",{className:"students-section",children:e.jsx("div",{className:"students",id:"students-"+u,children:c.map((N,S)=>e.jsx(ke,{activityId:"",student:N},S))})}),e.jsx("div",{className:"footer",children:e.jsx("button",{className:"ActionBtn",onClick:()=>{r()},children:"Close"})})]})})}me(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(De,{})}));function De(){const[c,i]=a.useState("student"),[r,u]=a.useState([]),[g,N]=a.useState(!0),[S,L]=a.useState(!1),[m,A]=a.useState(null),[d,w]=a.useState(l.Job),[x,F]=a.useState(f.Weekdays),[T,W]=a.useState(0),[k,n]=a.useState(""),[o,B]=a.useState(""),[p,C]=a.useState(),[v,R]=a.useState(),[D,M]=a.useState(),[E,P]=a.useState(),[se,U]=a.useState(""),[ne,H]=a.useState(""),[Y,ae]=a.useState([]),[V,q]=a.useState(""),[ie,z]=a.useState(!1),[y,Q]=a.useState(null),[I,X]=a.useState(!1),[J,le]=a.useState(void 0),_=a.useRef(null),[oe,Z]=a.useState([]);a.useEffect(()=>{he(()=>{}),new URLSearchParams(window.location.search);const t=localStorage.getItem("accountType");t&&i(t),t=="student"?ge().then(s=>{const h=s;le(s),pe().then(b=>{u(b.filter(j=>!(j.applicants.find(ue=>ue.userId==h.uid)&&j.type==l.Job))),N(!1)})}):ve().then(s=>{s||(window.location.href="/"),A(s),ae([...s.savedLocations,s.location]),C(s.location),(s==null?void 0:s.type)==xe.Job?w(l.Job):w(l.OneTimeVolunteer),ye().then(h=>{u(h),N(!1),console.log(h)})})},[]);const re=t=>{const s=t.target.value,[h,b]=s.split(":").map(Number),j=new Date(v);j.setHours(h,b,0,0),M(j),U(j.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},de=t=>{const s=t.target.value,[h,b]=s.split(":").map(Number),j=new Date(v);j.setHours(h,b,0,0),P(j),H(j.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(t){return this.setTime(this.getTime()+t*60*60*1e3),this};function ce(){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"createOpportunity",children:[e.jsxs("h1",{children:[I?"Edit":"Create"," Opportunity"]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Position: "}),e.jsx("input",{placeholder:"Position",value:k,onChange:t=>{n(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Description: "}),e.jsx("textarea",{placeholder:"Description",value:o,onChange:t=>{B(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Locaiton: "}),e.jsx("select",{name:"location",id:"",value:p==null?void 0:p.address,onChange:t=>{const s=Y.find(h=>h.address==t.target.value);s&&C(s)},children:Y.map(t=>e.jsx("option",{value:t.address,children:t.name}))})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Opporunity Type: "}),e.jsxs("select",{name:"opportunityType",id:"",value:d,onChange:t=>{w(t.target.value)},children:[e.jsx("option",{value:l.Job,children:"Job"}),e.jsx("option",{value:l.OneTimeVolunteer,children:"One Time Volunteer"}),e.jsx("option",{value:l.RecurringVolunteer,children:"Recurring Volunteer"})]})]}),d==l.Job&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Salary: "}),e.jsx("input",{type:"number",placeholder:"Salary",value:T,onChange:t=>{W(parseFloat(t.target.value))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:x,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:f.Weekdays,children:"Weekdays"}),e.jsx("option",{value:f.Weekends,children:"Weekends"}),e.jsx("option",{value:f.All,children:"Weekdays and Weekends"})]})]})]}),d==l.OneTimeVolunteer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:v==null?void 0:v.toISOString().split("T")[0],onChange:t=>{const s=new Date(t.target.value);if(s=="Invalid Date"){R(new Date);return}s.setHours(0,0,0,0),s.setDate(s.getDate()+1),R(s);const h=new Date(s);h.setHours(D.getHours(),D.getMinutes(),0,0),M(h),U(h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const b=new Date(s);b.setHours(E.getHours(),E.getMinutes(),0,0),P(b),H(b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:se,onChange:re})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:ne,onChange:de})]})]}),d==l.RecurringVolunteer&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:x,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:f.Weekdays,children:"Weekdays"}),e.jsx("option",{value:f.Weekends,children:"Weekends"}),e.jsx("option",{value:f.All,children:"Weekdays and Weekends"})]})]})}),e.jsxs("div",{className:"FormRow",children:[e.jsxs("label",{htmlFor:"",children:["Application Link ",d!=l.Job?"(Optional)":"",": "]}),e.jsx("input",{placeholder:"Application Link",value:V,onChange:t=>{q(t.target.value)}})]}),ie?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(k==""||o==""||p==null){alert("Please fill out all fields");return}if(d==l.Job&&V==""){alert("Please fill out all fields");return}if(d==l.Job&&(T==0||x==null)){alert("Please fill out all fields");return}if(d==l.OneTimeVolunteer&&(v==null||D==null||E==null)){alert("Please fill out all fields");return}if(d==l.RecurringVolunteer&&x==null){alert("Please fill out all fields");return}z(!0);let t;if(d==l.Job)t=new te({companyName:m.name,position:k,description:o,location:p,shiftType:x,hourlyRate:T,applicationLink:V,companyId:m.id,id:"",type:l.Job,isAvailable:!0,lastUpdated:Date.now(),creatorId:$(),applicants:[]});else if(d==l.OneTimeVolunteer){const s=je.fromBlank(v,D,E);t=new O({companyName:m.name,position:k,description:o,location:p,eventDate:s,applicationLink:V,companyId:m.id,id:"",type:l.OneTimeVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[],creatorId:$(),taskId:I?y.taskId:""})}else t=new ee({companyName:m.name,position:k,description:o,location:p,shiftType:x,applicationLink:V,companyId:m.id,id:"",type:l.RecurringVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],creatorId:$(),volunteers:[]});console.log(t),I?(t.id=y.id,(y==null?void 0:y.type)==l.OneTimeVolunteer&&t.type!=l.OneTimeVolunteer&&await we(y.taskId),await K(t,!1),u(r.map(s=>s.id==(y==null?void 0:y.id)?t:s)),Q(null),X(!1)):(t=await Se(t),r.push(t),u(r),L(!1)),z(!1)},children:I?"Save":"Create"})]})})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Opportunities"})}),e.jsxs("div",{className:"center",children:[g&&e.jsx("div",{className:"loader"}),S||I?ce():e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opportunities",children:r.map(t=>e.jsx(Fe,{opportunity:t,accountType:c,studentData:J,onViewAttendees:()=>{var s;Z(t.applicants),t instanceof O&&Z(t.volunteers),(s=_.current)==null||s.showModal()},onApply:()=>{t.type==l.Job&&u(r.filter(s=>s.id!=t.id))},onRSVP:async()=>{const s=fe.fromMap(t.toMap());s.applicants.push(J.toActivityMember()),s instanceof O&&s.volunteers.push(J.toActivityMember()),s instanceof ee&&s.volunteers.push(J.toActivityMember()),s.lastUpdated=Date.now(),await K(s,!0)},onEdit:()=>{if(Q(t),w(t.type),n(t.position),B(t.description),C(t.location),t.type==l.Job&&(W(t.hourlyRate),F(t.shiftType)),t.type==l.OneTimeVolunteer){const s=t.eventDate;R(s.date),M(s.from),P(s.to),U(s.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),H(s.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}t.type==l.RecurringVolunteer&&F(t.shiftType),q(t.applicationLink),X(!0)},onRemove:async()=>{await be(t),u(r.filter(s=>s.id!=t.id))}}))}),c=="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{L(!0)},children:"Create Opportunity"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{S?L(!1):window.location.href="/"},children:"Back"})]}),e.jsx(Ce,{attendees:oe,dialogRef:_,close:()=>{var t;(t=_.current)==null||t.close()}})]})}
