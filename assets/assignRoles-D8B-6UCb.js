import{j as c,c as P,r as f,i as U}from"./index-BrfWEQze.js";import{d as A,E as R,f as H,C as d,b as I,e as q}from"./constants-BaAdZBoe.js";import{C as z,S as K}from"./Show_Group_Tile-DUQneAVq.js";import{n as Q,s as V}from"./db-D_7SZOlL.js";import{T as W}from"./trash-BnpXJPEK.js";import{A as X}from"./Ensemble_Section_Tile-DsdJNtKT.js";function Y({actor:u,canDelete:j,onDelete:g}){return c.jsx("div",{className:"ActorTile",id:"actor-tile-"+u.userId,children:c.jsxs("div",{className:"header",children:[c.jsx("div",{className:"ActorNameDiv",children:c.jsxs("label",{htmlFor:"Actor",children:["Actor: ",u.name]})}),j&&c.jsx("div",{className:"ActorTrashDiv",children:c.jsx("img",{src:W,alt:"",className:"TrashIcon",onClick:()=>{g()}})})]})})}P(document.getElementById("root")).render(c.jsx(f.StrictMode,{children:c.jsx(Z,{})}));function Z(){const[u,j]=f.useState(""),[g,T]=f.useState(""),[n,y]=f.useState(),[m,v]=f.useState([]),[w,x]=f.useState([]),[k,G]=f.useState(!1),[N,J]=f.useState([]),[S,b]=f.useState([]),[O,E]=f.useState(!1),C=f.useRef(null),[B,D]=f.useState(!1);async function F(){let l=!0;if(G(!0),!n){G(!1);return}for(let s=0;s<n.characters.length;s++){const t=n.characters[s],e=m.find(a=>a.name==t.name);e&&(console.log("New Character"),console.log(e),n.characters[s]=e,e.actor==null&&(console.log("Actor is null"),l=!1))}for(let s=0;s<n.showGroups.length;s++){const t=n.showGroups[s];if(w.find(a=>a.name==t.name))for(let a=0;a<t.characters.length;a++){const o=t.characters[a];if(o instanceof d){const r=m.find(i=>i.name==o.name);r&&(t.characters[a]=r,r.actor==null&&(l=!1))}}}for(let s=0;s<n.layout.length;s++){const t=n.layout[s];for(let e=0;e<t.scenes.length;e++){const a=t.scenes[e];for(let o=0;o<a.characters.length;o++){const r=a.characters[o];if(r instanceof d){const i=m.find(h=>h.name==r.name);i&&(a.characters[o]=i)}else if(r instanceof I){const i=w.find(h=>h.name==r.name);if(i){for(let h=0;h<i.characters.length;h++){const p=i.characters[h];if(p instanceof d){const M=m.find(L=>L.name==p.name);M&&(i.characters[h]=M)}}a.characters[o]=i}}}}}for(let s=0;s<n.songs.length;s++){const t=n.songs[s];console.log("Assigning roles to song"),console.log(t);for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(console.log("Character"),console.log(a),console.log(typeof a),a instanceof d){const o=m.find(r=>r.name==a.name);o&&(t.characters[e]=o)}else if(a instanceof I){const o=w.find(r=>r.name==a.name);if(o){for(let r=0;r<o.characters.length;r++){const i=o.characters[r];if(i instanceof d){const h=m.find(p=>p.name==i.name);h&&(o.characters[r]=h)}}t.characters[e]=o}}console.log("New Character"),console.log(t.characters[e]),console.log(typeof t.characters[e])}}for(let s=0;s<n.dances.length;s++){const t=n.dances[s];for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(a instanceof d){const o=m.find(r=>r.name==a.name);o&&(t.characters[e]=o)}else if(a instanceof I){const o=w.find(r=>r.name==a.name);if(o){for(let r=0;r<o.characters.length;r++){const i=o.characters[r];if(i instanceof d){const h=m.find(p=>p.name==i.name);h&&(o.characters[r]=h)}}t.characters[e]=o}}}}n.canCreateSchedule=l,n.ensemble=q.fromBlank(S,Date.now()),y(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+g,JSON.stringify(n)),await V(u,g,n),G(!1)}return f.useEffect(()=>{U(()=>{}),E(!0);const l=new URLSearchParams(window.location.search),s=l.get("activityId");s&&(j(s),Q(s).then(a=>{J(a),console.log(a),E(!1)}));const t=l.get("showId");t&&T(t);const e=localStorage.getItem("show-"+t);if(e){console.log(JSON.parse(e)),y(A.fromMap(JSON.parse(e))),console.log(A.fromMap(JSON.parse(e))),v(A.fromMap(JSON.parse(e)).characters),x(A.fromMap(JSON.parse(e)).showGroups);const a=A.fromMap(JSON.parse(e)).showGroups;let o=!1;for(let r=0;r<a.length;r++)a[r].characters.map(h=>h instanceof R).includes(!0)&&(o=!0);D(o)}},[]),c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"title",children:c.jsx("h1",{children:"Assign Roles"})}),c.jsxs("div",{className:"center",children:[c.jsx("h2",{children:"Assign Characters"}),c.jsx("div",{className:"characters",id:"create-characters",children:m.map((l,s)=>c.jsx(z,{character:l,actors:N,characters:[],isAssign:!0,setCharacter:t=>{v(e=>{const a=[...e];return a[s]=t,a})},removeCharacter:()=>{v(m.filter((t,e)=>e!==s))},isCreate:!1},s))}),B&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Show Groups"}),c.jsx("div",{className:"showGroups",id:"create-showGroups",children:w.map((l,s)=>l.characters.map(t=>t instanceof R).includes(!0)?c.jsx(K,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:m,actors:N,isAssign:!0,setShowGroup:t=>{x(e=>{const a=[...e];return a[s]=t,a})},removeShowGroup:()=>{x(w.filter((t,e)=>e!==s))},isCreate:!1},s):null)})]}),(n==null?void 0:n.hasEnsemble)&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Ensemble"}),c.jsx("div",{className:"ensemble",id:"create-ensemble",children:S.map((l,s)=>(console.log(l),c.jsx(Y,{actor:l,canDelete:!0,onDelete:()=>{b(S.filter((t,e)=>e!==s))}},s)))}),c.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=C.current)==null||l.showModal()},children:"Add Actor"})]}),k?c.jsx("div",{className:"loader"}):c.jsx("button",{className:"ActionBtn",onClick:async()=>{await F(),window.location.href="/Activity/Shows/Show/?activityId="+u+"&showId="+g},children:"Save"}),c.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+u+"&showId="+g},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!O&&c.jsx(X,{dialogRef:C,keepPastResult:!1,actor:new H,addedActors:S,actors:N,setActor:l=>{var t;const s=[...S];s.push(l),console.log("Setting actors"),b(s),(t=C.current)==null||t.close()},close:()=>{var l;(l=C.current)==null||l.close()}})]})}
