import{w as It,x as l,y as c,z as T,q as _,g as b,B as U,H as I,d as Y,f as L,I as S,J as D,K as C,i as G,N as R,m as V,O as q,S as z,T as yt,P as k,Q as vt,U as B,u as wt,r as E,V as st,W as at,M as K,s as A,X as St,p as x,Y as O,n as Dt,L as dt,C as H,b as nt,F as Tt,E as ct}from"./constants-CXGD8REG.js";import{h as Mt,C as Ct,k as it,_ as At,d as W,e as Et,f as kt,F as bt,n as Z,g as P}from"./index-C75OlIaX.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut="type.googleapis.com/google.protobuf.Int64Value",Nt="type.googleapis.com/google.protobuf.UInt64Value";function ft(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function Q(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>Q(e));if(typeof t=="function"||typeof t=="object")return ft(t,e=>Q(e));throw new Error("Data cannot be encoded in JSON: "+t)}function $(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Ut:case Nt:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>$(e)):typeof t=="function"||typeof t=="object"?ft(t,e=>$(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tt="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends bt{constructor(e,o,s){super(`${tt}/${e}`,o||""),this.details=s}}function Ft(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Lt(t,e){let o=Ft(t),s=o,a;try{const n=e&&e.error;if(n){const u=n.status;if(typeof u=="string"){if(!rt[u])return new F("internal","internal");o=rt[u],s=u}const r=n.message;typeof r=="string"&&(s=r),a=n.details,a!==void 0&&(a=$(a))}}catch{}return o==="ok"?null:new F(o,s,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(a=>this.auth=a,()=>{}),this.messaging||o.get().then(a=>this.messaging=a,()=>{}),this.appCheck||s.get().then(a=>this.appCheck=a,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),a=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X="us-central1";function Rt(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new F("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class Ot{constructor(e,o,s,a,n=X,u){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new Pt(o,s,a),this.cancelAllRequests=new Promise(r=>{this.deleteService=()=>Promise.resolve(r())});try{const r=new URL(n);this.customDomain=r.origin+(r.pathname==="/"?"":r.pathname),this.region=X}catch{this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function _t(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function xt(t,e,o){return s=>Bt(t,e,s,{})}async function Gt(t,e,o,s){o["Content-Type"]="application/json";let a;try{a=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let n=null;try{n=await a.json()}catch{}return{status:a.status,json:n}}function Bt(t,e,o,s){const a=t._url(e);return $t(t,a,o,s)}async function $t(t,e,o,s){o=Q(o);const a={data:o},n={},u=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);u.authToken&&(n.Authorization="Bearer "+u.authToken),u.messagingToken&&(n["Firebase-Instance-ID-Token"]=u.messagingToken),u.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=u.appCheckToken);const r=s.timeout||7e4,f=Rt(r),i=await Promise.race([Gt(e,a,n,t.fetchImpl),f.promise,t.cancelAllRequests]);if(f.cancel(),!i)throw new F("cancelled","Firebase Functions instance was deleted.");const d=Lt(i.status,i.json);if(d)throw d;if(!i.json)throw new F("internal","Response is not valid JSON object.");let h=i.json.data;if(typeof h>"u"&&(h=i.json.result),typeof h>"u")throw new F("internal","Response is missing data field.");return{data:$(h)}}const lt="@firebase/functions",ut="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="auth-internal",Ht="app-check-internal",jt="messaging-internal";function Vt(t,e){const o=(s,{instanceIdentifier:a})=>{const n=s.getProvider("app").getImmediate(),u=s.getProvider(Jt),r=s.getProvider(jt),f=s.getProvider(Ht);return new Ot(n,u,r,f,a,t)};Mt(new Ct(tt,o,"PUBLIC").setMultipleInstances(!0)),it(lt,ut,e),it(lt,ut,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t=kt(),e=X){const s=At(W(t),tt).getImmediate({identifier:e}),a=Et("functions");return a&&qt(s,...a),s}function qt(t,e,o){_t(W(t),e,o)}function et(t,e,o){return xt(W(t),e)}Vt(fetch.bind(self));const Kt=ht(Z);function N(t,e,o,s){et(Kt,"sendEmail")({emails:e.map(a=>a.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:t.message,senderName:t.senderName})}const mt=ht(Z),m=It(Z),gt=l(m,"schools"),Qt=async t=>{const e=c(gt,t);return(await T(e)).data()},Zt=async()=>{const t=await S(gt),e=[];return t.forEach(o=>{e.push(o.data())}),e},te=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=c(m,"schools",e);if(t=="student"){const s=D(l(o,"activities"),C("studentUids","array-contains",P())),a=[];return(await S(s)).forEach(u=>{a.push(b.fromMap(u.data()))}),a}else{const s=D(l(o,"activities"),C("teacherUids","array-contains",P())),a=[];return(await S(s)).forEach(u=>{console.log(u.data()),a.push(b.fromMap(u.data()))}),a}};async function Xt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(m,"schools",e),s=c(l(o,"activities"),t),a=await T(s);return a.exists()?a.data().type=="theater"?_.fromMap(a.data()):b.fromMap(a.data()):null}async function ee(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=l(s,"shows"),n=await U(a,t.toMap());return t.id=n.id,await I(n,{id:n.id}),n.id}async function oe(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=c(l(s,"shows"),t.id);await I(a,t.toMap())}async function se(t){const e=l(m,"showTemplates"),o=await U(e,t.toMap());return t.id=o.id,await I(o,{id:o.id}),o.id}async function ae(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(m,"schools",o),a=c(l(s,"activities"),t),n=c(l(a,"shows"),e),u=await T(n);return u.exists()?(console.log(u.data()),Y.fromMap(u.data())):null}async function ne(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=c(m,"schools",e),s=c(l(o,"activities"),t),a=await T(s);if(!a.exists())return[];const n=[];return a.data().students.forEach(u=>{n.push(L.fromMap(u))}),n}async function ce(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e);await R(u,o.toMap())}async function ie(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=l(s,"events"),n=await U(a,t.toMap());t.id=n.id,await I(n,{id:n.id})}async function re(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(m,"schools",o),n=c(l(a,"activities"),t),u=l(n,"events");if(s=="student"){const r=await S(D(u,C("showId","==",e),C("targetUids","array-contains",P()))),f=[];return r.forEach(i=>{i.data().deleted||f.push(G.fromMap(i.data()))}),f}else{const r=await S(D(u,C("showId","==",e))),f=[];return r.forEach(i=>{i.data().deleted||f.push(G.fromMap(i.data()))}),f}}async function le(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=c(l(s,"events"),t.id);await I(a,{deleted:!0}),await et(mt,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function ue(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=c(m,"schools",e),s=c(l(o,"activities"),t),a=l(s,"shows"),n=await S(a),u=[];return n.forEach(r=>{u.push(Y.fromMap(r.data()))}),u}async function de(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e);await I(u,{conflictForm:o.toMap()}),await et(mt,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function fe(){const t=await P(),e=localStorage.getItem("schoolId");if(!e)return null;const o=c(m,"schools",e),s=l(o,"students"),a=c(s,t),n=await T(a);return n.exists()?L.fromMap(n.data()):null}async function he(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e),r=c(u,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await R(r,o.toMap())}async function me(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const a=c(m,"schools",o),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e),r=l(u,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(P());const d=await S(D(r,C("submitterId","==",P()))),h=[];return d.forEach(w=>{h.push(V.fromMap(w.data()))}),h}const f=await S(r),i=[];return f.forEach(d=>{i.push(V.fromMap(d.data()))}),i}async function ge(){const t=l(m,"showTemplates"),e=await S(t),o=[];return e.forEach(s=>{o.push(Y.fromMap(s.data()))}),o}async function pe(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const a=c(m,"schools",e),n=D(l(a,"activities"),C("joinCode","==",t)),u=await S(n);if(u.empty)return null;const r=u.docs[0],f=c(l(a,s=="student"?"students":"teachers"),o),i=await T(f);if(console.log(i.data()),!i.exists())return null;if(r.data().studentUids.includes(o)||r.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),r.data().type=="theater"){if((i.data().gender==null||i.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),i.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(i.data().phoneNumber==""||i.data().gender==null||i.data().gender=="")&&s=="student")return null;if(s=="student")return await I(r.ref,{studentUids:[...r.data().studentUids,o],students:[...r.data().students,L.fromMap(i.data()).toMap()]}),_.fromMap(r.data());{console.log("Joining as teacher"),console.log(i.data());const d=B.fromBlank(i.data().fullname,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return console.log(d.toMap()),await I(r.ref,{teacherUids:[...r.data().teacherUids,o],teachers:[...r.data().teachers,d.toMap()]}),_.fromMap(r.data())}}else if(s=="student"){const d=L.fromBlank(i.data().fullname,i.data().gender,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return await I(r.ref,{studentUids:[...r.data().studentUids,o],students:[...r.data().students,d.toMap()]}),b.fromMap(r.data())}else{const d=B.fromBlank(i.data().fullname,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return await I(r.ref,{teacherUids:[...r.data().teacherUids,o],teachers:[...r.data().teachers,d.toMap()]}),b.fromMap(r.data())}}async function Ie(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const a=c(m,"schools",e),n=c(l(a,s=="student"?"students":"teachers"),o);await I(n,{gender:t})}async function ye(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const a=c(m,"schools",e),n=c(l(a,s=="student"?"students":"teachers"),o);await I(n,{phoneNumber:t})}async function ve(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=c(l(s,"events"),t.id);await I(a,t.toMap())}async function we(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=c(m,"schools",t),a=[];let n;o=="student"?n=await S(D(l(s,"activities"),C("studentUids","array-contains",e))):n=await S(D(l(s,"activities"),C("teacherUids","array-contains",e))),console.log(n);for(const u of n.docs){let r;o=="student"?r=await S(D(l(u.ref,"events"),C("targetUids","array-contains",e))):r=await S(l(u.ref,"events"));for(const f of r.docs){const i=f.data();console.log(i),i.type=="activity-theater-event"?a.push(G.fromMap(i)):a.push(wt.fromMap(i))}}return a}async function Se(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const a=c(m,"schools",o),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e),r=l(u,"conflictResponses"),f=await T(c(r,s));return f.exists()?V.fromMap(f.data()):null}async function De(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=c(l(s,"activities"),t);await I(a,{rehearsalLocations:e.map(n=>n.toMap())})}async function Te(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const a=localStorage.getItem("accountType"),n=c(m,"schools",o),u=c(l(n,"activities"),t);if(a=="teacher")q(l(u,"groupChats"),async r=>{const f=[];for(const i of r.docs){const d=E.fromMap(i.data());if((d.generalTarget=="direct"||d.generalTarget=="custom")&&!d.members.find(p=>p.userId==s))continue;if(d.generalTarget=="direct"){const p=d.members.find(g=>g.userId!=s);d.name=(p==null?void 0:p.name)||"Unknown"}const h=l(i.ref,"messages"),w=D(h,at("timeSent","desc"),st(1)),y=await S(w);y.empty||(d.lastMessage=K.fromMap(y.docs[0].data())),f.push(d)}f.sort((i,d)=>i.lastMessage?d.lastMessage?d.lastMessage.timeSent.getTime()-i.lastMessage.timeSent.getTime():-1:1),e(f)});else{const r=c(l(n,"students"),s),f=await T(r);if(!f.exists())return;const i=z.fromMap(f.data());console.log(i),q(l(u,"groupChats"),async d=>{const h=[];for(const w of d.docs){const y=E.fromMap(w.data());if(!(y.generalTarget=="everyone"||y.generalTarget=="students")&&(y.generalTarget=="parents"||!y.members.find(M=>M.userId==s)))continue;if(y.generalTarget=="direct"){const M=y.members.find(J=>J.userId!=s);y.name=(M==null?void 0:M.name)||"Unknown"}const p=l(w.ref,"messages"),g=D(p,at("timeSent","desc"),st(1)),v=await S(g);v.empty||(y.lastMessage=K.fromMap(v.docs[0].data())),h.push(y)}h.sort((w,y)=>w.lastMessage?y.lastMessage?y.lastMessage.timeSent.getTime()-w.lastMessage.timeSent.getTime():-1:1),e(h)})}}async function Me(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const a=c(m,"schools",s),n=c(l(a,"activities"),t);console.log("Getting messages for "+e);const u=c(l(n,"groupChats"),e),r=l(u,"messages");q(r,f=>{const i=[];f.forEach(d=>{i.push(K.fromMap(d.data()))}),i.sort((d,h)=>d.timeSent.getTime()-h.timeSent.getTime()),o(i)})}async function ot(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=c(m,"schools",t),a=c(l(s,o=="student"?"students":"teachers"),e),n=await T(a);return n.exists()?o=="student"?z.fromMap(n.data()):yt.fromMap(n.data()):null}async function Ce(t,e,o,s,a){if(o.message=="")return;const n=localStorage.getItem("schoolId"),u=localStorage.getItem("userId");if(!n||!u)return;const r=c(m,"schools",n),f=c(l(r,"activities"),t),i=c(l(f,"groupChats"),e),d=await T(i);if(!d.exists()){if(a==null)return;const p=await ot();if(!p)return;const g=E.fromBlank("",a.userId,[A.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),a],"direct",t,Date.now());await R(i,g.toMap());const v=l(i,"messages"),M=await U(v,o.toMap());o.messageId=M.id,await I(M,{messageId:M.id}),N(o,[A.fromMap(a)],g,s);return}const h=E.fromMap(d.data()),w=l(i,"messages"),y=await U(w,o.toMap());if(o.messageId=y.id,await I(y,{messageId:y.id}),h.generalTarget!="direct"&&h.generalTarget!="custom"&&h.generalTarget!="group"){const p=await Xt(t);if(!p)return;if(h.generalTarget=="everyone"){let g=p.students.map(v=>A.fromMap(v));g=g.concat(p.teachers.map(v=>A.fromMap(v))),g=g.concat(p.parents.map(v=>A.fromMap(v))),g=g.filter(v=>v.userId!=o.senderUid),N(o,g,h,p.name)}else if(h.generalTarget=="students"){let g=p.students.map(v=>A.fromMap(v));g=g.filter(v=>v.userId!=o.senderUid),N(o,g,h,p.name)}else if(h.generalTarget=="parents"){let g=p.parents.map(v=>A.fromMap(v));g=g.filter(v=>v.userId!=o.senderUid),N(o,g,h,p.name)}return}if(h.generalTarget=="direct"){const p=h.members.find(g=>g.userId!=u);if(!p)return;N(o,[p],h,s);return}if(h.generalTarget=="custom"){N(o,h.members.filter(p=>p.userId!=u),h,s);return}}async function j(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=l(s,"groupChats"),n=await ot();if(!n)return;const u=A.fromBlank(n.fullname,n.email,n.phoneNumber,n.FCMToken,n.uid);t.members.push(u);const r=await U(a,t.toMap());t.id=r.id,await I(r,{id:r.id})}async function Ae(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e);I(u,{resources:k(o.toMap())})}async function Ee(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e);I(u,{resources:St(o.toMap())})}async function ke(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const a=c(m,"schools",s),n=c(l(a,"activities"),t),u=c(l(n,"shows"),e),r=l(u,"conflictResponses"),f=c(r,o.id);await vt(f)}async function be(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=l(s,t+"s");await R(c(a,e.uid),e.toMap());let n;e instanceof z?n=L.fromBlank(e.fullname,e.gender,e.email,e.phoneNumber,e.FCMToken,e.uid):n=B.fromBlank(e.fullname,e.email,e.phoneNumber,e.FCMToken,e.uid),await I(s,{[t+"Uids"]:k(e.uid),[t+"s"]:k(n.toMap())})}function Yt(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function Ue(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(m,"schools",o),a=await T(s);if(!a.exists())return null;const n=a.data(),u=l(s,"activities"),r=Yt(t),f=[x.fromMap({name:"Rehearsal",color:O("#FF0000")}),x.fromMap({name:"Performance",color:O("#00FF00")})],i=[x.fromMap({name:"Practice",color:O("#FF0000")}),x.fromMap({name:"Game",color:O("#00FF00")})],d=[Dt.fromMap({name:"Auditorium",color:O("#0000FF")})],h=dt.fromMap(n.location),w=[h],y=await ot();if(!y)return null;const p=B.fromBlank(y.fullname,y.email,y.phoneNumber,y.FCMToken,y.uid);let g;e=="theater"?g=_.fromBlank(t,"",r,[],[],[],[p],w,f,h,d,"type",Date.now()):g=b.fromBlank(t,"",r,[],[],[],[p],w,i,h,"type",Date.now(),"activity");const v=await U(u,g.toMap());g.id=v.id,await I(v,{id:v.id});const M=E.fromMap({name:"Everyone",members:[],id:"",activityId:g.id,lastUpdated:Date.now(),generalTarget:"everyone"});await j(M);const J=E.fromMap({name:"Parents",members:[],id:"",activityId:g.id,lastUpdated:Date.now(),generalTarget:"parents"});await j(J);const pt=E.fromMap({name:"Students",members:[],id:"",activityId:g.id,lastUpdated:Date.now(),generalTarget:"students"});return await j(pt),g}async function Ne(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return null;const a=c(m,"schools",s),n=c(l(a,"activities"),o),u=l(n,"groupChats"),r=E.fromBlank("",e.userId,[t,e],"direct",o,Date.now());return await R(c(u,e.userId),r.toMap()),r.name=e.name,r}async function Fe(){const t=await Qt(localStorage.getItem("schoolId")||"");if(!t)return[];const e=[];return t.savedLocations.forEach(o=>{e.push(dt.fromMap(o))}),e}async function Le(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=c(l(s,"activities"),t);await I(a,{locations:k(e.toMap())})}async function Pe(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e);await I(o,{savedLocations:k(t.toMap())})}async function Re(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=c(l(s,"activities"),t);await I(a,{eventTypes:k(e.toMap())})}async function Oe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=c(l(s,"activities"),t),n=c(l(a,"shows"),e);await I(n,{isCreatingSchedule:!0})}async function _e(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(m,"schools",o),a=l(s,"students");await R(c(a,t.uid),t.toMap());const n=L.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid);await I(s,{studentUids:k(t.uid),students:k(n.toMap())});const u=n.userId;if(!o||!u)return null;const r=c(l(s,"activities"),e),f=await T(r);return f.exists()?f.data().type=="theater"?(await I(f.ref,{studentUids:[...f.data().studentUids,u],students:[...f.data().students,n.toMap()]}),_.fromMap(f.data())):(await I(f.ref,{studentUids:[...f.data().studentUids,u],students:[...f.data().students,n.toMap()]}),b.fromMap(f.data())):null}async function xe(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(m,"schools",e),s=c(l(o,"activities"),t.activityId),a=D(l(s,"events"),C("showId","==",t.id)),n=await S(a);for(const u of n.docs){const r=G.fromMap(u.data());for(let i=0;i<r.characters.length;i++){const d=r.characters[i];d instanceof H?r.characters[i]=t.characters.find(h=>h.name==d.name):d instanceof nt&&(r.characters[i]=t.showGroups.find(h=>h.name==d.name))}const f=[];for(const i of r.characters){if(i instanceof Tt){for(const d of t.ensemble.actors)f.push(d);for(const d of t.characters)f.find(h=>h.userId==d.actor.userId)==null&&f.push(d.actor);break}if(i instanceof H){if(f.find(d=>d.userId==i.actor.userId)!=null)continue;f.push(i.actor)}if(i instanceof ct){if(i.includeAll)for(const d of t.ensemble.actors)f.find(h=>h.userId==d.userId)==null&&f.push(d);else if(i.includeMale){for(const d of t.ensemble.actors)if(d.gender=="male"){if(f.find(h=>h.userId==d.userId)!=null)continue;f.push(d)}}else if(i.includeFemale){for(const d of t.ensemble.actors)if(d.gender=="female"){if(f.find(h=>h.userId==d.userId)!=null)continue;f.push(d)}}else if(i.includeCustom)for(const d of i.customActors)f.find(h=>h.userId==d.userId)==null&&f.push(d)}if(i instanceof nt)for(const d of i.characters){if(d instanceof H){if(f.find(h=>h.userId==d.actor.userId)!=null)continue;f.push(d.actor)}if(d instanceof ct){if(d.includeAll)for(const h of t.ensemble.actors)f.find(w=>w.userId==h.userId)==null&&f.push(h);else if(d.includeMale){for(const h of t.ensemble.actors)if(h.gender=="male"){if(f.find(w=>w.userId==h.userId)!=null)continue;f.push(h)}}else if(d.includeFemale){for(const h of t.ensemble.actors)if(h.gender=="female"){if(f.find(w=>w.userId==h.userId)!=null)continue;f.push(h)}}else if(d.includeCustom)for(const h of d.customActors)f.find(w=>w.userId==h.userId)==null&&f.push(h)}}}r.targets=f,r.lastUpdated=Date.now(),await I(u.ref,r.toMap())}}export{he as A,we as B,Se as C,De as D,Le as E,Pe as F,Re as G,Fe as H,j as I,Ce as J,Me as K,Te as L,ot as M,Ne as N,Ae as O,Ee as P,_e as Q,Ie as a,Ue as b,be as c,te as d,Xt as e,ue as f,Zt as g,ge as h,ee as i,pe as j,se as k,oe as l,ae as m,ne as n,xe as o,ce as p,me as q,re as r,Oe as s,le as t,ye as u,ve as v,ie as w,de as x,ke as y,fe as z};
