import{j as e,r as d,c as te}from"./index-BvKDzgix.js";import{J as T,z as E,K as p,l as F,t as se,L as ae,M as ne,N as le,O as re,P as oe,Q as ie,q as ce}from"./db-CcV56dnt.js";import{T as de}from"./trash-BnpXJPEK.js";import{A as ue}from"./Add_User_Dialog-B9hG2C_v.js";function me({conflict:s,canDelete:o,onDelete:j,setConflict:x}){return e.jsx("div",{className:"ConflictDateTile",id:"conflict-date-tile-"+s.date.date.toISOString(),children:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"ConflictDateNameDiv",children:[e.jsx("label",{htmlFor:"Character",children:"Date: "}),e.jsx("input",{type:"date",value:s.date.date.toISOString().slice(0,10),onChange:n=>{const u=new Date(n.target.value);u.setHours(0,0,0,0),x(T.fromBlank(E.fromBlank(u,s.date.from,s.date.to),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Actor",children:"From: "}),e.jsx("input",{type:"time",value:s.date.from.toTimeString().slice(0,5),onChange:n=>{console.log(n.target.value);const u=new Date,g=n.target.value.split(":");u.setHours(parseInt(g[0]),parseInt(g[1]),0,0),x(T.fromBlank(E.fromBlank(s.date.date,u,s.date.to),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Actor",children:"To: "}),e.jsx("input",{type:"time",value:s.date.to.toTimeString().slice(0,5),onChange:n=>{console.log(n.target.value);const u=new Date,g=n.target.value.split(":");u.setHours(parseInt(g[0]),parseInt(g[1]),0,0),console.log({date:u}),x(T.fromBlank(E.fromBlank(s.date.date,s.date.from,u),s.moreInfo))}}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Character",children:"More Info: "}),e.jsx("input",{type:"text",value:s.moreInfo,onChange:n=>{x(T.fromBlank(E.fromBlank(s.date.date,s.date.from,s.date.to),n.target.value))}})]}),o&&e.jsx("div",{children:e.jsx("img",{src:de,alt:"",className:"TrashIcon",onClick:()=>{j()}})})]})})}function he({minTime:s,maxTime:o,setConflict:j,dialogRef:x,close:n,date:u}){const[g,C]=d.useState(p.fromBlank(u,s,o,!0,""));return d.useEffect(()=>{C(p.fromBlank(u,s,o,!0,""))},[s,o,u]),e.jsxs("dialog",{ref:x,className:"AddConflictDialog",children:[e.jsx("h2",{children:"Add Conflict"}),e.jsxs("div",{className:"conflict-times",children:[e.jsx("label",{htmlFor:"",children:"From: "}),e.jsx("input",{type:"time",value:g.from.toTimeString().slice(0,5),onChange:k=>{const D=new Date,y=k.target.value.split(":");D.setHours(parseInt(y[0]),parseInt(y[1]),0,0),C(p.fromBlank(u,D,g.to,!0,g.note))}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"To: "}),e.jsx("input",{type:"time",value:g.to.toTimeString().slice(0,5),onChange:k=>{const D=new Date,y=k.target.value.split(":");D.setHours(parseInt(y[0]),parseInt(y[1]),0,0),C(p.fromBlank(u,g.from,D,!0,g.note))}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Note (Optional): "}),e.jsx("input",{type:"text",value:g.note,onChange:k=>{C(p.fromBlank(u,g.from,g.to,!0,k.target.value))}}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{C(p.fromBlank(u,s,o,!0,"")),j(g)},children:"Add Conflict"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{n()},children:"Close"})]})]})}function xe({conflict:s,conflictResponseDate:o,setConflict:j}){const x=d.useRef(null);return e.jsxs("div",{className:"ConflictDateFormTile",id:"conflict-date-form-tile-"+s.date.date.toISOString(),children:[e.jsx("div",{className:"header",children:e.jsxs("div",{className:"ConflictDateFormNameDiv",children:[e.jsxs("label",{htmlFor:"Character",children:["Date: ",s.date.date.toDateString()]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["From: ",s.date.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," "]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["To: ",s.date.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("br",{}),s.moreInfo!=""&&e.jsxs("label",{htmlFor:"Character",children:["More Info: ",s.moreInfo]})]})}),e.jsxs("div",{className:"can-attend-div",children:[e.jsx("label",{htmlFor:"can-attend-cbox",children:"Can attend rehersal: "}),e.jsxs("div",{className:"custom-checkbox",onClick:()=>{j(p.fromBlank(s.date.date,null,null,!(o!=null&&o.canAttend),""))},children:[e.jsx("input",{type:"checkbox",id:"ensemble",checked:o==null?void 0:o.canAttend,onChange:n=>j(p.fromBlank(s.date.date,null,null,n.target.checked,""))}),e.jsx("span",{className:"checkmark"})]})]}),(o==null?void 0:o.from)&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Conflict:"}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"",children:["From: ",o.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"",children:["To: ",o.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),o.note!=""&&e.jsx("br",{}),o.note!=""&&e.jsxs("label",{htmlFor:"",children:["Note: ",o.note]})]})}),(o==null?void 0:o.canAttend)&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var n;if(o!=null&&o.from){j(p.fromBlank(s.date.date,null,null,!0,""));return}(n=x.current)==null||n.showModal()},children:o!=null&&o.from?"Remove Conflict":"Add Conflict"}),e.jsx(he,{minTime:s.date.from,maxTime:s.date.to,setConflict:n=>{var u;j(p.fromBlank(s.date.date,n.from,n.to,!0,n.note)),(u=x.current)==null||u.close()},date:s.date.date,dialogRef:x,close:()=>{var n;(n=x.current)==null||n.close()}})]})}function ge({dialogRef:s,close:o,addConflicts:j}){const[x,n]=d.useState("daily"),[u,g]=d.useState(new Date),[C,k]=d.useState(new Date),[D,y]=d.useState(new Date),[N,M]=d.useState(new Date),[A,I]=d.useState(""),[r,m]=d.useState([]),[w,L]=d.useState(!1);return e.jsxs("dialog",{ref:s,className:"AddRecurringConflictDialog",children:[e.jsx("h2",{children:"Add Recurring Conflict"}),e.jsx("label",{htmlFor:"",children:"Note: Only use this if you can still attend part of the rehersal!"}),e.jsxs("div",{className:"conflict-times",children:[e.jsx("label",{htmlFor:"",children:"Recurring Type: "}),e.jsxs("select",{name:"recurring-type",id:"recurring-type",value:x,onChange:l=>{n(l.target.value)},children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"biweekly",children:"Every other week"})]}),x=="daily"&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Exclude weekends: "}),e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",id:"ensemble",checked:w,onChange:l=>L(l.target.checked)}),e.jsx("span",{className:"checkmark"})]})]}),(x=="weekly"||x=="biweekly")&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Days of the week: "}),e.jsxs("div",{className:"repeat-days",children:[e.jsx("div",{className:"day-of-week noselect "+(r.includes(0)?"day-chosen":""),onClick:()=>{if(r.includes(0)){m(r.filter(l=>l!=0));return}m([...r,0])},children:e.jsx("label",{htmlFor:"",children:"Sun"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(1)?"day-chosen":""),onClick:()=>{if(r.includes(1)){m(r.filter(l=>l!=1));return}m([...r,1])},children:e.jsx("label",{htmlFor:"",children:"Mon"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(2)?"day-chosen":""),onClick:()=>{if(r.includes(2)){m(r.filter(l=>l!=2));return}m([...r,2])},children:e.jsx("label",{htmlFor:"",children:"Tue"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(3)?"day-chosen":""),onClick:()=>{if(r.includes(3)){m(r.filter(l=>l!=3));return}m([...r,3])},children:e.jsx("label",{htmlFor:"",children:"Wed"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(4)?"day-chosen":""),onClick:()=>{if(r.includes(4)){m(r.filter(l=>l!=4));return}m([...r,4])},children:e.jsx("label",{htmlFor:"",children:"Thu"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(5)?"day-chosen":""),onClick:()=>{if(r.includes(5)){m(r.filter(l=>l!=5));return}m([...r,5])},children:e.jsx("label",{htmlFor:"",children:"Fri"})}),e.jsx("div",{className:"day-of-week noselect "+(r.includes(6)?"day-chosen":""),onClick:()=>{if(r.includes(6)){m(r.filter(l=>l!=6));return}m([...r,6])},children:e.jsx("label",{htmlFor:"",children:"Sat"})})]})]}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Start Date: "}),e.jsx("input",{type:"date",value:u.toISOString().slice(0,10),onChange:l=>{console.log(l.target.value);const i=new Date(l.target.value);i.setHours(0,0,0,0),i.setDate(i.getDate()+1),g(i)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"End Date: "}),e.jsx("input",{type:"date",value:C.toISOString().slice(0,10),onChange:l=>{console.log(l.target.value);const i=new Date(l.target.value);i.setHours(0,0,0,0),i.setDate(i.getDate()+1),k(i)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Start Time: "}),e.jsx("input",{type:"time",value:D.toTimeString().slice(0,5),onChange:l=>{const i=new Date,b=l.target.value.split(":");i.setHours(parseInt(b[0]),parseInt(b[1]),0,0),y(i)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"End Time: "}),e.jsx("input",{type:"time",value:N.toTimeString().slice(0,5),onChange:l=>{const i=new Date,b=l.target.value.split(":");i.setHours(parseInt(b[0]),parseInt(b[1]),0,0),M(i)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Note (Optional): "}),e.jsx("input",{type:"text",value:A,onChange:l=>{I(l.target.value)}}),e.jsx("button",{className:"ActionBtn",onClick:()=>{const l=[],i=new Date(u);i.setHours(0,0,0,0),console.log("Start Date"),console.log(i),console.log("End Date"),console.log(C),C.setHours(0,0,0,0),console.log("End Date Changed"),console.log(C);let b=0;for(;i<=C;)if(console.log(i),x=="daily"?l.push(p.fromBlank(new Date(i),D,N,!0,A)):x=="weekly"?r.includes(i.getDay())&&l.push(p.fromBlank(new Date(i),D,N,!0,A)):x=="biweekly"&&(b%2==0&&r.includes(i.getDay())&&l.push(p.fromBlank(new Date(i),D,N,!0,A)),b++),i.setDate(i.getDate()+1),w)for(;i.getDay()==0||i.getDay()==6;)i.setDate(i.getDate()+1);console.log(l),j(l)},children:"Add Conflicts"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{o()},children:"Close"})]})]})}function je({conflictResponseDate:s}){return e.jsx("div",{className:"SimpleConflictResponseDisplayTile",id:"simple-conflict-response-display-tile-"+s.date.toISOString(),children:e.jsx("div",{className:"header",children:e.jsxs("div",{className:"CharacterNameDiv",children:[e.jsxs("label",{htmlFor:"Actor",children:["Date: ",s.date.toDateString()]}),e.jsx("br",{}),e.jsx("br",{}),s.canAttend?e.jsxs("label",{htmlFor:"Actor",children:[s.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",s.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):e.jsx("label",{htmlFor:"Actor",children:"Can't Attend"}),s.note!=""&&e.jsx("br",{}),s.note!=""&&e.jsx("br",{}),s.note!=""&&e.jsxs("label",{htmlFor:"Actor",children:["Note: ",s.note]})]})})})}te(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(fe,{})}));function fe(){var z;const[s,o]=d.useState(""),[j,x]=d.useState(""),[n,u]=d.useState(),[g,C]=d.useState(null),[k,D]=d.useState(null),[y,N]=d.useState(null),[M,A]=d.useState(null),[I,r]=d.useState([]),[m,w]=d.useState([]),[L,l]=d.useState("setDates"),[i,b]=d.useState(!1),[P,K]=d.useState("student"),[B,J]=d.useState([]),[U,Q]=d.useState(!0),[q,G]=d.useState(null),[W,$]=d.useState(!1),[V,X]=d.useState(),[Y,Z]=d.useState([]),O=d.useRef(null),H=d.useRef(null);return d.useEffect(()=>{const a=new URLSearchParams(window.location.search),t=a.get("activityId");t&&o(t);const c=a.get("showId");c&&x(c);const h=localStorage.getItem("show-"+c);if(h){u(F.fromMap(JSON.parse(h)));let v=[...F.fromMap(JSON.parse(h)).characters.map(f=>f.actor)];F.fromMap(JSON.parse(h)).ensemble&&(v=[...v,...F.fromMap(JSON.parse(h)).ensemble.actors]),v=v.filter((f,_,R)=>_===R.findIndex(ee=>ee.userId===f.userId)),Z(v),console.log(F.fromMap(JSON.parse(h))),se(t,c).then(f=>{J(f),console.log(f)})}const S=localStorage.getItem("accountType");if(S&&(K(S),S=="student"&&h&&F.fromMap(JSON.parse(h)).conflictForm)){const v=[];F.fromMap(JSON.parse(h)).conflictForm.dates.map(f=>{v.push(p.fromBlank(f.date.date,null,null,!1,""))}),w(v)}},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Conflict Form"})}),e.jsxs("div",{className:"center",children:[!(n!=null&&n.conflictForm)&&P=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Create Conflict Form"}),e.jsx("br",{}),L=="setDates"?e.jsxs(e.Fragment,{children:[" ",e.jsx("label",{children:"Start Date"}),e.jsx("input",{type:"date",onChange:a=>{console.log(new Date(a.target.value));const t=new Date(a.target.value);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),C(t)}}),e.jsx("br",{}),e.jsx("label",{children:"End Date"}),e.jsx("input",{type:"date",onChange:a=>{const t=new Date(a.target.value);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),D(t)}}),e.jsx("br",{}),e.jsx("label",{children:"Default Rehersal Start Time"}),e.jsx("input",{type:"time",onChange:a=>{console.log(a.target.value);const t=new Date,c=a.target.value.split(":");t.setHours(parseInt(c[0]),parseInt(c[1]),0,0),N(t),console.log({date:t})}}),e.jsx("br",{}),e.jsx("label",{children:"Default Rehersal End Time"}),e.jsx("input",{type:"time",onChange:a=>{console.log(a.target.value);const t=new Date,c=a.target.value.split(":");t.setHours(parseInt(c[0]),parseInt(c[1]),0,0),A(t),console.log({date:t})}}),e.jsx("br",{}),e.jsx("label",{children:"Exclude Weekends"}),e.jsx("input",{type:"checkbox",checked:U,onChange:a=>{Q(a.target.checked)}}),e.jsx("br",{}),e.jsx("label",{children:"Form Deadline"}),e.jsx("input",{type:"date",onChange:a=>{const t=new Date(a.target.value);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),G(t)}}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{if(g&&k&&y&&M){const a=[],t=new Date(g);for(console.log("Start Date"),console.log(t);t<=k;)if(console.log(t),a.push(T.fromBlank(E.fromBlank(new Date(t),y,M),"")),t.setDate(t.getDate()+1),U)for(;t.getDay()==0||t.getDay()==6;)t.setDate(t.getDate()+1);r(a),l("editDates"),console.log(a)}},children:"Next"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"conflicts",children:I.map((a,t)=>e.jsx(me,{conflict:a,canDelete:!0,onDelete:()=>{const c=[...I];c.splice(t,1),r(c)},setConflict:c=>{const h=[...I];h[t]=c,r(h)}},a.date.date.toISOString()))}),e.jsx("br",{}),i?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(b(!0),q==null){alert("Please set a form deadline"),b(!1);return}const a=F.fromMap(n.toMap());a.conflictForm=ae.fromBlank(I,q,Date.now()),u(a),console.log(a),await ne(s,j,a.conflictForm),b(!1)},children:"Save Conflict Form"}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{l("setDates"),r([])},children:"Back"})]})]}):P=="teacher"&&!W?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Conflict Form Responses"}),e.jsx("div",{className:"conflicts",children:B.map(a=>e.jsxs("div",{className:"conflict-response",children:[a.actor.name,e.jsx("br",{}),e.jsxs("div",{className:"conflict-response-dates",children:[a.dates.map(t=>t.canAttend?e.jsxs("div",{className:"conflict-response-date",children:[t.date.toDateString(),e.jsx("br",{}),t.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",t.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),t.note!=""&&e.jsx("br",{}),t.note!=""&&e.jsxs("label",{htmlFor:"Actor",children:["Note: ",t.note]})]}):e.jsxs("div",{className:"conflict-response-date",children:[t.date.toDateString(),e.jsx("br",{}),"Can't Attend"]})),e.jsx("button",{className:"ActionBtn",onClick:async()=>{const t=[...B];t.splice(B.indexOf(a),1),J(t),await le(s,j,a)},children:"Delete"})]})]}))}),e.jsx("button",{className:"ActionBtn",onClick:()=>{var a;(a=O.current)==null||a.showModal()},children:"Add Conflict Response"})]}):B.length==0&&(n==null?void 0:n.formStatus)=="open"||W?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Conflict Form"}),e.jsx("p",{children:"Select can attend even if you can't make the full rehersal, just add a conflict"}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("button",{className:"ActionBtn",onClick:()=>{var t;const a=[];(t=n==null?void 0:n.conflictForm)==null||t.dates.map(c=>{a.push(p.fromBlank(c.date.date,null,null,!0,""))}),w(a)},children:"I can attend all the rehersals"}),e.jsx("button",{className:"ActionBtn",onClick:a=>{var t;(t=H.current)==null||t.showModal()},children:"Add recurring conflict"})]}),e.jsx("div",{className:"conflicts",children:(z=n==null?void 0:n.conflictForm)==null?void 0:z.dates.map((a,t)=>(console.log(a),e.jsx(xe,{conflict:a,conflictResponseDate:m[t],setConflict:c=>{const h=[...m];console.log(h),h[t]=c,w(h)}})))}),e.jsx("br",{}),i?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{b(!0);const a=m.filter(S=>S.canAttend&&S.from||!S.canAttend);let t;W?t=V:t=await re();const c=oe.fromBlank(a,"",t,s,j,Date.now());console.log(c),await ie(s,j,c);const h=[...B];h.push(c),J(h),b(!1),$(!1)},children:"Submit Conflict Form"})]}):(n==null?void 0:n.formStatus)=="open"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Conflict Form Response"}),e.jsx("div",{className:"conflicts",children:B[0].dates.map(a=>e.jsx(je,{conflictResponseDate:a}))})]}):e.jsx(e.Fragment,{children:e.jsx("h2",{children:"Conflict Form Closed"})}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href=`/Campus.Connect/Activity/Shows/Show/?activityId=${s}&showId=${j}`},children:"Close"})]}),e.jsx(ge,{dialogRef:H,addConflicts:a=>{const t=[...m];a.map(c=>{var v;if(console.log("FInding conflict"),console.log(c),m.findIndex(f=>(console.log("Checking date"),console.log(f.date.toDateString()),f.date.toDateString()==c.date.toDateString()))==-1)return;const h=m.findIndex(f=>f.date.toDateString()==c.date.toDateString());console.log("Index"),console.log(h),console.log("Current Conflicts"),console.log((v=n==null?void 0:n.conflictForm)==null?void 0:v.dates),console.log(m);const S=n.conflictForm.dates[h];S.date.from&&c.from<S.date.from&&(c.from=S.date.from),S.date.to&&c.to>S.date.to&&(c.to=S.date.to),t[t.findIndex(f=>f.date.toDateString()==c.date.toDateString())]=c}),w(t),H.current.close()},close:()=>{H.current.close()}}),e.jsx(ue,{dialogRef:O,close:()=>{O.current.close()},members:Y,addedMembers:[],addUser:a=>{a instanceof ce&&X(a),O.current.close(),$(!0)}})]})}
