import{c as J,j as e,r as a,a as K,l as U,s as Q,b as Z,i as V}from"./index-CBYUpoa4.js";import{c as D,g as X,a as ee}from"./db-BmeP-Gam.js";import{T as te,L as ae,G as oe,S as ne}from"./constants-WQrXGkfb.js";J(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(se,{})}));function se(){const[d,v]=a.useState(""),[p,P]=a.useState(""),[w,s]=a.useState(!1),[x,$]=a.useState([]),[F,O]=a.useState([]),[y,I]=a.useState(""),[N,b]=a.useState(""),[A,f]=a.useState("accountType"),[g,E]=a.useState("student"),[k,G]=a.useState("LoginInfo"),[S,L]=a.useState(""),[l,u]=a.useState(""),[T,H]=a.useState(""),[j,R]=a.useState(""),[C,M]=a.useState("");a.useState(""),a.useState(""),a.useState(""),a.useState("");const[Y,B]=a.useState("");a.useState(!1);async function _(t){const n={lat:0,lon:0},r="",c=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const o=await Z(d,p);if(console.log(o),!o){alert("Error creating account");return}const h=ae.fromBlank("home",r,new oe(n.lat,n.lon),!1),i=ne.fromBlank(o,t.schoolId,"unknown",c,"","student",l.replace("none",""),T,"unknown",S.toLowerCase().trim(),S.trim(),d.trim(),{},h);await D("student",i),localStorage.setItem("accountType","student");const z=new URLSearchParams(window.location.search).get("redirect");z?window.location.href=z.replace(/~/g,"&"):window.location.href="/",s(!1)}return a.useEffect(()=>{async function t(){await V(h=>{if(h&&localStorage.getItem("accountType")!=null){const m=new URLSearchParams(window.location.search).get("redirect");m?window.location.href=m.replace(/~/g,"&"):window.location.href="/"}});const n=await X();$(n);const r=await ee();O(r);const c=localStorage.getItem("schoolId");c&&c!=""?b(c):b(n[0].schoolId);const o=localStorage.getItem("companyId");o&&o!=""?I(o):r.length>0&&(console.log(r[0].id),I(r[0].id))}t()},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:A=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{E("student"),f("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{E("teacher"),f("login")},children:"Teacher"}),e.jsx("button",{className:"actionBtn",onClick:()=>{E("employer"),f("login")},children:"Employer"})]}):A=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",value:d,onChange:t=>{v(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{P(t.target.value)}}),e.jsx("label",{htmlFor:"",className:"forgotPassword",onClick:()=>{f("forgotPassword")},children:"Forgot Password?"}),e.jsxs("label",{htmlFor:"",children:["Select your ",g!="employer"?"School":"Company"]}),g!="employer"?e.jsx("select",{onChange:t=>{b(t.target.value)},value:N,children:x.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}):e.jsx("select",{onChange:t=>{I(t.target.value)},value:y,children:F.map(t=>e.jsx("option",{value:t.id,children:t.name}))}),w?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await K(d,p,N,y)){s(!1),alert("Wrong email or password");return}const n=localStorage.getItem("userId");if(g=="employer"){const o=F.find(i=>i.id==y);if(console.log(o),console.log(y),!o){s(!1),alert("Error logging in as employer");return}if(!o.employers.find(i=>i.uid==n)){s(!1),alert("You are not in this company"),await U();return}}else{let o=!1;const h=x.find(i=>i.schoolId==N);if(!h){s(!1),alert("Error logging in");return}if(g=="teacher"?h.teachers.find(m=>m.uid==n)&&(o=!0):h.students.find(m=>m.uid==n)&&(o=!0),!o){s(!1),alert("You are not in this school"),await U();return}}localStorage.setItem("accountType",g),console.log("Logging in as "+g);const c=new URLSearchParams(window.location.search).get("redirect");c?window.location.href=c.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Login"}),e.jsx("button",{className:"actionBtn",onClick:()=>{f("createAccount")},children:"Create an Account"}),e.jsxs("p",{children:[e.jsxs("label",{htmlFor:"",className:"info",onClick:()=>{},children:["Signing in as a ",g,", "]}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{f("accountType")},children:"back?"})]})]}):A=="forgotPassword"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Forgot Password"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{B(t.target.value)}}),w?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await Q(Y)){alert("Error sending email"),s(!1);return}B(""),alert("Email sent"),f("login"),s(!1)},children:"Send Password Request Email"})]}):g=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{L(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{v(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{u(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{P(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{R(t.target.value)}}),w?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),S==""){alert("Please enter your full name");return}if(d==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(d)){alert("Invalid email");return}if(l==""){alert("Please enter your phone number, if you don't have one, type none");return}u(l.replace(/-/g,"")),u(l.replace(/ /g,"")),u(l.replace(/\(/g,"")),u(l.replace(/\)/g,""));const n=/^\d{10}$/;if(l!="none"&&!n.test(l)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if(j==""){alert("Please enter your school code");return}const r=x.find(m=>m.schoolTeacherCode==j);if(!r){alert("Invalid School Code");return}localStorage.setItem("schoolId",r.schoolId);const c=te.fromBlank("",r.schoolId,l.replace("none",""),"","teacher",S.toLowerCase().trim(),S.trim(),d.trim()),o=await Z(d,p);if(!o){alert("Error creating account");return}c.uid=o,await D("teacher",c),localStorage.setItem("accountType","teacher");const i=new URLSearchParams(window.location.search).get("redirect");i?window.location.href=i.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Create Account"})]}):k=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),q(),w?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:()=>{if(S==""){alert("Please enter your full name");return}if(d==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(d)){alert("Invalid email");return}if(l==""){alert("Please enter your phone number, if you don't have one, type none");return}u(l.replace(/-/g,"")),u(l.replace(/ /g,"")),u(l.replace(/\(/g,"")),u(l.replace(/\)/g,""));const n=/^\d{10}$/;if(l!="none"&&!n.test(l)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if(T==""){alert("Please select your sex");return}const r=x.find(c=>c.schoolDomain==d.split("@")[1]);if(r!=null){s(!0),_(r);return}G("SchoolCode")},children:"Next"})]}):k=="HomeAddress"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),W(),w?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{s(!0);let t;if(j!=""?t=x.find(n=>n.schoolCode==j):t=x.find(n=>n.schoolDomain==C.split("@")[1]),t==null){j!=""&&C!=""?alert("Invalid School Code or a School Email"):C!=""?alert("Invalid School Email"):alert("Invalid School Code"),s(!1);return}},children:"Create Account"})]})})})});function q(){return e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Please enter your full name!"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{L(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{v(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{P(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{u(t.target.value)}}),e.jsxs("select",{onChange:t=>{H(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function W(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:j,onChange:t=>{R(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:C,onChange:t=>{M(t.target.value)}})]})}}
