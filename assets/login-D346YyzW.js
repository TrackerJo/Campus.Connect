import{c as ne,j as e,r as a,a as re,l as U,s as se,b as Z,i as le}from"./index-DnJ92IFj.js";import{c as $,g as ce,a as ie}from"./db-cSDhaUhj.js";import{T as de,L as ue,G as he,S as me}from"./constants-Buy-_EE_.js";import{A as ge}from"./Add_Location_Dialog-McYlTb9Q.js";import"./distance-CvoZ9uwc.js";ne(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(pe,{})}));function pe(){const[d,I]=a.useState(""),[p,N]=a.useState(""),[y,r]=a.useState(!1),[f,M]=a.useState([]),[T,G]=a.useState([]),[S,b]=a.useState(""),[F,A]=a.useState(""),[L,x]=a.useState("accountType"),[u,k]=a.useState("student"),[w,E]=a.useState("LoginInfo"),[C,B]=a.useState(""),[s,h]=a.useState(""),[D,H]=a.useState(""),[j,J]=a.useState(""),[v,Y]=a.useState("");a.useState(""),a.useState(""),a.useState(""),a.useState("");const[_,q]=a.useState(""),[W,K]=a.useState(""),[R,Q]=a.useState(void 0);a.useState(void 0);const P=a.useRef(null),[V,O]=a.useState("");a.useState(!1);async function X(t){const n={lat:0,lon:0},l="",c=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const o=await Z(d,p);if(console.log(o),!o){alert("Error creating account");return}const m=ue.fromBlank("home",l,new he(n.lat,n.lon),!1),i=me.fromBlank(o,t.schoolId,"unknown",c,"","student",s.replace("none",""),D,"unknown",C.toLowerCase().trim(),C.trim(),d.trim(),{},m);await $("student",i),localStorage.setItem("accountType","student");const z=new URLSearchParams(window.location.search).get("redirect");z?window.location.href=z.replace(/~/g,"&"):window.location.href="/",r(!1)}return a.useEffect(()=>{async function t(){await le(m=>{if(m&&localStorage.getItem("accountType")!=null){const g=new URLSearchParams(window.location.search).get("redirect");g?window.location.href=g.replace(/~/g,"&"):window.location.href="/"}});const n=await ce();M(n);const l=await ie();G(l);const c=localStorage.getItem("schoolId");c&&c!=""?A(c):A(n[0].schoolId);const o=localStorage.getItem("companyId");o&&o!=""?b(o):l.length>0&&(console.log(l[0].id),b(l[0].id))}t()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:L=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{k("student"),x("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{k("teacher"),x("login")},children:"Teacher"}),e.jsx("button",{className:"actionBtn",onClick:()=>{k("employer"),x("login")},children:"Employer"})]}):L=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",value:d,onChange:t=>{I(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{N(t.target.value)}}),e.jsx("label",{htmlFor:"",className:"forgotPassword",onClick:()=>{x("forgotPassword")},children:"Forgot Password?"}),e.jsxs("label",{htmlFor:"",children:["Select your ",u!="employer"?"School":"Company"]}),u!="employer"?e.jsx("select",{onChange:t=>{A(t.target.value)},value:F,children:f.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}):e.jsx("select",{onChange:t=>{b(t.target.value)},value:S,children:T.map(t=>e.jsx("option",{value:t.id,children:t.name}))}),y?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),!await re(d,p,F,S)){r(!1),alert("Wrong email or password");return}const n=localStorage.getItem("userId");if(u=="employer"){const o=T.find(i=>i.id==S);if(console.log(o),console.log(S),!o){r(!1),alert("Error logging in as employer");return}if(!o.employers.find(i=>i.uid==n)){r(!1),alert("You are not in this company"),await U();return}}else{let o=!1;const m=f.find(i=>i.schoolId==F);if(!m){r(!1),alert("Error logging in");return}if(u=="teacher"?m.teachers.find(g=>g.uid==n)&&(o=!0):m.students.find(g=>g.uid==n)&&(o=!0),!o){r(!1),alert("You are not in this school"),await U();return}}localStorage.setItem("accountType",u),console.log("Logging in as "+u);const c=new URLSearchParams(window.location.search).get("redirect");c?window.location.href=c.replace(/~/g,"&"):window.location.href="/",r(!1)},children:"Login"}),e.jsxs("p",{children:[e.jsx("label",{htmlFor:"",className:"info",onClick:()=>{},children:"Don't have an account? "}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{x("createAccount")},children:"Click here to create an account!"})]}),e.jsxs("p",{children:[e.jsxs("label",{htmlFor:"",className:"info",onClick:()=>{},children:["Signing in as a ",u,", "]}),e.jsx("label",{htmlFor:"",className:"ActionText",onClick:()=>{x("accountType")},children:"back?"})]})]}):L=="forgotPassword"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Forgot Password"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{O(t.target.value)}}),y?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),!await se(V)){alert("Error sending email"),r(!1);return}O(""),alert("Email sent"),x("login"),r(!1)},children:"Send Password Request Email"})]}):u=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{B(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{I(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{h(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{N(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{J(t.target.value)}}),y?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(r(!0),C==""){alert("Please enter your full name");return}if(d==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(d)){alert("Invalid email");return}if(s==""){alert("Please enter your phone number, if you don't have one, type none");return}h(s.replace(/-/g,"")),h(s.replace(/ /g,"")),h(s.replace(/\(/g,"")),h(s.replace(/\)/g,""));const n=/^\d{10}$/;if(s!="none"&&!n.test(s)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if(j==""){alert("Please enter your school code");return}const l=f.find(g=>g.schoolTeacherCode==j);if(!l){alert("Invalid School Code");return}localStorage.setItem("schoolId",l.schoolId);const c=de.fromBlank("",l.schoolId,s.replace("none",""),"","teacher",C.toLowerCase().trim(),C.trim(),d.trim()),o=await Z(d,p);if(!o){alert("Error creating account");return}c.uid=o,await $("teacher",c),localStorage.setItem("accountType","teacher");const i=new URLSearchParams(window.location.search).get("redirect");i?window.location.href=i.replace(/~/g,"&"):window.location.href="/",r(!1)},children:"Create Account"})]}):w=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),ee(),y?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:()=>{if(C==""){alert("Please enter your full name");return}if(d==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(d)){alert("Invalid email");return}if(s==""){alert("Please enter your phone number, if you don't have one, type none");return}h(s.replace(/-/g,"")),h(s.replace(/ /g,"")),h(s.replace(/\(/g,"")),h(s.replace(/\)/g,""));const n=/^\d{10}$/;if(s!="none"&&!n.test(s)){alert("Invalid phone number (Only include numbers or type none)");return}if(p==""){alert("Please enter a password");return}if(p.length<6){alert("Password must be at least 6 characters");return}if(D==""&&u!="employer"){alert("Please select your sex");return}const l=f.find(c=>c.schoolDomain==d.split("@")[1]);if(l!=null){r(!0),X(l);return}if(u=="employer"){E("CreateOrJoinCompany");return}E("SchoolCode")},children:"Next"})]}):w=="HomeAddress"?e.jsx(e.Fragment,{}):w=="CreateOrJoinCompany"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),ae()]}):w=="CreateCompany"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),oe()]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),te(),y?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{r(!0);let t;if(j!=""?t=f.find(n=>n.schoolCode==j):t=f.find(n=>n.schoolDomain==v.split("@")[1]),t==null){j!=""&&v!=""?alert("Invalid School Code or a School Email"):v!=""?alert("Invalid School Email"):alert("Invalid School Code"),r(!1);return}},children:"Create Account"})]})})}),e.jsx(ge,{addLocation:t=>{Q(t),P.current.close()},close:()=>{P.current.close()},dialogRef:P,savedLocations:[]})]});function ee(){return e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Please enter your full name!"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{B(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{I(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{N(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{h(t.target.value)}}),u!="employer"&&e.jsxs("select",{onChange:t=>{H(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function te(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:j,onChange:t=>{J(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:v,onChange:t=>{Y(t.target.value)}})]})}function ae(){return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"actionBtn",onClick:()=>{E("CreateCompany")},children:"Create a Company"}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"Compnay Join Code",value:_,onChange:t=>{q(t.target.value)}}),e.jsx("button",{className:"actionBtn",children:"Join Company"})]})}function oe(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Create a company"}),e.jsx("input",{type:"text",placeholder:"Company Name",value:W,onChange:t=>{K(t.target.value)}}),e.jsxs("div",{className:"form-element",children:[e.jsx("label",{htmlFor:"",children:"Company Location: "}),R?e.jsxs("label",{htmlFor:"",children:[R.name," (",R.address,")"]}):e.jsx("label",{htmlFor:"",children:"Location not set"}),e.jsx("button",{className:"actionBtn",onClick:()=>{P.current.showModal()},children:"Set Location"})]}),e.jsx("button",{className:"actionBtn",children:"Create Company"})]})}}
