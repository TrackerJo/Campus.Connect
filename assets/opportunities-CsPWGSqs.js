import{r as i,j as e,c as re,i as de}from"./index-U3pxML4x.js";import{J as X,O as $,B as h,H as l,C as ce,I as ue,K as Q,k as me}from"./constants-DXE-PJsk.js";import{aa as _,G as he,ab as xe,ac as fe,ad as je,ae as pe,af as ge,ag as ve}from"./db-3WgM_3p8.js";import{g as U}from"./distance-DNOHIura.js";function ye({close:d,dialogRef:a,confirmed:o}){const[u,w]=i.useState(!1);return e.jsx("dialog",{ref:a,children:e.jsxs("div",{className:"ConfirmApplyDialog",children:[e.jsx("h2",{children:"Did you apply?"}),e.jsx("br",{}),u?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{w(!0),await o(),w(!1)},children:"Yes"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{d()},children:"No"})]})})}function be({opportunity:d,accountType:a,studentData:o,onEdit:u,onRemove:w,onApply:A,onRSVP:C}){const x=i.useRef(null),[f,S]=i.useState(!1),[m,g]=i.useState(!1);function k(n,c,N){const W=new Intl.DateTimeFormat("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),j=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),D=W.format(n),v=j.format(c),L=j.format(N);return`On ${D} from ${v} to ${L}`}function F(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Job"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsxs("label",{htmlFor:"",children:["$",n.hourlyRate.toFixed(2)," per hour"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==h.Weekdays?"Weekdays":n.shiftType==h.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var c;window.open(n.applicationLink,"_blank"),(c=x.current)==null||c.showModal()},children:"Apply"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function T(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"One Time Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:k(n.eventDate.date,n.eventDate.from,n.eventDate.to)}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&m?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var c;if(n.applicationLink===""){g(!0),await C(),g(!1);return}window.open(n.applicationLink,"_blank"),(c=x.current)==null||c.showModal()},children:"RSVP"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function V(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Recurring Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==h.Weekdays?"Weekdays":n.shiftType==h.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&m?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var c;if(n.applicationLink===""){g(!0),await C(),g(!1);return}window.open(n.applicationLink,"_blank"),(c=x.current)==null||c.showModal()},children:"RSVP"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}return e.jsxs(e.Fragment,{children:[d instanceof X?F(d):d instanceof $?T(d):V(d),a==="student"&&e.jsx(ye,{dialogRef:x,close:()=>{var n;(n=x.current)==null||n.close()},confirmed:async()=>{var n;d.applicants.push(o.toActivityMember()),d.lastUpdated=Date.now(),await _(d,!0),(n=x.current)==null||n.close(),A()}})]})}re(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(we,{})}));function we(){const[d,a]=i.useState("student"),[o,u]=i.useState([]),[w,A]=i.useState(!0),[C,x]=i.useState(!1),[f,S]=i.useState(null),[m,g]=i.useState(l.Job),[k,F]=i.useState(h.Weekdays),[T,V]=i.useState(0),[n,c]=i.useState(""),[N,W]=i.useState(""),[j,D]=i.useState(),[v,L]=i.useState(),[I,J]=i.useState(),[B,M]=i.useState(),[Z,P]=i.useState(""),[ee,H]=i.useState(""),[G,te]=i.useState([]),[O,K]=i.useState(""),[se,Y]=i.useState(!1),[y,q]=i.useState(null),[R,z]=i.useState(!1),[E,ne]=i.useState(void 0);i.useEffect(()=>{de(()=>{}),new URLSearchParams(window.location.search);const t=localStorage.getItem("accountType");t&&a(t),t=="student"?he().then(s=>{const r=s;ne(s),xe().then(b=>{u(b.filter(p=>!(p.applicants.find(oe=>oe.userId==r.uid)&&p.type==l.Job))),A(!1)})}):fe().then(s=>{s||(window.location.href="/"),S(s),te([...s.savedLocations,s.location]),D(s.location),(s==null?void 0:s.type)==ce.Job?g(l.Job):g(l.OneTimeVolunteer),je().then(r=>{u(r),A(!1),console.log(r)})})},[]);const ie=t=>{const s=t.target.value,[r,b]=s.split(":").map(Number),p=new Date(v);p.setHours(r,b,0,0),J(p),P(p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},ae=t=>{const s=t.target.value,[r,b]=s.split(":").map(Number),p=new Date(v);p.setHours(r,b,0,0),M(p),H(p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(t){return this.setTime(this.getTime()+t*60*60*1e3),this};function le(){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"createOpportunity",children:[e.jsxs("h1",{children:[R?"Edit":"Create"," Opportunity"]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Position: "}),e.jsx("input",{placeholder:"Position",value:n,onChange:t=>{c(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Description: "}),e.jsx("textarea",{placeholder:"Description",value:N,onChange:t=>{W(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Locaiton: "}),e.jsx("select",{name:"location",id:"",value:j==null?void 0:j.address,onChange:t=>{const s=G.find(r=>r.address==t.target.value);s&&D(s)},children:G.map(t=>e.jsx("option",{value:t.address,children:t.name}))})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Opporunity Type: "}),e.jsxs("select",{name:"opportunityType",id:"",value:m,onChange:t=>{g(t.target.value)},children:[e.jsx("option",{value:l.Job,children:"Job"}),e.jsx("option",{value:l.OneTimeVolunteer,children:"One Time Volunteer"}),e.jsx("option",{value:l.RecurringVolunteer,children:"Recurring Volunteer"})]})]}),m==l.Job&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Salary: "}),e.jsx("input",{type:"number",placeholder:"Salary",value:T,onChange:t=>{V(parseFloat(t.target.value))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:k,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:h.Weekdays,children:"Weekdays"}),e.jsx("option",{value:h.Weekends,children:"Weekends"}),e.jsx("option",{value:h.All,children:"Weekdays and Weekends"})]})]})]}),m==l.OneTimeVolunteer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:v==null?void 0:v.toISOString().split("T")[0],onChange:t=>{const s=new Date(t.target.value);if(s=="Invalid Date"){L(new Date);return}s.setHours(0,0,0,0),s.setDate(s.getDate()+1),L(s);const r=new Date(s);r.setHours(I.getHours(),I.getMinutes(),0,0),J(r),P(r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const b=new Date(s);b.setHours(B.getHours(),B.getMinutes(),0,0),M(b),H(b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:Z,onChange:ie})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:ee,onChange:ae})]})]}),m==l.RecurringVolunteer&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:k,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:h.Weekdays,children:"Weekdays"}),e.jsx("option",{value:h.Weekends,children:"Weekends"}),e.jsx("option",{value:h.All,children:"Weekdays and Weekends"})]})]})}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Application Link (Optional): "}),e.jsx("input",{placeholder:"Application Link",value:O,onChange:t=>{K(t.target.value)}})]}),se?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(n==""||N==""||j==null){alert("Please fill out all fields");return}if(m==l.Job&&(T==0||k==null)){alert("Please fill out all fields");return}if(m==l.OneTimeVolunteer&&(v==null||I==null||B==null)){alert("Please fill out all fields");return}if(m==l.RecurringVolunteer&&k==null){alert("Please fill out all fields");return}Y(!0);let t;if(m==l.Job)t=new X({companyName:f.name,position:n,description:N,location:j,shiftType:k,hourlyRate:T,applicationLink:O,companyId:f.id,id:"",type:l.Job,isAvailable:!0,lastUpdated:Date.now(),applicants:[]});else if(m==l.OneTimeVolunteer){const s=me.fromBlank(v,I,B);t=new $({companyName:f.name,position:n,description:N,location:j,eventDate:s,applicationLink:O,companyId:f.id,id:"",type:l.OneTimeVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[],taskId:R?y.taskId:""})}else t=new Q({companyName:f.name,position:n,description:N,location:j,shiftType:k,applicationLink:O,companyId:f.id,id:"",type:l.RecurringVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[]});console.log(t),R?(t.id=y.id,(y==null?void 0:y.type)==l.OneTimeVolunteer&&t.type!=l.OneTimeVolunteer&&await ge(y.taskId),await _(t,!1),u(o.map(s=>s.id==(y==null?void 0:y.id)?t:s)),q(null),z(!1)):(t=await ve(t),o.push(t),u(o),x(!1)),Y(!1)},children:R?"Save":"Create"})]})})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Opportunities"})}),e.jsxs("div",{className:"center",children:[w&&e.jsx("div",{className:"loader"}),C||R?le():e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opportunities",children:o.map(t=>e.jsx(be,{opportunity:t,accountType:d,studentData:E,onApply:()=>{t.type==l.Job&&u(o.filter(s=>s.id!=t.id))},onRSVP:async()=>{const s=ue.fromMap(t.toMap());s.applicants.push(E.toActivityMember()),s instanceof $&&s.volunteers.push(E.toActivityMember()),s instanceof Q&&s.volunteers.push(E.toActivityMember()),s.lastUpdated=Date.now(),await _(s,!0)},onEdit:()=>{if(q(t),g(t.type),c(t.position),W(t.description),D(t.location),t.type==l.Job&&(V(t.hourlyRate),F(t.shiftType)),t.type==l.OneTimeVolunteer){const s=t.eventDate;L(s.date),J(s.from),M(s.to),P(s.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),H(s.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}t.type==l.RecurringVolunteer&&F(t.shiftType),K(t.applicationLink),z(!0)},onRemove:async()=>{await pe(t),u(o.filter(s=>s.id!=t.id))}}))}),d=="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{x(!0)},children:"Create Opportunity"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{C?x(!1):window.location.href="/"},children:"Back"})]})]})}
