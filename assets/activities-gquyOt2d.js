import{r as t,j as e,c as N,i as p}from"./index-BrfWEQze.js";import{u as w,a as b,j as f,b as C,d as S}from"./db-DepJtWcO.js";import"./constants-B9kCK6KS.js";function I({dialogRef:l,close:d,activityJoinCode:s}){const[o,a]=t.useState(""),[c,u]=t.useState(!1),[r,i]=t.useState(!1),[h,y]=t.useState(""),[m,g]=t.useState("male"),[x,A]=t.useState("");async function j(n){console.log("Joining activity"),localStorage.setItem("needsPhoneNumber","false"),localStorage.setItem("needsGender","false");const v=await f(n);if(u(localStorage.getItem("needsPhoneNumber")=="true"),i(localStorage.getItem("needsGender")=="true"),!(localStorage.getItem("needsPhoneNumber")=="true"||localStorage.getItem("needsGender")=="true")){if(!v){alert("Invalid activity code");return}if(x){window.location.href=x.replace(/~/g,"&");return}window.location.href=`/Activity/?activityId=${v.id}`}}return t.useEffect(()=>{s!=""&&(a(s),j(s));const v=new URLSearchParams(window.location.search).get("redirect");v&&A(v)},[s]),e.jsx("dialog",{ref:l,className:"JoinActivityDialog",children:e.jsxs("div",{className:"dialogContents",children:[!r&&!c?e.jsxs(e.Fragment,{children:[" ",e.jsx("h2",{children:"Join Activity"}),e.jsx("label",{htmlFor:"",children:"Activity Code"}),e.jsx("input",{type:"text",value:o,onChange:n=>{a(n.target.value)}}),e.jsx("button",{className:"ActionBtn",onClick:async()=>{await j(o)},children:"Join"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Activity requires some more information"}),c?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"text",value:h,onChange:n=>{y(n.target.value)}}),e.jsx("br",{})]}):e.jsx(e.Fragment,{}),r?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Gender"}),e.jsxs("select",{name:"",id:"",value:m,onChange:n=>{g(n.target.value)},children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{className:"ActionBtn",onClick:async()=>{console.log("Joining activity"),c&&(await w(h),localStorage.setItem("needsPhoneNumber","false")),r&&(await b(m),localStorage.setItem("needsGender","false"));const n=await f(o);if(!n){alert("Invalid activity code");return}if(x){window.location.href=x.replace(/~/g,"&");return}window.location.href=`/Activity/?activityId=${n.id}`},children:"Join"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{d()},children:"Close"})]})})}function P({dialogRef:l,close:d}){const[s,o]=t.useState(""),[a,c]=t.useState("activity"),[u,r]=t.useState(!1);return e.jsx("dialog",{ref:l,className:"CreateActivityDialog",children:e.jsxs("div",{className:"dialogContents",children:[e.jsx("h2",{children:"Join Activity"}),e.jsx("label",{htmlFor:"",children:"Activity Name"}),e.jsx("input",{type:"text",value:s,onChange:i=>{o(i.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Activity Type"}),e.jsxs("select",{value:a,onChange:i=>{c(i.target.value)},children:[e.jsx("option",{value:"activity",children:"Basic"}),e.jsx("option",{value:"theater",children:"Theater"})]}),u?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{r(!0);const i=await C(s,a);if(i===null){alert("Failed to create activity");return}window.location.href=`/Campus.Connect/Activity/?activityId=${i.id}`},children:"Create"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{d()},children:"Close"})]})})}N(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(F,{})}));function F(){const[l,d]=t.useState([]),[s,o]=t.useState("student"),a=t.useRef(null),c=t.useRef(null),[u,r]=t.useState("");return t.useEffect(()=>{p(()=>{});async function i(){const g=await S();d(g),console.log(g)}i();const h=localStorage.getItem("accountType");h&&o(h);const m=new URLSearchParams(window.location.search).get("activityJoinCode");m&&(r(m),a.current.showModal())},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Activities"})}),e.jsxs("div",{className:"center",children:[e.jsx("div",{className:"activities",children:l.map(i=>e.jsx("div",{className:"activity",onClick:()=>{window.location.href=`/Activity/?activityId=${i.id}`},children:e.jsx("h1",{children:i.name})},i.id))}),e.jsx("br",{}),s=="teacher"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{c.current.showModal()},children:"Create Activity"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{a.current.showModal()},children:"Join Activity"}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/"},children:"Back"})]}),e.jsx(I,{dialogRef:a,activityJoinCode:u,close:()=>{a.current.close()}}),e.jsx(P,{dialogRef:c,close:()=>{c.current.close()}})]})}
