import{r as l,j as e}from"./index-U3pxML4x.js";import{R as j,x as I}from"./constants-CZ2ZrUdU.js";import{$ as N,Z as b}from"./db-CqfEwaLm.js";function L({editResource:i,dialogRef:m,close:u,resource:t}){const[o,c]=l.useState("unset"),[n,d]=l.useState(""),[r,a]=l.useState(""),[g,f]=l.useState(!1),[R,k]=l.useState(""),v=l.useRef(null);return l.useEffect(()=>{t&&(d(t.name),a(t.description),c(t.type),console.log(t.toMap()),t.type=="link"&&k(t.link))},[t]),e.jsx("dialog",{ref:m,children:e.jsxs("div",{className:"EditResourceDiv",children:[e.jsx("h2",{children:"Edit Resource"}),e.jsx("h3",{children:"Resource Name"}),e.jsx("input",{type:"text",className:"ResourceNameInput",value:n,onChange:s=>{d(s.target.value)}}),e.jsx("h3",{children:"Resource Description"}),e.jsx("input",{type:"text",className:"ResourceDescriptionInput",value:r,onChange:s=>{a(s.target.value)}}),o=="link"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Link"}),e.jsx("input",{type:"text",className:"ResourceLinkInput",value:R,onChange:s=>{k(s.target.value)}})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Resource File"}),e.jsx("input",{type:"file",className:"ResourceFileInput",ref:v,accept:o=="image"?".png,.jpg,.jpeg":".mp4,.mov,.avi,.wmv,.mkv,"})]}),e.jsx("br",{}),g?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(f(!0),o=="link"){console.log("Link");const s=j.fromBlank(n,r,o,R);await i(s)}else{console.log("File");const s=v.current.files[0];if(s==null){alert("Please select a file"),f(!1);return}const h=s.name.split(".")[0]+Date.now()+"."+s.name.split(".")[1];if(h==t.file.name){const p=j.fromBlank(n,r,t.type,"",t.file);p.activityId=t.activityId,p.showId=t.showId,await i(p)}else{const p=localStorage.getItem("schoolId");await N(p,t.activityId,t.file.name);const w=await b(p,t.activityId,h,s),y=I.fromBlank(h,w),x=j.fromBlank(n,r,t.type,"",y);x.activityId=t.activityId,x.showId=t.showId,await i(x)}}f(!1)},children:"Save"}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{u()},children:"Close"})]})})}function D({resource:i,canRemove:m,removeResource:u,canEdit:t,editResource:o}){const c=l.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"resource-tile",children:[e.jsx("h3",{children:i.name}),e.jsx("p",{children:i.description}),e.jsxs("div",{children:[i.type=="link"?e.jsx("button",{className:"ActionBtn",onClick:()=>{window.open(i.link,"_blank")},children:"Open Link"}):e.jsx("button",{className:"ActionBtn",onClick:()=>{const n=new XMLHttpRequest;n.responseType="blob",n.onload=d=>{const r=n.response,a=document.createElement("a");a.href=URL.createObjectURL(r),a.download=i.file.name,a.click(),URL.revokeObjectURL(a.href)},n.open("GET",i.file.url),n.send()},children:"Download File"}),t&&e.jsx("button",{onClick:()=>{var n;(n=c.current)==null||n.showModal()},className:"ActionBtn",children:"Edit"}),m&&e.jsx("button",{onClick:()=>u(),className:"ActionBtn",children:"Remove"})]})]}),e.jsx(L,{editResource:async n=>{var d;await o(n),(d=c.current)==null||d.close()},dialogRef:c,close:()=>{var n;(n=c.current)==null||n.close()},resource:i})]})}export{D as R};
