import{r as n,j as e,c as A,i as B}from"./index-U3pxML4x.js";import{R,x as C,g as f}from"./constants-CZ2ZrUdU.js";import{Z as F,_ as v,$ as b,a0 as y}from"./db-CqfEwaLm.js";import{R as M}from"./Resource_Tile-2JtWy1Pq.js";function O({addResource:i,dialogRef:x,close:c,activityId:j}){const[s,r]=n.useState("unset"),[u,p]=n.useState(""),[d,g]=n.useState(""),[S,t]=n.useState(!1),[o,l]=n.useState(""),I=n.useRef(null);return e.jsx("dialog",{ref:x,children:e.jsxs("div",{className:"AddResourceDiv",children:[e.jsx("h2",{children:"Add Resource"}),s=="unset"?e.jsxs("div",{className:"ResourceTypeSelect",children:[e.jsx("h3",{children:"Resource Type"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{r("link")},children:"Link"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{r("image")},children:"Image"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{r("video")},children:"Video"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Resource Name"}),e.jsx("input",{type:"text",className:"ResourceNameInput",value:u,onChange:a=>{p(a.target.value)}}),e.jsx("h3",{children:"Resource Description"}),e.jsx("input",{type:"text",className:"ResourceDescriptionInput",value:d,onChange:a=>{g(a.target.value)}}),s=="link"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Link"}),e.jsx("input",{type:"text",className:"ResourceLinkInput",value:o,onChange:a=>{l(a.target.value)}})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Resource File"}),e.jsx("input",{type:"file",className:"ResourceFileInput",ref:I,accept:s=="image"?".png,.jpg,.jpeg":".mp4,.mov,.avi,.wmv,.mkv,"})]}),e.jsx("br",{}),S?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(t(!0),s=="link"){const a=R.fromBlank(u,d,s,o);await i(a)}else{const a=I.current.files[0];if(a==null)return;const m=a.name.split(".")[0]+Date.now()+"."+a.name.split(".")[1],h=localStorage.getItem("schoolId"),N=await F(h,j,m,a),w=C.fromBlank(m,N),k=R.fromBlank(u,d,s,"",w);await i(k)}r("unset"),p(""),g(""),l(""),t(!1)},children:"Add Resource"})]}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{r("unset"),p(""),g(""),l(""),c()},children:"Close"})]})})}A(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(T,{})}));function T(){const[i,x]=n.useState(""),[c,j]=n.useState(""),[s,r]=n.useState(),[u,p]=n.useState("student"),d=n.useRef(null);n.useEffect(()=>{B(()=>{});const t=new URLSearchParams(window.location.search),o=t.get("activityId");o&&x(o);const l=t.get("showId");l&&j(l);const I=localStorage.getItem("show-"+l);if(I){const m=f.fromMap(JSON.parse(I));m.resources=m.resources.map(h=>(console.log(h.toMap()),h.activityId=o,h.showId=l,h)),r(m),console.log(m)}const a=localStorage.getItem("accountType");a&&p(a)},[]);const g=t=>async()=>{if(t.type!="link"){const o=localStorage.getItem("schoolId");await b(o,i,t.file.name)}s==null||s.resources.splice(s.resources.indexOf(t),1),localStorage.setItem("show-"+c,JSON.stringify(s==null?void 0:s.toMap())),r(f.fromMap(JSON.parse(localStorage.getItem("show-"+c)))),await y(i,c,t)},S=t=>async o=>{s.resources=s.resources.map(l=>l.name==t.name?(o.activityId=i,o.showId=c,o):l),localStorage.setItem("show-"+c,JSON.stringify(s==null?void 0:s.toMap())),r(f.fromMap(JSON.parse(localStorage.getItem("show-"+c)))),console.log("deleting RESOURCE"),console.log(t),t.activityId=i,t.showId=c,await y(t.activityId,t.showId,t),console.log("adding RESOURCE"),o.activityId=i,o.showId=c,await v(t.activityId,t.showId,o)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Resources"})}),e.jsxs("div",{className:"center",children:[e.jsx("div",{className:"resources",children:s==null?void 0:s.resources.map((t,o)=>e.jsx(M,{resource:t,canRemove:u==="teacher",removeResource:g(t),canEdit:u=="teacher",editResource:S(t)},o))}),u==="teacher"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var t;(t=d.current)==null||t.showModal()},children:"Add Resource"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href=`/Activity/Shows/Show/?activityId=${i}&showId=${c}`},children:"Back"})]}),e.jsx(O,{dialogRef:d,activityId:i,close:()=>{var t;(t=d.current)==null||t.close()},addResource:async t=>{var o;console.log("Adding resource"),console.log(t),await v(i,c,t),s==null||s.resources.push(t),localStorage.setItem("show-"+c,JSON.stringify(s==null?void 0:s.toMap())),r(f.fromMap(JSON.parse(localStorage.getItem("show-"+c)))),(o=d.current)==null||o.close()}})]})}
