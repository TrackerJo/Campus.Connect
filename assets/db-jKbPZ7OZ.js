import{w as vt,x as l,y as c,z as D,q as x,g as U,B as b,H as I,d as Y,f as L,I as S,J as T,K as C,i as G,N as P,m as V,O as q,S as z,T as wt,P as k,Q as St,U as B,u as Dt,r as E,V as nt,W as at,M as K,s as A,X as Tt,p as _,Y as O,n as Mt,L as ft,C as H,b as ct,F as Ct,E as it}from"./constants-BvZPMWYG.js";import{h as At,C as Et,k as rt,_ as kt,d as W,e as Ut,f as bt,F as Nt,n as Z,g as R}from"./index-gmdc6g0F.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="type.googleapis.com/google.protobuf.Int64Value",Lt="type.googleapis.com/google.protobuf.UInt64Value";function ht(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function Q(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>Q(e));if(typeof t=="function"||typeof t=="object")return ht(t,e=>Q(e));throw new Error("Data cannot be encoded in JSON: "+t)}function $(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Ft:case Lt:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>$(e)):typeof t=="function"||typeof t=="object"?ht(t,e=>$(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tt="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends Nt{constructor(e,o,s){super(`${tt}/${e}`,o||""),this.details=s}}function Rt(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Pt(t,e){let o=Rt(t),s=o,n;try{const a=e&&e.error;if(a){const u=a.status;if(typeof u=="string"){if(!lt[u])return new F("internal","internal");o=lt[u],s=u}const r=a.message;typeof r=="string"&&(s=r),n=a.details,n!==void 0&&(n=$(n))}}catch{}return o==="ok"?null:new F(o,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||o.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X="us-central1";function xt(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new F("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class _t{constructor(e,o,s,n,a=X,u){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new Ot(o,s,n),this.cancelAllRequests=new Promise(r=>{this.deleteService=()=>Promise.resolve(r())});try{const r=new URL(a);this.customDomain=r.origin+(r.pathname==="/"?"":r.pathname),this.region=X}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function Gt(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function Bt(t,e,o){return s=>Jt(t,e,s,{})}async function $t(t,e,o,s){o["Content-Type"]="application/json";let n;try{n=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let a=null;try{a=await n.json()}catch{}return{status:n.status,json:a}}function Jt(t,e,o,s){const n=t._url(e);return Ht(t,n,o,s)}async function Ht(t,e,o,s){o=Q(o);const n={data:o},a={},u=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);u.authToken&&(a.Authorization="Bearer "+u.authToken),u.messagingToken&&(a["Firebase-Instance-ID-Token"]=u.messagingToken),u.appCheckToken!==null&&(a["X-Firebase-AppCheck"]=u.appCheckToken);const r=s.timeout||7e4,f=xt(r),i=await Promise.race([$t(e,n,a,t.fetchImpl),f.promise,t.cancelAllRequests]);if(f.cancel(),!i)throw new F("cancelled","Firebase Functions instance was deleted.");const d=Pt(i.status,i.json);if(d)throw d;if(!i.json)throw new F("internal","Response is not valid JSON object.");let h=i.json.data;if(typeof h>"u"&&(h=i.json.result),typeof h>"u")throw new F("internal","Response is missing data field.");return{data:$(h)}}const ut="@firebase/functions",dt="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt="auth-internal",Vt="app-check-internal",qt="messaging-internal";function Kt(t,e){const o=(s,{instanceIdentifier:n})=>{const a=s.getProvider("app").getImmediate(),u=s.getProvider(jt),r=s.getProvider(qt),f=s.getProvider(Vt);return new _t(a,u,r,f,n,t)};At(new Et(tt,o,"PUBLIC").setMultipleInstances(!0)),rt(ut,dt,e),rt(ut,dt,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(t=bt(),e=X){const s=kt(W(t),tt).getImmediate({identifier:e}),n=Ut("functions");return n&&Qt(s,...n),s}function Qt(t,e,o){Gt(W(t),e,o)}function et(t,e,o){return Bt(W(t),e)}Kt(fetch.bind(self));const Xt=gt(Z);function N(t,e,o,s){et(Xt,"sendEmail")({emails:e.map(n=>n.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:t.message,senderName:t.senderName})}const mt=gt(Z),g=vt(Z),ot=l(g,"schools"),Yt=async t=>{const e=c(ot,t);return(await D(e)).data()},ee=async()=>{const t=await S(ot),e=[];return t.forEach(o=>{e.push(o.data())}),e},oe=async(t,e,o)=>{const s=c(ot,t);console.log("School ID: "+t),console.log("User ID: "+e),console.log("Account Type: "+o);const n=c(l(s,o+"s"),e);return(await D(n)).exists()},pt=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=c(g,"schools",e);if(t=="student"){const s=T(l(o,"activities"),C("studentUids","array-contains",R())),n=[];return(await S(s)).forEach(u=>{n.push(U.fromMap(u.data()))}),n}else{const s=T(l(o,"activities"),C("teacherUids","array-contains",R())),n=[];return(await S(s)).forEach(u=>{console.log(u.data()),n.push(U.fromMap(u.data()))}),n}};async function zt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(g,"schools",e),s=c(l(o,"activities"),t),n=await D(s);return n.exists()?n.data().type=="theater"?x.fromMap(n.data()):U.fromMap(n.data()):null}async function se(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=l(s,"shows"),a=await b(n,t.toMap());return t.id=a.id,await I(a,{id:a.id}),a.id}async function ne(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=c(l(s,"shows"),t.id);await I(n,t.toMap())}async function ae(t){const e=l(g,"showTemplates"),o=await b(e,t.toMap());return t.id=o.id,await I(o,{id:o.id}),o.id}async function ce(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(g,"schools",o),n=c(l(s,"activities"),t),a=c(l(n,"shows"),e),u=await D(a);return u.exists()?(console.log(u.data()),Y.fromMap(u.data())):null}async function ie(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=c(g,"schools",e),s=c(l(o,"activities"),t),n=await D(s);if(!n.exists())return[];const a=[];return n.data().students.forEach(u=>{a.push(L.fromMap(u))}),a}async function re(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e);await P(u,o.toMap())}async function le(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=l(s,"events"),a=await b(n,t.toMap());t.id=a.id,await I(a,{id:a.id})}async function ue(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(g,"schools",o),a=c(l(n,"activities"),t),u=l(a,"events");if(s=="student"){const r=await S(T(u,C("showId","==",e),C("targetUids","array-contains",R()))),f=[];return r.forEach(i=>{i.data().deleted||f.push(G.fromMap(i.data()))}),f}else{const r=await S(T(u,C("showId","==",e))),f=[];return r.forEach(i=>{i.data().deleted||f.push(G.fromMap(i.data()))}),f}}async function de(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=c(l(s,"events"),t.id);await I(n,{deleted:!0}),await et(mt,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function It(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=c(g,"schools",e),s=c(l(o,"activities"),t),n=l(s,"shows"),a=await S(n),u=[];return a.forEach(r=>{u.push(Y.fromMap(r.data()))}),u}async function fe(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e);await I(u,{conflictForm:o.toMap()}),await et(mt,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function he(){const t=await R(),e=localStorage.getItem("schoolId");if(!e)return null;const o=c(g,"schools",e),s=l(o,"students"),n=c(s,t),a=await D(n);return a.exists()?L.fromMap(a.data()):null}async function ge(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e),r=c(u,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await P(r,o.toMap())}async function me(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(g,"schools",o),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e),r=l(u,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(R());const d=await S(T(r,C("submitterId","==",R()))),h=[];return d.forEach(w=>{h.push(V.fromMap(w.data()))}),h}const f=await S(r),i=[];return f.forEach(d=>{i.push(V.fromMap(d.data()))}),i}async function pe(){const t=l(g,"showTemplates"),e=await S(t),o=[];return e.forEach(s=>{o.push(Y.fromMap(s.data()))}),o}async function Ie(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const n=c(g,"schools",e),a=T(l(n,"activities"),C("joinCode","==",t)),u=await S(a);if(u.empty)return null;const r=u.docs[0],f=c(l(n,s=="student"?"students":"teachers"),o),i=await D(f);if(console.log(i.data()),!i.exists())return null;if(r.data().studentUids.includes(o)||r.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),r.data().type=="theater"){if((i.data().gender==null||i.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),i.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(i.data().phoneNumber==""||i.data().gender==null||i.data().gender=="")&&s=="student")return null;if(s=="student")return await I(r.ref,{studentUids:[...r.data().studentUids,o],students:[...r.data().students,L.fromMap(i.data()).toMap()]}),x.fromMap(r.data());{console.log("Joining as teacher"),console.log(i.data());const d=B.fromBlank(i.data().fullname,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return console.log(d.toMap()),await I(r.ref,{teacherUids:[...r.data().teacherUids,o],teachers:[...r.data().teachers,d.toMap()]}),x.fromMap(r.data())}}else if(s=="student"){const d=L.fromBlank(i.data().fullname,i.data().gender,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return await I(r.ref,{studentUids:[...r.data().studentUids,o],students:[...r.data().students,d.toMap()]}),U.fromMap(r.data())}else{const d=B.fromBlank(i.data().fullname,i.data().email,i.data().phoneNumber,i.data().uid,i.data().FCMToken);return await I(r.ref,{teacherUids:[...r.data().teacherUids,o],teachers:[...r.data().teachers,d.toMap()]}),U.fromMap(r.data())}}async function ye(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(g,"schools",e),a=c(l(n,s=="student"?"students":"teachers"),o);await I(a,{gender:t})}async function ve(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(g,"schools",e),a=c(l(n,s=="student"?"students":"teachers"),o);await I(a,{phoneNumber:t})}async function we(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=c(l(s,"events"),t.id);await I(n,t.toMap())}async function Se(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=c(g,"schools",t),n=[];let a;o=="student"?a=await S(T(l(s,"activities"),C("studentUids","array-contains",e))):a=await S(T(l(s,"activities"),C("teacherUids","array-contains",e))),console.log(a);for(const u of a.docs){let r;o=="student"?r=await S(T(l(u.ref,"events"),C("targetUids","array-contains",e))):r=await S(l(u.ref,"events"));for(const f of r.docs){const i=f.data();console.log(i),i.type=="activity-theater-event"?n.push(G.fromMap(i)):n.push(Dt.fromMap(i))}}return n}async function De(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const n=c(g,"schools",o),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e),r=l(u,"conflictResponses"),f=await D(c(r,s));return f.exists()?V.fromMap(f.data()):null}async function Te(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=c(l(s,"activities"),t);await I(n,{rehearsalLocations:e.map(a=>a.toMap())})}async function Me(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const n=localStorage.getItem("accountType"),a=c(g,"schools",o),u=c(l(a,"activities"),t);if(n=="teacher")q(l(u,"groupChats"),async r=>{const f=[];for(const i of r.docs){const d=E.fromMap(i.data());if((d.generalTarget=="direct"||d.generalTarget=="custom")&&!d.members.find(p=>p.userId==s))continue;if(d.generalTarget=="direct"){const p=d.members.find(m=>m.userId!=s);d.name=(p==null?void 0:p.name)||"Unknown"}const h=l(i.ref,"messages"),w=T(h,at("timeSent","desc"),nt(1)),y=await S(w);y.empty||(d.lastMessage=K.fromMap(y.docs[0].data())),f.push(d)}f.sort((i,d)=>i.lastMessage?d.lastMessage?d.lastMessage.timeSent.getTime()-i.lastMessage.timeSent.getTime():-1:1),e(f)});else{const r=c(l(a,"students"),s),f=await D(r);if(!f.exists())return;const i=z.fromMap(f.data());console.log(i),q(l(u,"groupChats"),async d=>{const h=[];for(const w of d.docs){const y=E.fromMap(w.data());if(!(y.generalTarget=="everyone"||y.generalTarget=="students")&&(y.generalTarget=="parents"||!y.members.find(M=>M.userId==s)))continue;if(y.generalTarget=="direct"){const M=y.members.find(J=>J.userId!=s);y.name=(M==null?void 0:M.name)||"Unknown"}const p=l(w.ref,"messages"),m=T(p,at("timeSent","desc"),nt(1)),v=await S(m);v.empty||(y.lastMessage=K.fromMap(v.docs[0].data())),h.push(y)}h.sort((w,y)=>w.lastMessage?y.lastMessage?y.lastMessage.timeSent.getTime()-w.lastMessage.timeSent.getTime():-1:1),e(h)})}}async function Ce(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const n=c(g,"schools",s),a=c(l(n,"activities"),t);console.log("Getting messages for "+e);const u=c(l(a,"groupChats"),e),r=l(u,"messages");q(r,f=>{const i=[];f.forEach(d=>{i.push(K.fromMap(d.data()))}),i.sort((d,h)=>d.timeSent.getTime()-h.timeSent.getTime()),o(i)})}async function st(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=c(g,"schools",t),n=c(l(s,o=="student"?"students":"teachers"),e),a=await D(n);return a.exists()?o=="student"?z.fromMap(a.data()):wt.fromMap(a.data()):null}async function Ae(t,e,o,s,n){if(o.message=="")return;const a=localStorage.getItem("schoolId"),u=localStorage.getItem("userId");if(!a||!u)return;const r=c(g,"schools",a),f=c(l(r,"activities"),t),i=c(l(f,"groupChats"),e),d=await D(i);if(!d.exists()){if(n==null)return;const p=await st();if(!p)return;const m=E.fromBlank("",n.userId,[A.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),n],"direct",t,Date.now());await P(i,m.toMap());const v=l(i,"messages"),M=await b(v,o.toMap());o.messageId=M.id,await I(M,{messageId:M.id}),N(o,[A.fromMap(n)],m,s);return}const h=E.fromMap(d.data()),w=l(i,"messages"),y=await b(w,o.toMap());if(o.messageId=y.id,await I(y,{messageId:y.id}),h.generalTarget!="direct"&&h.generalTarget!="custom"&&h.generalTarget!="group"){const p=await zt(t);if(!p)return;if(h.generalTarget=="everyone"){let m=p.students.map(v=>A.fromMap(v));m=m.concat(p.teachers.map(v=>A.fromMap(v))),m=m.concat(p.parents.map(v=>A.fromMap(v))),m=m.filter(v=>v.userId!=o.senderUid),N(o,m,h,p.name)}else if(h.generalTarget=="students"){let m=p.students.map(v=>A.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),N(o,m,h,p.name)}else if(h.generalTarget=="parents"){let m=p.parents.map(v=>A.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),N(o,m,h,p.name)}return}if(h.generalTarget=="direct"){const p=h.members.find(m=>m.userId!=u);if(!p)return;N(o,[p],h,s);return}if(h.generalTarget=="custom"){N(o,h.members.filter(p=>p.userId!=u),h,s);return}}async function j(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=l(s,"groupChats"),a=await st();if(!a)return;const u=A.fromBlank(a.fullname,a.email,a.phoneNumber,a.FCMToken,a.uid);t.members.push(u);const r=await b(n,t.toMap());t.id=r.id,await I(r,{id:r.id})}async function Ee(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e);I(u,{resources:k(o.toMap())})}async function ke(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e);I(u,{resources:Tt(o.toMap())})}async function Ue(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(g,"schools",s),a=c(l(n,"activities"),t),u=c(l(a,"shows"),e),r=l(u,"conflictResponses"),f=c(r,o.id);await St(f)}async function be(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=l(s,t+"s");await P(c(n,e.uid),e.toMap());let a;e instanceof z?a=L.fromBlank(e.fullname,e.gender,e.email,e.phoneNumber,e.FCMToken,e.uid):a=B.fromBlank(e.fullname,e.email,e.phoneNumber,e.FCMToken,e.uid),await I(s,{[t+"Uids"]:k(e.uid),[t+"s"]:k(a.toMap())})}function Wt(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function Ne(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(g,"schools",o),n=await D(s);if(!n.exists())return null;const a=n.data(),u=l(s,"activities"),r=Wt(t),f=[_.fromMap({name:"Rehearsal",color:O("#FF0000")}),_.fromMap({name:"Performance",color:O("#00FF00")})],i=[_.fromMap({name:"Practice",color:O("#FF0000")}),_.fromMap({name:"Game",color:O("#00FF00")})],d=[Mt.fromMap({name:"Auditorium",color:O("#0000FF")})],h=ft.fromMap(a.location),w=[h],y=await st();if(!y)return null;const p=B.fromBlank(y.fullname,y.email,y.phoneNumber,y.FCMToken,y.uid);let m;e=="theater"?m=x.fromBlank(t,"",r,[],[],[],[p],w,f,h,d,"type",Date.now()):m=U.fromBlank(t,"",r,[],[],[],[p],w,i,h,"type",Date.now(),"activity");const v=await b(u,m.toMap());m.id=v.id,await I(v,{id:v.id});const M=E.fromMap({name:"Everyone",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"everyone"});await j(M);const J=E.fromMap({name:"Parents",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"parents"});await j(J);const yt=E.fromMap({name:"Students",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"students"});return await j(yt),m}async function Fe(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return null;const n=c(g,"schools",s),a=c(l(n,"activities"),o),u=l(a,"groupChats"),r=E.fromBlank("",e.userId,[t,e],"direct",o,Date.now());return await P(c(u,e.userId),r.toMap()),r.name=e.name,r}async function Le(){const t=await Yt(localStorage.getItem("schoolId")||"");if(!t)return[];const e=[];return t.savedLocations.forEach(o=>{e.push(ft.fromMap(o))}),e}async function Re(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=c(l(s,"activities"),t);await I(n,{locations:k(e.toMap())})}async function Pe(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e);await I(o,{savedLocations:k(t.toMap())})}async function Oe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=c(l(s,"activities"),t);await I(n,{eventTypes:k(e.toMap())})}async function xe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=c(l(s,"activities"),t),a=c(l(n,"shows"),e);await I(a,{isCreatingSchedule:!0})}async function _e(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(g,"schools",o),n=l(s,"students");await P(c(n,t.uid),t.toMap());const a=L.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid);await I(s,{studentUids:k(t.uid),students:k(a.toMap())});const u=a.userId;if(!o||!u)return null;const r=c(l(s,"activities"),e),f=await D(r);return f.exists()?f.data().type=="theater"?(await I(f.ref,{studentUids:[...f.data().studentUids,u],students:[...f.data().students,a.toMap()]}),x.fromMap(f.data())):(await I(f.ref,{studentUids:[...f.data().studentUids,u],students:[...f.data().students,a.toMap()]}),U.fromMap(f.data())):null}async function Ge(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(g,"schools",e),s=c(l(o,"activities"),t.activityId),n=T(l(s,"events"),C("showId","==",t.id)),a=await S(n);for(const u of a.docs){const r=G.fromMap(u.data());for(let i=0;i<r.characters.length;i++){const d=r.characters[i];d instanceof H?r.characters[i]=t.characters.find(h=>h.name==d.name):d instanceof ct&&(r.characters[i]=t.showGroups.find(h=>h.name==d.name))}const f=[];for(const i of r.characters){if(i instanceof Ct){for(const d of t.ensemble.actors)f.push(d);for(const d of t.characters)f.find(h=>h.userId==d.actor.userId)==null&&f.push(d.actor);break}if(i instanceof H){if(f.find(d=>d.userId==i.actor.userId)!=null)continue;f.push(i.actor)}if(i instanceof it){if(i.includeAll)for(const d of t.ensemble.actors)f.find(h=>h.userId==d.userId)==null&&f.push(d);else if(i.includeMale){for(const d of t.ensemble.actors)if(d.gender=="male"){if(f.find(h=>h.userId==d.userId)!=null)continue;f.push(d)}}else if(i.includeFemale){for(const d of t.ensemble.actors)if(d.gender=="female"){if(f.find(h=>h.userId==d.userId)!=null)continue;f.push(d)}}else if(i.includeCustom)for(const d of i.customActors)f.find(h=>h.userId==d.userId)==null&&f.push(d)}if(i instanceof ct)for(const d of i.characters){if(d instanceof H){if(f.find(h=>h.userId==d.actor.userId)!=null)continue;f.push(d.actor)}if(d instanceof it){if(d.includeAll)for(const h of t.ensemble.actors)f.find(w=>w.userId==h.userId)==null&&f.push(h);else if(d.includeMale){for(const h of t.ensemble.actors)if(h.gender=="male"){if(f.find(w=>w.userId==h.userId)!=null)continue;f.push(h)}}else if(d.includeFemale){for(const h of t.ensemble.actors)if(h.gender=="female"){if(f.find(w=>w.userId==h.userId)!=null)continue;f.push(h)}}else if(d.includeCustom)for(const h of d.customActors)f.find(w=>w.userId==h.userId)==null&&f.push(h)}}}r.targets=f,r.lastUpdated=Date.now(),await I(u.ref,r.toMap())}}async function Be(){if(!localStorage.getItem("schoolId"))return[];const e=await pt(),o=[];for(const s of e)if(console.log("Getting resources for "+s.name),s.type=="theater"){const n=await It(s.id);for(const a of n)console.log("Getting resources for "+a.name),o.push(...a.resources)}return o}async function $e(){if(!localStorage.getItem("schoolId"))return[];const e=await pt(),o=[];for(const s of e)if(console.log("Getting resources for "+s.name),s.type=="theater"){const n=await It(s.id);for(const a of n)a.activityName=s.name,o.push(a)}return o}export{he as A,ge as B,Se as C,De as D,Te as E,Re as F,Pe as G,Oe as H,Le as I,j as J,Ae as K,Ce as L,Me as M,st as N,Fe as O,Ee as P,ke as Q,_e as R,Be as S,$e as T,ee as a,ye as b,be as c,Ne as d,pt as e,zt as f,oe as g,It as h,pe as i,Ie as j,se as k,ae as l,ne as m,ce as n,ie as o,Ge as p,re as q,me as r,xe as s,ue as t,ve as u,de as v,we as w,le as x,fe as y,Ue as z};
