import{c as G,j as e,r as a,a as H,l as M,b as T}from"./index-C75OlIaX.js";import{g as _,c as R,a as W}from"./db-DXn89F-F.js";import{T as Y,L as q,G as J,S as K}from"./constants-BV3XiQhG.js";G(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Q,{})}));function Q(){const[l,S]=a.useState(""),[u,j]=a.useState(""),[p,s]=a.useState(!1),[g,B]=a.useState([]),[w,y]=a.useState(""),[I,v]=a.useState("accountType"),[C,P]=a.useState("student"),[N,z]=a.useState("LoginInfo"),[h,A]=a.useState(""),[o,c]=a.useState(""),[b,U]=a.useState(""),[m,L]=a.useState(""),[x,Z]=a.useState("");a.useState(""),a.useState(""),a.useState(""),a.useState(""),a.useState(!1);async function D(t){const n={lat:0,lon:0},r="",d=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const i=await T(l,u);if(console.log(i),!i){alert("Error creating account");return}const E=q.fromBlank("home",r,new J(n.lat,n.lon)),f=K.fromBlank(i,t.schoolId,"unknown",d,"","student",o.replace("none",""),b,"unknown",h.toLowerCase().trim(),h.trim(),l.trim(),{},E);await R("student",f),localStorage.setItem("accountType","student");const k=new URLSearchParams(window.location.search).get("redirect");k?window.location.href=k.replace(/~/g,"&"):window.location.href="/",s(!1)}return a.useEffect(()=>{async function t(){const n=await W();B(n);const r=localStorage.getItem("schoolId");if(r){y(r);return}y(n[0].schoolId)}t()},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:I=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{P("student"),v("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{P("teacher"),v("login")},children:"Teacher"})]}):I=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{S(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{j(t.target.value)}}),e.jsx("label",{htmlFor:"",children:"Select your School"}),e.jsx("select",{onChange:t=>{y(t.target.value)},value:w,children:g.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await H(l,u,w)){s(!1),alert("Wrong email or password");return}const n=localStorage.getItem("userId");if(!await _(w,n,C)){s(!1),alert("You are not in this school"),await M();return}localStorage.setItem("accountType",C),s(!1);const i=new URLSearchParams(window.location.search).get("redirect");i?window.location.href=i.replace(/~/g,"&"):window.location.href="/"},children:"Login"}),e.jsx("button",{className:"actionBtn",onClick:()=>{v("createAccount")},children:"Create an Account"})]}):C=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{S(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{c(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{j(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{L(t.target.value)}}),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),h==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}c(o.replace(/-/g,"")),c(o.replace(/ /g,"")),c(o.replace(/\(/g,"")),c(o.replace(/\)/g,""));const n=/^\d{10}$/;if(o!="none"&&!n.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(u==""){alert("Please enter a password");return}if(u.length<6){alert("Password must be at least 6 characters");return}if(m==""){alert("Please enter your school code");return}const r=g.find(F=>F.schoolTeacherCode==m);if(!r){alert("Invalid School Code");return}localStorage.setItem("schoolId",r.schoolId);const d=Y.fromBlank("",r.schoolId,o.replace("none",""),"","teacher",h.toLowerCase().trim(),h.trim(),l.trim()),i=await T(l,u);if(!i){alert("Error creating account");return}d.uid=i,await R("teacher",d),localStorage.setItem("accountType","teacher");const f=new URLSearchParams(window.location.search).get("redirect");f?window.location.href=f.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Create Account"})]}):N=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),$(),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:()=>{if(h==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}c(o.replace(/-/g,"")),c(o.replace(/ /g,"")),c(o.replace(/\(/g,"")),c(o.replace(/\)/g,""));const n=/^\d{10}$/;if(o!="none"&&!n.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(u==""){alert("Please enter a password");return}if(u.length<6){alert("Password must be at least 6 characters");return}if(b==""){alert("Please select your sex");return}const r=g.find(d=>d.schoolDomain==l.split("@")[1]);if(r!=null){s(!0),D(r);return}z("SchoolCode")},children:"Next"})]}):N=="HomeAddress"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),O(),p?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{s(!0);let t;if(m!=""?t=g.find(n=>n.schoolCode==m):t=g.find(n=>n.schoolDomain==x.split("@")[1]),t==null){m!=""&&x!=""?alert("Invalid School Code or a School Email"):x!=""?alert("Invalid School Email"):alert("Invalid School Code"),s(!1);return}},children:"Create Account"})]})})})});function $(){return e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Please enter your full name!"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{S(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{j(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{c(t.target.value)}}),e.jsxs("select",{onChange:t=>{U(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function O(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:m,onChange:t=>{L(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:x,onChange:t=>{Z(t.target.value)}})]})}}
