import{w as It,x as i,y as c,z as M,q as B,g as L,B as b,H as y,C,E as N,b as j,d as W,f as _,I as w,J as T,K as A,i as q,N as x,m as K,O as X,S as Z,T as yt,P as R,Q as vt,U as $,u as wt,r as k,V as at,W as ct,M as Y,s as E,X as St,p as G,Y as O,n as Dt,L as dt}from"./constants-DVdhFwOl.js";import{h as Tt,C as Mt,k as it,_ as At,d as tt,e as Ct,f as Et,F as kt,n as et,g as P}from"./index-DsZHpGFm.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="type.googleapis.com/google.protobuf.Int64Value",bt="type.googleapis.com/google.protobuf.UInt64Value";function ft(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function z(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>z(e));if(typeof t=="function"||typeof t=="object")return ft(t,e=>z(e));throw new Error("Data cannot be encoded in JSON: "+t)}function J(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Nt:case bt:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>J(e)):typeof t=="function"||typeof t=="object"?ft(t,e=>J(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends kt{constructor(e,o,s){super(`${ot}/${e}`,o||""),this.details=s}}function Ut(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Ft(t,e){let o=Ut(t),s=o,n;try{const a=e&&e.error;if(a){const r=a.status;if(typeof r=="string"){if(!rt[r])return new F("internal","internal");o=rt[r],s=r}const l=a.message;typeof l=="string"&&(s=l),n=a.details,n!==void 0&&(n=J(n))}}catch{}return o==="ok"?null:new F(o,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||o.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q="us-central1";function Rt(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new F("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class Pt{constructor(e,o,s,n,a=Q,r){this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Lt(o,s,n),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=Q}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function Ot(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function _t(t,e,o){return s=>Gt(t,e,s,{})}async function xt(t,e,o,s){o["Content-Type"]="application/json";let n;try{n=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let a=null;try{a=await n.json()}catch{}return{status:n.status,json:a}}function Gt(t,e,o,s){const n=t._url(e);return Bt(t,n,o,s)}async function Bt(t,e,o,s){o=z(o);const n={data:o},a={},r=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);r.authToken&&(a.Authorization="Bearer "+r.authToken),r.messagingToken&&(a["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(a["X-Firebase-AppCheck"]=r.appCheckToken);const l=s.timeout||7e4,g=Rt(l),u=await Promise.race([xt(e,n,a,t.fetchImpl),g.promise,t.cancelAllRequests]);if(g.cancel(),!u)throw new F("cancelled","Firebase Functions instance was deleted.");const f=Ft(u.status,u.json);if(f)throw f;if(!u.json)throw new F("internal","Response is not valid JSON object.");let h=u.json.data;if(typeof h>"u"&&(h=u.json.result),typeof h>"u")throw new F("internal","Response is missing data field.");return{data:J(h)}}const lt="@firebase/functions",ut="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="auth-internal",Jt="app-check-internal",Ht="messaging-internal";function jt(t,e){const o=(s,{instanceIdentifier:n})=>{const a=s.getProvider("app").getImmediate(),r=s.getProvider($t),l=s.getProvider(Ht),g=s.getProvider(Jt);return new Pt(a,r,l,g,n,t)};Tt(new Mt(ot,o,"PUBLIC").setMultipleInstances(!0)),it(lt,ut,e),it(lt,ut,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t=Et(),e=Q){const s=At(tt(t),ot).getImmediate({identifier:e}),n=Ct("functions");return n&&Vt(s,...n),s}function Vt(t,e,o){Ot(tt(t),e,o)}function st(t,e,o){return _t(tt(t),e)}jt(fetch.bind(self));const qt=ht(et);function U(t,e,o,s){st(qt,"sendEmail")({emails:e.map(n=>n.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:t.message,senderName:t.senderName})}const gt=ht(et),d=It(et),mt=i(d,"schools"),Kt=async t=>{const e=c(mt,t);return(await M(e)).data()},Wt=async()=>{const t=await w(mt),e=[];return t.forEach(o=>{e.push(o.data())}),e},Zt=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=c(d,"schools",e);if(t=="student"){const s=T(i(o,"activities"),A("studentUids","array-contains",P())),n=[];return(await w(s)).forEach(r=>{n.push(L.fromMap(r.data()))}),n}else{const s=T(i(o,"activities"),A("teacherUids","array-contains",P())),n=[];return(await w(s)).forEach(r=>{console.log(r.data()),n.push(L.fromMap(r.data()))}),n}};async function Xt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(d,"schools",e),s=c(i(o,"activities"),t),n=await M(s);return n.exists()?n.data().type=="theater"?B.fromMap(n.data()):L.fromMap(n.data()):null}async function te(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"shows"),a=await b(n,t.toMap());return t.id=a.id,await y(a,{id:a.id}),a.id}async function ee(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"shows"),t.id);await y(n,t.toMap())}async function oe(t){const e=i(d,"showTemplates"),o=await b(e,t.toMap());return t.id=o.id,await y(o,{id:o.id}),o.id}async function se(t){t.ensemble&&(t.ensemble.actors=[]);for(const o of t.characters)o instanceof C&&(o.actor=null);for(const o of t.showGroups)for(const s of o.characters)s instanceof C?s.actor=null:s instanceof N&&(s.customActors=[]);for(const o of t.layout)for(const s of o.scenes)for(const n of s.characters)if(n instanceof C)n.actor=null;else if(n instanceof j)for(const a of n.characters)a instanceof C?a.actor=null:a instanceof N&&(a.customActors=[]);else n instanceof N&&(n.customActors=[]);for(const o of t.songs)for(const s of o.characters)if(s instanceof C)s.actor=null;else if(s instanceof j)for(const n of s.characters)n instanceof C?n.actor=null:n instanceof N&&(n.customActors=[]);else s instanceof N&&(s.customActors=[]);for(const o of t.dances)for(const s of o.characters)if(s instanceof C)s.actor=null;else if(s instanceof j)for(const n of s.characters)n instanceof C?n.actor=null:n instanceof N&&(n.customActors=[]);else s instanceof N&&(s.customActors=[]);const e=c(i(d,"showTemplates"),t.templateId);await y(e,t.toMap())}async function ne(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),n=c(i(s,"activities"),t),a=c(i(n,"shows"),e),r=await M(a);return r.exists()?(console.log(r.data()),W.fromMap(r.data())):null}async function ae(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=c(d,"schools",e),s=c(i(o,"activities"),t),n=await M(s);if(!n.exists())return[];const a=[];return n.data().students.forEach(r=>{a.push(_.fromMap(r))}),a}async function ce(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);await x(r,o.toMap())}async function ie(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"events"),a=await b(n,t.toMap());t.id=a.id,await y(a,{id:a.id})}async function re(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(d,"schools",o),a=c(i(n,"activities"),t),r=i(a,"events");if(s=="student"){const l=await w(T(r,A("showId","==",e),A("targetUids","array-contains",P()))),g=[];return l.forEach(u=>{u.data().deleted||g.push(q.fromMap(u.data()))}),g}else{const l=await w(T(r,A("showId","==",e))),g=[];return l.forEach(u=>{u.data().deleted||g.push(q.fromMap(u.data()))}),g}}async function le(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"events"),t.id);await y(n,{deleted:!0}),await st(gt,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function ue(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=c(d,"schools",e),s=c(i(o,"activities"),t),n=i(s,"shows"),a=await w(n),r=[];return a.forEach(l=>{r.push(W.fromMap(l.data()))}),r}async function de(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);await y(r,{conflictForm:o.toMap()}),await st(gt,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function fe(){const t=await P(),e=localStorage.getItem("schoolId");if(!e)return null;const o=c(d,"schools",e),s=i(o,"students"),n=c(s,t),a=await M(n);return a.exists()?_.fromMap(a.data()):null}async function he(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=c(r,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await x(l,o.toMap())}async function ge(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(d,"schools",o),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(P());const f=await w(T(l,A("submitterId","==",P()))),h=[];return f.forEach(S=>{h.push(K.fromMap(S.data()))}),h}const g=await w(l),u=[];return g.forEach(f=>{u.push(K.fromMap(f.data()))}),u}async function me(){const t=i(d,"showTemplates"),e=await w(t),o=[];return e.forEach(s=>{o.push(W.fromMap(s.data()))}),o}async function pe(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const n=c(d,"schools",e),a=T(i(n,"activities"),A("joinCode","==",t)),r=await w(a);if(r.empty)return null;const l=r.docs[0],g=c(i(n,s=="student"?"students":"teachers"),o),u=await M(g);if(console.log(u.data()),!u.exists())return null;if(l.data().studentUids.includes(o)||l.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),l.data().type=="theater"){if((u.data().gender==null||u.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),u.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(u.data().phoneNumber==""||u.data().gender==null||u.data().gender=="")&&s=="student")return null;if(s=="student")return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,_.fromMap(u.data()).toMap()]}),B.fromMap(l.data());{console.log("Joining as teacher"),console.log(u.data());const f=$.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return console.log(f.toMap()),await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),B.fromMap(l.data())}}else if(s=="student"){const f=_.fromBlank(u.data().fullname,u.data().gender,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,f.toMap()]}),L.fromMap(l.data())}else{const f=$.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),L.fromMap(l.data())}}async function Ie(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(d,"schools",e),a=c(i(n,s=="student"?"students":"teachers"),o);await y(a,{gender:t})}async function ye(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(d,"schools",e),a=c(i(n,s=="student"?"students":"teachers"),o);await y(a,{phoneNumber:t})}async function ve(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"events"),t.id);await y(n,t.toMap())}async function we(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=c(d,"schools",t),n=[];let a;o=="student"?a=await w(T(i(s,"activities"),A("studentUids","array-contains",e))):a=await w(T(i(s,"activities"),A("teacherUids","array-contains",e))),console.log(a);for(const r of a.docs){let l;o=="student"?l=await w(T(i(r.ref,"events"),A("targetUids","array-contains",e))):l=await w(i(r.ref,"events"));for(const g of l.docs){const u=g.data();console.log(u),u.type=="activity-theater-event"?n.push(q.fromMap(u)):n.push(wt.fromMap(u))}}return n}async function Se(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const n=c(d,"schools",o),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses"),g=await M(c(l,s));return g.exists()?K.fromMap(g.data()):null}async function De(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),t);await y(n,{rehearsalLocations:e.map(a=>a.toMap())})}async function Te(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const n=localStorage.getItem("accountType"),a=c(d,"schools",o),r=c(i(a,"activities"),t);if(n=="teacher")X(i(r,"groupChats"),async l=>{const g=[];for(const u of l.docs){const f=k.fromMap(u.data());if((f.generalTarget=="direct"||f.generalTarget=="custom")&&!f.members.find(p=>p.userId==s))continue;if(f.generalTarget=="direct"){const p=f.members.find(m=>m.userId!=s);f.name=(p==null?void 0:p.name)||"Unknown"}const h=i(u.ref,"messages"),S=T(h,ct("timeSent","desc"),at(1)),I=await w(S);I.empty||(f.lastMessage=Y.fromMap(I.docs[0].data())),g.push(f)}g.sort((u,f)=>u.lastMessage?f.lastMessage?f.lastMessage.timeSent.getTime()-u.lastMessage.timeSent.getTime():-1:1),e(g)});else{const l=c(i(a,"students"),s),g=await M(l);if(!g.exists())return;const u=Z.fromMap(g.data());console.log(u),X(i(r,"groupChats"),async f=>{const h=[];for(const S of f.docs){const I=k.fromMap(S.data());if(!(I.generalTarget=="everyone"||I.generalTarget=="students")&&(I.generalTarget=="parents"||!I.members.find(D=>D.userId==s)))continue;if(I.generalTarget=="direct"){const D=I.members.find(H=>H.userId!=s);I.name=(D==null?void 0:D.name)||"Unknown"}const p=i(S.ref,"messages"),m=T(p,ct("timeSent","desc"),at(1)),v=await w(m);v.empty||(I.lastMessage=Y.fromMap(v.docs[0].data())),h.push(I)}h.sort((S,I)=>S.lastMessage?I.lastMessage?I.lastMessage.timeSent.getTime()-S.lastMessage.timeSent.getTime():-1:1),e(h)})}}async function Me(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const n=c(d,"schools",s),a=c(i(n,"activities"),t);console.log("Getting messages for "+e);const r=c(i(a,"groupChats"),e),l=i(r,"messages");X(l,g=>{const u=[];g.forEach(f=>{u.push(Y.fromMap(f.data()))}),u.sort((f,h)=>f.timeSent.getTime()-h.timeSent.getTime()),o(u)})}async function nt(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=c(d,"schools",t),n=c(i(s,o=="student"?"students":"teachers"),e),a=await M(n);return a.exists()?o=="student"?Z.fromMap(a.data()):yt.fromMap(a.data()):null}async function Ae(t,e,o,s,n){if(o.message=="")return;const a=localStorage.getItem("schoolId"),r=localStorage.getItem("userId");if(!a||!r)return;const l=c(d,"schools",a),g=c(i(l,"activities"),t),u=c(i(g,"groupChats"),e),f=await M(u);if(!f.exists()){if(n==null)return;const p=await nt();if(!p)return;const m=k.fromBlank("",n.userId,[E.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),n],"direct",t,Date.now());await x(u,m.toMap());const v=i(u,"messages"),D=await b(v,o.toMap());o.messageId=D.id,await y(D,{messageId:D.id}),U(o,[E.fromMap(n)],m,s);return}const h=k.fromMap(f.data()),S=i(u,"messages"),I=await b(S,o.toMap());if(o.messageId=I.id,await y(I,{messageId:I.id}),h.generalTarget!="direct"&&h.generalTarget!="custom"&&h.generalTarget!="group"){const p=await Xt(t);if(!p)return;if(h.generalTarget=="everyone"){let m=p.students.map(v=>E.fromMap(v));m=m.concat(p.teachers.map(v=>E.fromMap(v))),m=m.concat(p.parents.map(v=>E.fromMap(v))),m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}else if(h.generalTarget=="students"){let m=p.students.map(v=>E.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}else if(h.generalTarget=="parents"){let m=p.parents.map(v=>E.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}return}if(h.generalTarget=="direct"){const p=h.members.find(m=>m.userId!=r);if(!p)return;U(o,[p],h,s);return}if(h.generalTarget=="custom"){U(o,h.members.filter(p=>p.userId!=r),h,s);return}}async function V(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"groupChats"),a=await nt();if(!a)return;const r=E.fromBlank(a.fullname,a.email,a.phoneNumber,a.FCMToken,a.uid);t.members.push(r);const l=await b(n,t.toMap());t.id=l.id,await y(l,{id:l.id})}async function Ce(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);y(r,{resources:R(o.toMap())})}async function Ee(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);y(r,{resources:St(o.toMap())})}async function ke(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses"),g=c(l,o.id);await vt(g)}async function Ne(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=i(s,t+"s");await x(c(n,e.uid),e.toMap());let a;e instanceof Z?a=_.fromBlank(e.fullname,e.gender,e.email,e.phoneNumber,e.FCMToken,e.uid):a=$.fromBlank(e.fullname,e.email,e.phoneNumber,e.FCMToken,e.uid),await y(s,{[t+"Uids"]:R(e.uid),[t+"s"]:R(a.toMap())})}function Yt(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function be(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),n=await M(s);if(!n.exists())return null;const a=n.data(),r=i(s,"activities"),l=Yt(t),g=[G.fromMap({name:"Rehearsal",color:O("#FF0000")}),G.fromMap({name:"Performance",color:O("#00FF00")})],u=[G.fromMap({name:"Practice",color:O("#FF0000")}),G.fromMap({name:"Game",color:O("#00FF00")})],f=[Dt.fromMap({name:"Auditorium",color:O("#0000FF")})],h=dt.fromMap(a.location),S=[h],I=await nt();if(!I)return null;const p=$.fromBlank(I.fullname,I.email,I.phoneNumber,I.FCMToken,I.uid);let m;e=="theater"?m=B.fromBlank(t,"",l,[],[],[],[p],S,g,h,f,"type",Date.now()):m=L.fromBlank(t,"",l,[],[],[],[p],S,u,h,"type",Date.now(),"activity");const v=await b(r,m.toMap());m.id=v.id,await y(v,{id:v.id});const D=k.fromMap({name:"Everyone",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"everyone"});await V(D);const H=k.fromMap({name:"Parents",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"parents"});await V(H);const pt=k.fromMap({name:"Students",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"students"});return await V(pt),m}async function Ue(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return null;const n=c(d,"schools",s),a=c(i(n,"activities"),o),r=i(a,"groupChats"),l=k.fromBlank("",e.userId,[t,e],"direct",o,Date.now());return await x(c(r,e.userId),l.toMap()),l.name=e.name,l}async function Fe(){const t=await Kt(localStorage.getItem("schoolId")||"");if(!t)return[];const e=[];return t.savedLocations.forEach(o=>{e.push(dt.fromMap(o))}),e}async function Le(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),t);await y(n,{locations:R(e.toMap())})}async function Re(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(d,"schools",e);await y(o,{savedLocations:R(t.toMap())})}async function Pe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),t);await y(n,{eventTypes:R(e.toMap())})}export{we as A,Se as B,De as C,Le as D,Re as E,Pe as F,Fe as G,V as H,Ae as I,Me as J,Te as K,nt as L,Ue as M,Ce as N,Ee as O,Ie as a,be as b,Ne as c,Zt as d,Xt as e,ue as f,Wt as g,me as h,te as i,pe as j,oe as k,se as l,ee as m,ne as n,ae as o,ge as p,re as q,le as r,ce as s,ve as t,ye as u,ie as v,de as w,ke as x,fe as y,he as z};
