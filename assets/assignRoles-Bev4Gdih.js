import{j as a,c as W,r as d,i as q}from"./index-U3pxML4x.js";import{g as z,d as O,i as K,c as w,e as y,h as Q}from"./constants-HHyPtPso.js";import{C as V,S as X}from"./Show_Group_Tile-Czxku-xc.js";import{r as Y,t as Z,v as _}from"./db-Dx9I_CLb.js";import{T as $}from"./trash-BnpXJPEK.js";import{A as ee}from"./Ensemble_Section_Tile-himdrGJR.js";function se({actor:g,canDelete:G,onDelete:m}){return a.jsx("div",{className:"ActorTile",id:"actor-tile-"+g.userId,children:a.jsxs("div",{className:"header",children:[a.jsx("div",{className:"ActorNameDiv",children:a.jsxs("label",{htmlFor:"Actor",children:["Actor: ",g.name]})}),G&&a.jsx("div",{className:"ActorTrashDiv",children:a.jsx("img",{src:$,alt:"",className:"TrashIcon",onClick:()=>{m()}})})]})})}W(document.getElementById("root")).render(a.jsx(d.StrictMode,{children:a.jsx(te,{})}));function te(){const[g,G]=d.useState(""),[m,B]=d.useState(""),[n,E]=d.useState(),[f,j]=d.useState([]),[p,v]=d.useState([]),[L,C]=d.useState(!1),[A,M]=d.useState([]),[I,x]=d.useState([]),[P,k]=d.useState(!1),N=d.useRef(null),[R,U]=d.useState(!1),[F,T]=d.useState(!0),[S,b]=d.useState("Characters");async function H(){let l=!0;if(C(!0),!n){C(!1);return}for(let t=0;t<n.characters.length;t++){const c=n.characters[t],s=f.find(e=>e.characterId==c.characterId);s&&(console.log("New Character"),console.log(s),n.characters[t]=s,s.actor==null&&(console.log("Actor is null"),l=!1))}for(let t=0;t<n.showGroups.length;t++){console.log("UPDATING SHOW GROUPS");const c=n.showGroups[t];console.log("Show Group: "+c.name);const s=p.find(e=>e.showGroupId==c.showGroupId);if(console.log("New Show Group: "+(s==null?void 0:s.name)),s){c.characters=s.characters;for(let e=0;e<c.characters.length;e++){const r=c.characters[e];if(r instanceof w){const o=f.find(i=>i.characterId==r.characterId);o&&(c.characters[e]=o,o.actor==null&&(l=!1))}}}}for(let t=0;t<n.layout.length;t++){const c=n.layout[t];for(let s=0;s<c.scenes.length;s++){const e=c.scenes[s];for(let r=0;r<e.characters.length;r++){const o=e.characters[r];if(o instanceof w){const i=f.find(h=>h.characterId==o.characterId);i&&(e.characters[r]=i)}else if(o instanceof y){const i=p.find(h=>h.showGroupId==o.showGroupId);if(i){for(let h=0;h<i.characters.length;h++){const u=i.characters[h];if(u instanceof w){const D=f.find(J=>J.characterId==u.characterId);D&&(i.characters[h]=D)}}e.characters[r]=i}}}}}for(let t=0;t<n.songs.length;t++){const c=n.songs[t];console.log("Assigning roles to song"),console.log(c);for(let s=0;s<c.characters.length;s++){const e=c.characters[s];if(console.log("Character"),console.log(e),console.log(typeof e),e instanceof w){const r=f.find(o=>o.characterId==e.characterId);r&&(c.characters[s]=r)}else if(e instanceof y){const r=p.find(o=>o.showGroupId==e.showGroupId);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof w){const h=f.find(u=>u.characterId==i.characterId);h&&(r.characters[o]=h)}}c.characters[s]=r}}console.log("New Character"),console.log(c.characters[s]),console.log(typeof c.characters[s])}}for(let t=0;t<n.dances.length;t++){const c=n.dances[t];for(let s=0;s<c.characters.length;s++){const e=c.characters[s];if(e instanceof w){const r=f.find(o=>o.characterId==e.characterId);r&&(c.characters[s]=r)}else if(e instanceof y){const r=p.find(o=>o.showGroupId==e.showGroupId);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof w){const h=f.find(u=>u.characterId==i.characterId);h&&(r.characters[o]=h)}}c.characters[s]=r}}}}if(n.canCreateSchedule=l,n.ensemble=Q.fromBlank(I,Date.now()),n.isCreatingSchedule){if(!l){alert("Cannot update show because not all characters have been assigned actors"),C(!1);return}await Z(n)}E(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+m,JSON.stringify(n)),await _(g,m,n),C(!1)}return d.useEffect(()=>{q(()=>{}),k(!0);const l=new URLSearchParams(window.location.search),t=l.get("activityId");t&&(G(t),Y(t).then(e=>{M(e),console.log(e),k(!1)}));const c=l.get("showId");c&&B(c);const s=localStorage.getItem("show-"+c);if(s){const e=z.fromMap(JSON.parse(s));if(T(!0),e==null){window.location.href="/Activity/Shows/Show/?activityId="+t;return}E(e),console.log(e),j(e.characters),v(e.showGroups);const r=e.showGroups;let o=!1;for(let i=0;i<r.length;i++)r[i].characters.map(u=>u instanceof O).includes(!0)&&(o=!0);U(o),e!=null&&e.hasEnsemble&&x(e.ensemble.actors),T(!1)}},[]),a.jsxs(a.Fragment,{children:[" ",F?a.jsx("div",{className:"centerLoader",children:a.jsx("div",{className:"loader"})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"title",children:a.jsx("h1",{children:"Assign Roles"})}),a.jsxs("div",{className:"center",children:[a.jsxs("div",{className:"sections",children:[a.jsx("h2",{className:"section "+(S=="Characters"?"selected":""),onClick:()=>{b("Characters")},children:"Characters"}),R&&a.jsx("h2",{className:"section "+(S=="Show Groups"?"selected":""),onClick:()=>{b("Show Groups")},children:"Show Groups"}),(n==null?void 0:n.hasEnsemble)&&a.jsx("h2",{className:"section "+(S=="Ensemble"?"selected":""),onClick:()=>{b("Ensemble")},children:"Ensemble"})]}),S=="Characters"&&a.jsx("div",{className:"characters",id:"create-characters",children:f.map((l,t)=>a.jsx(V,{character:l,actors:A,characters:[],isAssign:!0,setCharacter:c=>{j(s=>{const e=[...s];return e[t]=c,e})},removeCharacter:()=>{j(f.filter((c,s)=>s!==t))},isCreate:!1},t))}),R&&S=="Show Groups"&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"showGroups",id:"create-showGroups",children:p.map((l,t)=>l.characters.map(c=>c instanceof O).includes(!0)?a.jsx(X,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:f,actors:A,isAssign:!0,setShowGroup:c=>{v(s=>{const e=[...s];e[t]=c,console.log("NEW SHOW GROUPS");for(let r=0;r<e.length;r++){const o=e[r];console.log(o.toMap())}return e})},removeShowGroup:()=>{v(p.filter((c,s)=>s!==t))},isCreate:!1},t):null)})}),(n==null?void 0:n.hasEnsemble)&&S=="Ensemble"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"ensemble",id:"create-ensemble",children:I.map((l,t)=>(console.log(l),a.jsx(se,{actor:l,canDelete:!0,onDelete:()=>{x(I.filter((c,s)=>s!==t))}},t)))}),a.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=N.current)==null||l.showModal()},children:"Add Actor"})]}),L?a.jsx("div",{className:"loader"}):a.jsx("button",{className:"ActionBtn",onClick:async()=>{await H(),window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+m},children:"Save"}),a.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+m},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!P&&a.jsx(ee,{dialogRef:N,keepPastResult:!1,actor:new K,addedActors:I,actors:A,setActor:l=>{const t=[...I];t.push(l),console.log("Setting actors"),x(t)},close:()=>{var l;(l=N.current)==null||l.close()}})]})]})}
