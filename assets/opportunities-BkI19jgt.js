import{r as i,j as e,c as oe,i as re}from"./index-U3pxML4x.js";import{J as q,O as z,B as x,H as l,C as de,k as ce,I as ue}from"./constants-HHyPtPso.js";import{aa as K,G as me,ab as he,ac as xe,ad as je,ae as fe,af as ge,ag as pe}from"./db-Dx9I_CLb.js";import{g as U}from"./distance-DNOHIura.js";function ve({close:c,dialogRef:a,confirmed:o}){const[m,y]=i.useState(!1);return e.jsx("dialog",{ref:a,children:e.jsxs("div",{className:"ConfirmApplyDialog",children:[e.jsx("h2",{children:"Did you apply?"}),e.jsx("br",{}),m?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{y(!0),await o(),y(!1)},children:"Yes"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{c()},children:"No"})]})})}function ye({opportunity:c,accountType:a,studentData:o,onEdit:m,onRemove:y,onApply:L}){const j=i.useRef(null),[w,u]=i.useState(!1);function I(s,r,A){const S=new Intl.DateTimeFormat("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),C=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),k=S.format(s),R=C.format(r),f=C.format(A);return`On ${k} from ${R} to ${f}`}function h(s){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:s.position}),e.jsx("label",{htmlFor:"",children:"Job"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[s.companyName," • ",U(s.location.location.latitude,s.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsxs("label",{htmlFor:"",children:["$",s.hourlyRate.toFixed(2)," per hour"]}),e.jsx("label",{htmlFor:"",children:s.shiftType==x.Weekdays?"Weekdays":s.shiftType==x.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:s.description}),a==="student"&&e.jsx("br",{}),a==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var r;window.open(s.applicationLink,"_blank"),(r=j.current)==null||r.showModal()},children:"Apply"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{u(!0),await y(),u(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function F(s){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:s.position}),e.jsx("label",{htmlFor:"",children:"One Time Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[s.companyName," • ",U(s.location.location.latitude,s.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:I(s.eventDate.date,s.eventDate.from,s.eventDate.to)}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:s.description}),a==="student"&&e.jsx("br",{}),a==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var r;window.open(s.applicationLink,"_blank"),(r=j.current)==null||r.showModal()},children:"Apply"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{u(!0),await y(),u(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function b(s){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:s.position}),e.jsx("label",{htmlFor:"",children:"Recurring Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[s.companyName," • ",U(s.location.location.latitude,s.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:s.shiftType==x.Weekdays?"Weekdays":s.shiftType==x.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:s.description}),a==="student"&&e.jsx("br",{}),a==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var r;window.open(s.applicationLink,"_blank"),(r=j.current)==null||r.showModal()},children:"Apply"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?w?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{u(!0),await y(),u(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}return e.jsxs(e.Fragment,{children:[c instanceof q?h(c):c instanceof z?F(c):b(c),a==="student"&&e.jsx(ve,{dialogRef:j,close:()=>{var s;(s=j.current)==null||s.close()},confirmed:async()=>{var s;c.applicants.push(o.toActivityMember()),c.lastUpdated=Date.now(),await K(c,!0),(s=j.current)==null||s.close(),L()}})]})}oe(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(be,{})}));function be(){const[c,a]=i.useState("student"),[o,m]=i.useState([]),[y,L]=i.useState(!0),[j,w]=i.useState(!1),[u,I]=i.useState(null),[h,F]=i.useState(l.Job),[b,s]=i.useState(x.Weekdays),[r,A]=i.useState(0),[S,C]=i.useState(""),[k,R]=i.useState(""),[f,B]=i.useState(),[N,E]=i.useState(),[W,O]=i.useState(),[V,J]=i.useState(),[Q,H]=i.useState(""),[X,P]=i.useState(""),[M,Z]=i.useState([]),[T,$]=i.useState(""),[ee,_]=i.useState(!1),[g,G]=i.useState(null),[D,Y]=i.useState(!1),[te,ne]=i.useState(void 0);i.useEffect(()=>{re(()=>{}),new URLSearchParams(window.location.search);const t=localStorage.getItem("accountType");t&&a(t),t=="student"?me().then(n=>{const d=n;ne(n),he().then(p=>{m(p.filter(v=>!v.applicants.find(le=>le.userId==d.uid))),L(!1)})}):xe().then(n=>{n||(window.location.href="/"),I(n),Z([...n.savedLocations,n.location]),B(n.location),(n==null?void 0:n.type)==de.Job?F(l.Job):F(l.OneTimeVolunteer),je().then(d=>{m(d),L(!1),console.log(d)})})},[]);const se=t=>{const n=t.target.value,[d,p]=n.split(":").map(Number),v=new Date(N);v.setHours(d,p,0,0),O(v),H(v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},ie=t=>{const n=t.target.value,[d,p]=n.split(":").map(Number),v=new Date(N);v.setHours(d,p,0,0),J(v),P(v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(t){return this.setTime(this.getTime()+t*60*60*1e3),this};function ae(){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"createOpportunity",children:[e.jsxs("h1",{children:[D?"Edit":"Create"," Opportunity"]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Position: "}),e.jsx("input",{placeholder:"Position",value:S,onChange:t=>{C(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Description: "}),e.jsx("textarea",{placeholder:"Description",value:k,onChange:t=>{R(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Locaiton: "}),e.jsx("select",{name:"location",id:"",value:f==null?void 0:f.address,onChange:t=>{const n=M.find(d=>d.address==t.target.value);n&&B(n)},children:M.map(t=>e.jsx("option",{value:t.address,children:t.name}))})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Opporunity Type: "}),e.jsxs("select",{name:"opportunityType",id:"",value:h,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:l.Job,children:"Job"}),e.jsx("option",{value:l.OneTimeVolunteer,children:"One Time Volunteer"}),e.jsx("option",{value:l.RecurringVolunteer,children:"Recurring Volunteer"})]})]}),h==l.Job&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Salary: "}),e.jsx("input",{type:"number",placeholder:"Salary",value:r,onChange:t=>{A(parseFloat(t.target.value))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:b,onChange:t=>{s(t.target.value)},children:[e.jsx("option",{value:x.Weekdays,children:"Weekdays"}),e.jsx("option",{value:x.Weekends,children:"Weekends"}),e.jsx("option",{value:x.All,children:"Weekdays and Weekends"})]})]})]}),h==l.OneTimeVolunteer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:N==null?void 0:N.toISOString().split("T")[0],onChange:t=>{const n=new Date(t.target.value);if(n=="Invalid Date"){E(new Date);return}n.setHours(0,0,0,0),n.setDate(n.getDate()+1),E(n);const d=new Date(n);d.setHours(W.getHours(),W.getMinutes(),0,0),O(d),H(d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const p=new Date(n);p.setHours(V.getHours(),V.getMinutes(),0,0),J(p),P(p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:Q,onChange:se})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:X,onChange:ie})]})]}),h==l.RecurringVolunteer&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:b,onChange:t=>{s(t.target.value)},children:[e.jsx("option",{value:x.Weekdays,children:"Weekdays"}),e.jsx("option",{value:x.Weekends,children:"Weekends"}),e.jsx("option",{value:x.All,children:"Weekdays and Weekends"})]})]})}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Application Link: "}),e.jsx("input",{placeholder:"Application Link",value:T,onChange:t=>{$(t.target.value)}})]}),ee?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(S==""||k==""||f==null||T==""){alert("Please fill out all fields");return}if(h==l.Job&&(r==0||b==null)){alert("Please fill out all fields");return}if(h==l.OneTimeVolunteer&&(N==null||W==null||V==null)){alert("Please fill out all fields");return}if(h==l.RecurringVolunteer&&b==null){alert("Please fill out all fields");return}_(!0);let t;if(h==l.Job)t=new q({companyName:u.name,position:S,description:k,location:f,shiftType:b,hourlyRate:r,applicationLink:T,companyId:u.id,id:"",type:l.Job,isAvailable:!0,lastUpdated:Date.now(),applicants:[]});else if(h==l.OneTimeVolunteer){const n=ce.fromBlank(N,W,V);t=new z({companyName:u.name,position:S,description:k,location:f,eventDate:n,applicationLink:T,companyId:u.id,id:"",type:l.OneTimeVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[],taskId:D?g.taskId:""})}else t=new ue({companyName:u.name,position:S,description:k,location:f,shiftType:b,applicationLink:T,companyId:u.id,id:"",type:l.RecurringVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[]});console.log(t),D?(t.id=g.id,(g==null?void 0:g.type)==l.OneTimeVolunteer&&t.type!=l.OneTimeVolunteer&&await ge(g.taskId),await K(t,!1),m(o.map(n=>n.id==(g==null?void 0:g.id)?t:n)),G(null),Y(!1)):(t=await pe(t),o.push(t),m(o),w(!1)),_(!1)},children:D?"Save":"Create"})]})})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Opportunities"})}),e.jsxs("div",{className:"center",children:[y&&e.jsx("div",{className:"loader"}),j||D?ae():e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opportunities",children:o.map(t=>e.jsx(ye,{opportunity:t,accountType:c,studentData:te,onApply:()=>{m(o.filter(n=>n.id!=t.id))},onEdit:()=>{if(G(t),F(t.type),C(t.position),R(t.description),B(t.location),t.type==l.Job&&(A(t.hourlyRate),s(t.shiftType)),t.type==l.OneTimeVolunteer){const n=t.eventDate;E(n.date),O(n.from),J(n.to),H(n.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),P(n.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}t.type==l.RecurringVolunteer&&s(t.shiftType),$(t.applicationLink),Y(!0)},onRemove:async()=>{await fe(t),m(o.filter(n=>n.id!=t.id))}}))}),c=="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{w(!0)},children:"Create Opportunity"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{j?w(!1):window.location.href="/"},children:"Back"})]})]})}
