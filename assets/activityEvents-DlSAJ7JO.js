import{r as l,j as e,n as te,c as Te,i as Ee,I as ue}from"./index-TIL8WiPk.js";import{X as De,h as be,Y as Ne,Z as we,_ as me}from"./db-CKd-MU9l.js";import{B as Ce,C as he}from"./Calendar-6zQklVNK.js";import{T as ye}from"./trash-BnpXJPEK.js";function ke({dialogRef:Q,close:W,addDate:x,eventDate:f}){const[S,O]=l.useState(new Date),[P,J]=l.useState(new Date),[V,E]=l.useState(new Date),[D,k]=l.useState(""),[s,_]=l.useState(""),U=Y=>{const c=Y.target.value,[g,u]=c.split(":").map(Number),d=new Date(S);d.setHours(g,u,0,0),J(d),k(d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},q=Y=>{const c=Y.target.value,[g,u]=c.split(":").map(Number),d=new Date(S);d.setHours(g,u,0,0),E(d),_(d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};return l.useEffect(()=>{f&&(O(f.date),J(f.from),E(f.to),k(f.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),_(f.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})))},[f]),e.jsxs("dialog",{ref:Q,className:"AddEventDateDialog",children:[e.jsx("h2",{children:"Add Event Date"}),e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:S==null?void 0:S.toISOString().split("T")[0],onChange:Y=>{const c=new Date(Y.target.value);c.setHours(0,0,0,0),c.setDate(c.getDate()+1),O(c);const g=new Date(c);g.setHours(P.getHours(),P.getMinutes(),0,0),J(g),k(g.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const u=new Date(c);u.setHours(V.getHours(),V.getMinutes(),0,0),E(u),_(u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:D,onChange:U}),e.jsx("br",{}),e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:s,onChange:q}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"ActionBtn",onClick:()=>{W()},children:"Close"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{x(te.fromBlank(S,P,V))},children:"Add Date"})]})]})}Te(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(Fe,{})}));function Fe(){const[Q,W]=l.useState("student"),[x,f]=l.useState([]),[S,O]=l.useState([]),[P,J]=l.useState(null),[V,E]=l.useState(!1),[D,k]=l.useState([]),[s,_]=l.useState(),[U,q]=l.useState("students"),[Y,c]=l.useState("date"),[g,u]=l.useState(null),[d,F]=l.useState(null),[j,A]=l.useState(null),[I,L]=l.useState(""),[R,M]=l.useState(""),[ne,B]=l.useState(""),[se,$]=l.useState(""),[m,T]=l.useState(void 0),[N,b]=l.useState([]),[v,G]=l.useState("students"),[ae,Ae]=l.useState(!1);l.useState(""),l.useState(""),l.useState(null),l.useState(null);const[oe,Ie]=l.useState(""),[X,z]=l.useState(!1),[ge,ve]=l.useState(null),[p,w]=l.useState(void 0),[C,pe]=l.useState(void 0),[Z,ie]=l.useState([]),[xe,fe]=l.useState(void 0),K=l.useRef(null);l.useEffect(()=>{Ee(()=>{});async function t(){E(!0);const a=new URLSearchParams(window.location.search).get("activityId");if(a){J(a);const r=await be(a);_(r),console.log(r),T(r.defaultLocation)}const i=await Ne(a);console.log(i),f(i);const h=[];for(const r of i){console.log(r);const H=r.date.from;console.log(r.date.date),H.setDate(r.date.date.getDate()),H.setMonth(r.date.date.getMonth()),H.setFullYear(r.date.date.getFullYear());const y=r.date.to;y.setDate(r.date.date.getDate()),y.setMonth(r.date.date.getMonth()),y.setFullYear(r.date.date.getFullYear()),console.log(H),console.log(y),h.push({title:r.name,start:H.toISOString(),end:y.toISOString(),isAllDay:!1,interactive:!0,description:r.info,color:r.eventType.color.setAlpha(.8).toRBGAString(),id:r.id,location:r.location.name})}O(h),console.log(i),console.log(h),E(!1)}t();const n=localStorage.getItem("accountType");n&&W(n)},[]);function le(){return x}const re=t=>{const n=t.target.value,[o,a]=n.split(":").map(Number),i=new Date(g);i.setHours(o,a,0,0),F(i),B(i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},ce=t=>{const n=t.target.value,[o,a]=n.split(":").map(Number),i=new Date(g);i.setHours(o,a,0,0),A(i),$(i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(t){return this.setTime(this.getTime()+t*60*60*1e3),this};function de(){return e.jsxs("div",{className:"custom-invite-view",children:[e.jsx("button",{className:U=="students"?"selected":"",onClick:()=>{q("students")},children:"Students"}),e.jsx("button",{className:U=="parents"?"selected":"",onClick:()=>{q("parents")},children:"Parents"}),e.jsx("div",{className:"current-view",children:U=="students"?e.jsx("div",{className:"students",children:s==null?void 0:s.students.map((t,n)=>e.jsxs("div",{className:"student",children:[e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",id:"student",checked:N.find(o=>o.userId==t.userId)!=null,onChange:o=>{o.target.checked?b([...N,t]):b(N.filter(a=>a!=t))}}),e.jsx("span",{className:"checkmark",children:" "})]}),e.jsx("label",{htmlFor:t.userId,children:t.name})]},t.userId))}):e.jsx("div",{className:"parents",children:s==null?void 0:s.parents.map((t,n)=>e.jsxs("div",{className:"parent",children:[e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",id:"parent",onChange:o=>{o.target.checked?b([...N,t]):b(N.filter(a=>a!=t))}}),e.jsx("span",{className:"checkmark",children:" "})]}),e.jsx("label",{htmlFor:t.userId,children:t.name})]},t.userId))})})]})}function Se(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mode",children:"Enter Event Information"}),e.jsx("label",{htmlFor:"Name",children:"Name: "}),e.jsx("input",{type:"text",value:I,onChange:t=>{L(t.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Description",children:"Description: "}),e.jsx("textarea",{value:R,onChange:t=>{M(t.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:g==null?void 0:g.toISOString().split("T")[0],onChange:t=>{const n=new Date(t.target.value);n.setHours(0,0,0,0),n.setDate(n.getDate()+1),u(n);const o=new Date(n);o.setHours(d.getHours(),d.getMinutes(),0,0),F(o),B(o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const a=new Date(n);a.setHours(j.getHours(),j.getMinutes(),0,0),A(a),$(a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:ne,onChange:re}),e.jsx("br",{}),e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:se,onChange:ce}),e.jsx("br",{}),e.jsx("label",{htmlFor:"location",children:"Location: "}),e.jsx("select",{name:"location",id:"location",onChange:t=>{T(s==null?void 0:s.locations.find(n=>n.name==t.target.value))},children:s==null?void 0:s.locations.map((t,n)=>e.jsx("option",{value:t.name,selected:(m==null?void 0:m.name)==t.name,children:t.name+" ("+t.address+")"},n))}),e.jsx("br",{}),e.jsx("label",{htmlFor:"eventType",children:"Event Type: "}),e.jsx("select",{name:"eventType",id:"event-type",onChange:t=>{w(s==null?void 0:s.eventTypes.find(n=>n.name==t.target.value))},children:s==null?void 0:s.eventTypes.map((t,n)=>e.jsx("option",{value:t.name,selected:(p==null?void 0:p.name)==t.name,children:t.name},n))}),e.jsx("br",{}),e.jsx("label",{htmlFor:"inviteType",children:"Invite Type: "}),e.jsxs("select",{name:"inviteType",id:"invite-type",onChange:t=>{G(t.target.value)},children:[e.jsx("option",{value:"students",selected:v=="students",children:"Students"}),e.jsx("option",{value:"parents",selected:v=="parents",children:"Parents"}),e.jsx("option",{value:"groups",selected:v=="groups",children:"Groups"}),e.jsx("option",{value:"custom",selected:v=="custom",children:"Custom"})]}),v=="groups"?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("label",{htmlFor:"groups",children:"Groups: "}),e.jsx("div",{className:"groups",children:s.groups.map((t,n)=>e.jsxs("div",{className:"group",children:[e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",id:"ensemble",checked:D.find(o=>o.groupName==t.groupName)!=null,onChange:o=>{o.target.checked?(k([...D,t]),b([...N,...t.groupMembers])):(k(D.filter(a=>a.groupName!=t.groupName)),b(N.filter(a=>!t.groupMembers.includes(a))))}}),e.jsx("span",{className:"checkmark",children:" "})]}),e.jsx("label",{htmlFor:t.groupName,children:t.groupName})]},t.groupName))})]}):e.jsx(e.Fragment,{}),v=="custom"?de():e.jsx(e.Fragment,{}),e.jsx("br",{}),V?e.jsx("div",{className:"loader"}):e.jsx("button",{onClick:async()=>{if(E(!0),console.log(`Name: ${I}, Description: ${R}, Start Time: ${d}, End Time: ${j}, Selected Location: ${m},Event Type: ${p}`),I==""||d==null||j==null||m==null||p==null){alert("Please fill out all fields"),console.log(`Name: ${I}, Description: ${R}, Start Time: ${d}, End Time: ${j}, Selected Location: ${m},  Event Type: ${p}`),E(!1);return}console.log("Submit");const t=m??s.locations[0];console.log(d),console.log(j);const n=te.fromBlank(g,d,j);console.log(n.toMap());const o=p;o.color.setAlpha(255);const a=ue.fromBlank(I,R,t,n,"activity-event",Date.now(),P,D.map(i=>i.groupName),N,v,o,D,ae,oe,[],s.name);if(X){a.id=ge.id,await we(a),z(!1);const i=a.date.from,h=a.date.to,r={title:a.name,start:i.toISOString(),end:h.toISOString(),isAllDay:!1,interactive:!0,description:a.info,color:a.eventType.color.setAlpha(.8).toRBGAString(),id:a.id,location:a.location.name},H=S.filter(ee=>ee.id!=a.id);H.push(r),O(H);const y=x.filter(ee=>ee.id!=a.id);y.push(a),console.log(y),f([...y])}else{await me(a);const i=a.date.from,h=a.date.to;i.setDate(a.date.date.getDate()),i.setMonth(a.date.date.getMonth()),i.setFullYear(a.date.date.getFullYear()),h.setDate(a.date.date.getDate()),h.setMonth(a.date.date.getMonth()),h.setFullYear(a.date.date.getFullYear());const r={title:a.name,start:i.toISOString(),end:h.toISOString(),isAllDay:!1,interactive:!0,description:a.info,color:a.eventType.color.setAlpha(.8).toRBGAString(),id:a.id,location:a.location.name};O([...S,r]),f([...x,a])}E(!1),c("date"),u(null),F(null),A(null),L(""),M(""),B(""),$(""),w(s==null?void 0:s.eventTypes[0]),T(s==null?void 0:s.defaultLocation),b([]),G("students")},className:"ActionBtn",children:X?"Save":"Submit"}),e.jsx("button",{onClick:()=>{if(X){c("date"),u(null),F(null),A(null),L(""),M(""),B(""),$(""),T(s.defaultLocation),w(s.eventTypes[0]),T(s==null?void 0:s.defaultLocation),z(!1);return}c("date"),M(""),L(""),G("students")},className:"ActionBtn",children:"Back"})]})}function je(){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mode",children:"Enter Event Information"}),e.jsx("label",{htmlFor:"Name",children:"Name: "}),e.jsx("input",{type:"text",value:I,onChange:t=>{L(t.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Description",children:"Description: "}),e.jsx("textarea",{value:R,onChange:t=>{M(t.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:ne,onChange:re}),e.jsx("br",{}),e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:se,onChange:ce}),e.jsx("br",{}),e.jsx("label",{htmlFor:"location",children:"Location: "}),e.jsx("select",{name:"location",id:"location",onChange:t=>{T(s==null?void 0:s.locations.find(n=>n.name==t.target.value))},children:s==null?void 0:s.locations.map((t,n)=>e.jsx("option",{value:t.name,selected:(m==null?void 0:m.name)==t.name,children:t.name+" ("+t.address+")"},n))}),e.jsx("br",{}),e.jsx("label",{htmlFor:"eventType",children:"Event Type: "}),e.jsx("select",{name:"eventType",id:"event-type",onChange:t=>{w(s==null?void 0:s.eventTypes.find(n=>n.name==t.target.value))},children:s==null?void 0:s.eventTypes.map((t,n)=>e.jsx("option",{value:t.name,selected:(p==null?void 0:p.name)==t.name,children:t.name},n))}),e.jsx("br",{}),e.jsx("label",{htmlFor:"inviteType",children:"Invite Type: "}),e.jsxs("select",{name:"inviteType",id:"invite-type",onChange:t=>{G(t.target.value)},children:[e.jsx("option",{value:"students",selected:v=="students",children:"Students"}),e.jsx("option",{value:"parents",selected:v=="parents",children:"Parents"}),e.jsx("option",{value:"groups",selected:v=="groups",children:"Groups"}),e.jsx("option",{value:"custom",selected:v=="custom",children:"Custom"})]}),v=="groups"?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("label",{htmlFor:"groups",children:"Groups: "}),e.jsx("div",{className:"groups",children:s.groups.map((t,n)=>e.jsxs("div",{className:"group",children:[e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",id:"ensemble",checked:D.find(o=>o.groupName==t.groupName)!=null,onChange:o=>{o.target.checked?(k([...D,t]),b([...N,...t.groupMembers])):(k(D.filter(a=>a.groupName!=t.groupName)),b(N.filter(a=>!t.groupMembers.includes(a))))}}),e.jsx("span",{className:"checkmark",children:" "})]}),e.jsx("label",{htmlFor:t.groupName,children:t.groupName})]},t.groupName))})]}):e.jsx(e.Fragment,{}),v=="custom"?de():e.jsx(e.Fragment,{}),e.jsx("br",{}),e.jsx("h2",{children:"Event Dates"}),e.jsx("div",{className:"event-dates",children:Z.map((t,n)=>e.jsxs("div",{className:"event-date",children:[e.jsxs("div",{className:"event-date-title",children:[e.jsx("label",{htmlFor:"",className:"event-date-name",children:t.date.toDateString()}),e.jsx("label",{htmlFor:"",className:"event-date-time",children:t.from.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0})+" - "+t.to.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0})})]}),e.jsx("img",{src:ye,className:"event-date-icon",onClick:()=>{ie(Z.filter(o=>o!=t))}})]},n))}),e.jsx("button",{className:"ActionBtn",onClick:()=>{var o;if(d==null||j==null){alert("Please fill out start time and end time");return}const t=new Date;t.setHours(0,0,0,0);const n=te.fromBlank(t,d,j);fe(n),(o=K.current)==null||o.showModal()},children:"Add Date"}),e.jsx("br",{}),V?e.jsx("div",{className:"loader"}):e.jsx("button",{onClick:async()=>{if(E(!0),console.log(`Name: ${I}, Description: ${R}, Start Time: ${d}, End Time: ${j}, Selected Location: ${m},Event Type: ${p}`),I==""||d==null||j==null||m==null||p==null||Z.length==0){alert("Please fill out all fields"),console.log(`Name: ${I}, Description: ${R}, Start Time: ${d}, End Time: ${j}, Selected Location: ${m},  Event Type: ${p}`),E(!1);return}console.log("Submit");const t=m??s.locations[0];console.log(d),console.log(j);const n=[];for(const o of Z){const a=p;a.color.setAlpha(255);const i=ue.fromBlank(I,R,t,o,"activity-event",Date.now(),P,D.map(y=>y.groupName),N,v,a,D,ae,oe,[],s.name);await me(i);const h=i.date.from,r=i.date.to;h.setDate(i.date.date.getDate()),h.setMonth(i.date.date.getMonth()),h.setFullYear(i.date.date.getFullYear()),r.setDate(i.date.date.getDate()),r.setMonth(i.date.date.getMonth()),r.setFullYear(i.date.date.getFullYear());const H={title:i.name,start:h.toISOString(),end:r.toISOString(),isAllDay:!1,interactive:!0,description:i.info,color:i.eventType.color.setAlpha(.8).toRBGAString(),id:i.id,location:i.location.name};n.push(H),f([...x,i])}O([...S,...n]),E(!1),c("date"),u(null),F(null),A(null),L(""),M(""),B(""),$(""),w(s==null?void 0:s.eventTypes[0]),T(s==null?void 0:s.defaultLocation),b([]),G("students")},className:"ActionBtn",children:X?"Save":"Submit"}),e.jsx("button",{onClick:()=>{if(X){c("date"),u(null),F(null),A(null),L(""),M(""),B(""),$(""),T(s.defaultLocation),w(s.eventTypes[0]),T(s==null?void 0:s.defaultLocation),z(!1);return}c("date"),M(""),L(""),G("students")},className:"ActionBtn",children:"Back"})]})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("img",{src:Ce,alt:"back arrow",onClick:()=>{window.location.href="/Activity/?activityId="+P}}),e.jsx("h1",{children:"Events"})]}),V?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("div",{className:"center",children:Q=="teacher"?Y=="multipleEvents"?je():Y=="date"?e.jsxs(e.Fragment,{children:[" ",e.jsx(he,{canPaste:C!=null,canCopy:!0,copyEvent:t=>{const n=x.find(o=>o.id==t.id);for(const o of x)console.log(o.id);pe(n),console.log(n),console.log(t.id)},pasteEvent:t=>{console.log("PASTE EVENT"),console.log(t);const n=new Date(t);n.setHours(0,0,0,0),u(n),F(new Date(C.date.from)),B(C.date.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const o=new Date(C.date.to);A(o),console.log(o),$(o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),T(C.location),w(C.eventType),L(C.name),M(C.info),b(C.targets),G(C.generalTarget),k(C.groupTargets),c("info")},canViewConflicts:!1,isCreating:!0,canOpenContextMenu:!0,events:S,editEvent:t=>{const n=le().find(o=>o.id==t.id);console.log(t.id),n&&(console.log(n),c("info"),L(n.name),M(n.info),u(n.date.date),F(n.date.from),B(n.date.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),A(n.date.to),$(n.date.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),T(n.location),b(n.targets),console.log("FROM EDIT"),console.log(n.targets),w(n.eventType),z(!0),G(n.generalTarget),ve(n),k(n.groupTargets))},viewEvent:t=>{const n=le().find(o=>o.id==t.id);n&&(localStorage.setItem("event",JSON.stringify(n.toMap())),localStorage.setItem("back","/Activity/Events/?activityId="+P),window.location.href="/Calendar/Event/")},viewConflicts:t=>{},deleteEvent:async t=>{console.log(t);const n=x.find(i=>i.id==t.id),o=x.filter(i=>i.id!=t.id);f(o);const a=S.filter(i=>i.id!=t.id);O(a),await De(n)},dateClick:t=>{console.log(t.date),u(t.date),new Date(t.date).setHours(0,0,0,0),F(new Date(t.date)),B(t.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const o=new Date(t.date);A(o.addHours(1)),console.log(o),$(t.date.addHours(1).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),T(s.defaultLocation),w(s.eventTypes[0]),c("info")},eventClick:t=>{u(t.event.start),new Date(t.event.start).setHours(0,0,0,0),F(new Date(t.event.start)),B(t.event.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const o=new Date(t.event.end);A(o),$(o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),T(s.defaultLocation),w(s.eventTypes[0]),c("info")}}),e.jsx("button",{className:"ActionBtn",onClick:()=>{c("multipleEvents"),w(s.eventTypes[0])},children:"Add Multiple Events"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{localStorage.setItem("events",JSON.stringify(x.map(t=>t.toMap()))),window.open("/Activity/Events/Print/","_blank")},children:"Print"})]}):Se():e.jsxs(e.Fragment,{children:[" ",e.jsx(he,{canPaste:!1,canCopy:!1,copyEvent:()=>{},pasteEvent:()=>{},viewEvent:t=>{},canViewConflicts:!1,events:S,canOpenContextMenu:!1,dateClick:()=>{},deleteEvent:()=>{},viewConflicts:()=>{},editEvent:()=>{},eventIdClick:t=>{const n=x.find(o=>o.id===t);n&&(localStorage.setItem("event",JSON.stringify(n.toMap())),localStorage.removeItem("back"),window.location.href="/Calendar/Event/")}})," ",e.jsx("button",{className:"ActionBtn",onClick:()=>{localStorage.setItem("events",JSON.stringify(x.map(t=>t.toMap()))),window.open("/Activity/Events/Print/","_blank")},children:"Print"})]})}),e.jsx(ke,{dialogRef:K,addDate:t=>{ie([...Z,t]),K.current.close()},close:()=>{K.current.close()},eventDate:xe})]})}
