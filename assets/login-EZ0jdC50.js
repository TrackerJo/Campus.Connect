import{c as G,j as e,r as a,a as H,b as T}from"./index-DsZHpGFm.js";import{c as R,g as M}from"./db-DUjF3t9k.js";import{T as _,L as W,G as q,S as J}from"./constants-D66I3kr4.js";G(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(K,{})}));function K(){const[l,f]=a.useState(""),[i,S]=a.useState(""),[j,s]=a.useState(!1),[m,B]=a.useState([]),[z,C]=a.useState(""),[v,w]=a.useState("accountType"),[P,I]=a.useState("student"),[N,Z]=a.useState("LoginInfo"),[u,A]=a.useState(""),[o,n]=a.useState(""),[b,U]=a.useState(""),[d,L]=a.useState(""),[g,$]=a.useState("");return a.useState(""),a.useState(""),a.useState(""),a.useState(""),a.useState(!1),a.useEffect(()=>{async function t(){const r=await M();B(r),C(r[0].schoolId)}t()},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"center",children:e.jsx("div",{className:"Login",children:v=="accountType"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Account Type"}),e.jsx("button",{className:"actionBtn",onClick:()=>{I("student"),w("login")},children:"Student"}),e.jsx("button",{className:"actionBtn",onClick:()=>{I("teacher"),w("login")},children:"Teacher"})]}):v=="login"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Login"}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{f(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{S(t.target.value)}}),e.jsx("select",{onChange:t=>{C(t.target.value)},children:m.map(t=>e.jsx("option",{value:t.schoolId,children:t.schoolName}))}),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),!await H(l,i,z)){s(!1),alert("Wrong email or password");return}localStorage.setItem("accountType",P),s(!1);const c=new URLSearchParams(window.location.search).get("redirect");c?window.location.href=c.replace(/~/g,"&"):window.location.href="/"},children:"Login"}),e.jsx("button",{className:"actionBtn",onClick:()=>{w("createAccount")},children:"Create an Account"})]}):P=="teacher"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{f(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{n(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{S(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"School Code",onChange:t=>{L(t.target.value)}}),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{className:"actionBtn",onClick:async()=>{if(s(!0),u==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}n(o.replace(/-/g,"")),n(o.replace(/ /g,"")),n(o.replace(/\(/g,"")),n(o.replace(/\)/g,""));const r=/^\d{10}$/;if(o!="none"&&!r.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(i==""){alert("Please enter a password");return}if(i.length<6){alert("Password must be at least 6 characters");return}if(d==""){alert("Please enter your school code");return}const c=m.find(k=>k.schoolTeacherCode==d);if(!c){alert("Invalid School Code");return}localStorage.setItem("schoolId",c.schoolId);const p=_.fromBlank("",c.schoolId,o.replace("none",""),"","teacher",u.toLowerCase().trim(),u.trim(),l.trim()),h=await T(l,i);if(!h){alert("Error creating account");return}p.uid=h,await R("teacher",p),localStorage.setItem("accountType","teacher");const x=new URLSearchParams(window.location.search).get("redirect");x?window.location.href=x.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Create Account"})]}):N=="LoginInfo"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),D(),e.jsx("button",{onClick:()=>{if(u==""){alert("Please enter your full name");return}if(l==""){alert("Please enter your email");return}if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(l)){alert("Invalid email");return}if(o==""){alert("Please enter your phone number, if you don't have one, type none");return}n(o.replace(/-/g,"")),n(o.replace(/ /g,"")),n(o.replace(/\(/g,"")),n(o.replace(/\)/g,""));const r=/^\d{10}$/;if(o!="none"&&!r.test(o)){alert("Invalid phone number (Only include numbers or type none)");return}if(i==""){alert("Please enter a password");return}if(i.length<6){alert("Password must be at least 6 characters");return}if(b==""){alert("Please select your sex");return}Z("SchoolCode")},children:"Next"})]}):N=="HomeAddress"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Create Account"}),O(),j?e.jsx("div",{className:"center",children:e.jsx("div",{className:"loader"})}):e.jsx("button",{onClick:async()=>{s(!0);let t;if(d!=""?t=m.find(y=>y.schoolCode==d):t=m.find(y=>y.schoolDomain==g.split("@")[1]),t==null){d!=""&&g!=""?alert("Invalid School Code or a School Email"):g!=""?alert("Invalid School Email"):alert("Invalid School Code"),s(!1);return}let r={lat:0,lon:0},c="",p=0;localStorage.setItem("schoolId",t.schoolId),console.log(localStorage.getItem("schoolId")),console.log("Creating account");const h=await T(l,i);if(console.log(h),!h){alert("Error creating account");return}const E=W.fromBlank("home",c,new q(r.lat,r.lon)),x=J.fromBlank(h,t.schoolId,"unknown",p,"","student",o.replace("none",""),b,"unknown",u.toLowerCase().trim(),u.trim(),l.trim(),{},E);await R("student",x),localStorage.setItem("accountType","student");const F=new URLSearchParams(window.location.search).get("redirect");F?window.location.href=F.replace(/~/g,"&"):window.location.href="/",s(!1)},children:"Create Account"})]})})})});function D(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Full Name",onChange:t=>{A(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Email",onChange:t=>{f(t.target.value)}}),e.jsx("input",{type:"password",placeholder:"Password",onChange:t=>{S(t.target.value)}}),e.jsx("input",{type:"text",placeholder:"Phone Number",onChange:t=>{n(t.target.value)}}),e.jsxs("select",{onChange:t=>{U(t.target.value)},children:[e.jsx("option",{value:"",selected:!0,children:"Select your Sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})}function O(){return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"School Code",value:d,onChange:t=>{L(t.target.value)}}),e.jsx("p",{children:"Or"}),e.jsx("input",{type:"text",placeholder:"School Email",value:g,onChange:t=>{$(t.target.value)}})]})}}
