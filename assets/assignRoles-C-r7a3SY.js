import{j as c,c as B,r as f}from"./index-CKNi8vpN.js";import{o as F,k as A,p as L,C as d,h as I,l as P,s as U}from"./db-DROJG-1T.js";import{C as q,S as z,A as H}from"./Show_Group_Tile-SoX8-Gd3.js";import{T as K}from"./trash-BnpXJPEK.js";function Q({actor:w,canDelete:j,onDelete:p}){return c.jsx("div",{className:"ActorTile",id:"actor-tile-"+w.userId,children:c.jsxs("div",{className:"header",children:[c.jsx("div",{className:"ActorNameDiv",children:c.jsxs("label",{htmlFor:"Actor",children:["Actor: ",w.name]})}),j&&c.jsx("div",{className:"ActorTrashDiv",children:c.jsx("img",{src:K,alt:"",className:"TrashIcon",onClick:()=>{p()}})})]})})}B(document.getElementById("root")).render(c.jsx(f.StrictMode,{children:c.jsx(V,{})}));function V(){const[w,j]=f.useState(""),[p,R]=f.useState(""),[n,y]=f.useState(),[m,x]=f.useState([]),[u,v]=f.useState([]),[M,N]=f.useState(!1),[G,k]=f.useState([]),[S,b]=f.useState([]),[D,E]=f.useState(!1),C=f.useRef(null);async function J(){let l=!0;if(N(!0),!n){N(!1);return}for(let s=0;s<n.characters.length;s++){const t=n.characters[s],e=m.find(a=>a.name==t.name);e&&(console.log("New Character"),console.log(e),n.characters[s]=e,e.actor==null&&(console.log("Actor is null"),l=!1))}for(let s=0;s<n.showGroups.length;s++){const t=n.showGroups[s];if(u.find(a=>a.name==t.name))for(let a=0;a<t.characters.length;a++){const r=t.characters[a];if(r instanceof d){const o=m.find(i=>i.name==r.name);o&&(t.characters[a]=o,o.actor==null&&(l=!1))}}}for(let s=0;s<n.layout.length;s++){const t=n.layout[s];for(let e=0;e<t.scenes.length;e++){const a=t.scenes[e];for(let r=0;r<a.characters.length;r++){const o=a.characters[r];if(o instanceof d){const i=m.find(h=>h.name==o.name);i&&(a.characters[r]=i)}else if(o instanceof I){const i=u.find(h=>h.name==o.name);if(i){for(let h=0;h<i.characters.length;h++){const g=i.characters[h];if(g instanceof d){const T=m.find(O=>O.name==g.name);T&&(i.characters[h]=T)}}a.characters[r]=i}}}}}for(let s=0;s<n.songs.length;s++){const t=n.songs[s];console.log("Assigning roles to song"),console.log(t);for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(console.log("Character"),console.log(a),console.log(typeof a),a instanceof d){const r=m.find(o=>o.name==a.name);r&&(t.characters[e]=r)}else if(a instanceof I){const r=u.find(o=>o.name==a.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof d){const h=m.find(g=>g.name==i.name);h&&(r.characters[o]=h)}}t.characters[e]=r}}console.log("New Character"),console.log(t.characters[e]),console.log(typeof t.characters[e])}}for(let s=0;s<n.dances.length;s++){const t=n.dances[s];for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(a instanceof d){const r=m.find(o=>o.name==a.name);r&&(t.characters[e]=r)}else if(a instanceof I){const r=u.find(o=>o.name==a.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof d){const h=m.find(g=>g.name==i.name);h&&(r.characters[o]=h)}}t.characters[e]=r}}}}n.canCreateSchedule=l,n.ensemble=P.fromBlank(S,Date.now()),y(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+p,JSON.stringify(n)),await U(w,p,n),N(!1)}return f.useEffect(()=>{E(!0);const l=new URLSearchParams(window.location.search),s=l.get("activityId");s&&(j(s),F(s).then(a=>{k(a),console.log(a),E(!1)}));const t=l.get("showId");t&&R(t);const e=localStorage.getItem("show-"+t);e&&(console.log(JSON.parse(e)),y(A.fromMap(JSON.parse(e))),console.log(A.fromMap(JSON.parse(e))),x(A.fromMap(JSON.parse(e)).characters),v(A.fromMap(JSON.parse(e)).showGroups))},[]),c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"title",children:c.jsx("h1",{children:"Assign Roles"})}),c.jsxs("div",{className:"center",children:[c.jsx("h2",{children:"Assign Characters"}),c.jsx("div",{className:"characters",id:"create-characters",children:m.map((l,s)=>c.jsx(q,{character:l,actors:G,characters:[],isAssign:!0,setCharacter:t=>{x(e=>{const a=[...e];return a[s]=t,a})},removeCharacter:()=>{x(m.filter((t,e)=>e!==s))},isCreate:!1},s))}),c.jsx("h2",{children:"Assign Show Groups"}),c.jsx("div",{className:"showGroups",id:"create-showGroups",children:u.map((l,s)=>c.jsx(z,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:m,actors:G,isAssign:!0,setShowGroup:t=>{v(e=>{const a=[...e];return a[s]=t,a})},removeShowGroup:()=>{v(u.filter((t,e)=>e!==s))},isCreate:!1},s))}),(n==null?void 0:n.hasEnsemble)&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Ensemble"}),c.jsx("div",{className:"ensemble",id:"create-ensemble",children:S.map((l,s)=>(console.log(l),c.jsx(Q,{actor:l,canDelete:!0,onDelete:()=>{b(S.filter((t,e)=>e!==s))}},s)))}),c.jsx("button",{className:"AddActorBtn",onClick:()=>{var l;(l=C.current)==null||l.showModal()},children:"Add Actor"})]}),M?c.jsx("div",{className:"loader"}):c.jsx("button",{className:"CreateShowTemplateBtn",onClick:async()=>{await J(),window.location.href="/Campus.Connect/Activity/Shows/Show/?activityId="+w+"&showId="+p},children:"Save"})]}),(n==null?void 0:n.hasEnsemble)&&!D&&c.jsx(H,{dialogRef:C,keepPastResult:!1,actor:new L,addedActors:S,actors:G,setActor:l=>{var t;const s=[...S];s.push(l),console.log("Setting actors"),b(s),(t=C.current)==null||t.close()},close:()=>{var l;(l=C.current)==null||l.close()}})]})}
