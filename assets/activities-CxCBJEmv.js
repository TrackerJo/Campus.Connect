import{r as t,j as e,c as p,i as N}from"./index-DHlFav2G.js";import{u as b,a as w,j as A,b as S,d as C}from"./db-SqBjFcA9.js";import"./constants-hVZ3UUQ_.js";function I({dialogRef:u,close:h,activityJoinCode:s}){const[c,a]=t.useState(""),[o,m]=t.useState(!1),[r,n]=t.useState(!1),[v,l]=t.useState(""),[g,x]=t.useState("male"),[d,j]=t.useState("");async function f(i){console.log("Joining activity"),localStorage.setItem("needsPhoneNumber","false"),localStorage.setItem("needsGender","false"),localStorage.setItem("alreadyJoined","false");const y=await A(i);if(localStorage.getItem("alreadyJoined")=="true"){alert("You have already joined this activity");return}if(m(localStorage.getItem("needsPhoneNumber")=="true"),n(localStorage.getItem("needsGender")=="true"),!(localStorage.getItem("needsPhoneNumber")=="true"||localStorage.getItem("needsGender")=="true")){if(!y){alert("Invalid activity code");return}if(d){window.location.href=d.replace(/~/g,"&");return}window.location.href=`/Activity/?activityId=${y.id}`}}return t.useEffect(()=>{s!=""&&(a(s),f(s));const y=new URLSearchParams(window.location.search).get("redirect");y&&j(y)},[s]),e.jsx("dialog",{ref:u,className:"JoinActivityDialog",children:e.jsxs("div",{className:"dialogContents",children:[!r&&!o?e.jsxs(e.Fragment,{children:[" ",e.jsx("h2",{children:"Join Activity"}),e.jsx("label",{htmlFor:"",children:"Activity Code"}),e.jsx("input",{type:"text",value:c,onChange:i=>{a(i.target.value)}}),e.jsx("button",{className:"ActionBtn",onClick:async()=>{await f(c)},children:"Join"})," "]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Activity requires some more information"}),o?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"text",value:v,onChange:i=>{l(i.target.value)}}),e.jsx("label",{htmlFor:"",children:"If you don't have a phone number type none"}),e.jsx("br",{})]}):e.jsx(e.Fragment,{}),r?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"",children:"Gender"}),e.jsxs("select",{name:"",id:"",value:g,onChange:i=>{x(i.target.value)},children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{className:"ActionBtn",onClick:async()=>{console.log("Joining activity"),o&&(await b(v.replace("none","")),localStorage.setItem("needsPhoneNumber","false")),r&&(await w(g),localStorage.setItem("needsGender","false")),localStorage.setItem("alreadyJoined","false");const i=await A(c);if(localStorage.getItem("alreadyJoined")=="true"){alert("You have already joined this activity");return}if(!i){alert("Invalid activity code");return}if(d){window.location.href=d.replace(/~/g,"&");return}window.location.href=`/Activity/?activityId=${i.id}`},children:"Join"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{h()},children:"Close"})]})})}function F({dialogRef:u,close:h}){const[s,c]=t.useState(""),[a,o]=t.useState("activity"),[m,r]=t.useState(!1);return e.jsx("dialog",{ref:u,className:"CreateActivityDialog",children:e.jsxs("div",{className:"dialogContents",children:[e.jsx("h2",{children:"Join Activity"}),e.jsx("label",{htmlFor:"",children:"Activity Name"}),e.jsx("input",{type:"text",value:s,onChange:n=>{c(n.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"",children:"Activity Type"}),e.jsxs("select",{value:a,onChange:n=>{o(n.target.value)},children:[e.jsx("option",{value:"activity",children:"Basic"}),e.jsx("option",{value:"theater",children:"Theater"})]}),m?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{r(!0);const n=await S(s,a);if(n===null){alert("Failed to create activity");return}window.location.href=`/Campus.Connect/Activity/?activityId=${n.id}`},children:"Create"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{h()},children:"Close"})]})})}p(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(J,{})}));function J(){const[u,h]=t.useState([]),[s,c]=t.useState("student"),a=t.useRef(null),o=t.useRef(null),[m,r]=t.useState(""),[n,v]=t.useState(!0);return t.useEffect(()=>{v(!0),N(()=>{});async function l(){const j=await C();h(j),console.log(j),v(!1)}l();const g=localStorage.getItem("accountType");g&&c(g);const d=new URLSearchParams(window.location.search).get("activityJoinCode");d&&(r(d),a.current.showModal())},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Activities"})}),e.jsxs("div",{className:"center",children:[e.jsx("div",{className:"activities",children:n?e.jsx("div",{className:"loader-center",children:e.jsx("div",{className:"loader"})}):u.map(l=>e.jsx("div",{className:"activity",onClick:()=>{window.location.href=`/Activity/?activityId=${l.id}`},children:e.jsx("h1",{children:l.name})},l.id))}),e.jsx("br",{}),s=="teacher"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{o.current.showModal()},children:"Create Activity"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{a.current.showModal()},children:"Join Activity"}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/"},children:"Back"})]}),e.jsx(I,{dialogRef:a,activityJoinCode:m,close:()=>{a.current.close()}}),e.jsx(F,{dialogRef:o,close:()=>{o.current.close()}})]})}
