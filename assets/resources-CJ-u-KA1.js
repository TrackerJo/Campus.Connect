import{r as o,j as e,R as S,H as w,c as k,i as A,g as f}from"./index-CxI3RmU5.js";import{Q as B,R as C,S as F,T as b}from"./db-B9hTVkYM.js";import{R as T}from"./Resource_Tile-oHkqjKX4.js";function L({addResource:r,dialogRef:g,close:a,activityId:j}){const[t,i]=o.useState("unset"),[d,h]=o.useState(""),[l,p]=o.useState(""),[s,c]=o.useState(!1),[m,u]=o.useState(""),x=o.useRef(null);return e.jsx("dialog",{ref:g,children:e.jsxs("div",{className:"AddResourceDiv",children:[e.jsx("h2",{children:"Add Resource"}),t=="unset"?e.jsxs("div",{className:"ResourceTypeSelect",children:[e.jsx("h3",{children:"Resource Type"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{i("link")},children:"Link"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{i("image")},children:"Image"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{i("video")},children:"Video"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Resource Name"}),e.jsx("input",{type:"text",className:"ResourceNameInput",value:d,onChange:n=>{h(n.target.value)}}),e.jsx("h3",{children:"Resource Description"}),e.jsx("input",{type:"text",className:"ResourceDescriptionInput",value:l,onChange:n=>{p(n.target.value)}}),t=="link"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Link"}),e.jsx("input",{type:"text",className:"ResourceLinkInput",value:m,onChange:n=>{u(n.target.value)}})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Resource File"}),e.jsx("input",{type:"file",className:"ResourceFileInput",ref:x})]}),e.jsx("br",{}),s?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(c(!0),t=="link"){const n=S.fromBlank(d,l,t,m);await r(n)}else{const n=x.current.files[0];if(n==null)return;const R=n.name.split(".")[0]+Date.now()+"."+n.name.split(".")[1],I=localStorage.getItem("schoolId"),N=await B(I,j,R,n),y=w.fromBlank(R,N),v=S.fromBlank(d,l,t,"",y);await r(v)}i("unset"),h(""),p(""),u(""),c(!1)},children:"Add Resource"})]}),e.jsx("br",{}),e.jsx("button",{className:"ActionBtn",onClick:()=>{i("unset"),h(""),p(""),u(""),a()},children:"Close"})]})})}k(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(D,{})}));function D(){const[r,g]=o.useState(""),[a,j]=o.useState(""),[t,i]=o.useState(),[d,h]=o.useState("student"),l=o.useRef(null);o.useEffect(()=>{A(()=>{});const s=new URLSearchParams(window.location.search),c=s.get("activityId");c&&g(c);const m=s.get("showId");m&&j(m);const u=localStorage.getItem("show-"+m);u&&(i(f.fromMap(JSON.parse(u))),console.log(f.fromMap(JSON.parse(u))));const x=localStorage.getItem("accountType");x&&h(x)},[]);const p=s=>async()=>{if(s.type!="link"){const c=localStorage.getItem("schoolId");await F(c,r,s.file.name)}t==null||t.resources.splice(t.resources.indexOf(s),1),localStorage.setItem("show-"+a,JSON.stringify(t)),i(f.fromMap(JSON.parse(localStorage.getItem("show-"+a)))),await b(r,a,s)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Resources"})}),e.jsxs("div",{className:"center",children:[e.jsx("div",{className:"resources",children:t==null?void 0:t.resources.map((s,c)=>e.jsx(T,{resource:s,canRemove:d==="teacher",removeResource:p(s)},c))}),d==="teacher"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var s;(s=l.current)==null||s.showModal()},children:"Add Resource"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href=`/Activity/Shows/Show/?activityId=${r}&showId=${a}`},children:"Back"})]}),e.jsx(L,{dialogRef:l,activityId:r,close:()=>{var s;(s=l.current)==null||s.close()},addResource:async s=>{var c;await C(r,a,s),t==null||t.resources.push(s),localStorage.setItem("show-"+a,JSON.stringify(t)),i(f.fromMap(JSON.parse(localStorage.getItem("show-"+a)))),(c=l.current)==null||c.close()}})]})}
