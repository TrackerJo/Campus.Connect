import{x as lt,y as i,z as c,B as S,s as O,g as N,H as k,I as p,d as q,f as X,J as y,K as D,N as M,l as G,O as _,p as B,T as ut,P as $,S as ot,Q as J,U as dt,V as ht,k as C,v as ft,t as E,W as z,X as Q,M as H,Y as gt,Z as P,r as R,q as mt,L as pt}from"./constants-B9kCK6KS.js";import{h as It,C as yt,k as W,_ as vt,d as Y,e as wt,f as St,F as Dt,n as st,p as Tt,g as b}from"./index-BrfWEQze.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mt="type.googleapis.com/google.protobuf.Int64Value",At="type.googleapis.com/google.protobuf.UInt64Value";function nt(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function j(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>j(e));if(typeof t=="function"||typeof t=="object")return nt(t,e=>j(e));throw new Error("Data cannot be encoded in JSON: "+t)}function x(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Mt:case At:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>x(e)):typeof t=="function"||typeof t=="object"?nt(t,e=>x(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends Dt{constructor(e,o,s){super(`${K}/${e}`,o||""),this.details=s}}function Ct(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function kt(t,e){let o=Ct(t),s=o,n;try{const a=e&&e.error;if(a){const r=a.status;if(typeof r=="string"){if(!Z[r])return new U("internal","internal");o=Z[r],s=r}const l=a.message;typeof l=="string"&&(s=l),n=a.details,n!==void 0&&(n=x(n))}}catch{}return o==="ok"?null:new U(o,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||o.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V="us-central1";function Ut(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new U("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class Nt{constructor(e,o,s,n,a=V,r){this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Et(o,s,n),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=V}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function bt(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function Ft(t,e,o){return s=>Pt(t,e,s,{})}async function Rt(t,e,o,s){o["Content-Type"]="application/json";let n;try{n=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let a=null;try{a=await n.json()}catch{}return{status:n.status,json:a}}function Pt(t,e,o,s){const n=t._url(e);return Ot(t,n,o,s)}async function Ot(t,e,o,s){o=j(o);const n={data:o},a={},r=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);r.authToken&&(a.Authorization="Bearer "+r.authToken),r.messagingToken&&(a["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(a["X-Firebase-AppCheck"]=r.appCheckToken);const l=s.timeout||7e4,d=Ut(l),u=await Promise.race([Rt(e,n,a,t.fetchImpl),d.promise,t.cancelAllRequests]);if(d.cancel(),!u)throw new U("cancelled","Firebase Functions instance was deleted.");const g=kt(u.status,u.json);if(g)throw g;if(!u.json)throw new U("internal","Response is not valid JSON object.");let m=u.json.data;if(typeof m>"u"&&(m=u.json.result),typeof m>"u")throw new U("internal","Response is missing data field.");return{data:x(m)}}const tt="@firebase/functions",et="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt="auth-internal",_t="app-check-internal",Lt="messaging-internal";function Gt(t,e){const o=(s,{instanceIdentifier:n})=>{const a=s.getProvider("app").getImmediate(),r=s.getProvider(xt),l=s.getProvider(Lt),d=s.getProvider(_t);return new Nt(a,r,l,d,n,t)};It(new yt(K,o,"PUBLIC").setMultipleInstances(!0)),W(tt,et,e),W(tt,et,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(t=St(),e=V){const s=vt(Y(t),K).getImmediate({identifier:e}),n=wt("functions");return n&&$t(s,...n),s}function $t(t,e,o){bt(Y(t),e,o)}function at(t,e,o){return Ft(Y(t),e)}Gt(fetch.bind(self));const ct=Bt(st),h=lt(st),Jt=i(h,"schools"),qt=async()=>{const t=await y(Jt),e=[];return t.forEach(o=>{e.push(o.data())}),e},Xt=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=c(h,"schools",e);if(t=="student"){const s=D(i(o,"activities"),M("studentUids","array-contains",b())),n=[];return(await y(s)).forEach(r=>{n.push(N.fromMap(r.data()))}),n}else{const s=D(i(o,"activities"),M("teacherUids","array-contains",b())),n=[];return(await y(s)).forEach(r=>{console.log(r.data()),n.push(N.fromMap(r.data()))}),n}};async function Yt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(h,"schools",e),s=c(i(o,"activities"),t),n=await S(s);return n.exists()?n.data().type=="theater"?O.fromMap(n.data()):N.fromMap(n.data()):null}async function Kt(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"shows"),a=await k(n,t.toMap());return t.id=a.id,await p(a,{id:a.id}),a.id}async function zt(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"shows"),t.id);await p(n,t.toMap())}async function Qt(t){await Tt("cmurphy@gmail.com","123456");const e=i(h,"showTemplates"),o=await k(e,t.toMap());t.id=o.id,await p(o,{id:o.id})}async function Wt(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(h,"schools",o),n=c(i(s,"activities"),t),a=c(i(n,"shows"),e),r=await S(a);return r.exists()?(console.log(r.data()),q.fromMap(r.data())):null}async function Zt(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=c(h,"schools",e),s=c(i(o,"activities"),t),n=await S(s);if(!n.exists())return[];const a=[];return n.data().students.forEach(r=>{a.push(X.fromMap(r))}),a}async function te(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);await _(r,o.toMap())}async function ee(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"events"),a=await k(n,t.toMap());t.id=a.id,await p(a,{id:a.id})}async function oe(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(h,"schools",o),a=c(i(n,"activities"),t),r=i(a,"events");if(s=="student"){const l=await y(D(r,M("showId","==",e),M("targetUids","array-contains",b()))),d=[];return l.forEach(u=>{u.data().deleted||d.push(G.fromMap(u.data()))}),d}else{const l=await y(D(r,M("showId","==",e))),d=[];return l.forEach(u=>{u.data().deleted||d.push(G.fromMap(u.data()))}),d}}async function se(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"events"),t.id);await p(n,{deleted:!0}),await at(ct,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function ne(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=c(h,"schools",e),s=c(i(o,"activities"),t),n=i(s,"shows"),a=await y(n),r=[];return a.forEach(l=>{r.push(q.fromMap(l.data()))}),r}async function ae(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);await p(r,{conflictForm:o.toMap()}),await at(ct,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function ce(){const t=await b(),e=localStorage.getItem("schoolId");if(!e)return null;const o=c(h,"schools",e),s=i(o,"students"),n=c(s,t),a=await S(n);return a.exists()?X.fromMap(a.data()):null}async function ie(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=c(r,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await _(l,o.toMap())}async function re(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(localStorage.getItem("userId"),!o)return[];const n=c(h,"schools",o),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(b());const g=await y(D(l,M("submitterId","==",b()))),m=[];return g.forEach(I=>{m.push(B.fromMap(I.data()))}),m}const d=await y(l),u=[];return d.forEach(g=>{u.push(B.fromMap(g.data()))}),u}async function le(){const t=i(h,"showTemplates"),e=await y(t),o=[];return e.forEach(s=>{o.push(q.fromMap(s.data()))}),o}async function ue(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const n=c(h,"schools",e),a=D(i(n,"activities"),M("joinCode","==",t)),r=await y(a);if(r.empty)return null;const l=r.docs[0],d=c(i(n,s=="student"?"students":"teachers"),o),u=await S(d);if(console.log(u.data()),!u.exists())return null;if(l.data().type=="theater"){if((u.data().gender==null||u.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),u.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(u.data().phoneNumber==""||u.data().gender==null||u.data().gender=="")&&s=="student")return null;if(s=="student")return await p(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,X.fromMap(u.data()).toMap()]}),O.fromMap(l.data());{console.log("Joining as teacher"),console.log(u.data());const g=C.fromBlank(u.data().fullname,u.data().uid,u.data().FCMToken);return console.log(g.toMap()),await p(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,g.toMap()]}),O.fromMap(l.data())}}else if(s=="student"){const g=C.fromBlank(u.data().fullname,u.data().uid,u.data().FCMToken);return await p(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,g.toMap()]}),N.fromMap(l.data())}else{const g=C.fromBlank(u.data().fullname,u.data().uid,u.data().FCMToken);return await p(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,g.toMap()]}),N.fromMap(l.data())}}async function de(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(h,"schools",e),a=c(i(n,s=="student"?"students":"teachers"),o);await p(a,{gender:t})}async function he(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=c(h,"schools",e),a=c(i(n,s=="student"?"students":"teachers"),o);await p(a,{phoneNumber:t})}async function fe(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=c(i(s,"events"),t.id);await p(n,t.toMap())}async function ge(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=c(h,"schools",t),n=[];let a;o=="student"?a=await y(D(i(s,"activities"),M("studentUids","array-contains",e))):a=await y(D(i(s,"activities"),M("teacherUids","array-contains",e))),console.log(a);for(const r of a.docs){let l;o=="student"?l=await y(D(i(r.ref,"events"),M("targetUids","array-contains",e))):l=await y(i(r.ref,"events"));for(const d of l.docs){const u=d.data();console.log(u),u.type=="activity-theater-event"?n.push(G.fromMap(u)):n.push(ft.fromMap(u))}}return n}async function me(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const n=c(h,"schools",o),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses"),d=await S(c(l,s));return d.exists()?B.fromMap(d.data()):null}async function pe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),n=c(i(s,"activities"),t);await p(n,{rehearsalLocations:e.map(a=>a.toMap())})}async function Ie(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const n=localStorage.getItem("accountType"),a=c(h,"schools",o),r=c(i(a,"activities"),t);if(n=="teacher"){const l=c(i(a,"teachers"),s),d=await S(l);if(!d.exists())return;const u=ut.fromMap(d.data());$(i(r,"groupChats"),async g=>{const m=[];for(const I of g.docs){const f=E.fromMap(I.data());if((f.generalTarget=="direct"||f.generalTarget=="custom")&&(C.fromBlank(u.fullname,u.uid,u.FCMToken),!f.members.find(v=>v.memberUid==s)))continue;if(f.generalTarget=="direct"){const v=f.members.find(F=>F.memberUid!=s);f.name=(v==null?void 0:v.memberName)||"Unknown"}const T=i(I.ref,"messages"),w=D(T,Q("timeSent","desc"),z(1)),A=await y(w);A.empty||(f.lastMessage=H.fromMap(A.docs[0].data())),m.push(f)}m.sort((I,f)=>I.lastMessage?f.lastMessage?f.lastMessage.timeSent.getTime()-I.lastMessage.timeSent.getTime():-1:1),e(m)})}else{const l=c(i(a,"students"),s),d=await S(l);if(!d.exists())return;const u=ot.fromMap(d.data());console.log(u),$(i(r,"groupChats"),async g=>{const m=[];C.fromBlank(u.fullname,u.uid,u.FCMToken);for(const I of g.docs){const f=E.fromMap(I.data());if(!(f.generalTarget=="everyone"||f.generalTarget=="students")&&(f.generalTarget=="parents"||!f.members.find(v=>v.memberUid==s)))continue;if(f.generalTarget=="direct"){const v=f.members.find(F=>F.memberUid!=s);f.name=(v==null?void 0:v.memberName)||"Unknown"}const T=i(I.ref,"messages"),w=D(T,Q("timeSent","desc"),z(1)),A=await y(w);A.empty||(f.lastMessage=H.fromMap(A.docs[0].data())),m.push(f)}m.sort((I,f)=>I.lastMessage?f.lastMessage?f.lastMessage.timeSent.getTime()-I.lastMessage.timeSent.getTime():-1:1),e(m)})}}async function ye(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const n=c(h,"schools",s),a=c(i(n,"activities"),t);console.log("Getting messages for "+e);const r=c(i(a,"groupChats"),e),l=i(r,"messages");$(l,d=>{const u=[];d.forEach(g=>{u.push(H.fromMap(g.data()))}),u.sort((g,m)=>g.timeSent.getTime()-m.timeSent.getTime()),o(u)})}async function it(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=c(h,"schools",t),n=c(i(s,o=="student"?"students":"teachers"),e),a=await S(n);return a.exists()?a.data():null}async function ve(t,e,o,s){const n=localStorage.getItem("schoolId"),a=localStorage.getItem("userId");if(!n||!a)return;const r=c(h,"schools",n),l=c(i(r,"activities"),t),d=c(i(l,"groupChats"),e);if(!(await S(d)).exists()){if(s==null)return;const I=E.fromBlank("",s.memberUid,[C.fromBlank(o.senderName,o.senderUid,o.senderFCMToken),s],"direct",t,Date.now());await _(d,I.toMap());const f=i(d,"messages"),T=await k(f,o.toMap());o.messageId=T.id,await p(T,{messageId:T.id});return}const g=i(d,"messages"),m=await k(g,o.toMap());o.messageId=m.id,await p(m,{messageId:m.id})}async function L(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=c(h,"schools",e),s=c(i(o,"activities"),t.activityId),n=i(s,"groupChats"),a=await it();if(!a)return;const r=C.fromBlank(a.fullname,a.uid,a.FCMToken);t.members.push(r);const l=await k(n,t.toMap());t.id=l.id,await p(l,{id:l.id})}async function we(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);p(r,{resources:J(o.toMap())})}async function Se(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e);p(r,{resources:gt(o.toMap())})}async function De(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(h,"schools",s),a=c(i(n,"activities"),t),r=c(i(a,"shows"),e),l=i(r,"conflictResponses"),d=c(l,o.id);await dt(d)}async function Te(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(h,"schools",o),n=i(s,t+"s");await _(c(n,e.uid),e.toMap());const a=ht.fromBlank(e.fullname,e.FCMToken,e.uid);await p(s,{[t+"Uids"]:J(e.uid),[t+"s"]:J(a.toMap())})}function Ht(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function Me(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(h,"schools",o),n=await S(s);if(!n.exists())return null;const a=n.data(),r=i(s,"activities"),l=Ht(t),d=[P.fromMap({name:"Rehearsal",color:R("#FF0000")}),P.fromMap({name:"Performance",color:R("#00FF00")})],u=[P.fromMap({name:"Practice",color:R("#FF0000")}),P.fromMap({name:"Game",color:R("#00FF00")})],g=[mt.fromMap({name:"Auditorium",color:R("#0000FF")})],m=pt.fromMap(a.location),I=[m],f=await it();if(!f)return null;const T=C.fromBlank(f.fullname,f.uid,f.FCMToken);let w;e=="theater"?w=O.fromBlank(t,"",l,[],[],[],[T],I,d,m,g,"type",Date.now()):w=N.fromBlank(t,"",l,[],[],[],[T],I,u,m,"type",Date.now(),"activity");const A=await k(r,w.toMap());w.id=A.id,await p(A,{id:A.id});const v=E.fromMap({name:"Everyone",members:[],id:"",activityId:w.id,lastUpdated:Date.now(),generalTarget:"everyone"});await L(v);const F=E.fromMap({name:"Parents",members:[],id:"",activityId:w.id,lastUpdated:Date.now(),generalTarget:"parents"});await L(F);const rt=E.fromMap({name:"Students",members:[],id:"",activityId:w.id,lastUpdated:Date.now(),generalTarget:"students"});return await L(rt),w}async function Ae(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=c(h,"schools",e),s=c(i(o,"students"),t),n=await S(s);return n.exists()?ot.fromMap(n.data()):null}export{me as A,pe as B,L as C,ve as D,ye as E,Ie as F,it as G,we as H,Se as I,Ae as J,de as a,Me as b,Te as c,Xt as d,Yt as e,ne as f,qt as g,le as h,Kt as i,ue as j,Qt as k,zt as l,Wt as m,Zt as n,re as o,oe as p,se as q,fe as r,te as s,ee as t,he as u,ae as v,De as w,ce as x,ie as y,ge as z};
