import{j as c,c as W,r as f,i as q,g as z,E as O,k as K,C as u,e as y,h as Q}from"./index-DfMoZj84.js";import{C as V,S as X}from"./Show_Group_Tile-27Jmvlnv.js";import{q as Y,r as Z,t as _}from"./db-BaAA548E.js";import{T as $}from"./trash-BnpXJPEK.js";import{A as ee}from"./Ensemble_Section_Tile-C0ICAhvO.js";function se({actor:g,canDelete:v,onDelete:w}){return c.jsx("div",{className:"ActorTile",id:"actor-tile-"+g.userId,children:c.jsxs("div",{className:"header",children:[c.jsx("div",{className:"ActorNameDiv",children:c.jsxs("label",{htmlFor:"Actor",children:["Actor: ",g.name]})}),v&&c.jsx("div",{className:"ActorTrashDiv",children:c.jsx("img",{src:$,alt:"",className:"TrashIcon",onClick:()=>{w()}})})]})})}W(document.getElementById("root")).render(c.jsx(f.StrictMode,{children:c.jsx(te,{})}));function te(){const[g,v]=f.useState(""),[w,B]=f.useState(""),[n,E]=f.useState(),[d,A]=f.useState([]),[S,G]=f.useState([]),[L,j]=f.useState(!1),[x,M]=f.useState([]),[C,N]=f.useState([]),[P,k]=f.useState(!1),b=f.useRef(null),[R,U]=f.useState(!1),[F,T]=f.useState(!0),[p,I]=f.useState("Characters");async function H(){let l=!0;if(j(!0),!n){j(!1);return}for(let t=0;t<n.characters.length;t++){const a=n.characters[t],s=d.find(e=>e.name==a.name);s&&(console.log("New Character"),console.log(s),n.characters[t]=s,s.actor==null&&(console.log("Actor is null"),l=!1))}for(let t=0;t<n.showGroups.length;t++){console.log("UPDATING SHOW GROUPS");const a=n.showGroups[t];console.log("Show Group: "+a.name);const s=S.find(e=>e.name==a.name);if(console.log("New Show Group: "+(s==null?void 0:s.name)),s){a.characters=s.characters;for(let e=0;e<a.characters.length;e++){const r=a.characters[e];if(r instanceof u){const o=d.find(i=>i.name==r.name);o&&(a.characters[e]=o,o.actor==null&&(l=!1))}}}}for(let t=0;t<n.layout.length;t++){const a=n.layout[t];for(let s=0;s<a.scenes.length;s++){const e=a.scenes[s];for(let r=0;r<e.characters.length;r++){const o=e.characters[r];if(o instanceof u){const i=d.find(h=>h.name==o.name);i&&(e.characters[r]=i)}else if(o instanceof y){const i=S.find(h=>h.name==o.name);if(i){for(let h=0;h<i.characters.length;h++){const m=i.characters[h];if(m instanceof u){const D=d.find(J=>J.name==m.name);D&&(i.characters[h]=D)}}e.characters[r]=i}}}}}for(let t=0;t<n.songs.length;t++){const a=n.songs[t];console.log("Assigning roles to song"),console.log(a);for(let s=0;s<a.characters.length;s++){const e=a.characters[s];if(console.log("Character"),console.log(e),console.log(typeof e),e instanceof u){const r=d.find(o=>o.name==e.name);r&&(a.characters[s]=r)}else if(e instanceof y){const r=S.find(o=>o.name==e.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof u){const h=d.find(m=>m.name==i.name);h&&(r.characters[o]=h)}}a.characters[s]=r}}console.log("New Character"),console.log(a.characters[s]),console.log(typeof a.characters[s])}}for(let t=0;t<n.dances.length;t++){const a=n.dances[t];for(let s=0;s<a.characters.length;s++){const e=a.characters[s];if(e instanceof u){const r=d.find(o=>o.name==e.name);r&&(a.characters[s]=r)}else if(e instanceof y){const r=S.find(o=>o.name==e.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof u){const h=d.find(m=>m.name==i.name);h&&(r.characters[o]=h)}}a.characters[s]=r}}}}if(n.canCreateSchedule=l,n.ensemble=Q.fromBlank(C,Date.now()),n.isCreatingSchedule){if(!l){alert("Cannot update show because not all characters have been assigned actors"),j(!1);return}await Z(n)}E(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+w,JSON.stringify(n)),await _(g,w,n),j(!1)}return f.useEffect(()=>{q(()=>{}),k(!0);const l=new URLSearchParams(window.location.search),t=l.get("activityId");t&&(v(t),Y(t).then(e=>{M(e),console.log(e),k(!1)}));const a=l.get("showId");a&&B(a);const s=localStorage.getItem("show-"+a);if(s){const e=z.fromMap(JSON.parse(s));if(T(!0),e==null){window.location.href="/Activity/Shows/Show/?activityId="+t;return}E(e),console.log(e),A(e.characters),G(e.showGroups);const r=e.showGroups;let o=!1;for(let i=0;i<r.length;i++)r[i].characters.map(m=>m instanceof O).includes(!0)&&(o=!0);U(o),e!=null&&e.hasEnsemble&&N(e.ensemble.actors),T(!1)}},[]),c.jsxs(c.Fragment,{children:[" ",F?c.jsx("div",{className:"centerLoader",children:c.jsx("div",{className:"loader"})}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"title",children:c.jsx("h1",{children:"Assign Roles"})}),c.jsxs("div",{className:"center",children:[c.jsxs("div",{className:"sections",children:[c.jsx("h2",{className:"section "+(p=="Characters"?"selected":""),onClick:()=>{I("Characters")},children:"Characters"}),R&&c.jsx("h2",{className:"section "+(p=="Show Groups"?"selected":""),onClick:()=>{I("Show Groups")},children:"Show Groups"}),(n==null?void 0:n.hasEnsemble)&&c.jsx("h2",{className:"section "+(p=="Ensemble"?"selected":""),onClick:()=>{I("Ensemble")},children:"Ensemble"})]}),p=="Characters"&&c.jsx("div",{className:"characters",id:"create-characters",children:d.map((l,t)=>c.jsx(V,{character:l,actors:x,characters:[],isAssign:!0,setCharacter:a=>{A(s=>{const e=[...s];return e[t]=a,e})},removeCharacter:()=>{A(d.filter((a,s)=>s!==t))},isCreate:!1},t))}),R&&p=="Show Groups"&&c.jsx(c.Fragment,{children:c.jsx("div",{className:"showGroups",id:"create-showGroups",children:S.map((l,t)=>l.characters.map(a=>a instanceof O).includes(!0)?c.jsx(X,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:d,actors:x,isAssign:!0,setShowGroup:a=>{G(s=>{const e=[...s];e[t]=a,console.log("NEW SHOW GROUPS");for(let r=0;r<e.length;r++){const o=e[r];console.log(o.toMap())}return e})},removeShowGroup:()=>{G(S.filter((a,s)=>s!==t))},isCreate:!1},t):null)})}),(n==null?void 0:n.hasEnsemble)&&p=="Ensemble"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"ensemble",id:"create-ensemble",children:C.map((l,t)=>(console.log(l),c.jsx(se,{actor:l,canDelete:!0,onDelete:()=>{N(C.filter((a,s)=>s!==t))}},t)))}),c.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=b.current)==null||l.showModal()},children:"Add Actor"})]}),L?c.jsx("div",{className:"loader"}):c.jsx("button",{className:"ActionBtn",onClick:async()=>{await H(),window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Save"}),c.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!P&&c.jsx(ee,{dialogRef:b,keepPastResult:!1,actor:new K,addedActors:C,actors:x,setActor:l=>{const t=[...C];t.push(l),console.log("Setting actors"),N(t)},close:()=>{var l;(l=b.current)==null||l.close()}})]})]})}
