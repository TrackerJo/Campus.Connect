import{c as de,j as t,r as i,i as ue,n as me,I as he}from"./index-TIL8WiPk.js";import{X as ge,h as ve,Y as pe,Z as fe,_ as Se}from"./db-DunmcTym.js";import{B as xe,C as Z}from"./Calendar-fQs3k3OX.js";de(document.getElementById("root")).render(t.jsx(i.StrictMode,{children:t.jsx(je,{})}));function je(){const[q,z]=i.useState("student"),[d,B]=i.useState([]),[C,H]=i.useState([]),[P,K]=i.useState(null),[_,I]=i.useState(!1),[A,G]=i.useState([]),[a,Q]=i.useState(),[R,U]=i.useState("students"),[W,y]=i.useState("date"),[N,D]=i.useState(null),[p,f]=i.useState(null),[S,x]=i.useState(null),[F,L]=i.useState(""),[M,O]=i.useState(""),[ee,j]=i.useState(""),[te,E]=i.useState(""),[u,m]=i.useState(void 0),[h,g]=i.useState([]),[T,$]=i.useState("students"),[ne,Ee]=i.useState(!1);i.useState(""),i.useState(""),i.useState(null),i.useState(null);const[se,Te]=i.useState(""),[V,Y]=i.useState(!1),[ae,oe]=i.useState(null),[w,k]=i.useState(void 0);i.useEffect(()=>{ue(()=>{});async function e(){I(!0);const s=new URLSearchParams(window.location.search).get("activityId");if(s){K(s);const c=await ve(s);Q(c),console.log(c),m(c.defaultLocation)}const l=await pe(s);console.log(l),B(l);const b=[];for(const c of l){console.log(c);const v=c.date.from;console.log(c.date.date),v.setDate(c.date.date.getDate()),v.setMonth(c.date.date.getMonth()),v.setFullYear(c.date.date.getFullYear());const r=c.date.to;r.setDate(c.date.date.getDate()),r.setMonth(c.date.date.getMonth()),r.setFullYear(c.date.date.getFullYear()),console.log(v),console.log(r),b.push({title:c.name,start:v.toISOString(),end:r.toISOString(),isAllDay:!1,interactive:!0,description:c.info,color:c.eventType.color.setAlpha(.8).toRBGAString(),id:c.id,location:c.location.name})}H(b),console.log(l),console.log(b),I(!1)}e();const n=localStorage.getItem("accountType");n&&z(n)},[]);function X(){return d}const ie=e=>{const n=e.target.value,[o,s]=n.split(":").map(Number),l=new Date(N);l.setHours(o,s,0,0),f(l),j(l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},le=e=>{const n=e.target.value,[o,s]=n.split(":").map(Number),l=new Date(N);l.setHours(o,s,0,0),x(l),E(l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(e){return this.setTime(this.getTime()+e*60*60*1e3),this};function ce(){return t.jsxs("div",{className:"custom-invite-view",children:[t.jsx("button",{className:R=="students"?"selected":"",onClick:()=>{U("students")},children:"Students"}),t.jsx("button",{className:R=="parents"?"selected":"",onClick:()=>{U("parents")},children:"Parents"}),t.jsx("div",{className:"current-view",children:R=="students"?t.jsx("div",{className:"students",children:a==null?void 0:a.students.map((e,n)=>t.jsxs("div",{className:"student",children:[t.jsxs("label",{className:"custom-checkbox",children:[t.jsx("input",{type:"checkbox",id:"student",checked:h.find(o=>o.userId==e.userId)!=null,onChange:o=>{o.target.checked?g([...h,e]):g(h.filter(s=>s!=e))}}),t.jsx("span",{className:"checkmark",children:" "})]}),t.jsx("label",{htmlFor:e.userId,children:e.name})]},e.userId))}):t.jsx("div",{className:"parents",children:a==null?void 0:a.parents.map((e,n)=>t.jsxs("div",{className:"parent",children:[t.jsxs("label",{className:"custom-checkbox",children:[t.jsx("input",{type:"checkbox",id:"parent",onChange:o=>{o.target.checked?g([...h,e]):g(h.filter(s=>s!=e))}}),t.jsx("span",{className:"checkmark",children:" "})]}),t.jsx("label",{htmlFor:e.userId,children:e.name})]},e.userId))})})]})}function re(){return t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"mode",children:"Enter Event Information"}),t.jsx("label",{htmlFor:"Name",children:"Name: "}),t.jsx("input",{type:"text",value:F,onChange:e=>{L(e.target.value)}}),t.jsx("br",{}),t.jsx("label",{htmlFor:"Description",children:"Description: "}),t.jsx("textarea",{value:M,onChange:e=>{O(e.target.value)}}),t.jsx("br",{}),t.jsx("label",{htmlFor:"",children:"Date: "}),t.jsx("input",{type:"date",value:N==null?void 0:N.toISOString().split("T")[0],onChange:e=>{const n=new Date(e.target.value);n.setHours(0,0,0,0),n.setDate(n.getDate()+1),D(n);const o=new Date(n);o.setHours(p.getHours(),p.getMinutes(),0,0),f(o),j(o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const s=new Date(n);s.setHours(S.getHours(),S.getMinutes(),0,0),x(s),E(s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}}),t.jsx("br",{}),t.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),t.jsx("input",{type:"time",value:ee,onChange:ie}),t.jsx("br",{}),t.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),t.jsx("input",{type:"time",value:te,onChange:le}),t.jsx("br",{}),t.jsx("label",{htmlFor:"location",children:"Location: "}),t.jsx("select",{name:"location",id:"location",onChange:e=>{m(a==null?void 0:a.locations.find(n=>n.name==e.target.value))},children:a==null?void 0:a.locations.map((e,n)=>t.jsx("option",{value:e.name,selected:(u==null?void 0:u.name)==e.name,children:e.name+" ("+e.address+")"},n))}),t.jsx("br",{}),t.jsx("label",{htmlFor:"eventType",children:"Event Type: "}),t.jsx("select",{name:"eventType",id:"event-type",onChange:e=>{k(a==null?void 0:a.eventTypes.find(n=>n.name==e.target.value))},children:a==null?void 0:a.eventTypes.map((e,n)=>t.jsx("option",{value:e.name,selected:(w==null?void 0:w.name)==e.name,children:e.name},n))}),t.jsx("br",{}),t.jsx("label",{htmlFor:"inviteType",children:"Invite Type: "}),t.jsxs("select",{name:"inviteType",id:"invite-type",onChange:e=>{$(e.target.value)},children:[t.jsx("option",{value:"students",selected:T=="students",children:"Students"}),t.jsx("option",{value:"parents",selected:T=="parents",children:"Parents"}),t.jsx("option",{value:"groups",selected:T=="groups",children:"Groups"}),t.jsx("option",{value:"custom",selected:T=="custom",children:"Custom"})]}),T=="groups"?t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("label",{htmlFor:"groups",children:"Groups: "}),t.jsx("div",{className:"groups",children:a.groups.map((e,n)=>t.jsxs("div",{className:"group",children:[t.jsxs("label",{className:"custom-checkbox",children:[t.jsx("input",{type:"checkbox",id:"ensemble",checked:A.find(o=>o.groupName==e.groupName)!=null,onChange:o=>{o.target.checked?(G([...A,e]),g([...h,...e.groupMembers])):(G(A.filter(s=>s.groupName!=e.groupName)),g(h.filter(s=>!e.groupMembers.includes(s))))}}),t.jsx("span",{className:"checkmark",children:" "})]}),t.jsx("label",{htmlFor:e.groupName,children:e.groupName})]},e.groupName))})]}):t.jsx(t.Fragment,{}),T=="custom"?ce():t.jsx(t.Fragment,{}),t.jsx("br",{}),_?t.jsx("div",{className:"loader"}):t.jsx("button",{onClick:async()=>{if(I(!0),console.log(`Name: ${F}, Description: ${M}, Start Time: ${p}, End Time: ${S}, Selected Location: ${u},Event Type: ${w}`),F==""||M==""||p==null||S==null||u==null||w==null){alert("Please fill out all fields"),console.log(`Name: ${F}, Description: ${M}, Start Time: ${p}, End Time: ${S}, Selected Location: ${u},  Event Type: ${w}`),I(!1);return}console.log("Submit");const e=u??a.locations[0];console.log(p),console.log(S);const n=me.fromBlank(N,p,S);console.log(n.toMap());const o=w;o.color.setAlpha(255);const s=he.fromBlank(F,M,e,n,"activity-event",Date.now(),P,A.map(l=>l.groupName),h,T,o,A,ne,se,[],a.name);if(V){s.id=ae.id,await fe(s),Y(!1);const l=s.date.from,b=s.date.to,c={title:s.name,start:l.toISOString(),end:b.toISOString(),isAllDay:!1,interactive:!0,description:s.info,color:s.eventType.color.setAlpha(.8).toRBGAString(),id:s.id,location:s.location.name},v=C.filter(J=>J.id!=s.id);v.push(c),H(v);const r=d.filter(J=>J.id!=s.id);r.push(s),console.log(r),B([...r])}else{await Se(s);const l=s.date.from,b=s.date.to,c={title:s.name,start:l.toISOString(),end:b.toISOString(),isAllDay:!1,interactive:!0,description:s.info,color:s.eventType.color.setAlpha(.8).toRBGAString(),id:s.id,location:s.location.name};H([...C,c]),B([...d,s])}I(!1),y("date"),D(null),f(null),x(null),L(""),O(""),j(""),E(""),k(a==null?void 0:a.eventTypes[0]),m(a==null?void 0:a.defaultLocation),g([]),$("students")},className:"ActionBtn",children:V?"Save":"Submit"}),t.jsx("button",{onClick:()=>{if(V){y("date"),D(null),f(null),x(null),L(""),O(""),j(""),E(""),m(a.defaultLocation),k(a.eventTypes[0]),m(a==null?void 0:a.defaultLocation),Y(!1);return}y("date"),O(""),L(""),$("students")},className:"ActionBtn",children:"Back"})]})}return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"page-title",children:[t.jsx("img",{src:xe,alt:"back arrow",onClick:()=>{window.location.href="/Activity/?activityId="+P}}),t.jsx("h1",{children:"Events"})]}),_?t.jsx("div",{className:"center",children:t.jsx("div",{className:"loader"})}):t.jsx("div",{className:"center",children:q=="teacher"?W=="date"?t.jsxs(t.Fragment,{children:[" ",t.jsx(Z,{canViewConflicts:!1,isCreating:!0,canOpenContextMenu:!0,events:C,editEvent:e=>{const n=X().find(o=>o.id==e.id);console.log(e.id),n&&(console.log(n),y("info"),L(n.name),O(n.info),D(n.date.date),f(n.date.from),j(n.date.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),x(n.date.to),E(n.date.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),m(n.location),g(n.targets),console.log("FROM EDIT"),console.log(n.targets),k(n.eventType),Y(!0),$(n.generalTarget),oe(n),G(n.groupTargets))},viewEvent:e=>{const n=X().find(o=>o.id==e.id);n&&(localStorage.setItem("event",JSON.stringify(n.toMap())),localStorage.setItem("back","/Activity/Events/?activityId="+P),window.location.href="/Calendar/Event/")},viewConflicts:e=>{},deleteEvent:async e=>{console.log(e);const n=d.find(l=>l.id==e.id),o=d.filter(l=>l.id!=e.id);B(o);const s=C.filter(l=>l.id!=e.id);H(s),await ge(n)},dateClick:e=>{console.log(e.date),D(e.date),new Date(e.date).setHours(0,0,0,0),f(new Date(e.date)),j(e.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const o=new Date(e.date);x(o.addHours(1)),console.log(o),E(e.date.addHours(1).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),m(a.defaultLocation),k(a.eventTypes[0]),y("info")},eventClick:e=>{D(e.event.start),new Date(e.event.start).setHours(0,0,0,0),f(new Date(e.event.start)),j(e.event.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const o=new Date(e.event.end);x(o),E(o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),m(a.defaultLocation),k(a.eventTypes[0]),y("info")}})," ",t.jsx("button",{className:"ActionBtn",onClick:()=>{localStorage.setItem("events",JSON.stringify(d.map(e=>e.toMap()))),window.open("/Activity/Events/Print/","_blank")},children:"Print"})]}):re():t.jsxs(t.Fragment,{children:[" ",t.jsx(Z,{viewEvent:e=>{},canViewConflicts:!1,events:C,canOpenContextMenu:!1,dateClick:()=>{},deleteEvent:()=>{},viewConflicts:()=>{},editEvent:()=>{},eventIdClick:e=>{const n=d.find(o=>o.id===e);n&&(localStorage.setItem("event",JSON.stringify(n.toMap())),localStorage.removeItem("back"),window.location.href="/Calendar/Event/")}})," ",t.jsx("button",{className:"ActionBtn",onClick:()=>{localStorage.setItem("events",JSON.stringify(d.map(e=>e.toMap()))),window.open("/Activity/Events/Print/","_blank")},children:"Print"})]})})]})}
