import{j as r,r as u,c as E}from"./index-BvKDzgix.js";import{e as _,E as M,C as S,i as F,F as D,d as G,X as R,B as k,Z as L,_ as O,q as B,$ as y,a0 as U,a1 as q,a2 as H,a3 as X}from"./db-CcV56dnt.js";import{A as w}from"./Add_User_Dialog-B9hG2C_v.js";import{a as Z,A as $,S as z,D as J}from"./Show_Group_Display_Tile-DeKwMYpG.js";import{E as K}from"./Ensemble_Section_Tile-UX5oGjty.js";import"./trash-BnpXJPEK.js";function Q({message:d,isSender:p}){return r.jsx("div",{className:"message",children:r.jsx("div",{className:"message__outer",children:r.jsxs("div",{className:"message__inner",children:[p?r.jsx(r.Fragment,{}):r.jsx("div",{className:"message__spacer"}),r.jsxs("div",{className:"message__bubble "+(p?"isSender":"notSender"),children:[r.jsx("h1",{className:"message-sender",children:d.senderName}),r.jsxs("div",{className:"message-body",children:[r.jsx("p",{className:"message-text",children:d.message}),r.jsx("p",{className:"message-time-sent",children:d.timeSent.toLocaleTimeString()})]})]}),p?r.jsx("div",{className:"message__spacer"}):r.jsx(r.Fragment,{})]})})})}function V({sendMessage:d}){const p=u.useRef(null);return r.jsxs("div",{className:"message-send-bar",children:[r.jsx("input",{type:"text",placeholder:"Type a message...",className:"message-input",ref:p}),r.jsx("button",{onClick:()=>{d(p.current.value),p.current.value=""},className:"message-send-btn",children:"Send"})]})}function T({dialogRef:d,close:p,addMembers:h,activityId:x,setName:b}){const[j,m]=u.useState([]),[n,C]=u.useState(null),[A,N]=u.useState(null);return u.useEffect(()=>{x&&_(x).then(i=>{i=i.filter(l=>l.canCreateSchedule),m(i)})},[x]),r.jsx("dialog",{ref:d,className:"AddFromPlayDialog",children:r.jsxs("div",{className:"AddFromPlayDiv",children:[r.jsx("h2",{children:"Select Play"}),r.jsxs("select",{className:"SelectPlay",onChange:i=>{C(j.find(l=>l.id==i.target.value)||null),N(M.fromBlank(!0,!1,!1,!1,[],333))},children:[r.jsx("option",{value:"",children:"Select a Play"}),j.map((i,l)=>r.jsx("option",{value:i.id,children:i.name},l))]}),n&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),r.jsx("button",{className:"ActionBtn",onClick:()=>{const i=[],l=[];for(const c of n.ensemble.actors)l.includes(c.userId)||(i.push(c),l.push(c.userId));for(const c of n.characters)l.includes(c.actor.userId)||(i.push(c.actor),l.push(c.actor.userId));h(i)},children:"Add Full Cast"}),r.jsx("h2",{className:"title",children:"Ensemble"}),r.jsx("div",{className:"ensemble",children:r.jsx(K,{ensembleSection:A,isAssign:!1,actors:[],isCustom:!1,isCreate:!0,isGroupChatCreate:!0,setEnsembleSection:i=>{N(i)},onAddEnsemble:()=>{const i=[],l=[];if(A.includeAll)for(const c of n.ensemble.actors)l.includes(c.userId)||(i.push(c),l.push(c.userId));else if(A.includeMale)for(const c of n.ensemble.actors)c.gender=="male"&&(l.includes(c.userId)||(i.push(c),l.push(c.userId)));else if(A.includeFemale)for(const c of n.ensemble.actors)c.gender=="female"&&(l.includes(c.userId)||(i.push(c),l.push(c.userId)));h(i)},removeEnsembleSection:()=>{}})}),r.jsx("h2",{className:"title",children:"Show Groups"}),r.jsx("div",{className:"show-groups",children:n==null?void 0:n.showGroups.map((i,l)=>r.jsx(Z,{showGroup:i,canDelete:!1,onDelete:()=>{},canClick:!0,showCharacters:!1,onClick:()=>{b(i.name);const c=[],t=[];for(const a of i.characters)if(a instanceof S)t.includes(a.actor.userId)||(c.push(a.actor),t.push(a.actor.userId));else if(a instanceof F){for(const e of a.characters)if(e instanceof S)t.includes(e.actor.userId)||(c.push(e.actor),t.push(e.actor.userId));else if(e instanceof M){if(e.includeAll)for(const s of n.ensemble.actors)t.includes(s.userId)||(c.push(s),t.push(s.userId));else if(e.includeMale)for(const s of n.ensemble.actors)s.gender=="male"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeFemale)for(const s of n.ensemble.actors)s.gender=="female"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeCustom)for(const s of e.customActors)t.includes(s.userId)||(c.push(s),t.push(s.userId))}}else if(a instanceof M){if(a.includeAll)for(const e of n.ensemble.actors)t.includes(e.userId)||(c.push(e),t.push(e.userId));else if(a.includeMale)for(const e of n.ensemble.actors)e.gender=="male"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeFemale)for(const e of n.ensemble.actors)e.gender=="female"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)t.includes(e.userId)||(c.push(e),t.push(e.userId))}h(c)}},l))}),r.jsx("h2",{className:"title",children:"Show Layout"}),r.jsx("div",{className:"layout",children:n==null?void 0:n.layout.map((i,l)=>r.jsx($,{act:i,onClick:c=>{b(c.name+" - "+i.name);const t=[],a=[];console.log(c);for(const e of c.characters)if(e instanceof S)a.includes(e.actor.userId)||(t.push(e.actor),a.push(e.actor.userId));else if(e instanceof F){for(const s of e.characters)if(s instanceof S)a.includes(s.actor.userId)||(t.push(s.actor),a.push(s.actor.userId));else if(s instanceof M){if(s.includeAll)for(const o of n.ensemble.actors)a.includes(o.userId)||(t.push(o),a.push(o.userId));else if(s.includeMale)for(const o of n.ensemble.actors)o.gender=="male"&&(a.includes(o.userId)||(t.push(o),a.push(o.userId)));else if(s.includeFemale)for(const o of n.ensemble.actors)o.gender=="female"&&(a.includes(o.userId)||(t.push(o),a.push(o.userId)));else if(s.includeCustom)for(const o of s.customActors)a.includes(o.userId)||(t.push(o),a.push(o.userId))}}else if(e instanceof M){if(e.includeAll)for(const s of n.ensemble.actors)a.includes(s.userId)||(t.push(s),a.push(s.userId));else if(e.includeMale)for(const s of n.ensemble.actors)s.gender=="male"&&(a.includes(s.userId)||(t.push(s),a.push(s.userId)));else if(e.includeFemale)for(const s of n.ensemble.actors)s.gender=="female"&&(a.includes(s.userId)||(t.push(s),a.push(s.userId)));else if(e.includeCustom)for(const s of e.customActors)a.includes(s.userId)||(t.push(s),a.push(s.userId))}else if(e instanceof D){for(const s of n.ensemble.actors)a.includes(s.userId)||(t.push(s),a.push(s.userId));for(const s of n.characters)a.includes(s.actor.userId)||(t.push(s.actor),a.push(s.actor.userId))}h(t)}},l))}),r.jsx("h2",{className:"title",children:"Songs"}),r.jsx("div",{className:"songs",children:n==null?void 0:n.songs.map((i,l)=>r.jsx(z,{song:i,onClick:()=>{b(i.name);const c=[],t=[];for(const a of i.characters)if(a instanceof S)t.includes(a.actor.userId)||(c.push(a.actor),t.push(a.actor.userId));else if(a instanceof F){for(const e of a.characters)if(e instanceof S)t.includes(e.actor.userId)||(c.push(e.actor),t.push(e.actor.userId));else if(e instanceof M){if(e.includeAll)for(const s of n.ensemble.actors)t.includes(s.userId)||(c.push(s),t.push(s.userId));else if(e.includeMale)for(const s of n.ensemble.actors)s.gender=="male"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeFemale)for(const s of n.ensemble.actors)s.gender=="female"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeCustom)for(const s of e.customActors)t.includes(s.userId)||(c.push(s),t.push(s.userId))}}else if(a instanceof M){if(a.includeAll)for(const e of n.ensemble.actors)t.includes(e.userId)||(c.push(e),t.push(e.userId));else if(a.includeMale)for(const e of n.ensemble.actors)e.gender=="male"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeFemale)for(const e of n.ensemble.actors)e.gender=="female"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)t.includes(e.userId)||(c.push(e),t.push(e.userId))}else if(a instanceof D){for(const e of n.ensemble.actors)t.includes(e.userId)||(c.push(e),t.push(e.userId));for(const e of n.characters)t.includes(e.actor.userId)||(c.push(e.actor),t.push(e.actor.userId))}h(c)}},l))}),r.jsx("h2",{className:"title",children:"Dances"}),r.jsx("div",{className:"dances",children:n==null?void 0:n.dances.map((i,l)=>r.jsx(J,{dance:i,onClick:()=>{b(i.name);const c=[],t=[];for(const a of i.characters)if(a instanceof S)t.includes(a.actor.userId)||(c.push(a.actor),t.push(a.actor.userId));else if(a instanceof F){for(const e of a.characters)if(e instanceof S)t.includes(e.actor.userId)||(c.push(e.actor),t.push(e.actor.userId));else if(e instanceof M){if(e.includeAll)for(const s of n.ensemble.actors)t.includes(s.userId)||(c.push(s),t.push(s.userId));else if(e.includeMale)for(const s of n.ensemble.actors)s.gender=="male"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeFemale)for(const s of n.ensemble.actors)s.gender=="female"&&(t.includes(s.userId)||(c.push(s),t.push(s.userId)));else if(e.includeCustom)for(const s of e.customActors)t.includes(s.userId)||(c.push(s),t.push(s.userId))}}else if(a instanceof M){if(a.includeAll)for(const e of n.ensemble.actors)t.includes(e.userId)||(c.push(e),t.push(e.userId));else if(a.includeMale)for(const e of n.ensemble.actors)e.gender=="male"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeFemale)for(const e of n.ensemble.actors)e.gender=="female"&&(t.includes(e.userId)||(c.push(e),t.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)t.includes(e.userId)||(c.push(e),t.push(e.userId))}else if(a instanceof D){for(const e of n.ensemble.actors)t.includes(e.userId)||(c.push(e),t.push(e.userId));for(const e of n.characters)t.includes(e.actor.userId)||(c.push(e.actor),t.push(e.actor.userId))}h(c)}},l))})]}),r.jsx("button",{className:"ActionBtn",onClick:()=>{p()},children:"Close"}),r.jsx("br",{})]})})}function P({dialogRef:d,close:p,addMembers:h,activityGroups:x}){const[b,j]=u.useState(null);return r.jsx("dialog",{ref:d,className:"AddFromGroupDialog",children:r.jsxs("div",{className:"AddFromGroupDiv",children:[r.jsx("h2",{children:"Select Group"}),r.jsxs("select",{className:"SelectPlay",onChange:m=>{j(x.find(n=>n.groupName==m.target.value)||null)},children:[r.jsx("option",{value:"",children:"Select a Group"}),x.map((m,n)=>r.jsx("option",{value:m.groupName,children:m.groupName},n))]}),r.jsx("br",{}),r.jsx("button",{className:"ActionBtn",onClick:()=>{b&&h(b.groupMembers),p()},children:"Add Group"}),r.jsx("button",{className:"ActionBtn",onClick:()=>{p()},children:"Close"}),r.jsx("br",{})]})})}function W({close:d,dialogRef:p,activityId:h,refresh:x}){const b=u.useRef(null),j=u.useRef(null),m=u.useRef(null),n=u.useRef(null),[C,A]=u.useState(null),[N,i]=u.useState([]),[l,c]=u.useState([]),[t,a]=u.useState([]);return u.useEffect(()=>{h&&G(h).then(e=>{if(A(e),e!=null)if(e instanceof R){const s=e.students.map(o=>k.fromBlank(o.name,o.userId,o.FCMToken));i([...e.parents,...s]),a(e.groups)}else i([...e.parents,...e.students]),a(e.groups)})},[h]),r.jsxs(r.Fragment,{children:[r.jsx("dialog",{className:"create-group-chat-dialog",ref:p,children:r.jsxs("div",{className:"create-group-chat-dialog-inner",children:[r.jsx("h1",{className:"create-group-chat-dialog-title",children:"Create Group Chat"}),r.jsx("input",{type:"text",placeholder:"Group Chat Name",className:"create-group-chat-dialog-input",ref:b}),l.length>0&&r.jsxs(r.Fragment,{children:[" ",r.jsx("h2",{className:"create-group-chat-dialog-members-title",children:"Members: "}),r.jsx("div",{className:"create-group-chat-dialog-members",children:l.map((e,s)=>r.jsxs("div",{className:"create-group-chat-dialog-member",children:[r.jsx("label",{htmlFor:"",children:e.memberName}),r.jsx("button",{className:"ActionBtn",onClick:()=>{c(l.filter(o=>o!=e))},children:"Remove"})]},s))})," "]}),r.jsx("button",{className:"ActionBtn",onClick:()=>{j.current.showModal()},children:"Add Member"}),t.length>0&&r.jsx("button",{className:"ActionBtn",onClick:()=>{n.current.showModal()},children:"Add from Group"}),C instanceof R?r.jsx("button",{className:"ActionBtn",onClick:()=>{m.current.showModal()},children:"Add from Play"}):null,r.jsx("button",{className:"ActionBtn",onClick:async()=>{if(b.current.value==""){alert("Please enter a name for the group chat");return}if(l.length==0){alert("Please add at least one member to the group chat");return}const e=L.fromBlank(b.current.value,"",l,"custom",h);await O(e),x(),d()},children:"Create"}),r.jsx("button",{onClick:d,className:"ActionBtn",children:"Close"})]})}),r.jsx(w,{members:N,dialogRef:j,addedMembers:l,close:()=>{j.current.close()},addUser:e=>{e instanceof B&&(e=k.fromBlank(e.name,e.userId,e.FCMToken));const s=[...l,e],o=[],f=s.filter(g=>o.includes(g.memberUid)?!1:(o.push(g.memberUid),!0));c(f)}}),r.jsx(P,{dialogRef:n,close:()=>{n.current.close()},addMembers:e=>{const s=[...l,...e],o=[],f=s.filter(g=>o.includes(g.memberUid)?!1:(o.push(g.memberUid),!0));c(f),n.current.close()},activityGroups:t}),r.jsx(T,{dialogRef:m,close:()=>{m.current.close()},addMembers:e=>{const s=e.map(I=>k.fromBlank(I.name,I.userId,I.FCMToken)),o=[...l,...s],f=[],g=o.filter(I=>f.includes(I.memberUid)?!1:(f.push(I.memberUid),!0));c(g),m.current.close()},setName:e=>{},activityId:h})]})}function Y({groupChat:d,onClick:p}){return r.jsxs("div",{className:"group-chat-display-tile",onClick:p,children:[r.jsx("h1",{children:d.name}),r.jsx("div",{className:"divider"}),r.jsxs("div",{className:"recent-message-div",children:[r.jsx("h3",{children:d.lastMessage!=null?d.lastMessage.senderName+": "+d.lastMessage.message:"No messages"}),r.jsx("h4",{children:d.lastMessage!=null?new Date(d.lastMessage.timeSent).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]})]})}function ee({close:d,dialogRef:p,activityId:h,userData:x,refresh:b}){const j=u.useRef(null),m=u.useRef(null),n=u.useRef(null),C=u.useRef(null),[A,N]=u.useState(null),[i,l]=u.useState([]),[c,t]=u.useState([]),[a,e]=u.useState([]);return u.useEffect(()=>{h&&G(h).then(s=>{if(N(s),s!=null)if(s instanceof R){const o=s.students.map(f=>k.fromBlank(f.name,f.userId,f.FCMToken));l([...s.parents,...o]),e(s.groups)}else l([...s.parents,...s.students]),e(s.groups)})},[h]),r.jsxs(r.Fragment,{children:[r.jsx("dialog",{className:"broadcast-message-dialog",ref:p,children:r.jsxs("div",{className:"broadcast-message-dialog-inner",children:[r.jsx("h1",{className:"broadcast-message-dialog-title",children:"Broadcast message"}),r.jsx("input",{type:"text",placeholder:"Message",className:"broadcast-message-dialog-input",ref:j}),c.length>0&&r.jsxs(r.Fragment,{children:[" ",r.jsx("h2",{className:"broadcast-message-dialog-members-title",children:"Recipient: "}),r.jsx("div",{className:"broadcast-message-dialog-members",children:c.map((s,o)=>r.jsxs("div",{className:"broadcast-message-dialog-member",children:[r.jsx("label",{htmlFor:"",children:s.memberName}),r.jsx("button",{className:"ActionBtn",onClick:()=>{t(c.filter(f=>f!=s))},children:"Remove"})]},o))})," "]}),r.jsx("button",{className:"ActionBtn",onClick:()=>{m.current.showModal()},children:"Add Recipient"}),a.length>0&&r.jsx("button",{className:"ActionBtn",onClick:()=>{C.current.showModal()},children:"Add from Group"}),A instanceof R?r.jsx("button",{className:"ActionBtn",onClick:()=>{n.current.showModal()},children:"Add from Play"}):null,r.jsx("button",{className:"ActionBtn",onClick:async()=>{if(j.current.value==""){alert("Please enter a message to broadcast");return}if(c.length==0){alert("Please add at least one recipient");return}const s=y.fromBlank(j.current.value,x.uid,x.fullname,x.FCMToken,"",h,"",new Date,[x.uid]);for(let o=0;o<c.length;o++){const f=c[o];s.gcId=f.memberUid,await U(h,f.memberUid,s,f)}b(),d()},children:"Send"}),r.jsx("button",{onClick:d,className:"ActionBtn",children:"Close"})]})}),r.jsx(w,{members:i,dialogRef:m,addedMembers:c,close:()=>{m.current.close()},addUser:s=>{s instanceof B&&(s=k.fromBlank(s.name,s.userId,s.FCMToken));const o=[...c,s],f=[],g=o.filter(I=>f.includes(I.memberUid)?!1:(f.push(I.memberUid),!0));t(g)}}),r.jsx(P,{dialogRef:C,close:()=>{C.current.close()},addMembers:s=>{const o=[...c,...s],f=[],g=o.filter(I=>f.includes(I.memberUid)?!1:(f.push(I.memberUid),!0));t(g),C.current.close()},activityGroups:a}),r.jsx(T,{dialogRef:n,close:()=>{n.current.close()},addMembers:s=>{const o=s.map(v=>k.fromBlank(v.name,v.userId,v.FCMToken)),f=[...c,...o],g=[],I=f.filter(v=>g.includes(v.memberUid)?!1:(g.push(v.memberUid),!0));t(I),n.current.close()},setName:s=>{},activityId:h})]})}E(document.getElementById("root")).render(r.jsx(u.StrictMode,{children:r.jsx(se,{})}));function se(){const[d,p]=u.useState(""),[h,x]=u.useState([]),[b,j]=u.useState("student"),[m,n]=u.useState(null),[C,A]=u.useState([]),[N,i]=u.useState(null),l=u.useRef(null),c=u.useRef(null),t=u.useRef(null);function a(s){A(s),setTimeout(()=>{l.current.scrollTop=l.current.scrollHeight},100)}u.useEffect(()=>{m&&q(m.activityId,m.id,a)},[m]),u.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("activityId");o&&p(o),H(o,x),X().then(g=>{i(g)});const f=localStorage.getItem("accountType");f&&j(f)},[]);async function e(s){if(!N||!m)return;const o=y.fromBlank(s,N.uid,N.fullname,N.FCMToken,m.id,d,"",new Date,[N.uid]);await U(d,m.id,o)}return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"title",children:r.jsx("h1",{children:"Messages"})}),r.jsxs("div",{className:"center",children:[r.jsxs("div",{className:"window",children:[r.jsxs("div",{className:"left",children:[r.jsx("div",{className:"groupChats",children:h.map(s=>r.jsx(Y,{groupChat:s,onClick:()=>{n(s)}}))}),r.jsx("button",{className:"CreateGCBtn",onClick:()=>{c.current.showModal()},children:"Create Group Chat"}),r.jsx("button",{className:"CreateGCBtn",onClick:()=>{t.current.showModal()},children:"Broadcast Message"})]}),r.jsx("div",{className:"right",children:m?r.jsxs("div",{className:"selectedGroupChat",children:[r.jsx("div",{className:"messages",ref:l,children:C.map(s=>r.jsx(Q,{message:s,isSender:s.senderUid==localStorage.getItem("userId")}))}),r.jsx(V,{sendMessage:e})]}):r.jsx("div",{className:"noSelectedGroupChat",children:r.jsx("h1",{children:"No Group Chat Selected"})})})]}),r.jsx("br",{}),r.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Campus.Connect/Activity/?activityId="+d},children:"Back"})]}),r.jsx(W,{dialogRef:c,refresh:()=>{},close:()=>{c.current.close()},activityId:d}),r.jsx(ee,{dialogRef:t,refresh:()=>{},close:()=>{t.current.close()},activityId:d,userData:N})]})}
