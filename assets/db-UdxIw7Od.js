import{K as wt,N as St,O as ct,_ as Dt,H as W,I as Tt,J as Mt,R as Ct,U as Z,a1 as At,a2 as d,a3 as r,a4 as T,y as G,m as k,a5 as U,a6 as y,g as tt,k as L,a7 as S,a8 as D,a9 as M,u as P,o as _,aa as O,t as Q,ab as X,S as et,T as Et,ac as b,ad as bt,ae as $,C as F,e as J,F as ft,E as H,X as kt,z as E,af as it,ag as rt,M as q,B as A,ah as Ut,x as B,ai as x,v as Nt,L as ht}from"./index-AQifkHdA.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="type.googleapis.com/google.protobuf.Int64Value",Rt="type.googleapis.com/google.protobuf.UInt64Value";function gt(t,e){const o={};for(const s in t)t.hasOwnProperty(s)&&(o[s]=e(t[s]));return o}function Y(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>Y(e));if(typeof t=="function"||typeof t=="object")return gt(t,e=>Y(e));throw new Error("Data cannot be encoded in JSON: "+t)}function j(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Ft:case Rt:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>j(e)):typeof t=="function"||typeof t=="object"?gt(t,e=>j(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class R extends Ct{constructor(e,o,s){super(`${ot}/${e}`,o||""),this.details=s}}function Lt(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Pt(t,e){let o=Lt(t),s=o,n;try{const a=e&&e.error;if(a){const f=a.status;if(typeof f=="string"){if(!lt[f])return new R("internal","internal");o=lt[f],s=f}const l=a.message;typeof l=="string"&&(s=l),n=a.details,n!==void 0&&(n=j(n))}}catch{}return o==="ok"?null:new R(o,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||o.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const o=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(e){const o=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(e);return{authToken:o,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z="us-central1";function xt(t){let e=null;return{promise:new Promise((o,s)=>{e=setTimeout(()=>{s(new R("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class Gt{constructor(e,o,s,n,a=z,f){this.app=e,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new Ot(o,s,n),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=z}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${o}.cloudfunctions.net/${e}`}}function _t(t,e,o){t.emulatorOrigin=`http://${e}:${o}`}function Bt(t,e,o){return s=>Jt(t,e,s,{})}async function $t(t,e,o,s){o["Content-Type"]="application/json";let n;try{n=await s(t,{method:"POST",body:JSON.stringify(e),headers:o})}catch{return{status:0,json:null}}let a=null;try{a=await n.json()}catch{}return{status:n.status,json:a}}function Jt(t,e,o,s){const n=t._url(e);return Ht(t,n,o,s)}async function Ht(t,e,o,s){o=Y(o);const n={data:o},a={},f=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);f.authToken&&(a.Authorization="Bearer "+f.authToken),f.messagingToken&&(a["Firebase-Instance-ID-Token"]=f.messagingToken),f.appCheckToken!==null&&(a["X-Firebase-AppCheck"]=f.appCheckToken);const l=s.timeout||7e4,h=xt(l),c=await Promise.race([$t(e,n,a,t.fetchImpl),h.promise,t.cancelAllRequests]);if(h.cancel(),!c)throw new R("cancelled","Firebase Functions instance was deleted.");const u=Pt(c.status,c.json);if(u)throw u;if(!c.json)throw new R("internal","Response is not valid JSON object.");let i=c.json.data;if(typeof i>"u"&&(i=c.json.result),typeof i>"u")throw new R("internal","Response is missing data field.");return{data:j(i)}}const ut="@firebase/functions",dt="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt="auth-internal",Vt="app-check-internal",Kt="messaging-internal";function Qt(t,e){const o=(s,{instanceIdentifier:n})=>{const a=s.getProvider("app").getImmediate(),f=s.getProvider(jt),l=s.getProvider(Kt),h=s.getProvider(Vt);return new Gt(a,f,l,h,n,t)};wt(new St(ot,o,"PUBLIC").setMultipleInstances(!0)),ct(ut,dt,e),ct(ut,dt,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(t=Mt(),e=z){const s=Dt(W(t),ot).getImmediate({identifier:e}),n=Tt("functions");return n&&Xt(s,...n),s}function Xt(t,e,o){_t(W(t),e,o)}function st(t,e,o){return Bt(W(t),e)}Qt(fetch.bind(self));const qt=mt(Z);function N(t,e,o,s){st(qt,"sendEmail")({emails:e.map(n=>n.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:t.message,senderName:t.senderName})}const pt=mt(Z),m=At(Z),nt=d(m,"schools"),Yt=async t=>{const e=r(nt,t);return(await T(e)).data()},te=async()=>{const t=await S(nt),e=[];return t.forEach(o=>{e.push(o.data())}),e},ee=async(t,e,o)=>{const s=r(nt,t);console.log("School ID: "+t),console.log("User ID: "+e),console.log("Account Type: "+o);const n=r(d(s,o+"s"),e);return(await T(n)).exists()},It=async()=>{const t=localStorage.getItem("accountType"),e=localStorage.getItem("schoolId");if(!e)return[];const o=r(m,"schools",e);if(t=="student"){const s=D(d(o,"activities"),M("studentUids","array-contains",P())),n=[];return(await S(s)).forEach(f=>{n.push(k.fromMap(f.data()))}),n}else{const s=D(d(o,"activities"),M("teacherUids","array-contains",P())),n=[];return(await S(s)).forEach(f=>{console.log(f.data()),n.push(k.fromMap(f.data()))}),n}};async function zt(t){const e=localStorage.getItem("schoolId");if(!e)return null;const o=r(m,"schools",e),s=r(d(o,"activities"),t),n=await T(s);return n.exists()?n.data().type=="theater"?G.fromMap(n.data()):k.fromMap(n.data()):null}async function oe(t){const e=localStorage.getItem("schoolId");if(!e)return"";const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=d(s,"shows"),a=await U(n,t.toMap());return t.id=a.id,await y(a,{id:a.id}),a.id}async function se(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=r(d(s,"shows"),t.id);await y(n,t.toMap())}async function ne(t){const e=d(m,"showTemplates"),o=await U(e,t.toMap());return t.id=o.id,await y(o,{id:o.id}),o.id}async function ae(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=r(m,"schools",o),n=r(d(s,"activities"),t),a=r(d(n,"shows"),e),f=await T(a);return f.exists()?(console.log(f.data()),tt.fromMap(f.data())):null}async function ce(t){const e=localStorage.getItem("schoolId");if(!e)return[];console.log("Getting actors for activity "+e);const o=r(m,"schools",e),s=r(d(o,"activities"),t),n=await T(s);if(!n.exists())return[];const a=[];return n.data().students.forEach(f=>{a.push(L.fromMap(f))}),a}async function ie(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e);await O(f,o.toMap())}async function re(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=d(s,"events");console.log("Adding event"),console.log(t.toMap());const a=await U(n,t.toMap());t.id=a.id,await y(a,{id:a.id})}async function le(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=r(m,"schools",o),a=r(d(n,"activities"),t),f=d(a,"events");if(s=="student"){const l=await S(D(f,M("showId","==",e),M("targetUids","array-contains",P()))),h=[];return l.forEach(c=>{c.data().deleted||h.push(_.fromMap(c.data()))}),h}else{const l=await S(D(f,M("showId","==",e))),h=[];return l.forEach(c=>{c.data().deleted||h.push(_.fromMap(c.data()))}),h}}async function ue(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=r(d(s,"events"),t.id);await y(n,{deleted:!0}),await st(pt,"startDeleteActivityEvent")({activityId:t.activityId,eventId:t.id,schoolId:e})}async function vt(t){const e=localStorage.getItem("schoolId");if(!e)return[];const o=r(m,"schools",e),s=r(d(o,"activities"),t),n=d(s,"shows"),a=await S(n),f=[];return a.forEach(l=>{f.push(tt.fromMap(l.data()))}),f}async function de(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e);await y(f,{conflictForm:o.toMap()}),await st(pt,"addConflictFormDeadline")({activityId:t,showId:e,schoolId:s,deadline:o.deadline.toISOString()})}async function fe(){const t=P(),e=localStorage.getItem("schoolId");if(!e)return null;const o=r(m,"schools",e),s=r(o,"students",t),n=await T(s);return n.exists()?L.fromMap(n.data()):null}async function he(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e),l=r(f,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await O(l,o.toMap())}async function ge(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=r(m,"schools",o),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e),l=d(f,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(P());const u=await S(D(l,M("submitterId","==",P()))),i=[];return u.forEach(g=>{i.push(Q.fromMap(g.data()))}),i}const h=await S(l),c=[];return h.forEach(u=>{c.push(Q.fromMap(u.data()))}),c}async function me(){const t=d(m,"showTemplates"),e=await S(t),o=[];return e.forEach(s=>{o.push(tt.fromMap(s.data()))}),o}async function pe(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+e+" UID: "+o+" AT: "+s),!e||!o||!s)return null;const n=r(m,"schools",e),a=D(d(n,"activities"),M("joinCode","==",t)),f=await S(a);if(f.empty)return null;const l=f.docs[0],h=r(d(n,s=="student"?"students":"teachers"),o),c=await T(h);if(console.log(c.data()),!c.exists())return null;if(l.data().studentUids.includes(o)||l.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),l.data().type=="theater"){if((c.data().gender==null||c.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),c.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(c.data().phoneNumber==""||c.data().gender==null||c.data().gender=="")&&s=="student")return null;if(s=="student")return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,L.fromMap(c.data()).toMap()]}),G.fromMap(l.data());{console.log("Joining as teacher"),console.log(c.data());const u=$.fromBlank(c.data().fullname,c.data().email,c.data().phoneNumber,c.data().uid,c.data().FCMToken);return console.log(u.toMap()),await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,u.toMap()]}),G.fromMap(l.data())}}else if(s=="student"){const u=L.fromBlank(c.data().fullname,c.data().gender,c.data().email,c.data().phoneNumber,c.data().uid,c.data().FCMToken);return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,u.toMap()]}),k.fromMap(l.data())}else{const u=$.fromBlank(c.data().fullname,c.data().email,c.data().phoneNumber,c.data().uid,c.data().FCMToken);return await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,u.toMap()]}),k.fromMap(l.data())}}async function Ie(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=r(m,"schools",e),a=r(d(n,s=="student"?"students":"teachers"),o);await y(a,{gender:t})}async function ve(t){const e=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!e||!o||!s)return;const n=r(m,"schools",e),a=r(d(n,s=="student"?"students":"teachers"),o);await y(a,{phoneNumber:t})}async function ye(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=r(d(s,"events"),t.id);await y(n,t.toMap())}async function we(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return[];const s=r(m,"schools",t),n=[];let a;o=="student"?a=await S(D(d(s,"activities"),M("studentUids","array-contains",e))):a=await S(D(d(s,"activities"),M("teacherUids","array-contains",e))),console.log(a);for(const f of a.docs){let l;o=="student"?l=await S(D(d(f.ref,"events"),M("targetUids","array-contains",e))):l=await S(d(f.ref,"events"));for(const h of l.docs){const c=h.data();console.log(c),c.type=="activity-theater-event"?n.push(_.fromMap(c)):n.push(kt.fromMap(c))}}return n}async function Se(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const n=r(m,"schools",o),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e),l=d(f,"conflictResponses"),h=await T(r(l,s));return h.exists()?Q.fromMap(h.data()):null}async function De(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=r(d(s,"activities"),t);await y(n,{rehearsalLocations:e.map(a=>a.toMap())})}async function Te(t,e){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const n=localStorage.getItem("accountType"),a=r(m,"schools",o),f=r(d(a,"activities"),t);if(n=="teacher")X(d(f,"groupChats"),async l=>{const h=[];for(const c of l.docs){const u=E.fromMap(c.data());if((u.generalTarget=="direct"||u.generalTarget=="custom")&&!u.members.find(v=>v.userId==s))continue;if(u.generalTarget=="direct"){const v=u.members.find(I=>I.userId!=s);u.name=(v==null?void 0:v.name)||"Unknown"}const i=d(c.ref,"messages"),g=D(i,rt("timeSent","desc"),it(1)),p=await S(g);p.empty||(u.lastMessage=q.fromMap(p.docs[0].data())),h.push(u)}h.sort((c,u)=>c.lastMessage?u.lastMessage?u.lastMessage.timeSent.getTime()-c.lastMessage.timeSent.getTime():-1:1),e(h)});else{const l=r(d(a,"students"),s),h=await T(l);if(!h.exists())return;const c=et.fromMap(h.data());console.log(c),X(d(f,"groupChats"),async u=>{const i=[];for(const g of u.docs){const p=E.fromMap(g.data());if(!(p.generalTarget=="everyone"||p.generalTarget=="students")&&(p.generalTarget=="parents"||!p.members.find(C=>C.userId==s)))continue;if(p.generalTarget=="direct"){const C=p.members.find(V=>V.userId!=s);p.name=(C==null?void 0:C.name)||"Unknown"}const v=d(g.ref,"messages"),I=D(v,rt("timeSent","desc"),it(1)),w=await S(I);w.empty||(p.lastMessage=q.fromMap(w.docs[0].data())),i.push(p)}i.sort((g,p)=>g.lastMessage?p.lastMessage?p.lastMessage.timeSent.getTime()-g.lastMessage.timeSent.getTime():-1:1),e(i)})}}async function Me(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return[];const n=r(m,"schools",s),a=r(d(n,"activities"),t);console.log("Getting messages for "+e);const f=r(d(a,"groupChats"),e),l=d(f,"messages");X(l,h=>{const c=[];h.forEach(u=>{c.push(q.fromMap(u.data()))}),c.sort((u,i)=>u.timeSent.getTime()-i.timeSent.getTime()),o(c)})}async function at(){const t=localStorage.getItem("schoolId"),e=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!t||!e)return null;const s=r(m,"schools",t),n=r(d(s,o=="student"?"students":"teachers"),e),a=await T(n);return a.exists()?o=="student"?et.fromMap(a.data()):Et.fromMap(a.data()):null}async function Ce(t,e,o,s,n){if(o.message=="")return;const a=localStorage.getItem("schoolId"),f=localStorage.getItem("userId");if(!a||!f)return;const l=r(m,"schools",a),h=r(d(l,"activities"),t),c=r(d(h,"groupChats"),e),u=await T(c);if(!u.exists()){if(n==null)return;const v=await at();if(!v)return;const I=E.fromBlank("",n.userId,[A.fromBlank(v.fullname,v.email,v.phoneNumber,v.FCMToken,v.uid),n],"direct",t,Date.now());await O(c,I.toMap());const w=d(c,"messages"),C=await U(w,o.toMap());o.messageId=C.id,await y(C,{messageId:C.id}),N(o,[A.fromMap(n)],I,s);return}const i=E.fromMap(u.data()),g=d(c,"messages"),p=await U(g,o.toMap());if(o.messageId=p.id,await y(p,{messageId:p.id}),i.generalTarget!="direct"&&i.generalTarget!="custom"&&i.generalTarget!="group"){const v=await zt(t);if(!v)return;if(i.generalTarget=="everyone"){let I=v.students.map(w=>A.fromMap(w));I=I.concat(v.teachers.map(w=>A.fromMap(w))),I=I.concat(v.parents.map(w=>A.fromMap(w))),I=I.filter(w=>w.userId!=o.senderUid),N(o,I,i,v.name)}else if(i.generalTarget=="students"){let I=v.students.map(w=>A.fromMap(w));I=I.filter(w=>w.userId!=o.senderUid),N(o,I,i,v.name)}else if(i.generalTarget=="parents"){let I=v.parents.map(w=>A.fromMap(w));I=I.filter(w=>w.userId!=o.senderUid),N(o,I,i,v.name)}return}if(i.generalTarget=="direct"){const v=i.members.find(I=>I.userId!=f);if(!v)return;N(o,[v],i,s);return}if(i.generalTarget=="custom"){N(o,i.members.filter(v=>v.userId!=f),i,s);return}}async function K(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=d(s,"groupChats"),a=await at();if(!a)return;const f=A.fromBlank(a.fullname,a.email,a.phoneNumber,a.FCMToken,a.uid);t.members.push(f);const l=await U(n,t.toMap());t.id=l.id,await y(l,{id:l.id})}async function Ae(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e);y(f,{resources:b(o.toMap())})}async function Ee(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e);y(f,{resources:Ut(o.toMap())})}async function be(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=r(m,"schools",s),a=r(d(n,"activities"),t),f=r(d(a,"shows"),e),l=d(f,"conflictResponses"),h=r(l,o.id);await bt(h)}async function ke(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=d(s,t+"s");await O(r(n,e.uid),e.toMap());let a;e instanceof et?a=L.fromBlank(e.fullname,e.gender,e.email,e.phoneNumber,e.FCMToken,e.uid):a=$.fromBlank(e.fullname,e.email,e.phoneNumber,e.FCMToken,e.uid),await y(s,{[t+"Uids"]:b(e.uid),[t+"s"]:b(a.toMap())})}function Wt(t){const e=new Date,o=e.getTime().toString();return`${t.charCodeAt(0)}${e.getDate()}${o.slice(-2)}`}async function Ue(t,e){const o=localStorage.getItem("schoolId");if(!o)return null;const s=r(m,"schools",o),n=await T(s);if(!n.exists())return null;const a=n.data(),f=d(s,"activities"),l=Wt(t),h=[B.fromMap({name:"Rehearsal",color:x("#FF0000")}),B.fromMap({name:"Performance",color:x("#00FF00")})],c=[B.fromMap({name:"Practice",color:x("#FF0000")}),B.fromMap({name:"Game",color:x("#00FF00")})],u=[Nt.fromMap({name:"Auditorium",color:x("#0000FF")})],i=ht.fromMap(a.location),g=[i],p=await at();if(!p)return null;const v=$.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid);let I;e=="theater"?I=G.fromBlank(t,"",l,[],[],[],[v],g,h,i,u,"type",Date.now()):I=k.fromBlank(t,"",l,[],[],[],[v],g,c,i,"type",Date.now(),"activity");const w=await U(f,I.toMap());I.id=w.id,await y(w,{id:w.id});const C=E.fromMap({name:"Everyone",members:[],id:"",activityId:I.id,lastUpdated:Date.now(),generalTarget:"everyone"});await K(C);const V=E.fromMap({name:"Parents",members:[],id:"",activityId:I.id,lastUpdated:Date.now(),generalTarget:"parents"});await K(V);const yt=E.fromMap({name:"Students",members:[],id:"",activityId:I.id,lastUpdated:Date.now(),generalTarget:"students"});return await K(yt),I}async function Ne(t,e,o){const s=localStorage.getItem("schoolId");if(!s)return null;const n=r(m,"schools",s),a=r(d(n,"activities"),o),f=d(a,"groupChats"),l=E.fromBlank("",e.userId,[t,e],"direct",o,Date.now());return await O(r(f,e.userId),l.toMap()),l.name=e.name,l}async function Fe(){const t=await Yt(localStorage.getItem("schoolId")||"");if(!t)return[];const e=[];return t.savedLocations.forEach(o=>{e.push(ht.fromMap(o))}),e}async function Re(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=r(d(s,"activities"),t);await y(n,{locations:b(e.toMap())})}async function Le(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e);await y(o,{savedLocations:b(t.toMap())})}async function Pe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=r(d(s,"activities"),t);await y(n,{eventTypes:b(e.toMap())})}async function Oe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=r(d(s,"activities"),t),a=r(d(n,"shows"),e);await y(a,{isCreatingSchedule:!0})}async function xe(t,e){const o=localStorage.getItem("schoolId");if(!o)return;const s=r(m,"schools",o),n=d(s,"students");await O(r(n,t.uid),t.toMap());const a=L.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid);await y(s,{studentUids:b(t.uid),students:b(a.toMap())});const f=a.userId;if(!o||!f)return null;const l=r(d(s,"activities"),e),h=await T(l);return h.exists()?h.data().type=="theater"?(await y(h.ref,{studentUids:[...h.data().studentUids,f],students:[...h.data().students,a.toMap()]}),G.fromMap(h.data())):(await y(h.ref,{studentUids:[...h.data().studentUids,f],students:[...h.data().students,a.toMap()]}),k.fromMap(h.data())):null}async function Ge(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=D(d(s,"events"),M("showId","==",t.id)),a=await S(n);for(const f of a.docs){const l=_.fromMap(f.data());for(let c=0;c<l.characters.length;c++){const u=l.characters[c];u instanceof F?l.characters[c]=t.characters.find(i=>i.name==u.name):u instanceof J&&(l.characters[c]=t.showGroups.find(i=>i.name==u.name))}const h=[];for(const c of l.characters){if(c instanceof ft){for(const u of t.ensemble.actors)h.push(u);for(const u of t.characters)h.find(i=>i.userId==u.actor.userId)==null&&h.push(u.actor);break}if(c instanceof F){if(h.find(u=>u.userId==c.actor.userId)!=null)continue;h.push(c.actor)}if(c instanceof H){if(c.includeAll)for(const u of t.ensemble.actors)h.find(i=>i.userId==u.userId)==null&&h.push(u);else if(c.includeMale){for(const u of t.ensemble.actors)if(u.gender=="male"){if(h.find(i=>i.userId==u.userId)!=null)continue;h.push(u)}}else if(c.includeFemale){for(const u of t.ensemble.actors)if(u.gender=="female"){if(h.find(i=>i.userId==u.userId)!=null)continue;h.push(u)}}else if(c.includeCustom)for(const u of c.customActors)h.find(i=>i.userId==u.userId)==null&&h.push(u)}if(c instanceof J)for(const u of c.characters){if(u instanceof F){if(h.find(i=>i.userId==u.actor.userId)!=null)continue;h.push(u.actor)}if(u instanceof H){if(u.includeAll)for(const i of t.ensemble.actors)h.find(g=>g.userId==i.userId)==null&&h.push(i);else if(u.includeMale){for(const i of t.ensemble.actors)if(i.gender=="male"){if(h.find(g=>g.userId==i.userId)!=null)continue;h.push(i)}}else if(u.includeFemale){for(const i of t.ensemble.actors)if(i.gender=="female"){if(h.find(g=>g.userId==i.userId)!=null)continue;h.push(i)}}else if(u.includeCustom)for(const i of u.customActors)h.find(g=>g.userId==i.userId)==null&&h.push(i)}}}l.targets=h,l.lastUpdated=Date.now(),await y(f.ref,l.toMap())}}async function _e(t){const e=localStorage.getItem("schoolId");if(!e)return;const o=r(m,"schools",e),s=r(d(o,"activities"),t.activityId),n=D(d(s,"events"),M("showId","==",t.id)),a=await S(n);for(const f of a.docs){const l=_.fromMap(f.data()),h=[];for(let u=0;u<l.characters.length;u++){const i=l.characters[u];if(i instanceof F){const g=t.characters.find(p=>p.characterId==i.characterId);g&&h.push(g)}else if(i instanceof J){const g=t.showGroups.find(p=>p.showGroupId==i.showGroupId);g&&h.push(g)}l.characters=h}const c=[];for(const u of h){if(u instanceof ft){for(const i of t.ensemble.actors)c.push(i);for(const i of t.characters)c.find(g=>g.userId==i.actor.userId)==null&&c.push(i.actor);break}if(u instanceof F){if(c.find(i=>i.userId==u.actor.userId)!=null)continue;c.push(u.actor)}if(u instanceof H){if(u.includeAll)for(const i of t.ensemble.actors)c.find(g=>g.userId==i.userId)==null&&c.push(i);else if(u.includeMale){for(const i of t.ensemble.actors)if(i.gender=="male"){if(c.find(g=>g.userId==i.userId)!=null)continue;c.push(i)}}else if(u.includeFemale){for(const i of t.ensemble.actors)if(i.gender=="female"){if(c.find(g=>g.userId==i.userId)!=null)continue;c.push(i)}}else if(u.includeCustom)for(const i of u.customActors)c.find(g=>g.userId==i.userId)==null&&c.push(i)}if(u instanceof J)for(const i of u.characters){if(i instanceof F){if(c.find(g=>g.userId==i.actor.userId)!=null)continue;c.push(i.actor)}if(i instanceof H){if(i.includeAll)for(const g of t.ensemble.actors)c.find(p=>p.userId==g.userId)==null&&c.push(g);else if(i.includeMale){for(const g of t.ensemble.actors)if(g.gender=="male"){if(c.find(p=>p.userId==g.userId)!=null)continue;c.push(g)}}else if(i.includeFemale){for(const g of t.ensemble.actors)if(g.gender=="female"){if(c.find(p=>p.userId==g.userId)!=null)continue;c.push(g)}}else if(i.includeCustom)for(const g of i.customActors)c.find(p=>p.userId==g.userId)==null&&c.push(g)}}}l.targets=c,l.lastUpdated=Date.now(),await y(f.ref,l.toMap())}}async function Be(){if(!localStorage.getItem("schoolId"))return[];const e=await It(),o=[];for(const s of e)if(console.log("Getting resources for "+s.name),s.type=="theater"){const n=await vt(s.id);for(const a of n)console.log("Getting resources for "+a.name),o.push(...a.resources)}return o}async function $e(){if(!localStorage.getItem("schoolId"))return[];const e=await It(),o=[];for(const s of e)if(console.log("Getting resources for "+s.name),s.type=="theater"){const n=await vt(s.id);for(const a of n)a.activityName=s.name,o.push(a)}return o}export{de as A,be as B,fe as C,he as D,we as E,Se as F,De as G,Re as H,Le as I,Pe as J,Fe as K,K as L,Ce as M,Me as N,Te as O,Ne as P,Ae as Q,Ee as R,xe as S,Be as T,$e as U,ee as a,te as b,ke as c,Ie as d,Ue as e,It as f,at as g,zt as h,vt as i,pe as j,me as k,oe as l,ne as m,se as n,_e as o,ae as p,ce as q,Ge as r,Oe as s,ie as t,ve as u,ge as v,le as w,ue as x,ye as y,re as z};
