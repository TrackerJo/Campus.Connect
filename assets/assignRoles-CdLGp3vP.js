import{j as c,c as H,r as f,i as W}from"./index-BrX1-YwQ.js";import{E as T,f as J,C as m,b,e as q}from"./constants-BNam4_mG.js";import{C as z,S as K}from"./Show_Group_Tile-RepVlWUJ.js";import{n as Q,m as V,o as X,p as Y}from"./db-mkYCc2gH.js";import{T as Z}from"./trash-BnpXJPEK.js";import{A as _}from"./Ensemble_Section_Tile-BTh7CyzS.js";function $({actor:u,canDelete:C,onDelete:g}){return c.jsx("div",{className:"ActorTile",id:"actor-tile-"+u.userId,children:c.jsxs("div",{className:"header",children:[c.jsx("div",{className:"ActorNameDiv",children:c.jsxs("label",{htmlFor:"Actor",children:["Actor: ",u.name]})}),C&&c.jsx("div",{className:"ActorTrashDiv",children:c.jsx("img",{src:Z,alt:"",className:"TrashIcon",onClick:()=>{g()}})})]})})}H(document.getElementById("root")).render(c.jsx(f.StrictMode,{children:c.jsx(ee,{})}));function ee(){const[u,C]=f.useState(""),[g,k]=f.useState(""),[n,y]=f.useState(),[d,j]=f.useState([]),[w,v]=f.useState([]),[D,A]=f.useState(!1),[x,B]=f.useState([]),[p,G]=f.useState([]),[L,I]=f.useState(!1),N=f.useRef(null),[P,U]=f.useState(!1),[F,E]=f.useState(!0);async function M(){let l=!0;if(A(!0),!n){A(!1);return}for(let s=0;s<n.characters.length;s++){const t=n.characters[s],e=d.find(a=>a.name==t.name);e&&(console.log("New Character"),console.log(e),n.characters[s]=e,e.actor==null&&(console.log("Actor is null"),l=!1))}for(let s=0;s<n.showGroups.length;s++){console.log("UPDATING SHOW GROUPS");const t=n.showGroups[s];console.log("Show Group: "+t.name);const e=w.find(a=>a.name==t.name);if(console.log("New Show Group: "+(e==null?void 0:e.name)),e){t.characters=e.characters;for(let a=0;a<t.characters.length;a++){const r=t.characters[a];if(r instanceof m){const o=d.find(i=>i.name==r.name);o&&(t.characters[a]=o,o.actor==null&&(l=!1))}}}}for(let s=0;s<n.layout.length;s++){const t=n.layout[s];for(let e=0;e<t.scenes.length;e++){const a=t.scenes[e];for(let r=0;r<a.characters.length;r++){const o=a.characters[r];if(o instanceof m){const i=d.find(h=>h.name==o.name);i&&(a.characters[r]=i)}else if(o instanceof b){const i=w.find(h=>h.name==o.name);if(i){for(let h=0;h<i.characters.length;h++){const S=i.characters[h];if(S instanceof m){const R=d.find(O=>O.name==S.name);R&&(i.characters[h]=R)}}a.characters[r]=i}}}}}for(let s=0;s<n.songs.length;s++){const t=n.songs[s];console.log("Assigning roles to song"),console.log(t);for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(console.log("Character"),console.log(a),console.log(typeof a),a instanceof m){const r=d.find(o=>o.name==a.name);r&&(t.characters[e]=r)}else if(a instanceof b){const r=w.find(o=>o.name==a.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof m){const h=d.find(S=>S.name==i.name);h&&(r.characters[o]=h)}}t.characters[e]=r}}console.log("New Character"),console.log(t.characters[e]),console.log(typeof t.characters[e])}}for(let s=0;s<n.dances.length;s++){const t=n.dances[s];for(let e=0;e<t.characters.length;e++){const a=t.characters[e];if(a instanceof m){const r=d.find(o=>o.name==a.name);r&&(t.characters[e]=r)}else if(a instanceof b){const r=w.find(o=>o.name==a.name);if(r){for(let o=0;o<r.characters.length;o++){const i=r.characters[o];if(i instanceof m){const h=d.find(S=>S.name==i.name);h&&(r.characters[o]=h)}}t.characters[e]=r}}}}if(n.canCreateSchedule=l,n.ensemble=q.fromBlank(p,Date.now()),n.isCreatingSchedule){if(!l){alert("Cannot update show because not all characters have been assigned actors"),A(!1);return}await X(n)}y(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+g,JSON.stringify(n)),await Y(u,g,n),A(!1)}return f.useEffect(()=>{W(()=>{}),I(!0);const l=new URLSearchParams(window.location.search),s=l.get("activityId");s&&(C(s),Q(s).then(e=>{B(e),console.log(e),I(!1)}));const t=l.get("showId");t&&k(t),E(!0),V(s,t).then(e=>{if(e==null){window.location.href="/Activity/Shows/Show/?activityId="+s;return}y(e),console.log(e),j(e.characters),v(e.showGroups);const a=e.showGroups;let r=!1;for(let o=0;o<a.length;o++)a[o].characters.map(h=>h instanceof T).includes(!0)&&(r=!0);U(r),e!=null&&e.hasEnsemble&&G(e.ensemble.actors),E(!1)})},[]),c.jsxs(c.Fragment,{children:[" ",F?c.jsx("div",{className:"centerLoader",children:c.jsx("div",{className:"loader"})}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"title",children:c.jsx("h1",{children:"Assign Roles"})}),c.jsxs("div",{className:"center",children:[c.jsx("h2",{children:"Assign Characters"}),c.jsx("div",{className:"characters",id:"create-characters",children:d.map((l,s)=>c.jsx(z,{character:l,actors:x,characters:[],isAssign:!0,setCharacter:t=>{j(e=>{const a=[...e];return a[s]=t,a})},removeCharacter:()=>{j(d.filter((t,e)=>e!==s))},isCreate:!1},s))}),P&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Show Groups"}),c.jsx("div",{className:"showGroups",id:"create-showGroups",children:w.map((l,s)=>l.characters.map(t=>t instanceof T).includes(!0)?c.jsx(K,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:d,actors:x,isAssign:!0,setShowGroup:t=>{v(e=>{const a=[...e];a[s]=t,console.log("NEW SHOW GROUPS");for(let r=0;r<a.length;r++){const o=a[r];console.log(o.toMap())}return a})},removeShowGroup:()=>{v(w.filter((t,e)=>e!==s))},isCreate:!1},s):null)})]}),(n==null?void 0:n.hasEnsemble)&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Ensemble"}),c.jsx("div",{className:"ensemble",id:"create-ensemble",children:p.map((l,s)=>(console.log(l),c.jsx($,{actor:l,canDelete:!0,onDelete:()=>{G(p.filter((t,e)=>e!==s))}},s)))}),c.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=N.current)==null||l.showModal()},children:"Add Actor"})]}),D?c.jsx("div",{className:"loader"}):c.jsx("button",{className:"ActionBtn",onClick:async()=>{await M(),window.location.href="/Activity/Shows/Show/?activityId="+u+"&showId="+g},children:"Save"}),c.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+u+"&showId="+g},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!L&&c.jsx(_,{dialogRef:N,keepPastResult:!1,actor:new J,addedActors:p,actors:x,setActor:l=>{const s=[...p];s.push(l),console.log("Setting actors"),G(s)},close:()=>{var l;(l=N.current)==null||l.close()}})]})]})}
