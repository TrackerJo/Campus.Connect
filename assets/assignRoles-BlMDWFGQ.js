import{j as c,c as H,r as f,i as J}from"./index-C75OlIaX.js";import{d as W,E as T,f as q,C as u,b,e as z}from"./constants-DuVVuktt.js";import{C as K,S as Q}from"./Show_Group_Tile-B22h9-2u.js";import{o as V,p as X,q as Y}from"./db-DdwSPomz.js";import{T as Z}from"./trash-BnpXJPEK.js";import{A as _}from"./Ensemble_Section_Tile-DblsEPLE.js";function $({actor:g,canDelete:C,onDelete:w}){return c.jsx("div",{className:"ActorTile",id:"actor-tile-"+g.userId,children:c.jsxs("div",{className:"header",children:[c.jsx("div",{className:"ActorNameDiv",children:c.jsxs("label",{htmlFor:"Actor",children:["Actor: ",g.name]})}),C&&c.jsx("div",{className:"ActorTrashDiv",children:c.jsx("img",{src:Z,alt:"",className:"TrashIcon",onClick:()=>{w()}})})]})})}H(document.getElementById("root")).render(c.jsx(f.StrictMode,{children:c.jsx(ee,{})}));function ee(){const[g,C]=f.useState(""),[w,k]=f.useState(""),[n,I]=f.useState(),[d,j]=f.useState([]),[S,v]=f.useState([]),[D,A]=f.useState(!1),[x,O]=f.useState([]),[p,G]=f.useState([]),[B,y]=f.useState(!1),N=f.useRef(null),[L,M]=f.useState(!1),[P,E]=f.useState(!0);async function U(){let l=!0;if(A(!0),!n){A(!1);return}for(let t=0;t<n.characters.length;t++){const a=n.characters[t],s=d.find(e=>e.name==a.name);s&&(console.log("New Character"),console.log(s),n.characters[t]=s,s.actor==null&&(console.log("Actor is null"),l=!1))}for(let t=0;t<n.showGroups.length;t++){console.log("UPDATING SHOW GROUPS");const a=n.showGroups[t];console.log("Show Group: "+a.name);const s=S.find(e=>e.name==a.name);if(console.log("New Show Group: "+(s==null?void 0:s.name)),s){a.characters=s.characters;for(let e=0;e<a.characters.length;e++){const o=a.characters[e];if(o instanceof u){const r=d.find(i=>i.name==o.name);r&&(a.characters[e]=r,r.actor==null&&(l=!1))}}}}for(let t=0;t<n.layout.length;t++){const a=n.layout[t];for(let s=0;s<a.scenes.length;s++){const e=a.scenes[s];for(let o=0;o<e.characters.length;o++){const r=e.characters[o];if(r instanceof u){const i=d.find(h=>h.name==r.name);i&&(e.characters[o]=i)}else if(r instanceof b){const i=S.find(h=>h.name==r.name);if(i){for(let h=0;h<i.characters.length;h++){const m=i.characters[h];if(m instanceof u){const R=d.find(F=>F.name==m.name);R&&(i.characters[h]=R)}}e.characters[o]=i}}}}}for(let t=0;t<n.songs.length;t++){const a=n.songs[t];console.log("Assigning roles to song"),console.log(a);for(let s=0;s<a.characters.length;s++){const e=a.characters[s];if(console.log("Character"),console.log(e),console.log(typeof e),e instanceof u){const o=d.find(r=>r.name==e.name);o&&(a.characters[s]=o)}else if(e instanceof b){const o=S.find(r=>r.name==e.name);if(o){for(let r=0;r<o.characters.length;r++){const i=o.characters[r];if(i instanceof u){const h=d.find(m=>m.name==i.name);h&&(o.characters[r]=h)}}a.characters[s]=o}}console.log("New Character"),console.log(a.characters[s]),console.log(typeof a.characters[s])}}for(let t=0;t<n.dances.length;t++){const a=n.dances[t];for(let s=0;s<a.characters.length;s++){const e=a.characters[s];if(e instanceof u){const o=d.find(r=>r.name==e.name);o&&(a.characters[s]=o)}else if(e instanceof b){const o=S.find(r=>r.name==e.name);if(o){for(let r=0;r<o.characters.length;r++){const i=o.characters[r];if(i instanceof u){const h=d.find(m=>m.name==i.name);h&&(o.characters[r]=h)}}a.characters[s]=o}}}}if(n.canCreateSchedule=l,n.ensemble=z.fromBlank(p,Date.now()),n.isCreatingSchedule){if(!l){alert("Cannot update show because not all characters have been assigned actors"),A(!1);return}await X(n)}I(n),console.log(n.toMap()),console.log("Can create schedule"),console.log(l),localStorage.setItem("show-"+w,JSON.stringify(n)),await Y(g,w,n),A(!1)}return f.useEffect(()=>{J(()=>{}),y(!0);const l=new URLSearchParams(window.location.search),t=l.get("activityId");t&&(C(t),V(t).then(e=>{O(e),console.log(e),y(!1)}));const a=l.get("showId");a&&k(a);const s=localStorage.getItem("show-"+a);if(s){const e=W.fromMap(JSON.parse(s));if(E(!0),e==null){window.location.href="/Activity/Shows/Show/?activityId="+t;return}I(e),console.log(e),j(e.characters),v(e.showGroups);const o=e.showGroups;let r=!1;for(let i=0;i<o.length;i++)o[i].characters.map(m=>m instanceof T).includes(!0)&&(r=!0);M(r),e!=null&&e.hasEnsemble&&G(e.ensemble.actors),E(!1)}},[]),c.jsxs(c.Fragment,{children:[" ",P?c.jsx("div",{className:"centerLoader",children:c.jsx("div",{className:"loader"})}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"title",children:c.jsx("h1",{children:"Assign Roles"})}),c.jsxs("div",{className:"center",children:[c.jsx("h2",{children:"Assign Characters"}),c.jsx("div",{className:"characters",id:"create-characters",children:d.map((l,t)=>c.jsx(K,{character:l,actors:x,characters:[],isAssign:!0,setCharacter:a=>{j(s=>{const e=[...s];return e[t]=a,e})},removeCharacter:()=>{j(d.filter((a,s)=>s!==t))},isCreate:!1},t))}),L&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Show Groups"}),c.jsx("div",{className:"showGroups",id:"create-showGroups",children:S.map((l,t)=>l.characters.map(a=>a instanceof T).includes(!0)?c.jsx(Q,{showGroup:l,showGroups:[],hasEnsemble:!1,characters:d,actors:x,isAssign:!0,setShowGroup:a=>{v(s=>{const e=[...s];e[t]=a,console.log("NEW SHOW GROUPS");for(let o=0;o<e.length;o++){const r=e[o];console.log(r.toMap())}return e})},removeShowGroup:()=>{v(S.filter((a,s)=>s!==t))},isCreate:!1},t):null)})]}),(n==null?void 0:n.hasEnsemble)&&c.jsxs(c.Fragment,{children:[c.jsx("h2",{children:"Assign Ensemble"}),c.jsx("div",{className:"ensemble",id:"create-ensemble",children:p.map((l,t)=>(console.log(l),c.jsx($,{actor:l,canDelete:!0,onDelete:()=>{G(p.filter((a,s)=>s!==t))}},t)))}),c.jsx("button",{className:"ActionBtn",onClick:()=>{var l;(l=N.current)==null||l.showModal()},children:"Add Actor"})]}),D?c.jsx("div",{className:"loader"}):c.jsx("button",{className:"ActionBtn",onClick:async()=>{await U(),window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Save"}),c.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/Shows/Show/?activityId="+g+"&showId="+w},children:"Back"})]}),(n==null?void 0:n.hasEnsemble)&&!B&&c.jsx(_,{dialogRef:N,keepPastResult:!1,actor:new q,addedActors:p,actors:x,setActor:l=>{const t=[...p];t.push(l),console.log("Setting actors"),G(t)},close:()=>{var l;(l=N.current)==null||l.close()}})]})]})}
