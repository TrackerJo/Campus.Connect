import{r as i,j as e,c as re,i as de}from"./index-U3pxML4x.js";import{J as X,O as $,B as h,H as l,C as ce,I as ue,K as Q,k as me}from"./constants-Cyoi8QJQ.js";import{aa as _,G as he,ab as xe,ac as fe,ad as je,ae as pe,af as ge,ag as ve}from"./db-B1Sht4uu.js";import{g as U}from"./distance-DNOHIura.js";function ye({close:c,dialogRef:a,confirmed:o}){const[m,w]=i.useState(!1);return e.jsx("dialog",{ref:a,children:e.jsxs("div",{className:"ConfirmApplyDialog",children:[e.jsx("h2",{children:"Did you apply?"}),e.jsx("br",{}),m?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{w(!0),await o(),w(!1)},children:"Yes"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{c()},children:"No"})]})})}function be({opportunity:c,accountType:a,studentData:o,onEdit:m,onRemove:w,onApply:V,onRSVP:C}){const x=i.useRef(null),[f,S]=i.useState(!1),[r,g]=i.useState(!1);function k(n,u,N){const I=new Intl.DateTimeFormat("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),j=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),D=I.format(n),v=j.format(u),L=j.format(N);return`On ${D} from ${v} to ${L}`}function F(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Job"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsxs("label",{htmlFor:"",children:["$",n.hourlyRate.toFixed(2)," per hour"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==h.Weekdays?"Weekdays":n.shiftType==h.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{var u;window.open(n.applicationLink,"_blank"),(u=x.current)==null||u.showModal()},children:"Apply"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function T(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"One Time Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:k(n.eventDate.date,n.eventDate.from,n.eventDate.to)}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&r?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var u;if(n.applicationLink===""){g(!0),await C(),g(!1);return}window.open(n.applicationLink,"_blank"),(u=x.current)==null||u.showModal()},children:"RSVP"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}function W(n){return e.jsxs("div",{className:"opportunity-tile",children:[e.jsx("h3",{children:n.position}),e.jsx("label",{htmlFor:"",children:"Recurring Volunteer"}),e.jsx("div",{className:"divider"}),a==="student"&&e.jsxs("label",{children:[n.companyName," • ",U(n.location.location.latitude,n.location.location.longitude,o.homeLocation.location.latitude,o.homeLocation.location.longitude).toFixed(2)," miles away"]}),e.jsx("label",{htmlFor:"",children:n.shiftType==h.Weekdays?"Weekdays":n.shiftType==h.Weekends?"Weekends":"Weekdays and Weekends"}),e.jsx("br",{}),a==="student"&&e.jsx("label",{children:"Description: "}),a==="student"&&e.jsx("label",{children:n.description}),a==="student"&&e.jsx("br",{}),a==="student"&&r?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{var u;if(n.applicationLink===""){g(!0),await C(),g(!1);return}window.open(n.applicationLink,"_blank"),(u=x.current)==null||u.showModal()},children:"RSVP"}),a==="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{m()},children:"Edit"}),a==="employer"?f?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{S(!0),await w(),S(!1)},children:"Remove"}):e.jsx(e.Fragment,{})]})}return e.jsxs(e.Fragment,{children:[c instanceof X?F(c):c instanceof $?T(c):W(c),a==="student"&&e.jsx(ye,{dialogRef:x,close:()=>{var n;(n=x.current)==null||n.close()},confirmed:async()=>{var n;c.applicants.push(o.toActivityMember()),c.lastUpdated=Date.now(),await _(c,!0),(n=x.current)==null||n.close(),V()}})]})}re(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(we,{})}));function we(){const[c,a]=i.useState("student"),[o,m]=i.useState([]),[w,V]=i.useState(!0),[C,x]=i.useState(!1),[f,S]=i.useState(null),[r,g]=i.useState(l.Job),[k,F]=i.useState(h.Weekdays),[T,W]=i.useState(0),[n,u]=i.useState(""),[N,I]=i.useState(""),[j,D]=i.useState(),[v,L]=i.useState(),[B,J]=i.useState(),[O,P]=i.useState(),[Z,M]=i.useState(""),[ee,H]=i.useState(""),[G,te]=i.useState([]),[R,K]=i.useState(""),[se,Y]=i.useState(!1),[y,q]=i.useState(null),[A,z]=i.useState(!1),[E,ne]=i.useState(void 0);i.useEffect(()=>{de(()=>{}),new URLSearchParams(window.location.search);const t=localStorage.getItem("accountType");t&&a(t),t=="student"?he().then(s=>{const d=s;ne(s),xe().then(b=>{m(b.filter(p=>!(p.applicants.find(oe=>oe.userId==d.uid)&&p.type==l.Job))),V(!1)})}):fe().then(s=>{s||(window.location.href="/"),S(s),te([...s.savedLocations,s.location]),D(s.location),(s==null?void 0:s.type)==ce.Job?g(l.Job):g(l.OneTimeVolunteer),je().then(d=>{m(d),V(!1),console.log(d)})})},[]);const ie=t=>{const s=t.target.value,[d,b]=s.split(":").map(Number),p=new Date(v);p.setHours(d,b,0,0),J(p),M(p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},ae=t=>{const s=t.target.value,[d,b]=s.split(":").map(Number),p=new Date(v);p.setHours(d,b,0,0),P(p),H(p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(t){return this.setTime(this.getTime()+t*60*60*1e3),this};function le(){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"createOpportunity",children:[e.jsxs("h1",{children:[A?"Edit":"Create"," Opportunity"]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Position: "}),e.jsx("input",{placeholder:"Position",value:n,onChange:t=>{u(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Description: "}),e.jsx("textarea",{placeholder:"Description",value:N,onChange:t=>{I(t.target.value)}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Locaiton: "}),e.jsx("select",{name:"location",id:"",value:j==null?void 0:j.address,onChange:t=>{const s=G.find(d=>d.address==t.target.value);s&&D(s)},children:G.map(t=>e.jsx("option",{value:t.address,children:t.name}))})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Opporunity Type: "}),e.jsxs("select",{name:"opportunityType",id:"",value:r,onChange:t=>{g(t.target.value)},children:[e.jsx("option",{value:l.Job,children:"Job"}),e.jsx("option",{value:l.OneTimeVolunteer,children:"One Time Volunteer"}),e.jsx("option",{value:l.RecurringVolunteer,children:"Recurring Volunteer"})]})]}),r==l.Job&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Salary: "}),e.jsx("input",{type:"number",placeholder:"Salary",value:T,onChange:t=>{W(parseFloat(t.target.value))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:k,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:h.Weekdays,children:"Weekdays"}),e.jsx("option",{value:h.Weekends,children:"Weekends"}),e.jsx("option",{value:h.All,children:"Weekdays and Weekends"})]})]})]}),r==l.OneTimeVolunteer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Date: "}),e.jsx("input",{type:"date",value:v==null?void 0:v.toISOString().split("T")[0],onChange:t=>{const s=new Date(t.target.value);if(s=="Invalid Date"){L(new Date);return}s.setHours(0,0,0,0),s.setDate(s.getDate()+1),L(s);const d=new Date(s);d.setHours(B.getHours(),B.getMinutes(),0,0),J(d),M(d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const b=new Date(s);b.setHours(O.getHours(),O.getMinutes(),0,0),P(b),H(b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:Z,onChange:ie})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:ee,onChange:ae})]})]}),r==l.RecurringVolunteer&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{htmlFor:"",children:"Shift Type: "}),e.jsxs("select",{name:"shiftType",id:"",value:k,onChange:t=>{F(t.target.value)},children:[e.jsx("option",{value:h.Weekdays,children:"Weekdays"}),e.jsx("option",{value:h.Weekends,children:"Weekends"}),e.jsx("option",{value:h.All,children:"Weekdays and Weekends"})]})]})}),e.jsxs("div",{className:"FormRow",children:[e.jsxs("label",{htmlFor:"",children:["Application Link ",r!=l.Job?"(Optional)":"",": "]}),e.jsx("input",{placeholder:"Application Link",value:R,onChange:t=>{K(t.target.value)}})]}),se?e.jsx("div",{className:"loader"}):e.jsx("button",{className:"ActionBtn",onClick:async()=>{if(n==""||N==""||j==null){alert("Please fill out all fields");return}if(r==l.Job&&R==""){alert("Please fill out all fields");return}if(r==l.Job&&(T==0||k==null)){alert("Please fill out all fields");return}if(r==l.OneTimeVolunteer&&(v==null||B==null||O==null)){alert("Please fill out all fields");return}if(r==l.RecurringVolunteer&&k==null){alert("Please fill out all fields");return}Y(!0);let t;if(r==l.Job)t=new X({companyName:f.name,position:n,description:N,location:j,shiftType:k,hourlyRate:T,applicationLink:R,companyId:f.id,id:"",type:l.Job,isAvailable:!0,lastUpdated:Date.now(),applicants:[]});else if(r==l.OneTimeVolunteer){const s=me.fromBlank(v,B,O);t=new $({companyName:f.name,position:n,description:N,location:j,eventDate:s,applicationLink:R,companyId:f.id,id:"",type:l.OneTimeVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[],taskId:A?y.taskId:""})}else t=new Q({companyName:f.name,position:n,description:N,location:j,shiftType:k,applicationLink:R,companyId:f.id,id:"",type:l.RecurringVolunteer,isAvailable:!0,lastUpdated:Date.now(),applicants:[],volunteers:[]});console.log(t),A?(t.id=y.id,(y==null?void 0:y.type)==l.OneTimeVolunteer&&t.type!=l.OneTimeVolunteer&&await ge(y.taskId),await _(t,!1),m(o.map(s=>s.id==(y==null?void 0:y.id)?t:s)),q(null),z(!1)):(t=await ve(t),o.push(t),m(o),x(!1)),Y(!1)},children:A?"Save":"Create"})]})})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",children:e.jsx("h1",{children:"Opportunities"})}),e.jsxs("div",{className:"center",children:[w&&e.jsx("div",{className:"loader"}),C||A?le():e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opportunities",children:o.map(t=>e.jsx(be,{opportunity:t,accountType:c,studentData:E,onApply:()=>{t.type==l.Job&&m(o.filter(s=>s.id!=t.id))},onRSVP:async()=>{const s=ue.fromMap(t.toMap());s.applicants.push(E.toActivityMember()),s instanceof $&&s.volunteers.push(E.toActivityMember()),s instanceof Q&&s.volunteers.push(E.toActivityMember()),s.lastUpdated=Date.now(),await _(s,!0)},onEdit:()=>{if(q(t),g(t.type),u(t.position),I(t.description),D(t.location),t.type==l.Job&&(W(t.hourlyRate),F(t.shiftType)),t.type==l.OneTimeVolunteer){const s=t.eventDate;L(s.date),J(s.from),P(s.to),M(s.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),H(s.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}t.type==l.RecurringVolunteer&&F(t.shiftType),K(t.applicationLink),z(!0)},onRemove:async()=>{await pe(t),m(o.filter(s=>s.id!=t.id))}}))}),c=="employer"&&e.jsx("button",{className:"ActionBtn",onClick:()=>{x(!0)},children:"Create Opportunity"})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{C?x(!1):window.location.href="/"},children:"Back"})]})]})}
