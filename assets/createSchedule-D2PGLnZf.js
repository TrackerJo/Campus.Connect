import{j as e,r as d,c as xe}from"./index-Drzf2ig_.js";import{C as x,E as S,c as Se,q as be,r as Ce,n as De,t as Ie,v as Te,h as M,w as Ne,x as j,T as Ae,y as Fe,z as Ee}from"./db-Cf5ZPQXo.js";import{C as we}from"./Calendar-DK0P3_cG.js";import{T as Z}from"./trash-BnpXJPEK.js";import{C as ke,E as ye,S as Me}from"./Show_Group_Tile-yyo_T4Ki.js";function Be({scene:l,onClick:f}){return e.jsxs("div",{className:"SceneDisplayTile",id:"scene-tile-"+l.sceneId,onClick:()=>{f(l)},children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"SceneNameDiv",children:e.jsx("label",{htmlFor:"Scene",children:l.name})})}),e.jsx("br",{})]})}function Re({act:l,onClick:f}){const[m,D]=d.useState(0);return d.useEffect(()=>{D(Math.floor(Math.random()*1e5))},[]),e.jsxs("div",{className:"ActDisplayTile",id:"act-tile-"+l.actId,children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"ActNameDiv",children:e.jsx("label",{htmlFor:"Act",children:l.name})})}),e.jsx("br",{}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"Scene",children:"Scenes: "}),e.jsx("div",{id:"scenes-"+m,className:"scenes",children:l.scenes.map((g,T)=>e.jsx(Be,{scene:g,onClick:f},T))})]})]})}function Le({song:l,onClick:f}){return e.jsxs("div",{className:"SongDisplayTile",id:"song-tile-"+l.songId,onClick:f,children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"SongNameDiv",children:e.jsx("label",{htmlFor:"Song",children:l.name})})}),e.jsx("br",{})]})}function Ge({dance:l,onClick:f}){return e.jsxs("div",{className:"DanceDisplayTile",id:"dance-tile-"+l.danceId,onClick:f,children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"DanceNameDiv",children:e.jsx("label",{htmlFor:"Dance",children:l.name})})}),e.jsx("br",{})]})}function ce({character:l,canDelete:f,onDelete:m,isMini:D}){var g;return e.jsx("div",{className:"CharacterDisplayTile "+(D?"mini-tile":""),id:"character-tile-"+l.characterId,children:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"CharacterNameDiv",children:[e.jsxs("label",{htmlFor:"Character",children:["Character: ",l.name]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["Actor: ",(g=l.actor)==null?void 0:g.name]})]}),f&&e.jsx("div",{children:e.jsx("img",{src:Z,alt:"",className:"TrashIcon",onClick:()=>{m()}})})]})})}function ie({ensembleSection:l,canDelete:f,onDelete:m}){return e.jsxs("div",{className:"EnsembleSectionDisplayTile",children:[e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"EnsembleSectionName",children:e.jsx("label",{htmlFor:"Ensemble",children:"Ensemble "+(l.includeCustom?"(Custom)":l.includeAll?"(Everyone)":l.includeFemale?"(Females)":"(Males)")})}),f&&e.jsx("div",{children:e.jsx("img",{src:Z,alt:"",className:"TrashIcon",onClick:()=>{m()}})})]}),e.jsx("br",{}),l.includeCustom&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Custom Actors: "}),e.jsx("br",{}),l.customActors.map((D,g)=>e.jsx("div",{className:"AssignedActor",children:e.jsx("label",{htmlFor:"",children:D.name})},g))]})]})}function Ue({showGroup:l,onDelete:f,canDelete:m}){const[D,g]=d.useState(0);return d.useEffect(()=>{g(Math.floor(Math.random()*1e5))},[]),e.jsxs("div",{className:"ShowGroupDisplayTile",id:"show-group-tile-"+l.showGroupId,children:[e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"ShowGroupNameDiv",children:e.jsxs("label",{htmlFor:"ShowGroup",children:["Show Group: ",l.name]})}),m&&e.jsx("div",{children:e.jsx("img",{src:Z,alt:"",className:"TrashIcon",onClick:()=>{f()}})})]}),e.jsx("br",{}),e.jsxs("div",{className:"characters-section",children:[e.jsx("label",{htmlFor:"Characters",children:"Characters: "}),e.jsx("div",{className:"characters",id:"characters-"+D,children:l.characters.map((T,r)=>{if(T instanceof x)return e.jsx(ce,{character:T,canDelete:!1,onDelete:()=>{},isMini:!0},r);if(T instanceof S)return e.jsx(ie,{ensembleSection:T,canDelete:!1,onDelete:()=>{},isMini:!0},r)})})]})]})}function X({conflictResponseDate:l,actor:f}){return e.jsx("div",{className:"ConflictDisplayTile ",id:"conflict-display-tile-"+f.userId,children:e.jsx("div",{className:"header",children:e.jsxs("div",{className:"CharacterNameDiv",children:[e.jsxs("label",{htmlFor:"Actor",children:["Actor: ",f.name]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"Actor",children:["Date: ",l.date.toDateString()]}),e.jsx("br",{}),l.canAttend?e.jsxs("label",{htmlFor:"Actor",children:[l.from.toLocaleTimeString()," - ",l.to.toLocaleTimeString()]}):e.jsx("label",{htmlFor:"Actor",children:"Can't Attend"})]})})})}xe(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(He,{})}));function He(){const[l,f]=d.useState(""),[m,D]=d.useState(),[g,T]=d.useState(""),[r,re]=d.useState(),[$,v]=d.useState("date"),[P,B]=d.useState(null),[ee,E]=d.useState(null),[te,w]=d.useState(null),[N,A]=d.useState("custom"),[se,F]=d.useState(""),[ne,R]=d.useState(""),[le,k]=d.useState(""),[de,y]=d.useState(""),[oe,U]=d.useState(void 0),[ue,ae]=d.useState(!1),[L,H]=d.useState([]),[O,_]=d.useState([]),[p,h]=d.useState([]),[q,Y]=d.useState(!1),[I,fe]=d.useState([]),[z,b]=d.useState([]),[V,me]=d.useState(!1),[C,G]=d.useState(null),[J,K]=d.useState(!1),[he,pe]=d.useState(null);d.useEffect(()=>{const a=new URLSearchParams(window.location.search),c=a.get("activityId");c&&(f(c),Se(c).then(i=>{i instanceof be||D(i)}));const n=a.get("showId");n&&(T(n),Ce(c,n).then(i=>{const s=[];for(const t of i)for(const o of t.dates)s.push({conflictResponseDate:o,actor:t.actor});s.sort((t,o)=>t.conflictResponseDate.date.getTime()-o.conflictResponseDate.date.getTime()),fe(s),b([...s])})),De(c,n).then(i=>{re(i)}),Ie(c,n).then(i=>{H(i);const s=[];for(const t of i){console.log(t);const o=t.date.from;console.log(t.date.date),o.setDate(t.date.date.getDate()),o.setMonth(t.date.date.getMonth()),o.setFullYear(t.date.date.getFullYear());const u=t.date.to;u.setDate(t.date.date.getDate()),u.setMonth(t.date.date.getMonth()),u.setFullYear(t.date.date.getFullYear()),console.log(o),console.log(u),s.push({title:t.name,start:o.toISOString(),end:u.toISOString(),isAllDay:!1,interactive:!0,color:"blue",id:t.id})}_(s)})},[]);const je=a=>{const c=a.target.value,[n,i]=c.split(":").map(Number),s=new Date(P);s.setHours(n,i,0,0),E(s),k(s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))},ge=a=>{const c=a.target.value,[n,i]=c.split(":").map(Number),s=new Date(P);s.setHours(n,i,0,0),w(s),y(s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))};Date.prototype.addHours=function(a){return this.setTime(this.getTime()+a*60*60*1e3),this};function ve(){return L}return e.jsxs("div",{className:"center",children:[e.jsx("h1",{className:"title",children:"Create Schedule"}),$=="date"?e.jsxs(e.Fragment,{children:[" ",e.jsx("h2",{className:"title",children:"Select a Date"}),e.jsxs("div",{className:"date-div",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:["Conflicts",C!=null?" on "+C.toDateString():""]}),e.jsx("div",{className:"conflicts",children:z.map((a,c)=>e.jsx(X,{conflictResponseDate:a.conflictResponseDate,actor:a.actor},c))})]}),e.jsx(we,{canOpenContextMenu:!0,events:O,editEvent:a=>{const c=ve().find(n=>n.id==a.id);c&&(console.log(c),v("info"),F(c.name),R(c.info),B(c.date.date),E(c.date.from),k(c.date.from.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),w(c.date.to),y(c.date.to.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),U(c.location),h(c.characters),K(!0),A(c.theaterEventType),pe(c))},viewConflicts:a=>{const c=new Date(a);c.setHours(0,0,0,0),G(c);const n=[];for(const i of I)i.conflictResponseDate.date.getTime()==c.getTime()&&n.push(i);b(n)},deleteEvent:async a=>{console.log(a);const c=L.find(s=>s.id==a.id),n=L.filter(s=>s.id!=a.id);H(n);const i=O.filter(s=>s.id!=a.id);_(i),await Te(c)},dateClick:a=>{console.log(a.date),B(a.date);const c=new Date(a.date);c.setHours(0,0,0,0),G(c);const n=[];for(const s of I)s.conflictResponseDate.date.getTime()==c.getTime()&&n.push(s);b(n),E(new Date(a.date)),k(a.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const i=new Date(a.date);w(i.addHours(1)),console.log(i),y(a.date.addHours(1).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),v("type")},eventClick:a=>{B(a.event.start),E(new Date(a.event.start)),k(a.event.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}));const c=new Date(a.event.end);w(c),y(c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),v("type")}})]}),e.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/activity/shows/show/?activityId="+l+"&showId="+g},children:"Back"})]}):$=="type"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"title",children:"Select a Rehersal Type"}),e.jsxs("div",{className:"conflicts-div",children:[e.jsxs("h2",{children:["Conflicts",C!=null?" on "+C.toDateString():""]}),e.jsx("div",{className:"conflicts",children:z.map((a,c)=>e.jsx(X,{conflictResponseDate:a.conflictResponseDate,actor:a.actor},c))})]}),e.jsx("button",{onClick:()=>{v("info"),A("custom"),h([])},className:"ActionBtn",children:"Custom"}),e.jsx("h2",{className:"title",children:"Show Layout"}),e.jsx("div",{className:"layout",children:r==null?void 0:r.layout.map((a,c)=>e.jsx(Re,{act:a,onClick:n=>{A("scene"),F(n.name+" - "+a.name),v("info"),h(n.characters);const i=[];for(const t of n.characters)if(t instanceof x)i.push(t.actor.userId);else if(t instanceof M){for(const o of t.characters)if(o instanceof x)i.push(o.actor.userId);else if(o instanceof S){if(o.includeAll)for(const u of r.ensemble.actors)i.push(u.userId);else if(o.includeMale)for(const u of r.ensemble.actors)u.gender=="male"&&i.push(u.userId);else if(o.includeFemale)for(const u of r.ensemble.actors)u.gender=="female"&&i.push(u.userId);else if(o.includeCustom)for(const u of o.customActors)i.push(u.userId)}}else if(t instanceof S){if(t.includeAll)for(const o of r.ensemble.actors)i.push(o.userId);else if(t.includeMale)for(const o of r.ensemble.actors)o.gender=="male"&&i.push(o.userId);else if(t.includeFemale)for(const o of r.ensemble.actors)o.gender=="female"&&i.push(o.userId);else if(t.includeCustom)for(const o of t.customActors)i.push(o.userId)}const s=[];for(const t of I)i.includes(t.actor.userId)&&t.conflictResponseDate.date.getTime()==C.getTime()&&s.push(t);b(s)}},c))}),e.jsx("h2",{className:"title",children:"Songs"}),e.jsx("div",{className:"songs",children:r==null?void 0:r.songs.map((a,c)=>e.jsx(Le,{song:a,onClick:()=>{A("song"),F(a.name),h(a.characters),v("info");const n=[];for(const s of a.characters)if(s instanceof x)n.push(s.actor.userId);else if(s instanceof M){for(const t of s.characters)if(t instanceof x)n.push(t.actor.userId);else if(t instanceof S){if(t.includeAll)for(const o of r.ensemble.actors)n.push(o.userId);else if(t.includeMale)for(const o of r.ensemble.actors)o.gender=="male"&&n.push(o.userId);else if(t.includeFemale)for(const o of r.ensemble.actors)o.gender=="female"&&n.push(o.userId);else if(t.includeCustom)for(const o of t.customActors)n.push(o.userId)}}else if(s instanceof S){if(s.includeAll)for(const t of r.ensemble.actors)n.push(t.userId);else if(s.includeMale)for(const t of r.ensemble.actors)t.gender=="male"&&n.push(t.userId);else if(s.includeFemale)for(const t of r.ensemble.actors)t.gender=="female"&&n.push(t.userId);else if(s.includeCustom)for(const t of s.customActors)n.push(t.userId)}const i=[];for(const s of I)n.includes(s.actor.userId)&&s.conflictResponseDate.date.getTime()==C.getTime()&&i.push(s);b(i)}},c))}),e.jsx("h2",{className:"title",children:"Dances"}),e.jsx("div",{className:"dances",children:r==null?void 0:r.dances.map((a,c)=>e.jsx(Ge,{dance:a,onClick:()=>{A("dance"),F(a.name),v("info"),h(a.characters);const n=[];for(const s of a.characters)if(s instanceof x)n.push(s.actor.userId);else if(s instanceof M){for(const t of s.characters)if(t instanceof x)n.push(t.actor.userId);else if(t instanceof S){if(t.includeAll)for(const o of r.ensemble.actors)n.push(o.userId);else if(t.includeMale)for(const o of r.ensemble.actors)o.gender=="male"&&n.push(o.userId);else if(t.includeFemale)for(const o of r.ensemble.actors)o.gender=="female"&&n.push(o.userId);else if(t.includeCustom)for(const o of t.customActors)n.push(o.userId)}}else if(s instanceof S){if(s.includeAll)for(const t of r.ensemble.actors)n.push(t.userId);else if(s.includeMale)for(const t of r.ensemble.actors)t.gender=="male"&&n.push(t.userId);else if(s.includeFemale)for(const t of r.ensemble.actors)t.gender=="female"&&n.push(t.userId);else if(s.includeCustom)for(const t of s.customActors)n.push(t.userId)}const i=[];for(const s of I)n.includes(s.actor.userId)&&s.conflictResponseDate.date.getTime()==C.getTime()&&i.push(s);b(i)}},c))}),e.jsx("button",{onClick:()=>{v("date"),G(null),b([...I])},className:"ActionBtn",children:"Back"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"conflicts-div",children:[e.jsxs("h2",{children:["Conflicts",C!=null?" on "+C.toDateString():""]}),e.jsx("div",{className:"conflicts",children:z.map((a,c)=>e.jsx(X,{conflictResponseDate:a.conflictResponseDate,actor:a.actor},c))})]}),e.jsx("h2",{className:"title",children:"Enter Rehersal Information"}),e.jsx("label",{htmlFor:"Name",children:"Name: "}),e.jsx("input",{type:"text",value:se,onChange:a=>{F(a.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"Description",children:"Description: "}),e.jsx("textarea",{value:ne,onChange:a=>{R(a.target.value)}}),e.jsx("br",{}),e.jsx("label",{htmlFor:"StartTime",children:"Start Time: "}),e.jsx("input",{type:"time",value:le,onChange:je}),e.jsx("br",{}),e.jsx("label",{htmlFor:"EndTime",children:"End Time: "}),e.jsx("input",{type:"time",value:de,onChange:ge}),e.jsx("br",{}),e.jsx("label",{htmlFor:"location",children:"Location: "}),e.jsx("select",{name:"location",id:"location",onChange:a=>{U(m==null?void 0:m.locations.find(c=>c.name==a.target.value))},children:m==null?void 0:m.locations.map((a,c)=>e.jsx("option",{value:a.name,children:a.name+" ("+a.address+")"},c))}),e.jsx("br",{}),N=="custom"?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"fullCast",children:"Full Cast: "}),e.jsx("input",{type:"checkbox",checked:V,onChange:a=>{me(a.target.checked)}})]}):e.jsx(e.Fragment,{}),N=="custom"&&e.jsx("br",{}),V?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[" ",e.jsx("h2",{children:"Characters"}),e.jsx("div",{className:"characters",children:p.map((a,c)=>{if(a instanceof x)return N=="custom"?e.jsx(ke,{character:a,isCreate:!1,actors:[],characters:r.characters,isAssign:!1,setCharacter:n=>{h(p.map((i,s)=>s===c?n:i))},removeCharacter:()=>{h(p.filter((n,i)=>i!==c))}},c):e.jsx(ce,{character:a,canDelete:!0,onDelete:()=>{h(p.filter((n,i)=>i!==c))},isMini:!1},c);if(a instanceof S)return N=="custom"?e.jsx(ye,{ensembleSection:a,isCustom:!0,setEnsembleSection:n=>{h(p.map((i,s)=>s===c?n:i))},removeEnsembleSection:()=>{h(p.filter((n,i)=>i!==c))},isCreate:!1,isAssign:!1,actors:m.students},c):e.jsx(ie,{ensembleSection:a,canDelete:!0,onDelete:()=>{h(p.filter((n,i)=>i!==c))},isMini:!1},c);if(a instanceof M)return N=="custom"?e.jsx(Me,{showGroup:a,characters:r.characters,setShowGroup:n=>{h(p.map((i,s)=>s===c?n:i))},removeShowGroup:()=>{h(p.filter((n,i)=>i!==c))},isCreate:!1,isAssign:!1,actors:m.students,hasEnsemble:r.hasEnsemble,showGroups:r.showGroups},c):e.jsx(Ue,{showGroup:a,canDelete:!0,onDelete:()=>{h(p.filter((n,i)=>i!==c))}},c)})}),N=="custom"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"ActionBtn",onClick:()=>{const a=Math.floor(Math.random()*1e5);h([...p,x.fromBlank("Character 1",null,a,0)])},children:"Add Character"}),e.jsx("button",{className:"ActionBtn",onClick:()=>{const a=Math.floor(Math.random()*1e5);h([...p,M.fromBlank("Show Group 1",[],a,0)])},children:"Add Show Group"}),(r==null?void 0:r.hasEnsemble)&&e.jsx("button",{className:"ActionBtn "+(q?"disabled":""),disabled:q,onClick:()=>{q||(Y(!0),h([...p,S.fromBlank(!0,!1,!1,!1,[],0)]))},children:"Add Ensemble"})," "]}):e.jsx(e.Fragment,{})," "]}),e.jsx("br",{}),ue?e.jsx("div",{className:"loader"}):e.jsx("button",{onClick:async()=>{ae(!0),console.log("Submit");const a=oe??m.locations[0];console.log(ee),console.log(te);const c=Ne.fromBlank(P,ee,te);console.log(c);const n=[];if(V){for(const s of r.ensemble.actors)n.push(j.fromBlank(s.name,s.userId,s.FCMToken));for(const s of r.characters)n.find(t=>t.memberUid==s.actor.userId)==null&&n.push(j.fromBlank(s.actor.name,s.actor.userId,s.actor.FCMToken))}else for(const s of p){if(s instanceof x){if(n.find(t=>t.memberUid==s.actor.userId)!=null)continue;n.push(j.fromBlank(s.actor.name,s.actor.userId,s.actor.FCMToken))}if(s instanceof S){if(s.includeAll)for(const t of r.ensemble.actors)n.find(o=>o.memberUid==t.userId)==null&&n.push(j.fromBlank(t.name,t.userId,t.FCMToken));else if(s.includeMale){for(const t of r.ensemble.actors)if(t.gender=="male"){if(n.find(o=>o.memberUid==t.userId)!=null)continue;n.push(j.fromBlank(t.name,t.userId,t.FCMToken))}}else if(s.includeFemale){for(const t of r.ensemble.actors)if(t.gender=="female"){if(n.find(o=>o.memberUid==t.userId)!=null)continue;n.push(j.fromBlank(t.name,t.userId,t.FCMToken))}}else if(s.includeCustom)for(const t of s.customActors)n.find(o=>o.memberUid==t.userId)==null&&n.push(j.fromBlank(t.name,t.userId,t.FCMToken))}if(s instanceof M)for(const t of s.characters){if(t instanceof x){if(n.find(o=>o.memberUid==t.actor.userId)!=null)continue;n.push(j.fromBlank(t.actor.name,t.actor.userId,t.actor.FCMToken))}if(t instanceof S){if(t.includeAll)for(const o of r.ensemble.actors)n.find(u=>u.memberUid==o.userId)==null&&n.push(j.fromBlank(o.name,o.userId,o.FCMToken));else if(t.includeMale){for(const o of r.ensemble.actors)if(o.gender=="male"){if(n.find(u=>u.memberUid==o.userId)!=null)continue;n.push(j.fromBlank(o.name,o.userId,o.FCMToken))}}else if(t.includeFemale){for(const o of r.ensemble.actors)if(o.gender=="female"){if(n.find(u=>u.memberUid==o.userId)!=null)continue;n.push(j.fromBlank(o.name,o.userId,o.FCMToken))}}else if(t.includeCustom)for(const o of t.customActors)n.find(u=>u.memberUid==o.userId)==null&&n.push(j.fromBlank(o.name,o.userId,o.FCMToken))}}}const i=Ae.fromBlank(se,ne,a,c,"activity-theater-event",Date.now(),l,g,p,n,N);if(console.log(i),J){i.id=he.id,await Fe(i),K(!1);const s=i.date.from,t=i.date.to,o={title:i.name,start:s.toISOString(),end:t.toISOString(),isAllDay:!1,interactive:!0,color:"blue",id:i.id},u=O.filter(W=>W.id!=i.id);u.push(o),_(u);const Q=L.filter(W=>W.id!=i.id);Q.push(i),console.log(Q),H([...Q])}else{await Ee(i);const s=i.date.from,t=i.date.to,o={title:i.name,start:s.toISOString(),end:t.toISOString(),isAllDay:!1,interactive:!0,color:"blue",id:i.id};_([...O,o]),H([...L,i])}ae(!1),v("date"),B(null),E(null),w(null),A("custom"),F(""),R(""),k(""),y(""),U(void 0),Y(!1),G(null),b(I)},className:"ActionBtn",children:J?"Save":"Submit"}),e.jsx("button",{onClick:()=>{if(J){v("date"),B(null),E(null),w(null),A("custom"),F(""),R(""),k(""),y(""),U(void 0),Y(!1),G(null),b(I),K(!1);return}v("type"),R(""),Y(!1);const a=[];for(const c of I)c.conflictResponseDate.date.getTime()==C.getTime()&&a.push(c);b(a)},className:"ActionBtn",children:"Back"})]})]})}
