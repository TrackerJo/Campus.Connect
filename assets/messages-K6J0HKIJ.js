import{j as s,r as l,E as D,C as G,e as E,F as T,z as P,B as se,M as z,c as te,i as _,H as O}from"./index-CTdd_IJn.js";import{i as re,h as U,Q as ne,R as H,S as ae,T as ce,g as oe,U as le}from"./db-BM5h2dO_.js";import{A as W}from"./Add_User_Dialog-BJuQ_wMK.js";import{a as ie,A as ue,S as de,D as fe}from"./Show_Group_Display_Tile-BwwAwYAh.js";import{E as me}from"./Ensemble_Section_Tile-Ck4EDYVd.js";import{B as he}from"./back-C9T8y7K2.js";import"./trash-BnpXJPEK.js";function pe({message:f,isSender:g}){return s.jsx("div",{className:"message",children:s.jsx("div",{className:"message__outer",children:s.jsxs("div",{className:"message__inner",children:[g?s.jsx(s.Fragment,{}):s.jsx("div",{className:"message__spacer"}),s.jsxs("div",{className:"message__bubble "+(g?"isSender":"notSender"),children:[s.jsx("h1",{className:"message-sender",children:f.senderName}),s.jsxs("div",{className:"message-body",children:[s.jsx("p",{className:"message-text",children:f.message}),s.jsx("p",{className:"message-time-sent",children:f.timeSent.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),g?s.jsx("div",{className:"message__spacer"}):s.jsx(s.Fragment,{})]})})})}function ge({sendMessage:f}){const g=l.useRef(null);return s.jsxs("div",{className:"message-send-bar",onKeyDown:d=>{d.key==="Enter"&&g.current.value.trim()!==""&&(f(g.current.value.trim()),g.current.value="")},children:[s.jsx("input",{type:"text",placeholder:"Type a message...",className:"message-input",ref:g}),s.jsx("button",{onClick:()=>{f(g.current.value.trim()),g.current.value=""},className:"message-send-btn",children:"Send"})]})}function J({dialogRef:f,close:g,addMembers:d,activityId:N,setName:b}){const[M,m]=l.useState([]),[c,v]=l.useState(null),[A,I]=l.useState(null);return l.useEffect(()=>{N&&re(N).then(u=>{u=u.filter(i=>i.canCreateSchedule),m(u)})},[N]),s.jsx("dialog",{ref:f,className:"AddFromPlayDialog",children:s.jsxs("div",{className:"AddFromPlayDiv",children:[s.jsx("h2",{children:"Select Play"}),s.jsxs("select",{className:"SelectPlay",onChange:u=>{v(M.find(i=>i.id==u.target.value)||null),I(D.fromBlank(!0,!1,!1,!1,[]))},children:[s.jsx("option",{value:"",children:"Select a Play"}),M.map((u,i)=>s.jsx("option",{value:u.id,children:u.name},i))]}),c&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("button",{className:"ActionBtn",onClick:()=>{const u=[],i=[];for(const n of c.ensemble.actors)i.includes(n.userId)||(u.push(n),i.push(n.userId));for(const n of c.characters)i.includes(n.actor.userId)||(u.push(n.actor),i.push(n.actor.userId));d(u)},children:"Add Full Cast"}),s.jsx("h2",{className:"title",children:"Ensemble"}),s.jsx("div",{className:"ensemble",children:s.jsx(me,{ensembleSection:A,isAssign:!1,actors:[],isCustom:!1,isCreate:!0,isGroupChatCreate:!0,setEnsembleSection:u=>{I(u)},onAddEnsemble:()=>{const u=[],i=[];if(A.includeAll)for(const n of c.ensemble.actors)i.includes(n.userId)||(u.push(n),i.push(n.userId));else if(A.includeMale)for(const n of c.ensemble.actors)n.gender=="male"&&(i.includes(n.userId)||(u.push(n),i.push(n.userId)));else if(A.includeFemale)for(const n of c.ensemble.actors)n.gender=="female"&&(i.includes(n.userId)||(u.push(n),i.push(n.userId)));d(u)},removeEnsembleSection:()=>{}})}),s.jsx("h2",{className:"title",children:"Show Groups"}),s.jsx("div",{className:"show-groups",children:c==null?void 0:c.showGroups.map((u,i)=>s.jsx(ie,{showGroup:u,canDelete:!1,onDelete:()=>{},canClick:!0,showCharacters:!1,onClick:()=>{b(u.name);const n=[],r=[];for(const a of u.characters)if(a instanceof G)r.includes(a.actor.userId)||(n.push(a.actor),r.push(a.actor.userId));else if(a instanceof E){for(const e of a.characters)if(e instanceof G)r.includes(e.actor.userId)||(n.push(e.actor),r.push(e.actor.userId));else if(e instanceof D){if(e.includeAll)for(const t of c.ensemble.actors)r.includes(t.userId)||(n.push(t),r.push(t.userId));else if(e.includeMale)for(const t of c.ensemble.actors)t.gender=="male"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeFemale)for(const t of c.ensemble.actors)t.gender=="female"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeCustom)for(const t of e.customActors)r.includes(t.userId)||(n.push(t),r.push(t.userId))}}else if(a instanceof D){if(a.includeAll)for(const e of c.ensemble.actors)r.includes(e.userId)||(n.push(e),r.push(e.userId));else if(a.includeMale)for(const e of c.ensemble.actors)e.gender=="male"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeFemale)for(const e of c.ensemble.actors)e.gender=="female"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)r.includes(e.userId)||(n.push(e),r.push(e.userId))}d(n)}},i))}),s.jsx("h2",{className:"title",children:"Show Layout"}),s.jsx("div",{className:"layout",children:c==null?void 0:c.layout.map((u,i)=>s.jsx(ue,{act:u,onClick:n=>{b(n.name+" - "+u.name);const r=[],a=[];console.log(n);for(const e of n.characters)if(e instanceof G)a.includes(e.actor.userId)||(r.push(e.actor),a.push(e.actor.userId));else if(e instanceof E){for(const t of e.characters)if(t instanceof G)a.includes(t.actor.userId)||(r.push(t.actor),a.push(t.actor.userId));else if(t instanceof D){if(t.includeAll)for(const o of c.ensemble.actors)a.includes(o.userId)||(r.push(o),a.push(o.userId));else if(t.includeMale)for(const o of c.ensemble.actors)o.gender=="male"&&(a.includes(o.userId)||(r.push(o),a.push(o.userId)));else if(t.includeFemale)for(const o of c.ensemble.actors)o.gender=="female"&&(a.includes(o.userId)||(r.push(o),a.push(o.userId)));else if(t.includeCustom)for(const o of t.customActors)a.includes(o.userId)||(r.push(o),a.push(o.userId))}}else if(e instanceof D){if(e.includeAll)for(const t of c.ensemble.actors)a.includes(t.userId)||(r.push(t),a.push(t.userId));else if(e.includeMale)for(const t of c.ensemble.actors)t.gender=="male"&&(a.includes(t.userId)||(r.push(t),a.push(t.userId)));else if(e.includeFemale)for(const t of c.ensemble.actors)t.gender=="female"&&(a.includes(t.userId)||(r.push(t),a.push(t.userId)));else if(e.includeCustom)for(const t of e.customActors)a.includes(t.userId)||(r.push(t),a.push(t.userId))}else if(e instanceof T){for(const t of c.ensemble.actors)a.includes(t.userId)||(r.push(t),a.push(t.userId));for(const t of c.characters)a.includes(t.actor.userId)||(r.push(t.actor),a.push(t.actor.userId))}d(r)}},i))}),s.jsx("h2",{className:"title",children:"Songs"}),s.jsx("div",{className:"songs",children:c==null?void 0:c.songs.map((u,i)=>s.jsx(de,{song:u,onClick:()=>{b(u.name);const n=[],r=[];for(const a of u.characters)if(a instanceof G)r.includes(a.actor.userId)||(n.push(a.actor),r.push(a.actor.userId));else if(a instanceof E){for(const e of a.characters)if(e instanceof G)r.includes(e.actor.userId)||(n.push(e.actor),r.push(e.actor.userId));else if(e instanceof D){if(e.includeAll)for(const t of c.ensemble.actors)r.includes(t.userId)||(n.push(t),r.push(t.userId));else if(e.includeMale)for(const t of c.ensemble.actors)t.gender=="male"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeFemale)for(const t of c.ensemble.actors)t.gender=="female"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeCustom)for(const t of e.customActors)r.includes(t.userId)||(n.push(t),r.push(t.userId))}}else if(a instanceof D){if(a.includeAll)for(const e of c.ensemble.actors)r.includes(e.userId)||(n.push(e),r.push(e.userId));else if(a.includeMale)for(const e of c.ensemble.actors)e.gender=="male"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeFemale)for(const e of c.ensemble.actors)e.gender=="female"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)r.includes(e.userId)||(n.push(e),r.push(e.userId))}else if(a instanceof T){for(const e of c.ensemble.actors)r.includes(e.userId)||(n.push(e),r.push(e.userId));for(const e of c.characters)r.includes(e.actor.userId)||(n.push(e.actor),r.push(e.actor.userId))}d(n)}},i))}),s.jsx("h2",{className:"title",children:"Dances"}),s.jsx("div",{className:"dances",children:c==null?void 0:c.dances.map((u,i)=>s.jsx(fe,{dance:u,onClick:()=>{b(u.name);const n=[],r=[];for(const a of u.characters)if(a instanceof G)r.includes(a.actor.userId)||(n.push(a.actor),r.push(a.actor.userId));else if(a instanceof E){for(const e of a.characters)if(e instanceof G)r.includes(e.actor.userId)||(n.push(e.actor),r.push(e.actor.userId));else if(e instanceof D){if(e.includeAll)for(const t of c.ensemble.actors)r.includes(t.userId)||(n.push(t),r.push(t.userId));else if(e.includeMale)for(const t of c.ensemble.actors)t.gender=="male"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeFemale)for(const t of c.ensemble.actors)t.gender=="female"&&(r.includes(t.userId)||(n.push(t),r.push(t.userId)));else if(e.includeCustom)for(const t of e.customActors)r.includes(t.userId)||(n.push(t),r.push(t.userId))}}else if(a instanceof D){if(a.includeAll)for(const e of c.ensemble.actors)r.includes(e.userId)||(n.push(e),r.push(e.userId));else if(a.includeMale)for(const e of c.ensemble.actors)e.gender=="male"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeFemale)for(const e of c.ensemble.actors)e.gender=="female"&&(r.includes(e.userId)||(n.push(e),r.push(e.userId)));else if(a.includeCustom)for(const e of a.customActors)r.includes(e.userId)||(n.push(e),r.push(e.userId))}else if(a instanceof T){for(const e of c.ensemble.actors)r.includes(e.userId)||(n.push(e),r.push(e.userId));for(const e of c.characters)r.includes(e.actor.userId)||(n.push(e.actor),r.push(e.actor.userId))}d(n)}},i))})]}),s.jsx("button",{className:"ActionBtn",onClick:()=>{g()},children:"Close"}),s.jsx("br",{})]})})}function K({dialogRef:f,close:g,addMembers:d,activityGroups:N}){const[b,M]=l.useState(null);return s.jsx("dialog",{ref:f,className:"AddFromGroupDialog",children:s.jsxs("div",{className:"AddFromGroupDiv",children:[s.jsx("h2",{children:"Select Group"}),s.jsxs("select",{className:"SelectPlay",onChange:m=>{M(N.find(c=>c.groupName==m.target.value)||null)},children:[s.jsx("option",{value:"",children:"Select a Group"}),N.map((m,c)=>s.jsx("option",{value:m.groupName,children:m.groupName},c))]}),s.jsx("br",{}),s.jsx("button",{className:"ActionBtn",onClick:()=>{b&&d(b.groupMembers),g()},children:"Add Group"}),s.jsx("button",{className:"ActionBtn",onClick:()=>{g()},children:"Close"}),s.jsx("br",{})]})})}function xe({close:f,dialogRef:g,activityId:d,refresh:N}){const b=l.useRef(null),M=l.useRef(null),m=l.useRef(null),c=l.useRef(null),[v,A]=l.useState(null),[I,u]=l.useState([]),[i,n]=l.useState([]),[r,a]=l.useState([]);return l.useEffect(()=>{d&&U(d).then(e=>{A(e),e!=null&&(e instanceof P?(u([...e.parents,...e.students]),a(e.groups)):(u([...e.parents,...e.students]),a(e.groups)))})},[d]),s.jsxs(s.Fragment,{children:[s.jsx("dialog",{className:"create-group-chat-dialog",ref:g,children:s.jsxs("div",{className:"create-group-chat-dialog-inner",children:[s.jsx("h1",{className:"create-group-chat-dialog-title",children:"Create Group Chat"}),s.jsx("input",{type:"text",placeholder:"Group Chat Name",className:"create-group-chat-dialog-input",ref:b}),i.length>0&&s.jsxs(s.Fragment,{children:[" ",s.jsx("h2",{className:"create-group-chat-dialog-members-title",children:"Members: "}),s.jsx("div",{className:"create-group-chat-dialog-members",children:i.map((e,t)=>s.jsxs("div",{className:"create-group-chat-dialog-member",children:[s.jsx("label",{htmlFor:"",children:e.name}),s.jsx("button",{className:"ActionBtn",onClick:()=>{n(i.filter(o=>o!=e))},children:"Remove"})]},t))})," "]}),s.jsx("button",{className:"ActionBtn",onClick:()=>{M.current.showModal()},children:"Add Member"}),r.length>0&&s.jsx("button",{className:"ActionBtn",onClick:()=>{c.current.showModal()},children:"Add from Group"}),v instanceof P?s.jsx("button",{className:"ActionBtn",onClick:()=>{m.current.showModal()},children:"Add from Play"}):null,s.jsx("button",{className:"ActionBtn",onClick:async()=>{if(b.current.value==""){alert("Please enter a name for the group chat");return}if(i.length==0){alert("Please add at least one member to the group chat");return}const e=se.fromBlank(b.current.value,"",i,"custom",d,Date.now());await ne(e),N(),f()},children:"Create"}),s.jsx("button",{onClick:f,className:"ActionBtn",children:"Close"})]})}),s.jsx(W,{members:I,dialogRef:M,addedMembers:i,close:()=>{M.current.close()},addUser:e=>{const t=[...i,e],o=[],x=t.filter(h=>o.includes(h.name)?!1:(o.push(h.name),!0));n(x)}}),s.jsx(K,{dialogRef:c,close:()=>{c.current.close()},addMembers:e=>{const t=[...i,...e],o=[],x=t.filter(h=>o.includes(h.name)?!1:(o.push(h.name),!0));n(x),c.current.close()},activityGroups:r}),s.jsx(J,{dialogRef:m,close:()=>{m.current.close()},addMembers:e=>{const t=[...i,...e],o=[],x=t.filter(h=>o.includes(h.name)?!1:(o.push(h.name),!0));n(x),m.current.close()},setName:e=>{},activityId:d})]})}function Ie({groupChat:f,onClick:g}){return s.jsxs("div",{className:"group-chat-display-tile",onClick:g,children:[s.jsx("h1",{children:f.name}),s.jsx("div",{className:"divider"}),s.jsxs("div",{className:"recent-message-div",children:[s.jsx("h3",{children:f.lastMessage!=null?f.lastMessage.senderName+": "+f.lastMessage.message:"No messages"}),s.jsx("h4",{children:f.lastMessage!=null?new Date(f.lastMessage.timeSent).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]})]})}function je({close:f,dialogRef:g,activityId:d,userData:N,refresh:b,activityName:M}){const m=l.useRef(null),c=l.useRef(null),v=l.useRef(null),A=l.useRef(null),[I,u]=l.useState(null),[i,n]=l.useState([]),[r,a]=l.useState([]),[e,t]=l.useState([]);return l.useEffect(()=>{d&&U(d).then(o=>{u(o),o!=null&&(o instanceof P?(n([...o.parents,...o.students]),t(o.groups)):(n([...o.parents,...o.students]),t(o.groups)))})},[d]),s.jsxs(s.Fragment,{children:[s.jsx("dialog",{className:"broadcast-message-dialog",ref:g,children:s.jsxs("div",{className:"broadcast-message-dialog-inner",children:[s.jsx("h1",{className:"broadcast-message-dialog-title",children:"Broadcast message"}),s.jsx("input",{type:"text",placeholder:"Message",className:"broadcast-message-dialog-input",ref:m}),r.length>0&&s.jsxs(s.Fragment,{children:[" ",s.jsx("h2",{className:"broadcast-message-dialog-members-title",children:"Recipient: "}),s.jsx("div",{className:"broadcast-message-dialog-members",children:r.map((o,x)=>s.jsxs("div",{className:"broadcast-message-dialog-member",children:[s.jsx("label",{htmlFor:"",children:o.name}),s.jsx("button",{className:"ActionBtn",onClick:()=>{a(r.filter(h=>h!=o))},children:"Remove"})]},x))})," "]}),s.jsx("button",{className:"ActionBtn",onClick:()=>{c.current.showModal()},children:"Add Recipient"}),e.length>0&&s.jsx("button",{className:"ActionBtn",onClick:()=>{A.current.showModal()},children:"Add from Group"}),I instanceof P?s.jsx("button",{className:"ActionBtn",onClick:()=>{v.current.showModal()},children:"Add from Play"}):null,s.jsx("button",{className:"ActionBtn",onClick:async()=>{if(m.current.value==""){alert("Please enter a message to broadcast");return}if(r.length==0){alert("Please add at least one recipient");return}const o=z.fromBlank(m.current.value,N.uid,N.fullname,N.FCMToken,"",d,"",new Date,[N.uid]);for(let x=0;x<r.length;x++){const h=r[x];o.gcId=h.userId,console.log("Sending message to "+h.userId),console.log(o.toMap()),await H(d,h.userId,o,M,h)}b(),f()},children:"Send"}),s.jsx("button",{onClick:f,className:"ActionBtn",children:"Close"})]})}),s.jsx(W,{members:i,dialogRef:c,addedMembers:r,close:()=>{c.current.close()},addUser:o=>{const x=[...r,o],h=[],k=x.filter(w=>h.includes(w.userId)?!1:(h.push(w.userId),!0));a(k)}}),s.jsx(K,{dialogRef:A,close:()=>{A.current.close()},addMembers:o=>{const x=[...r,...o],h=[],k=x.filter(w=>h.includes(w.userId)?!1:(h.push(w.userId),!0));a(k),A.current.close()},activityGroups:e}),s.jsx(J,{dialogRef:v,close:()=>{v.current.close()},addMembers:o=>{const x=[...r,...o],h=[],k=x.filter(w=>h.includes(w.userId)?!1:(h.push(w.userId),!0));a(k),v.current.close()},setName:o=>{},activityId:d})]})}te(document.getElementById("root")).render(s.jsx(l.StrictMode,{children:s.jsx(be,{})}));function be(){const[f,g]=l.useState(""),[d,N]=l.useState([]),[b,M]=l.useState("student"),[m,c]=l.useState(null),[v,A]=l.useState([]);l.useState([]);const[I,u]=l.useState(null),[i,n]=l.useState(!1),[r,a]=l.useState(!1),e=l.useRef(null),t=l.useRef(null),o=l.useRef(null),[x,h]=l.useState([]),[k,w]=l.useState(""),[Q,q]=l.useState(!1);function V(p){A(p),setTimeout(()=>{e.current.scrollTop=e.current.scrollHeight},100)}l.useEffect(()=>{m&&ae(m.activityId,m.id,V)},[m]),l.useEffect(()=>{_(()=>{});const p=()=>{window.innerWidth<800?n(!0):n(!1)};return window.addEventListener("resize",p),p(),()=>window.removeEventListener("resize",p)},[]);function X(p){const j={weekday:"long",year:"numeric",month:"long",day:"numeric"};return p.toLocaleDateString("en-US",j)}function Y(p){const j=[];let S=new Date(0);return p.forEach(C=>{C.timeSent.toDateString()!=S.toDateString()&&(j.push({time:X(C.timeSent)}),S=C.timeSent),j.push(C)}),j}l.useEffect(()=>{a(!0),_(()=>{});const j=new URLSearchParams(window.location.search).get("activityId");j&&(g(j),U(j).then(C=>{C&&w(C.name)})),ce(j,N).then(()=>{oe().then(C=>{u(C)})});const S=localStorage.getItem("accountType");S&&M(S)},[]),l.useEffect(()=>{async function p(){if(Q||!d||d.length==0)return;a(!1);const j=new URLSearchParams(window.location.search),S=j.get("groupChatId");if(console.log(S),S){const R=d.find(y=>y.id==S);R&&c(R)}const C=j.get("studentId");if(console.log(C),C){const R=d.find(y=>y.id==C);if(R)c(R);else{const y=O.fromBlank(I.fullname,I.email,I.phoneNumber,I.FCMToken,I.uid),L=localStorage.getItem("viewingUser");if(L){const F=JSON.parse(L),ee=O.fromBlank(F.fullname,F.email,F.phoneNumber,F.FCMToken,F.uid);le(y,ee,f).then(B=>{console.log(B==null?void 0:B.toMap()),c(B),localStorage.removeItem("viewingUser")})}}}q(!0)}p()},[d]);function Z(p){const j=p.toLowerCase(),S=d.filter(C=>C.name.toLowerCase().includes(j));h(S)}l.useEffect(()=>{h(d)},[d]);async function $(p){if(!I||!m)return;const j=z.fromBlank(p,I.uid,I.fullname,I.FCMToken,m.id,f,"",new Date,[I.uid]);await H(f,m.id,j,k)}return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"title",children:s.jsx("h1",{children:"Messages"})}),s.jsxs("div",{className:"center",children:[s.jsxs("div",{className:"window",children:[(!i||i&&!m)&&s.jsxs("div",{className:"left",children:[s.jsx("div",{className:"search-div",children:s.jsx("input",{type:"text",className:"search-input",placeholder:"Enter group chat name...",onChange:p=>{Z(p.target.value)}})}),s.jsx("div",{className:"groupChats",children:r?s.jsx("div",{className:"loader"}):x.map(p=>s.jsx(Ie,{groupChat:p,onClick:()=>{c(p)}}))}),s.jsxs("div",{className:"GCOptions "+b,children:[s.jsx("button",{className:"ActionBtn",onClick:()=>{t.current.showModal()},children:"Create Group Chat"}),b=="teacher"&&s.jsx("button",{className:"ActionBtn",onClick:()=>{o.current.showModal()},children:"Broadcast Message"})]})]}),(!i||i&&m)&&s.jsx("div",{className:"right",children:m?s.jsxs("div",{className:"selectedGroupChat",children:[s.jsxs("div",{className:"back-div",children:[i&&s.jsx("img",{src:he,alt:"",onClick:()=>c(null)}),s.jsx("h2",{children:m.name})]}),s.jsx("div",{className:"messages",ref:e,children:Y(v).map(p=>Object.prototype.hasOwnProperty.call(p,"time")?s.jsx("div",{className:"timeSeparator",children:p.time}):s.jsx(pe,{message:p,isSender:p.senderUid==localStorage.getItem("userId")}))}),s.jsx(ge,{sendMessage:$})]}):s.jsx("div",{className:"noSelectedGroupChat",children:s.jsx("h1",{children:"No Group Chat Selected"})})})]}),s.jsx("br",{}),s.jsx("button",{className:"ActionBtn",onClick:()=>{window.location.href="/Activity/?activityId="+f},children:"Back"})]}),s.jsx(xe,{dialogRef:t,refresh:()=>{},close:()=>{t.current.close()},activityId:f}),s.jsx(je,{activityName:k,dialogRef:o,refresh:()=>{},close:()=>{o.current.close()},activityId:f,userData:I})]})}
