import{w as It,x as i,y as c,z as M,q as B,g as L,B as k,H as y,C as N,b as j,E as b,d as W,f as _,I as w,J as T,K as A,i as q,N as x,m as K,O as X,S as Z,T as yt,P as R,Q as vt,U as $,u as wt,r as E,V as at,W as ct,M as Y,s as C,X as St,p as G,Y as O,n as Dt,L as dt}from"./constants-hVZ3UUQ_.js";import{h as Tt,C as Mt,k as it,_ as At,d as tt,e as Ct,f as Et,F as kt,n as et,g as P}from"./index-DHlFav2G.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="type.googleapis.com/google.protobuf.Int64Value",bt="type.googleapis.com/google.protobuf.UInt64Value";function ft(e,t){const o={};for(const s in e)e.hasOwnProperty(s)&&(o[s]=t(e[s]));return o}function z(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>z(t));if(typeof e=="function"||typeof e=="object")return ft(e,t=>z(t));throw new Error("Data cannot be encoded in JSON: "+e)}function J(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Nt:case bt:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>J(t)):typeof e=="function"||typeof e=="object"?ft(e,t=>J(t)):e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends kt{constructor(t,o,s){super(`${ot}/${t}`,o||""),this.details=s}}function Ut(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Ft(e,t){let o=Ut(e),s=o,n;try{const a=t&&t.error;if(a){const r=a.status;if(typeof r=="string"){if(!rt[r])return new F("internal","internal");o=rt[r],s=r}const l=a.message;typeof l=="string"&&(s=l),n=a.details,n!==void 0&&(n=J(n))}}catch{}return o==="ok"?null:new F(o,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(t,o,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||t.get().then(n=>this.auth=n,()=>{}),this.messaging||o.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return t==null?void 0:t.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.appCheck){const o=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(t){const o=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(t);return{authToken:o,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q="us-central1";function Rt(e){let t=null;return{promise:new Promise((o,s)=>{t=setTimeout(()=>{s(new F("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class Pt{constructor(t,o,s,n,a=Q,r){this.app=t,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Lt(o,s,n),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=Q}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(t){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${o}.cloudfunctions.net/${t}`}}function Ot(e,t,o){e.emulatorOrigin=`http://${t}:${o}`}function _t(e,t,o){return s=>Gt(e,t,s,{})}async function xt(e,t,o,s){o["Content-Type"]="application/json";let n;try{n=await s(e,{method:"POST",body:JSON.stringify(t),headers:o})}catch{return{status:0,json:null}}let a=null;try{a=await n.json()}catch{}return{status:n.status,json:a}}function Gt(e,t,o,s){const n=e._url(t);return Bt(e,n,o,s)}async function Bt(e,t,o,s){o=z(o);const n={data:o},a={},r=await e.contextProvider.getContext(s.limitedUseAppCheckTokens);r.authToken&&(a.Authorization="Bearer "+r.authToken),r.messagingToken&&(a["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(a["X-Firebase-AppCheck"]=r.appCheckToken);const l=s.timeout||7e4,g=Rt(l),u=await Promise.race([xt(t,n,a,e.fetchImpl),g.promise,e.cancelAllRequests]);if(g.cancel(),!u)throw new F("cancelled","Firebase Functions instance was deleted.");const f=Ft(u.status,u.json);if(f)throw f;if(!u.json)throw new F("internal","Response is not valid JSON object.");let h=u.json.data;if(typeof h>"u"&&(h=u.json.result),typeof h>"u")throw new F("internal","Response is missing data field.");return{data:J(h)}}const lt="@firebase/functions",ut="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="auth-internal",Jt="app-check-internal",Ht="messaging-internal";function jt(e,t){const o=(s,{instanceIdentifier:n})=>{const a=s.getProvider("app").getImmediate(),r=s.getProvider($t),l=s.getProvider(Ht),g=s.getProvider(Jt);return new Pt(a,r,l,g,n,e)};Tt(new Mt(ot,o,"PUBLIC").setMultipleInstances(!0)),it(lt,ut,t),it(lt,ut,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(e=Et(),t=Q){const s=At(tt(e),ot).getImmediate({identifier:t}),n=Ct("functions");return n&&Vt(s,...n),s}function Vt(e,t,o){Ot(tt(e),t,o)}function st(e,t,o){return _t(tt(e),t)}jt(fetch.bind(self));const qt=ht(et);function U(e,t,o,s){st(qt,"sendEmail")({emails:t.map(n=>n.email),activityId:o.activityId,activityName:s,groupName:o.name,groupId:o.id,message:e.message,senderName:e.senderName})}const gt=ht(et),d=It(et),mt=i(d,"schools"),Kt=async e=>{const t=c(mt,e);return(await M(t)).data()},Wt=async()=>{const e=await w(mt),t=[];return e.forEach(o=>{t.push(o.data())}),t},Zt=async()=>{const e=localStorage.getItem("accountType"),t=localStorage.getItem("schoolId");if(!t)return[];const o=c(d,"schools",t);if(e=="student"){const s=T(i(o,"activities"),A("studentUids","array-contains",P())),n=[];return(await w(s)).forEach(r=>{n.push(L.fromMap(r.data()))}),n}else{const s=T(i(o,"activities"),A("teacherUids","array-contains",P())),n=[];return(await w(s)).forEach(r=>{console.log(r.data()),n.push(L.fromMap(r.data()))}),n}};async function Xt(e){const t=localStorage.getItem("schoolId");if(!t)return null;const o=c(d,"schools",t),s=c(i(o,"activities"),e),n=await M(s);return n.exists()?n.data().type=="theater"?B.fromMap(n.data()):L.fromMap(n.data()):null}async function te(e){const t=localStorage.getItem("schoolId");if(!t)return"";const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=i(s,"shows"),a=await k(n,e.toMap());return e.id=a.id,await y(a,{id:a.id}),a.id}async function ee(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=c(i(s,"shows"),e.id);await y(n,e.toMap())}async function oe(e){const t=i(d,"showTemplates"),o=await k(t,e.toMap());return e.id=o.id,await y(o,{id:o.id}),o.id}async function se(e){e.ensemble&&(e.ensemble.actors=[]);for(const o of e.layout)for(const s of o.scenes)for(const n of s.characters)if(n instanceof N)n.actor=null;else if(n instanceof j)for(const a of n.characters)a instanceof N?a.actor=null:a instanceof b&&(a.customActors=[]);else n instanceof b&&(n.customActors=[]);for(const o of e.songs)for(const s of o.characters)if(s instanceof N)s.actor=null;else if(s instanceof j)for(const n of s.characters)n instanceof N?n.actor=null:n instanceof b&&(n.customActors=[]);else s instanceof b&&(s.customActors=[]);for(const o of e.dances)for(const s of o.characters)if(s instanceof N)s.actor=null;else if(s instanceof j)for(const n of s.characters)n instanceof N?n.actor=null:n instanceof b&&(n.customActors=[]);else s instanceof b&&(s.customActors=[]);const t=c(i(d,"showTemplates"),e.id);await y(t,e.toMap())}async function ne(e,t){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),n=c(i(s,"activities"),e),a=c(i(n,"shows"),t),r=await M(a);return r.exists()?(console.log(r.data()),W.fromMap(r.data())):null}async function ae(e){const t=localStorage.getItem("schoolId");if(!t)return[];console.log("Getting actors for activity "+t);const o=c(d,"schools",t),s=c(i(o,"activities"),e),n=await M(s);if(!n.exists())return[];const a=[];return n.data().students.forEach(r=>{a.push(_.fromMap(r))}),a}async function ce(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t);await x(r,o.toMap())}async function ie(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=i(s,"events"),a=await k(n,e.toMap());e.id=a.id,await y(a,{id:a.id})}async function re(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(d,"schools",o),a=c(i(n,"activities"),e),r=i(a,"events");if(s=="student"){const l=await w(T(r,A("showId","==",t),A("targetUids","array-contains",P()))),g=[];return l.forEach(u=>{u.data().deleted||g.push(q.fromMap(u.data()))}),g}else{const l=await w(T(r,A("showId","==",t))),g=[];return l.forEach(u=>{u.data().deleted||g.push(q.fromMap(u.data()))}),g}}async function le(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=c(i(s,"events"),e.id);await y(n,{deleted:!0}),await st(gt,"startDeleteActivityEvent")({activityId:e.activityId,eventId:e.id,schoolId:t})}async function ue(e){const t=localStorage.getItem("schoolId");if(!t)return[];const o=c(d,"schools",t),s=c(i(o,"activities"),e),n=i(s,"shows"),a=await w(n),r=[];return a.forEach(l=>{r.push(W.fromMap(l.data()))}),r}async function de(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t);await y(r,{conflictForm:o.toMap()}),await st(gt,"addConflictFormDeadline")({activityId:e,showId:t,schoolId:s,deadline:o.deadline.toISOString()})}async function fe(){const e=await P(),t=localStorage.getItem("schoolId");if(!t)return null;const o=c(d,"schools",t),s=i(o,"students"),n=c(s,e),a=await M(n);return a.exists()?_.fromMap(a.data()):null}async function he(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t),l=c(r,"conflictResponses",o.actor.userId);o.id=o.actor.userId,await x(l,o.toMap())}async function ge(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("accountType");if(!o)return[];const n=c(d,"schools",o),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t),l=i(r,"conflictResponses");if(s=="student"){console.log("Getting conflict responses for student"),console.log(P());const f=await w(T(l,A("submitterId","==",P()))),h=[];return f.forEach(S=>{h.push(K.fromMap(S.data()))}),h}const g=await w(l),u=[];return g.forEach(f=>{u.push(K.fromMap(f.data()))}),u}async function me(){const e=i(d,"showTemplates"),t=await w(e),o=[];return t.forEach(s=>{o.push(W.fromMap(s.data()))}),o}async function pe(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(console.log("SC: "+t+" UID: "+o+" AT: "+s),!t||!o||!s)return null;const n=c(d,"schools",t),a=T(i(n,"activities"),A("joinCode","==",e)),r=await w(a);if(r.empty)return null;const l=r.docs[0],g=c(i(n,s=="student"?"students":"teachers"),o),u=await M(g);if(console.log(u.data()),!u.exists())return null;if(l.data().studentUids.includes(o)||l.data().teacherUids.includes(o))return localStorage.setItem("alreadyJoined","true"),null;if(localStorage.setItem("alreadyJoined","false"),l.data().type=="theater"){if((u.data().gender==null||u.data().gender=="")&&s=="student"&&(console.log("needsGender"),localStorage.setItem("needsGender","true")),u.data().phoneNumber==""&&s=="student"&&localStorage.setItem("needsPhoneNumber","true"),(u.data().phoneNumber==""||u.data().gender==null||u.data().gender=="")&&s=="student")return null;if(s=="student")return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,_.fromMap(u.data()).toMap()]}),B.fromMap(l.data());{console.log("Joining as teacher"),console.log(u.data());const f=$.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return console.log(f.toMap()),await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),B.fromMap(l.data())}}else if(s=="student"){const f=_.fromBlank(u.data().fullname,u.data().gender,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await y(l.ref,{studentUids:[...l.data().studentUids,o],students:[...l.data().students,f.toMap()]}),L.fromMap(l.data())}else{const f=$.fromBlank(u.data().fullname,u.data().email,u.data().phoneNumber,u.data().uid,u.data().FCMToken);return await y(l.ref,{teacherUids:[...l.data().teacherUids,o],teachers:[...l.data().teachers,f.toMap()]}),L.fromMap(l.data())}}async function Ie(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!t||!o||!s)return;const n=c(d,"schools",t),a=c(i(n,s=="student"?"students":"teachers"),o);await y(a,{gender:e})}async function ye(e){const t=localStorage.getItem("schoolId"),o=localStorage.getItem("userId"),s=localStorage.getItem("accountType");if(!t||!o||!s)return;const n=c(d,"schools",t),a=c(i(n,s=="student"?"students":"teachers"),o);await y(a,{phoneNumber:e})}async function ve(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=c(i(s,"events"),e.id);await y(n,e.toMap())}async function we(){const e=localStorage.getItem("schoolId"),t=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!e||!t)return[];const s=c(d,"schools",e),n=[];let a;o=="student"?a=await w(T(i(s,"activities"),A("studentUids","array-contains",t))):a=await w(T(i(s,"activities"),A("teacherUids","array-contains",t))),console.log(a);for(const r of a.docs){let l;o=="student"?l=await w(T(i(r.ref,"events"),A("targetUids","array-contains",t))):l=await w(i(r.ref,"events"));for(const g of l.docs){const u=g.data();console.log(u),u.type=="activity-theater-event"?n.push(q.fromMap(u)):n.push(wt.fromMap(u))}}return n}async function Se(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return null;const n=c(d,"schools",o),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t),l=i(r,"conflictResponses"),g=await M(c(l,s));return g.exists()?K.fromMap(g.data()):null}async function De(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),e);await y(n,{rehearsalLocations:t.map(a=>a.toMap())})}async function Te(e,t){const o=localStorage.getItem("schoolId"),s=localStorage.getItem("userId");if(!o||!s)return[];const n=localStorage.getItem("accountType"),a=c(d,"schools",o),r=c(i(a,"activities"),e);if(n=="teacher")X(i(r,"groupChats"),async l=>{const g=[];for(const u of l.docs){const f=E.fromMap(u.data());if((f.generalTarget=="direct"||f.generalTarget=="custom")&&!f.members.find(p=>p.userId==s))continue;if(f.generalTarget=="direct"){const p=f.members.find(m=>m.userId!=s);f.name=(p==null?void 0:p.name)||"Unknown"}const h=i(u.ref,"messages"),S=T(h,ct("timeSent","desc"),at(1)),I=await w(S);I.empty||(f.lastMessage=Y.fromMap(I.docs[0].data())),g.push(f)}g.sort((u,f)=>u.lastMessage?f.lastMessage?f.lastMessage.timeSent.getTime()-u.lastMessage.timeSent.getTime():-1:1),t(g)});else{const l=c(i(a,"students"),s),g=await M(l);if(!g.exists())return;const u=Z.fromMap(g.data());console.log(u),X(i(r,"groupChats"),async f=>{const h=[];for(const S of f.docs){const I=E.fromMap(S.data());if(!(I.generalTarget=="everyone"||I.generalTarget=="students")&&(I.generalTarget=="parents"||!I.members.find(D=>D.userId==s)))continue;if(I.generalTarget=="direct"){const D=I.members.find(H=>H.userId!=s);I.name=(D==null?void 0:D.name)||"Unknown"}const p=i(S.ref,"messages"),m=T(p,ct("timeSent","desc"),at(1)),v=await w(m);v.empty||(I.lastMessage=Y.fromMap(v.docs[0].data())),h.push(I)}h.sort((S,I)=>S.lastMessage?I.lastMessage?I.lastMessage.timeSent.getTime()-S.lastMessage.timeSent.getTime():-1:1),t(h)})}}async function Me(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return[];const n=c(d,"schools",s),a=c(i(n,"activities"),e);console.log("Getting messages for "+t);const r=c(i(a,"groupChats"),t),l=i(r,"messages");X(l,g=>{const u=[];g.forEach(f=>{u.push(Y.fromMap(f.data()))}),u.sort((f,h)=>f.timeSent.getTime()-h.timeSent.getTime()),o(u)})}async function nt(){const e=localStorage.getItem("schoolId"),t=localStorage.getItem("userId"),o=localStorage.getItem("accountType");if(!e||!t)return null;const s=c(d,"schools",e),n=c(i(s,o=="student"?"students":"teachers"),t),a=await M(n);return a.exists()?o=="student"?Z.fromMap(a.data()):yt.fromMap(a.data()):null}async function Ae(e,t,o,s,n){if(o.message=="")return;const a=localStorage.getItem("schoolId"),r=localStorage.getItem("userId");if(!a||!r)return;const l=c(d,"schools",a),g=c(i(l,"activities"),e),u=c(i(g,"groupChats"),t),f=await M(u);if(!f.exists()){if(n==null)return;const p=await nt();if(!p)return;const m=E.fromBlank("",n.userId,[C.fromBlank(p.fullname,p.email,p.phoneNumber,p.FCMToken,p.uid),n],"direct",e,Date.now());await x(u,m.toMap());const v=i(u,"messages"),D=await k(v,o.toMap());o.messageId=D.id,await y(D,{messageId:D.id}),U(o,[C.fromMap(n)],m,s);return}const h=E.fromMap(f.data()),S=i(u,"messages"),I=await k(S,o.toMap());if(o.messageId=I.id,await y(I,{messageId:I.id}),h.generalTarget!="direct"&&h.generalTarget!="custom"&&h.generalTarget!="group"){const p=await Xt(e);if(!p)return;if(h.generalTarget=="everyone"){let m=p.students.map(v=>C.fromMap(v));m=m.concat(p.teachers.map(v=>C.fromMap(v))),m=m.concat(p.parents.map(v=>C.fromMap(v))),m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}else if(h.generalTarget=="students"){let m=p.students.map(v=>C.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}else if(h.generalTarget=="parents"){let m=p.parents.map(v=>C.fromMap(v));m=m.filter(v=>v.userId!=o.senderUid),U(o,m,h,p.name)}return}if(h.generalTarget=="direct"){const p=h.members.find(m=>m.userId!=r);if(!p)return;U(o,[p],h,s);return}if(h.generalTarget=="custom"){U(o,h.members.filter(p=>p.userId!=r),h,s);return}}async function V(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t),s=c(i(o,"activities"),e.activityId),n=i(s,"groupChats"),a=await nt();if(!a)return;const r=C.fromBlank(a.fullname,a.email,a.phoneNumber,a.FCMToken,a.uid);e.members.push(r);const l=await k(n,e.toMap());e.id=l.id,await y(l,{id:l.id})}async function Ce(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t);y(r,{resources:R(o.toMap())})}async function Ee(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t);y(r,{resources:St(o.toMap())})}async function ke(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return;const n=c(d,"schools",s),a=c(i(n,"activities"),e),r=c(i(a,"shows"),t),l=i(r,"conflictResponses"),g=c(l,o.id);await vt(g)}async function Ne(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=i(s,e+"s");await x(c(n,t.uid),t.toMap());let a;t instanceof Z?a=_.fromBlank(t.fullname,t.gender,t.email,t.phoneNumber,t.FCMToken,t.uid):a=$.fromBlank(t.fullname,t.email,t.phoneNumber,t.FCMToken,t.uid),await y(s,{[e+"Uids"]:R(t.uid),[e+"s"]:R(a.toMap())})}function Yt(e){const t=new Date,o=t.getTime().toString();return`${e.charCodeAt(0)}${t.getDate()}${o.slice(-2)}`}async function be(e,t){const o=localStorage.getItem("schoolId");if(!o)return null;const s=c(d,"schools",o),n=await M(s);if(!n.exists())return null;const a=n.data(),r=i(s,"activities"),l=Yt(e),g=[G.fromMap({name:"Rehearsal",color:O("#FF0000")}),G.fromMap({name:"Performance",color:O("#00FF00")})],u=[G.fromMap({name:"Practice",color:O("#FF0000")}),G.fromMap({name:"Game",color:O("#00FF00")})],f=[Dt.fromMap({name:"Auditorium",color:O("#0000FF")})],h=dt.fromMap(a.location),S=[h],I=await nt();if(!I)return null;const p=$.fromBlank(I.fullname,I.email,I.phoneNumber,I.FCMToken,I.uid);let m;t=="theater"?m=B.fromBlank(e,"",l,[],[],[],[p],S,g,h,f,"type",Date.now()):m=L.fromBlank(e,"",l,[],[],[],[p],S,u,h,"type",Date.now(),"activity");const v=await k(r,m.toMap());m.id=v.id,await y(v,{id:v.id});const D=E.fromMap({name:"Everyone",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"everyone"});await V(D);const H=E.fromMap({name:"Parents",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"parents"});await V(H);const pt=E.fromMap({name:"Students",members:[],id:"",activityId:m.id,lastUpdated:Date.now(),generalTarget:"students"});return await V(pt),m}async function Ue(e,t,o){const s=localStorage.getItem("schoolId");if(!s)return null;const n=c(d,"schools",s),a=c(i(n,"activities"),o),r=i(a,"groupChats"),l=E.fromBlank("",t.userId,[e,t],"direct",o,Date.now());return await x(c(r,t.userId),l.toMap()),l.name=t.name,l}async function Fe(){const e=await Kt(localStorage.getItem("schoolId")||"");if(!e)return[];const t=[];return e.savedLocations.forEach(o=>{t.push(dt.fromMap(o))}),t}async function Le(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),e);await y(n,{locations:R(t.toMap())})}async function Re(e){const t=localStorage.getItem("schoolId");if(!t)return;const o=c(d,"schools",t);await y(o,{savedLocations:R(e.toMap())})}async function Pe(e,t){const o=localStorage.getItem("schoolId");if(!o)return;const s=c(d,"schools",o),n=c(i(s,"activities"),e);await y(n,{eventTypes:R(t.toMap())})}export{we as A,Se as B,De as C,Le as D,Re as E,Pe as F,Fe as G,V as H,Ae as I,Me as J,Te as K,nt as L,Ue as M,Ce as N,Ee as O,Ie as a,be as b,Ne as c,Zt as d,Xt as e,ue as f,Wt as g,me as h,te as i,pe as j,oe as k,se as l,ee as m,ne as n,ae as o,ge as p,re as q,le as r,ce as s,ve as t,ye as u,ie as v,de as w,ke as x,fe as y,he as z};
